//##############################################################################
// CHANGEFORM
/* global CMS, URLify, gettext */

(function ($) {
    'use strict';
    // CMS.$ will be passed for $
    $(document).ready(function () {

        // set local variables
        var title = $('#id_title');
        var slug = $('#id_slug');
        var changed = false;
        var prefill = false;

        // hide rows when hidden input fields are added
        $('input[type="hidden"]').each(function () {
            $(this).parent('.form-row').hide();
        });

        // determine if slug is empty
        if (slug.val() === '') {
            prefill = true;
        }

        // always bind the title > slug generation and do the validation inside for better ux
        title.bind('keyup', function () {
            var value = title.val();
            // international language handling
            if (window.UNIHANDECODER) {
                value = window.UNIHANDECODER.decode(value);
            }
            // if slug is empty, prefill again
            if (prefill === false && slug.val() === '') {
                prefill = true;
            }
            // urlify
            // jshint newcap: false
            var urlified = URLify(value, 64);
            // jshint newcap: true
            if (prefill) {
                slug.val(urlified);
            }
        });
        // autocall
        title.trigger('keyup');

        // set focus to title
        title.focus();

        // all permissions and page states loader
        $('div.loading').each(function () {
            $(this).load($(this).attr('rel'));
        });

        // add changed data bindings to elements
        slug.add(title).bind('change', function () {
            $(this).data('changed', true);
        });

        // public api for changing the language tabs
        // used in admin/cms/page/change_form.html
        CMS.API.changeLanguage = function (url) {
            // also make sure that we will display the confirm dialog
            // in case users switch tabs while editing plugins
            var answer = true;
            if (slug.length) {
                // check if the slug has the changed attribute
                if (slug.data('changed') || title.data('changed')) {
                    changed = true;
                }
            }

            if (changed) {
                var question = gettext('Are you sure you want to change tabs without saving the page first?');
                answer = confirm(question);
            }
            if (answer) {
                window.location.href = url;
            }
        };

    });
})(CMS.$);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNtcy5jaGFuZ2Vmb3JtLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImJ1bmRsZS5hZG1pbi5jaGFuZ2Vmb3JtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBDSEFOR0VGT1JNXG4vKiBnbG9iYWwgQ01TLCBVUkxpZnksIGdldHRleHQgKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8vIENNUy4kIHdpbGwgYmUgcGFzc2VkIGZvciAkXG4gICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIC8vIHNldCBsb2NhbCB2YXJpYWJsZXNcbiAgICAgICAgdmFyIHRpdGxlID0gJCgnI2lkX3RpdGxlJyk7XG4gICAgICAgIHZhciBzbHVnID0gJCgnI2lkX3NsdWcnKTtcbiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIHByZWZpbGwgPSBmYWxzZTtcblxuICAgICAgICAvLyBoaWRlIHJvd3Mgd2hlbiBoaWRkZW4gaW5wdXQgZmllbGRzIGFyZSBhZGRlZFxuICAgICAgICAkKCdpbnB1dFt0eXBlPVwiaGlkZGVuXCJdJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnLmZvcm0tcm93JykuaGlkZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkZXRlcm1pbmUgaWYgc2x1ZyBpcyBlbXB0eVxuICAgICAgICBpZiAoc2x1Zy52YWwoKSA9PT0gJycpIHtcbiAgICAgICAgICAgIHByZWZpbGwgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWx3YXlzIGJpbmQgdGhlIHRpdGxlID4gc2x1ZyBnZW5lcmF0aW9uIGFuZCBkbyB0aGUgdmFsaWRhdGlvbiBpbnNpZGUgZm9yIGJldHRlciB1eFxuICAgICAgICB0aXRsZS5iaW5kKCdrZXl1cCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRpdGxlLnZhbCgpO1xuICAgICAgICAgICAgLy8gaW50ZXJuYXRpb25hbCBsYW5ndWFnZSBoYW5kbGluZ1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5VTklIQU5ERUNPREVSKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB3aW5kb3cuVU5JSEFOREVDT0RFUi5kZWNvZGUodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaWYgc2x1ZyBpcyBlbXB0eSwgcHJlZmlsbCBhZ2FpblxuICAgICAgICAgICAgaWYgKHByZWZpbGwgPT09IGZhbHNlICYmIHNsdWcudmFsKCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcHJlZmlsbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB1cmxpZnlcbiAgICAgICAgICAgIC8vIGpzaGludCBuZXdjYXA6IGZhbHNlXG4gICAgICAgICAgICB2YXIgdXJsaWZpZWQgPSBVUkxpZnkodmFsdWUsIDY0KTtcbiAgICAgICAgICAgIC8vIGpzaGludCBuZXdjYXA6IHRydWVcbiAgICAgICAgICAgIGlmIChwcmVmaWxsKSB7XG4gICAgICAgICAgICAgICAgc2x1Zy52YWwodXJsaWZpZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gYXV0b2NhbGxcbiAgICAgICAgdGl0bGUudHJpZ2dlcigna2V5dXAnKTtcblxuICAgICAgICAvLyBzZXQgZm9jdXMgdG8gdGl0bGVcbiAgICAgICAgdGl0bGUuZm9jdXMoKTtcblxuICAgICAgICAvLyBhbGwgcGVybWlzc2lvbnMgYW5kIHBhZ2Ugc3RhdGVzIGxvYWRlclxuICAgICAgICAkKCdkaXYubG9hZGluZycpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5sb2FkKCQodGhpcykuYXR0cigncmVsJykpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhZGQgY2hhbmdlZCBkYXRhIGJpbmRpbmdzIHRvIGVsZW1lbnRzXG4gICAgICAgIHNsdWcuYWRkKHRpdGxlKS5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ2NoYW5nZWQnLCB0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHVibGljIGFwaSBmb3IgY2hhbmdpbmcgdGhlIGxhbmd1YWdlIHRhYnNcbiAgICAgICAgLy8gdXNlZCBpbiBhZG1pbi9jbXMvcGFnZS9jaGFuZ2VfZm9ybS5odG1sXG4gICAgICAgIENNUy5BUEkuY2hhbmdlTGFuZ3VhZ2UgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICAvLyBhbHNvIG1ha2Ugc3VyZSB0aGF0IHdlIHdpbGwgZGlzcGxheSB0aGUgY29uZmlybSBkaWFsb2dcbiAgICAgICAgICAgIC8vIGluIGNhc2UgdXNlcnMgc3dpdGNoIHRhYnMgd2hpbGUgZWRpdGluZyBwbHVnaW5zXG4gICAgICAgICAgICB2YXIgYW5zd2VyID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChzbHVnLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBzbHVnIGhhcyB0aGUgY2hhbmdlZCBhdHRyaWJ1dGVcbiAgICAgICAgICAgICAgICBpZiAoc2x1Zy5kYXRhKCdjaGFuZ2VkJykgfHwgdGl0bGUuZGF0YSgnY2hhbmdlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXR0ZXh0KCdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2hhbmdlIHRhYnMgd2l0aG91dCBzYXZpbmcgdGhlIHBhZ2UgZmlyc3Q/Jyk7XG4gICAgICAgICAgICAgICAgYW5zd2VyID0gY29uZmlybShxdWVzdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKENNUy4kKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==