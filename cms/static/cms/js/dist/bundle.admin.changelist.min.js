/*! jQuery UI - v1.11.4 - 2015-11-13
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, sortable.js, effect.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])
},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}});var o="ui-effects-",r=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(r),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(r.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(o+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(o+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects});

//##############################################################################
// CHANGELIST
/* global CMS, tree_component */

(function ($) {
    'use strict';
    // CMS.$ will be passed for $
    $(document).ready(function () {

        /*!
         * TreeManager
         * Handles treeview
         * TODO this will be refactored in 3.2
         */
        CMS.TreeManager = new CMS.Class({

            options: {
                'lang': {}
            },

            initialize: function (options) {
                this.options = $.extend(true, {}, this.options, options);

                this.setupFunctions();
                this.setupTreePublishing();
                this.setupInfoTooltip();
                this.setupUIHacks();

                // load internal functions
                if (!this.options.settings.filtered) {
                    this.setupGlobals();
                    this.setupTree();

                    // init tree component
                    window.initTree();
                } else {
                    // when filtered is active, prevent tree actions
                    $.syncCols();
                }
            },

            setupFunctions: function () {
                var that = this;

                $.syncCols = function () {
                    $('#sitemap .col-softroot').syncWidth(0);
                    $('#sitemap .col-apphook').syncWidth(0);
                    $('#sitemap .col-language').syncWidth(0);
                    $('#sitemap .col-navigation').syncWidth(0);
                    $('#sitemap .col-actions').syncWidth(0);
                    $('#sitemap .col-info').syncWidth(0);

                    that.refreshColumns.call($('ul.tree-default li'));
                };

                /* Colums width sync */
                $.fn.syncWidth = function (max) {
                    var visible = false;

                    $(this).each(function () {
                        if ($(this).is(':visible')) {
                            visible = true;
                            var val = $(this).width();
                            if (val > max) {
                                max = val;
                            }
                        }
                    });
                    if (visible && max > 0) {
                        $(this).each(function () {
                            $(this).css('width', max);
                        });
                    }
                };

                // jquery.functional
                $.curry = function (fn) {
                    if (arguments.length < 2) {
                        return fn;
                    }
                    var args = $.makeArray(arguments).slice(1, arguments.length);
                    return function () {
                        return fn.apply(this, args.concat($.makeArray(arguments)));
                    };
                };

                $.__callbackPool = {};

                $.callbackRegister = function (name, fn /*, arg0, arg1, ..*/) {
                    if (arguments.length > 2) {
                        // create curried function
                        fn = $.curry.apply(this, $.makeArray(arguments).slice(1, arguments.length));
                    }
                    $.__callbackPool[name] = fn;
                    return name;
                };

                $.callbackCall = function (name/*, extra arg0, extra arg1, ..*/) {
                    if (!name || !(name in $.__callbackPool)) {
                        throw 'No callback registered with name: ' + name;
                    }
                    $.__callbackPool[name].apply(this, $.makeArray(arguments).slice(1, arguments.length));
                    $.callbackRemove(name);
                    return name;
                };

                $.callbackRemove = function (name) {
                    delete $.__callbackPool[name];
                };

                // very simple yellow fade plugin..
                $.fn.yft = function () {
                    this.effect('highlight', {}, 1000);
                };

                // jquery replace plugin :)
                $.fn.replace = function (o) {
                    return this.after(o).remove().end();
                };

            },

            setupInfoTooltip: function () {
                var tree = $('.tree');
                var infoTrigger = '.col-info .info';
                var infoTooltips = '.info-details';
                var infoTimer = function () {};
                var infoDelay = 100;
                // workaround for the info tooltip on touch devices
                var touchUsedInfoTooltip;

                tree.delegate(infoTrigger, 'pointerover touchstart', function (e) {
                    var tooltip = $(this).closest('.col-info').find('.info-details');

                    // clear timer
                    clearTimeout(infoTimer);

                    // cancel if tooltip already visible
                    if (tooltip.is(':visible') && !touchUsedInfoTooltip) {
                        return false;
                    }

                    $(infoTooltips).hide();
                    $(infoTrigger).removeClass('hover');
                    $('.moveable').removeClass('hover');

                    if (e.type === 'touchstart') {
                        e.preventDefault();
                        var target = $(e.target).closest(infoTrigger);
                        touchUsedInfoTooltip = touchUsedInfoTooltip && touchUsedInfoTooltip.is(target) ? false : target;
                        if (touchUsedInfoTooltip) {
                            return;
                        }
                    }

                    infoTimer = setTimeout(function () {
                        tooltip.show();
                        $(infoTrigger).addClass('hover');
                        tooltip.closest('.moveable').addClass('hover');
                    }, infoDelay);

                });
                // hide the tooltip when leaving the area
                tree.delegate(infoTrigger, 'pointerout', function () {
                    if (touchUsedInfoTooltip) {
                        return;
                    }

                    // clear timer
                    clearTimeout(infoTimer);
                    // hide all elements
                    infoTimer = setTimeout(function () {
                        $(infoTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }, infoDelay * 2);
                });
                // reset hiding when entering the tooltip itself
                tree.delegate(infoTooltips, 'pointerover', function () {
                    // clear timer
                    clearTimeout(infoTimer);
                });
                tree.delegate(infoTooltips, 'pointerout', function () {
                    // hide all elements
                    infoTimer = setTimeout(function () {
                        $(infoTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }, infoDelay * 2);
                });
                $('html').on('touchend', function (e) {
                    if (!$(e.target).hasClass('info')) {
                        $(infoTooltips).hide();
                        $(infoTrigger).removeClass('hover');
                        $('.moveable').removeClass('hover');
                    }
                });
            },

            setupTreePublishing: function () {
                // ADD DIRECT PUBLISHING
                var that = this;
                var tree = $('.tree');
                var langTrigger = '.col-language .trigger-tooltip';
                var langTooltips = '.language-tooltip';
                var langTimer = function () {};
                var langDelay = 100;
                // workaround for the publishing tooltip on touch devices
                var touchUsedNode;

                // show the tooltip
                tree.delegate(langTrigger, 'pointerover touchstart', function (e) {
                    var el = $(this).closest('.col-language').find('.language-tooltip');

                    // clear timer
                    clearTimeout(langTimer);

                    // cancel if tooltip already visible
                    if (el.is(':visible') && !touchUsedNode) {
                        return false;
                    }

                    // set correct position
                    el.css('right', 32 + $(this).position().left);

                    // hide all elements
                    $(langTooltips).hide();
                    $('.moveable').removeClass('hover');

                    if (e.type === 'touchstart') {
                        e.preventDefault();
                        var target = $(e.target).closest(langTrigger);
                        touchUsedNode = touchUsedNode && touchUsedNode.is(target) ? false : target;
                        if (touchUsedNode) {
                            return;
                        }
                    }

                    // use a timeout to display the tooltip
                    langTimer = setTimeout(function () {
                        el.closest('.moveable').addClass('hover');
                        el.show();
                    }, langDelay);
                });
                // hide the tooltip when leaving the area
                tree.delegate(langTrigger, 'pointerout', function () {
                    if (touchUsedNode) {
                        return;
                    }

                    // clear timer
                    clearTimeout(langTimer);
                    // hide all elements
                    langTimer = setTimeout(function () {
                        $(langTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }, langDelay * 2);
                });
                // reset hiding when entering the tooltip itself
                tree.delegate(langTooltips, 'pointerover', function () {
                    // clear timer
                    clearTimeout(langTimer);
                });
                tree.delegate(langTooltips, 'pointerout', function () {
                    // hide all elements
                    langTimer = setTimeout(function () {
                        $(langTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }, langDelay * 2);
                });
                // attach double check event if publish or unpublish should be triggered
                tree.delegate('.language-tooltip a', 'click touchstart', function (e) {
                    e.preventDefault();

                    // cancel if not confirmed
                    if (!CMS.API.Helpers.secureConfirm(that.options.lang.publish
                        .replace('§', $(this).text().toLowerCase()))) {
                        return false;
                    }

                    // send post request to prevent xss attacks
                    $.ajax({
                        type: 'post',
                        url: $(this).prop('href'),
                        success: function () {
                            CMS.API.Helpers.reloadBrowser();
                        },
                        error: function (request) {
                            throw new Error(request);
                        }
                    });
                });
                $('html').on('touchend', function (e) {
                    if (!$(e.target).hasClass('unpublished') ||
                        !$(e.target).hasClass('published') ||
                        !$(e.target).hasClass('dirty')) {
                        $(langTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }
                });
            },

            setupUIHacks: function () {
                // adds functionality to the filter
                $('#changelist-filter-button').bind('click', function () {
                    $('#changelist-filter').toggle();
                });

                // set correct active entry
                if (window.parent && window.parent.CMS && window.parent.CMS.config) {
                    var page_id = window.parent.CMS.config.request.page_id;

                    $('div[data-page_id="' + page_id + '"]').addClass('cont-active');
                }
            },

            setupGlobals: function () {
                var that = this;
                var msg = '';
                var parent = null;

                window.moveSuccess = function (node) {
                    $.syncCols();

                    msg = $('<span class="success">' + that.options.lang.success + '</span>');
                    parent = window.parent;

                    node.after(msg);
                    node.parent().find('.col2').hide();
                    msg.fadeOut(1000, function () {
                        node.parent().find('.col2').show();
                    });
                    // check for reload changes
                    if (window.self !== window.top) {
                        window.parent.CMS.API.Helpers.reloadBrowser(false, false, true);
                        window.parent.CMS.API.Messages.open({
                            message: that.options.lang.changes,
                            delay: 0
                        });
                    }
                };

                window.moveError = function (node, message) {
                    if (message && message !== 'error') {
                        msg = $('<span class="success">' + message + '</span>');
                    } else {
                        msg = $('<span class="success">' + that.options.lang.error + '</span>');
                    }
                    node.parent().find('.col2').hide();
                    node.after(msg);
                };

            },

            setupTree: function () {
                var that = this;
                var tree;
                var origin = window.location.protocol + '//' + window.location.hostname +
                    (window.location.port ? ':' + window.location.port : '');
                // global initTree function
                window.initTree = function () {
                    // jshint newcap: false
                    // jscs:disable requireCapitalizedConstructors
                    tree = new tree_component();
                    // jscs:enable requireCapitalizedConstructors
                    // jshint newcap: true
                    var options = {
                        rules: {
                            clickable: 'all',
                            renameable: 'none',
                            deletable: 'all',
                            creatable: 'all',
                            draggable: 'all',
                            dragrules: 'all',
                            droppable: 'all',
                            metadata : 'mdata',
                            use_inline: true
                            //droppable : ['tree_drop']
                        },
                        // has to be absolute full path
                        path: origin + that.options.settings.staticPath + 'cms/js/jstree/',
                        ui: {
                            dots: true,
                            rtl: false,
                            animation: 0,
                            hover_mode: true,
                            //theme_path: script_url_path() + '/../jstree/themes/',
                            a_class: 'title',
                            context: false
                        },
                        cookies : {
                            prefix: 'djangocms_nodes'
                        },
                        callback: {
                            beforemove  : function (what, where, position) {
                                window.item_id = what.id.split('page_')[1];
                                window.target_id = where.id.split('page_')[1];
                                window.old_node = what;

                                if ($(what).parent().children('li').length > 1) {
                                    if ($(what).next('li').length) {
                                        window.old_target = $(what).next('li')[0];
                                        window.old_position = 'right';
                                    }
                                    if ($(what).prev('li').length) {
                                        window.old_target = $(what).prev('li')[0];
                                        window.old_position = 'left';
                                    }
                                } else {
                                    if ($(what).attr('rel') !== 'topnode') {
                                        window.old_target = $(what).parent().parent()[0];
                                        window.old_position = 'inside';
                                    }
                                }

                                addUndo(what, where, position);
                                return true;
                            },
                            onmove: function (what, where, position) {
                                window.item_id = what.id.split('page_')[1];
                                window.target_id = where.id.split('page_')[1];

                                if (position === 'before') {
                                    position = 'left';
                                } else if (position === 'after') {
                                    position = 'right';
                                } else if (position === 'inside') {
                                    position = 'last-child';
                                }
                                moveTreeItem(what, window.item_id, window.target_id, position, false);
                            },

                            onload: function () {
                                setTimeout(function () {
                                    reCalc();
                                }, 250);
                            }

                        }
                    };

                    if (!$($('div.tree').get(0)).hasClass('root_allow_children')) {
                        // disalow possibility for adding subnodes to main tree, user doesn't
                        // have permissions for this
                        options.rules.dragrules = ['node inside topnode', 'topnode inside topnode', 'node * node'];
                    }

                    tree.init($('div.tree'), options);
                };

                window.selected_page = false;
                action = false;

                var _oldAjax = $.ajax;

                $.ajax = function (s) {
                    // just override ajax function, so the loader message gets displayed
                    // always
                    $('#loader-message').show();

                    var callback = s.success || false;
                    s.success = function (data, status) {
                        if (callback) {
                            callback(data, status);
                        }
                        $('#loader-message').hide();
                    };

                    // just for debuging!!
                    /*s.complete = function (xhr, status) {
                        if (status == 'error' && that.options.settings.debug) {
                            $('body').before(xhr.responseText);
                        }
                    }*/
                    // end just for debuging

                    // TODO: add error state!
                    return _oldAjax(s);
                };

                // // defined but never used
                // function refresh() {
                //     window.location = window.location.href;
                // }

                // // defined but never used
                // function refreshIfChildren(pageId) {
                //     return $('#page_' + pageId).find('li[id^=page_]').length ?
                //     refresh :
                //     function () { return true; };
                // }

                /**
                 * Loads remote dialog to dialogs div.
                 *
                 * @param {String} url
                 * @param {Object} data Data to be send over post
                 * @param {Function} noDialogCallback Gets called when response is empty.
                 * @param {Function} callback Standard callback function.
                 */
                function loadDialog(url, data, noDialogCallback, callback) {
                    if (data === undefined) {
                        data = {};
                    }
                    $.post(url, data, function (response) {
                        if (response === '' && noDialogCallback) {
                            noDialogCallback();
                        }
                        $('#dialogs').empty().append(response);
                        if (callback) {
                            callback(response);
                        }
                    });
                }

                function mark_copy_node(id) {
                    $('a.move-target, span.move-target-container, span.line').show();
                    $('#page_' + id).addClass('selected');
                    $('#page_' + id).parent().parent()
                        .children('div.cont').find('a.move-target.first-child, span.second').hide();
                    $('#page_' + id).parent().parent()
                        .children('ul').children('li').children('div.cont')
                        .find('a.move-target.left, a.move-target.right, span.first, span.second').hide();
                    return 'copy';
                }


                // let's start event delegation
                $('#changelist li').on('click', function (e) {
                    // I want a link to check the class
                    if (e.target.tagName === 'IMG' || e.target.tagName === 'SPAN') {
                        window.target = e.target.parentNode;
                    } else {
                        window.target = e.target;
                    }
                    var jtarget = $(window.target);
                    var id;
                    var page_id;
                    if (jtarget.hasClass('move')) {
                        // prepare tree for move / cut paste
                        id = e.target.id.split('move-link-')[1];
                        if (!id) {
                            id = e.target.parentNode.id.split('move-link-')[1];
                        }
                        page_id = id;
                        window.selected_page = page_id;
                        action = 'move';
                        $('span.move-target-container, span.line, a.move-target').show();
                        $('#page_' + page_id).addClass('selected');
                        $('#page_' + page_id + ' span.move-target-container').hide();
                        e.stopPropagation();
                        return false;
                    }

                    if (jtarget.hasClass('copy')) {
                        // prepare tree for copy
                        id = e.target.id.split('copy-link-')[1];
                        if (!id) {
                            id = e.target.parentNode.id.split('copy-link-')[1];
                        }
                        window.selected_page = id;
                        action = mark_copy_node(id);
                        e.stopPropagation();
                        return false;
                    }

                    if (jtarget.hasClass('viewpage')) {
                        var view_page_url = $('#' + window.target.id + '-select').val();
                        if (view_page_url) {
                            window.open(view_page_url);
                        }
                    }

                    if (jtarget.hasClass('addlink')) {
                        if (!/#$/g.test(jtarget.attr('href'))) {
                            // if there is url instead of # inside href, follow this url
                            // used if user haves add_page
                            return true;
                        }

                        $('tr').removeClass('target');
                        $('#changelist table').removeClass('table-selected');
                        page_id = window.target.id.split('add-link-')[1];
                        window.selected_page = page_id;
                        action = 'add';
                        $('tr').removeClass('selected');
                        $('#page-row-' + page_id).addClass('selected');
                        $('.move-target-container').hide();
                        $('a.move-target, span.line, #move-target-' + page_id).show();
                        e.stopPropagation();
                        return false;
                    }

                    // don't assume admin site is root-level
                    // grab base url to construct full absolute URLs
                    window.admin_base_url = document.URL.split('/cms/page/')[0] + '/';

                    var pageId;
                    var language;
                    // in navigation
                    if (jtarget.hasClass('navigation-checkbox')) {
                        e.stopPropagation();

                        pageId = jtarget.attr('name').split('navigation-')[1];
                        language = jtarget.closest('.cont').find('a[lang]').attr('lang') || '';

                        // if I don't put data in the post, django doesn't get it
                        reloadItem(
                            jtarget,
                            window.admin_base_url + 'cms/page/' + pageId + '/change-navigation/?language=' + language,
                            { 1: 1 }
                        );
                    }

                    // lazy load descendants on tree open
                    if (jtarget.hasClass('closed')) {
                        // only load them once
                        if (jtarget.find('ul > li').length === 0 && !jtarget.hasClass('loading')) {
                            // keeps this event from firing multiple times before
                            // the dom as changed. it still needs to propagate for
                            // the other click event on this element to fire
                            jtarget.addClass('loading');
                            pageId = $(jtarget).attr('id').split('page_')[1];
                            language = $(jtarget)
                                .children('div.cont')
                                .children('div.col1')
                                .children('.title').attr('lang');
                            $.get(
                                window.admin_base_url + 'cms/page/' + pageId + '/' + language + '/descendants/',
                                {},
                                function (r) {
                                    jtarget.children('ul').append(r);
                                    // show move targets if needed
                                    if ($('span.move-target-container:visible').length > 0) {
                                        jtarget.children('ul')
                                            .find('a.move-target, span.move-target-container, span.line')
                                            .show();
                                    }
                                    reCalc();
                                }
                            );
                        } else {
                            reCalc();
                        }
                    }

                    if (jtarget.hasClass('move-target')) {
                        if (jtarget.hasClass('left')) {
                            window.position = 'left';
                        }
                        if (jtarget.hasClass('right')) {
                            window.position = 'right';
                        }
                        if (jtarget.hasClass('last-child')) {
                            window.position = 'last-child';
                        }
                        window.target_id = window.target.parentNode.id.split('move-target-')[1];

                        if (action === 'move') {
                            moveTreeItem(null, window.selected_page, window.target_id, window.position, tree);
                            $('.move-target-container').hide();
                        } else if (action === 'copy') {
                            window.site = $('#site-select')[0].value;
                            copyTreeItem(window.selected_page, window.target_id, window.position, window.site);
                            $('.move-target-container').hide();
                        } else if (action === 'add') {
                            window.site = $('#site-select')[0].value;
                            window.location.href = window.location.href.split('?')[0].split('#')[0] +
                                'add/?target=' + window.target_id + '&amp;position=' + window.position +
                                '&amp;site=' + window.site;
                        }
                        e.stopPropagation();
                        return false;
                    }
                    return true;
                });
                $('div#sitemap').show();

                function reCalc() {
                    $.syncCols();
                }

                $(window).bind('resize', reCalc);
                /* Site Selector */
                $('#site-select').change(function () {
                    var form = $(this).closest('form');
                    // add correct value for copy
                    if (action === 'copy') {
                        $('#site-copy').val(window.selected_page);
                    }
                    // submit form
                    form.submit();
                });

                //
                // If an A element has a data-attribute 'alt-class'. At this time,
                // this is only the edit button in the page-tree, but could be
                // more in future. It is important that the CSS be written in such
                // a manner that the alt-class is defined after the normal class,
                // so that it can be overridden when the alt-key is depressed.
                //
                // NOTE: This 'preview' part of the 'alt-click to [alternative
                // function]' feature may not work in some environments (Windows
                // in a some virtual machine environments, notably), but is only a
                // nice-'extra', not a requirement for the feature.
                //
                $(document).on('keydown keyup', function (evt) {
                    if (evt.which === 18) {
                        $('a[data-alt-class]').each(function () {
                            var self = $(this);
                            self.toggleClass(self.data('alt-class'), evt.type === 'keydown');
                        });
                    }
                });

                //
                // If the A-element has a data-attribute 'alt-href', then this
                // click-handler uses that instead of the normal href attribute as
                // the click-destination. Again, currently this is only on the
                // edit button, but could be more in future.
                //
                $('a[data-alt-href]').on('click', function (evt) {
                    var href;
                    evt.preventDefault();
                    if (evt.shiftKey) {
                        href = $(this).data('alt-href');
                    } else {
                        href = $(this).attr('href');
                    }
                    window.location = href;
                });

                var copy_splits = window.location.href.split('copy=');
                if (copy_splits.length > 1) {
                    var id = copy_splits[1].split('&')[0];
                    // jshint latedef: false
                    var action = mark_copy_node(id);
                    // jshint latedef: true
                    window.selected_page = id;
                }

                function copyTreeItem(item_id, target_id, position, site) {
                    if (that.options.settings.permission) {
                        return loadDialog('./' + item_id + '/dialog/copy/', {
                            position: position,
                            target: target_id,
                            site: site,
                            callback: $.callbackRegister(
                                '_copyTreeItem', _copyTreeItem, item_id, target_id, position, site
                            )
                        });
                    }
                    return _copyTreeItem(item_id, target_id, position, site);
                }

                function _copyTreeItem(item_id, target_id, position, site, options) {
                    var data = {
                        position: position,
                        target: target_id,
                        site: site
                    };
                    data = $.extend(data, options);

                    $.post('./' + item_id + '/copy-page/', data, function (decoded) {
                        var response = decoded.content;
                        var status = decoded.status;
                        if (status === 200) {
                            // reload tree
                            window.location = window.location.href;
                        } else {
                            alert(response);
                            window.moveError($('#page_' + item_id + ' div.col1:eq(0)'), response);
                        }
                    });
                }

                /**
                 * Reloads tree item (one line). If some filtering is found, adds
                 * filtered variable into posted data.
                 *
                 * @param {HTMLElement} el Any child element of tree item
                 * @param {String} url Requested url
                 * @param {Object} data Optional posted data
                 * @param {Function} callback Optional calback function
                 */
                function reloadItem(el, url, data, callback, errorCallback) {
                    if (data === undefined) {
                        data = {};
                    }

                    if (/\/\?/ig.test(window.location.href)) {
                        // probably some filter here, tell backend, we need a filtered
                        // version of item
                        data.fitlered = 1;
                    }

                    function onSuccess(response, textStatus) {
                        var status = true;
                        var target = null;

                        if (callback) {
                            status = callback(response, textStatus);
                        }
                        if (status) {
                            if (/page_\d+/.test($(el).attr('id'))) {
                                // one level higher
                                target = $(el).find('div.cont:first');
                            } else {
                                target = $(el).parents('div.cont:first');
                            }

                            var parent = target.parent();

                            // remove the element if something went wrong
                            if (response === 'NotFound') {
                                return parent.remove();
                            }

                            var origin = $('.messagelist');
                            target.replace(response);

                            var messages = $(parent).find('.messagelist');
                            if (messages.length) {
                                origin.remove();
                                messages.insertAfter('.breadcrumbs');
                            }
                            parent.find('div.cont:first').yft();

                            // ensure after removal everything is aligned again
                            $(window).trigger('resize');
                        }
                    }

                    $.ajax({
                        'type': 'POST',
                        'data': data,
                        'url': url,
                        'success': onSuccess,
                        'error': function (XMLHttpRequest, textStatus, errorThrown) {
                            // errorCallback is passed through the reloadItem function
                            if (errorCallback) {
                                errorCallback(XMLHttpRequest, textStatus, errorThrown);
                            }
                        },
                        'xhr': (window.ActiveXObject) ?
                            function () {
                                try {
                                    return new window.ActiveXObject('Microsoft.XMLHTTP');
                                } catch (e) {}
                            } :
                            function () {
                                return new window.XMLHttpRequest();
                            }
                    });
                }

                function moveTreeItem(jtarget, item_id, target_id, position, tree) {
                    reloadItem(
                        jtarget, './' + item_id + '/move-page/',

                        { position: position, target: target_id },

                        // on success
                        function (decoded) {
                            var response = decoded.content;
                            var status = decoded.status;
                            if (status === 200) {
                                if (tree) {
                                    var tree_pos = { 'left': 'before', 'right': 'after' }[position] || 'inside';
                                    tree.moved(
                                        '#page_' + item_id,
                                        $('#page_' + target_id + ' a.title')[0],
                                        tree_pos,
                                        false,
                                        false
                                    );
                                } else {
                                    window.moveSuccess($('#page_' + item_id + ' div.col1:eq(0)'));
                                }
                                return false;
                            } else {
                                window.moveError($('#page_' + item_id + ' div.col1:eq(0)'), response);
                                return false;
                            }
                        }
                    );
                }

                var undos = [];

                function addUndo(node, target, position) {
                    undos.push({ node: node, target: target, position: position });
                }
            },

            refreshColumns: function () {
                $('div.col2').children('div').each(function (index, item) {
                    $(item).css('display', 'block');
                });
                var min_width = 100000;
                var max_col2_width = 0;
                var max_col2 = null;
                $(this).each(function () {
                    var cont = $(this).children('div.cont');
                    if (!cont.is(':visible')) {
                        return;
                    }
                    var col1 = cont.children('div.col1').find('.title span');
                    var col2 = cont.children('div.col2');
                    var col1_width = col1.outerWidth(true);
                    var col2_width = col2.outerWidth(true);
                    var total_width = cont.outerWidth(true);

                    var dif = total_width - col1_width;
                    if (dif < min_width) {
                        min_width = dif;
                    }
                    if (col2_width > max_col2_width) {
                        max_col2_width = col2_width;
                        max_col2 = col2;
                    }
                });

                var offset = 50;
                var w = 0;
                var hidden_count = 0;
                var max_reached = false;
                if (max_col2) {
                    max_col2.children('div').each(function () {
                        if (!max_reached) {
                            w += $(this).outerWidth(true);
                        }

                        if (max_reached || w > (min_width - offset)) {
                            hidden_count = hidden_count + 1;
                            max_reached = true;
                        }
                    });

                    if (hidden_count) {
                        $(this).each(function () {
                            $(this).children('div.cont').children('div.col2').children('div')
                                .slice(-hidden_count).each(function () {
                                    $(this).css('display', 'none');
                                });
                        });
                        $('div#sitemap ul.header div.col2').children().slice(-hidden_count).each(function () {
                            $(this).css('display', 'none');
                        });
                    }
                }
            }

        });

    });
})(CMS.$);

// all, but without jquery !! (modified by Peter Cicman)

// css.js

function get_css(rule_name,stylesheet,delete_flag){if(!document.styleSheets)return false;rule_name=rule_name.toLowerCase();stylesheet=stylesheet||0;for(var i=stylesheet;i<document.styleSheets.length;i++){var styleSheet=document.styleSheets[i];css_rules=document.styleSheets[i].cssRules||document.styleSheets[i].rules;if(!css_rules)continue;var j=0;do{if(css_rules[j].selectorText.toLowerCase()==rule_name){if(delete_flag==true){if(document.styleSheets[i].removeRule)document.styleSheets[i].removeRule(j);if(document.styleSheets[i].deleteRule)document.styleSheets[i].deleteRule(j);return true;}
else return css_rules[j];}}
while(css_rules[++j]);}
return false;}
function add_css(rule_name,stylesheet){rule_name=rule_name.toLowerCase();stylesheet=stylesheet||0;if(!document.styleSheets||get_css(rule_name,stylesheet))return false;(document.styleSheets[stylesheet].addRule)?document.styleSheets[stylesheet].addRule(rule_name,null,0):document.styleSheets[stylesheet].insertRule(rule_name+' { }',0);return get_css(rule_name);}
function get_sheet_num(href_name){if(!document.styleSheets)return false;for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].href&&document.styleSheets[i].href.toString().match(href_name))return i;}
return false;}
function remove_css(rule_name,stylesheet){return get_css(rule_name,stylesheet,true);}
function add_sheet(url){if(document.createStyleSheet){document.createStyleSheet(url);}
else{var styles="@import url(' "+url+" ');";var newSS=document.createElement('link');newSS.rel='stylesheet';newSS.href='data:text/css,'+escape(styles);document.getElementsByTagName("head")[0].appendChild(newSS);}}

// jquery.listen.js
;(function($){var a='indexer',h=$.event,j=h.special,k=$.listen=function(c,d,e,f){if(typeof d!='object'){f=e;e=d;d=document}o(c.split(/\s+/),function(a){a=k.fixes[a]||a;var b=m(d,a)||m(d,a,new n(a,d));b.append(e,f);b.start()})},m=function(b,c,d){return $.data(b,c+'.'+a,d)};$.fn[a]=function(a){return this[0]&&m(this[0],a)||null};$[a]=function(a){return m(document,a)};$.extend(k,{regex:/^((?:\w*?|\*))(?:([#.])([\w-]+))?$/,fixes:{focus:'focusin',blur:'focusout'},cache:function(a){this.caching=a}});$.each(k.fixes,function(a,b){j[b]={setup:function(){if($.browser.msie)return!1;this.addEventListener(a,j[b].handler,!0)},teardown:function(){if($.browser.msie)return!1;this.removeEventListener(a,j[b].handler,!0)},handler:function(e){arguments[0]=e=h.fix(e);e.type=b;return h.handle.apply(this,arguments)}}});$.fn.listen=function(a,b,c){return this.each(function(){k(a,this,b,c)})};function n(a,b){$.extend(this,{ids:{},tags:{},listener:b,event:a});this.id=n.instances.push(this)};n.instances=[];n.prototype={constructor:n,handle:function(e){var a=e.stopPropagation;e.stopPropagation=function(){e.stopped=1;a.apply(this,arguments)};m(this,e.type).parse(e);e.stopPropagation=a;a=e.data=null},on:0,bubbles:0,start:function(){var a=this;if(!a.on){h.add(a.listener,a.event,a.handle);a.on=1}},stop:function(){var a=this;if(a.on){h.remove(a.listener,a.event,a.handle);a.on=0}},cache:function(a,b){return $.data(a,'listenCache_'+this.id,b)},parse:function(e){var z=this,c=e.data||e.target,d=arguments,f;if(!k.caching||!(f=z.cache(c))){f=[];if(c.id&&z.ids[c.id])p(f,z.ids[c.id]);o([c.nodeName,'*'],function(a){var b=z.tags[a];if(b)o((c.className+' *').split(' '),function(a){if(a&&b[a])p(f,b[a])})});if(k.caching)z.cache(c,f)}if(f[0]){o(f,function(a){if(a.apply(c,d)===!1){e.preventDefault();e.stopPropagation()}})}if(!e.stopped&&(c=c.parentNode)&&(c.nodeName=='A'||z.bubbles&&c!=z.listener)){e.data=c;z.parse(e)}f=d=c=null},append:function(f,g){var z=this;o(f.split(/\s*,\s*/),function(a){var b=k.regex.exec(a);if(!b)throw'$.listen > "'+a+'" is not a supported selector.';var c=b[2]=='#'&&b[3],d=b[1].toUpperCase()||'*',e=b[3]||'*';if(c)(z.ids[c]||(z.ids[c]=[])).push(g);else if(d){d=z.tags[d]=z.tags[d]||{};(d[e]||(d[e]=[])).push(g)}})}};function o(a,b,c){for(var i=0,l=a.length;i<l;i++)b.call(c,a[i],i)};function p(a,b){a.push.apply(a,b);return a};$(window).unload(function(){if(typeof n=='function')o(n.instances,function(b){b.stop();$.removeData(b.listener,b.event+'.'+a);b.ids=b.names=b.listener=null})})})(jQuery);

// sarissa.js

function Sarissa(){}
Sarissa.VERSION="0.9.9.4";Sarissa.PARSED_OK="Document contains no parsing errors";Sarissa.PARSED_EMPTY="Document is empty";Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error";Sarissa.IS_ENABLED_TRANSFORM_NODE=false;Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG";Sarissa._lastUniqueSuffix=0;Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++;};Sarissa._SARISSA_IEPREFIX4XSLPARAM="";Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&true;Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument;Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature;Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE;Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1;Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&(parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420);Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1;Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE){Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};}
if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__;HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;x=null;}
if(typeof XMLDocument=="undefined"&&typeof Document!="undefined"){XMLDocument=Document;}
if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="";var _SARISSA_XMLHTTP_PROGID="";var _SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(idList){var bFound=false,e;var o2Store;for(var i=0;i<idList.length&&!bFound;i++){try{var oDoc=new ActiveXObject(idList[i]);o2Store=idList[i];bFound=true;}catch(objException){e=objException;}}
if(!bFound){throw"Could not retrieve a valid progID of Class: "+idList[idList.length-1]+". (original exception: "+e+")";}
idList=null;return o2Store;};_SARISSA_DOM_PROGID=null;_SARISSA_THREADEDDOM_PROGID=null;_SARISSA_XSLTEMPLATE_PROGID=null;_SARISSA_XMLHTTP_PROGID=null;XMLHttpRequest=function(){if(!_SARISSA_XMLHTTP_PROGID){_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"]);}
return new ActiveXObject(_SARISSA_XMLHTTP_PROGID);};Sarissa.getDomDocument=function(sUri,sName){if(!_SARISSA_DOM_PROGID){_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]);}
var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(sName){var prefix="";if(sUri){if(sName.indexOf(":")>1){prefix=sName.substring(0,sName.indexOf(":"));sName=sName.substring(sName.indexOf(":")+1);}else{prefix="a"+Sarissa._getUniqueSuffix();}}
if(sUri){oDoc.loadXML('<'+prefix+':'+sName+" xmlns:"+prefix+"=\""+sUri+"\""+" />");}else{oDoc.loadXML('<'+sName+" />");}}
return oDoc;};Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if(oDoc&&oDoc.parseError&&oDoc.parseError.errorCode&&oDoc.parseError.errorCode!=0){parseErrorText="XML Parsing Error: "+oDoc.parseError.reason+"\nLocation: "+oDoc.parseError.url+"\nLine Number "+oDoc.parseError.line+", Column "+
oDoc.parseError.linepos+":\n"+oDoc.parseError.srcText+"\n";for(var i=0;i<oDoc.parseError.linepos;i++){parseErrorText+="-";}
parseErrorText+="^\n";}
else if(oDoc.documentElement===null){parseErrorText=Sarissa.PARSED_EMPTY;}
return parseErrorText;};Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc.setProperty("SelectionLanguage","XPath");oDoc.setProperty("SelectionNamespaces",sNsSet);};XSLTProcessor=function(){if(!_SARISSA_XSLTEMPLATE_PROGID){_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"]);}
this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID);this.processor=null;};XSLTProcessor.prototype.importStylesheet=function(xslDoc){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"]);}
xslDoc.setProperty("SelectionLanguage","XPath");xslDoc.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var converted=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{converted.resolveExternals=true;converted.setProperty("AllowDocumentFunction",true);}
catch(e){}
if(xslDoc.url&&xslDoc.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null){converted.async=false;converted.load(xslDoc.url);}
else{converted.loadXML(xslDoc.xml);}
converted.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var output=converted.selectSingleNode("//xsl:output");if(output){this.outputMethod=output.getAttribute("method");}
else{delete this.outputMethod;}
this.template.stylesheet=converted;this.processor=this.template.createProcessor();this.paramsSet=[];};XSLTProcessor.prototype.transformToDocument=function(sourceDoc){var outDoc;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_PROGID);this.processor.output=outDoc;this.processor.transform();return outDoc;}
else{if(!_SARISSA_DOM_XMLWRITER){_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"]);}
this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_XMLWRITER);this.processor.output=outDoc;this.processor.transform();var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);oDoc.loadXML(outDoc.output+"");return oDoc;}};XSLTProcessor.prototype.transformToFragment=function(sourceDoc,ownerDoc){this.processor.input=sourceDoc;this.processor.transform();var s=this.processor.output;var f=ownerDoc.createDocumentFragment();var container;if(this.outputMethod=='text'){f.appendChild(ownerDoc.createTextNode(s));}else if(ownerDoc.body&&ownerDoc.body.innerHTML){container=ownerDoc.createElement('div');container.innerHTML=s;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}
else{var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(s.substring(0,5)=='<?xml'){s=s.substring(s.indexOf('?>')+2);}
var xml=''.concat('<my>',s,'</my>');oDoc.loadXML(xml);container=oDoc.documentElement;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}
return f;};XSLTProcessor.prototype.setParameter=function(nsURI,name,value){value=value?value:"";if(nsURI){this.processor.addParameter(name,value,nsURI);}else{this.processor.addParameter(name,value);}
nsURI=""+(nsURI||"");if(!this.paramsSet[nsURI]){this.paramsSet[nsURI]=[];}
this.paramsSet[nsURI][name]=value;};XSLTProcessor.prototype.getParameter=function(nsURI,name){nsURI=""+(nsURI||"");if(this.paramsSet[nsURI]&&this.paramsSet[nsURI][name]){return this.paramsSet[nsURI][name];}else{return null;}};XSLTProcessor.prototype.clearParameters=function(){for(var nsURI in this.paramsSet){for(var name in this.paramsSet[nsURI]){if(nsURI!=""){this.processor.addParameter(name,"",nsURI);}else{this.processor.addParameter(name,"");}}}
this.paramsSet=[];};}else{if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT){Sarissa.__handleLoad__=function(oDoc){Sarissa.__setReadyState__(oDoc,4);};_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this);};Sarissa.__setReadyState__=function(oDoc,iReadyState){oDoc.readyState=iReadyState;oDoc.readystate=iReadyState;if(oDoc.onreadystatechange!=null&&typeof oDoc.onreadystatechange=="function"){oDoc.onreadystatechange();}};Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(!oDoc.onreadystatechange){oDoc.onreadystatechange=null;}
if(!oDoc.readyState){oDoc.readyState=0;}
oDoc.addEventListener("load",_sarissa_XMLDocument_onload,false);return oDoc;};if(window.XMLDocument){}
else if(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature('LS','3.0')){Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);return oDoc;};}
else{Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(oDoc&&(sUri||sName)&&!oDoc.documentElement){oDoc.appendChild(oDoc.createElementNS(sUri,sName));}
return oDoc;};}}}
if(!window.DOMParser){if(Sarissa._SARISSA_IS_SAFARI){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(sXml),false);xmlhttp.send(null);return xmlhttp.responseXML;};}else if(Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var doc=Sarissa.getDomDocument();doc.loadXML(sXml);return doc;};}}
if((typeof(document.importNode)=="undefined")&&Sarissa._SARISSA_IS_IE){try{document.importNode=function(oNode,bChildren){var tmp;if(oNode.nodeName=='#text'){return document.createTextNode(oNode.data);}
else{if(oNode.nodeName=="tbody"||oNode.nodeName=="tr"){tmp=document.createElement("table");}
else if(oNode.nodeName=="td"){tmp=document.createElement("tr");}
else if(oNode.nodeName=="option"){tmp=document.createElement("select");}
else{tmp=document.createElement("div");}
if(bChildren){tmp.innerHTML=oNode.xml?oNode.xml:oNode.outerHTML;}else{tmp.innerHTML=oNode.xml?oNode.cloneNode(false).xml:oNode.cloneNode(false).outerHTML;}
return tmp.getElementsByTagName("*")[0];}};}catch(e){}}
if(!Sarissa.getParseErrorText){Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if((!oDoc)||(!oDoc.documentElement)){parseErrorText=Sarissa.PARSED_EMPTY;}else if(oDoc.documentElement.tagName=="parsererror"){parseErrorText=oDoc.documentElement.firstChild.data;parseErrorText+="\n"+oDoc.documentElement.firstChild.nextSibling.firstChild.data;}else if(oDoc.getElementsByTagName("parsererror").length>0){var parsererror=oDoc.getElementsByTagName("parsererror")[0];parseErrorText=Sarissa.getText(parsererror,true)+"\n";}else if(oDoc.parseError&&oDoc.parseError.errorCode!=0){parseErrorText=Sarissa.PARSED_UNKNOWN_ERROR;}
return parseErrorText;};}
Sarissa.getText=function(oNode,deep){var s="";var nodes=oNode.childNodes;for(var i=0;i<nodes.length;i++){var node=nodes[i];var nodeType=node.nodeType;if(nodeType==Node.TEXT_NODE||nodeType==Node.CDATA_SECTION_NODE){s+=node.data;}else if(deep===true&&(nodeType==Node.ELEMENT_NODE||nodeType==Node.DOCUMENT_NODE||nodeType==Node.DOCUMENT_FRAGMENT_NODE)){s+=Sarissa.getText(node,true);}}
return s;};if(!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer=function(){};XMLSerializer.prototype.serializeToString=function(oNode){return oNode.xml;};}
Sarissa.stripTags=function(s){return s?s.replace(/<[^>]+>/g,""):s;};Sarissa.clearChildNodes=function(oNode){while(oNode.firstChild){oNode.removeChild(oNode.firstChild);}};Sarissa.copyChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if(Sarissa._SARISSA_IS_SAFARI&&nodeTo.nodeType==Node.DOCUMENT_NODE){nodeTo=nodeTo.documentElement;}
if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}
if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}
var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var nodes=nodeFrom.childNodes;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}};Sarissa.moveChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}
if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}
var nodes=nodeFrom.childNodes;if(nodeFrom.ownerDocument==nodeTo.ownerDocument){while(nodeFrom.firstChild){nodeTo.appendChild(nodeFrom.firstChild);}}else{var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}
Sarissa.clearChildNodes(nodeFrom);}};Sarissa.xmlize=function(anyObject,objectName,indentSpace){indentSpace=indentSpace?indentSpace:'';var s=indentSpace+'<'+objectName+'>';var isLeaf=false;if(!(anyObject instanceof Object)||anyObject instanceof Number||anyObject instanceof String||anyObject instanceof Boolean||anyObject instanceof Date){s+=Sarissa.escape(""+anyObject);isLeaf=true;}else{s+="\n";var isArrayItem=anyObject instanceof Array;for(var name in anyObject){s+=Sarissa.xmlize(anyObject[name],(isArrayItem?"array-item key=\""+name+"\"":name),indentSpace+"   ");}
s+=indentSpace;}
return(s+=(objectName.indexOf(' ')!=-1?"</array-item>\n":"</"+objectName+">\n"));};Sarissa.escape=function(sXml){return sXml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");};Sarissa.unescape=function(sXml){return sXml.replace(/&apos;/g,"'").replace(/&quot;/g,"\"").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");};Sarissa.updateCursor=function(oTargetElement,sValue){if(oTargetElement&&oTargetElement.style&&oTargetElement.style.cursor!=undefined){oTargetElement.style.cursor=sValue;}};Sarissa.updateContentFromURI=function(sFromUrl,oTargetElement,xsltproc,callback,skipCache){try{Sarissa.updateCursor(oTargetElement,"wait");var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",sFromUrl,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){try{var oDomDoc=xmlhttp.responseXML;if(oDomDoc&&Sarissa.getParseErrorText(oDomDoc)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(xmlhttp.responseXML,oTargetElement,xsltproc);if(callback){callback(sFromUrl,oTargetElement);}}
else{throw Sarissa.getParseErrorText(oDomDoc);}}
catch(e){if(callback){callback(sFromUrl,oTargetElement,e);}
else{throw e;}}}};if(skipCache){var oldage="Sat, 1 Jan 2000 00:00:00 GMT";xmlhttp.setRequestHeader("If-Modified-Since",oldage);}
xmlhttp.send("");}
catch(e){Sarissa.updateCursor(oTargetElement,"auto");if(callback){callback(sFromUrl,oTargetElement,e);}
else{throw e;}}};Sarissa.updateContentFromNode=function(oNode,oTargetElement,xsltproc){try{Sarissa.updateCursor(oTargetElement,"wait");Sarissa.clearChildNodes(oTargetElement);var ownerDoc=oNode.nodeType==Node.DOCUMENT_NODE?oNode:oNode.ownerDocument;if(ownerDoc.parseError&&ownerDoc.parseError.errorCode!=0){var pre=document.createElement("pre");pre.appendChild(document.createTextNode(Sarissa.getParseErrorText(ownerDoc)));oTargetElement.appendChild(pre);}
else{if(xsltproc){oNode=xsltproc.transformToDocument(oNode);}
if(oTargetElement.tagName.toLowerCase()=="textarea"||oTargetElement.tagName.toLowerCase()=="input"){oTargetElement.value=new XMLSerializer().serializeToString(oNode);}
else{try{oTargetElement.appendChild(oTargetElement.ownerDocument.importNode(oNode,true));}
catch(e){oTargetElement.innerHTML=new XMLSerializer().serializeToString(oNode);}}}}
catch(e){throw e;}
finally{Sarissa.updateCursor(oTargetElement,"auto");}};Sarissa.formToQueryString=function(oForm){var qs="";for(var i=0;i<oForm.elements.length;i++){var oField=oForm.elements[i];var sFieldName=oField.getAttribute("name")?oField.getAttribute("name"):oField.getAttribute("id");if(sFieldName&&((!oField.disabled)||oField.type=="hidden")){switch(oField.type){case"hidden":case"text":case"textarea":case"password":qs+=sFieldName+"="+encodeURIComponent(oField.value)+"&";break;case"select-one":qs+=sFieldName+"="+encodeURIComponent(oField.options[oField.selectedIndex].value)+"&";break;case"select-multiple":for(var j=0;j<oField.length;j++){var optElem=oField.options[j];if(optElem.selected===true){qs+=sFieldName+"[]"+"="+encodeURIComponent(optElem.value)+"&";}}
break;case"checkbox":case"radio":if(oField.checked){qs+=sFieldName+"="+encodeURIComponent(oField.value)+"&";}
break;}}}
return qs.substr(0,qs.length-1);};Sarissa.updateContentFromForm=function(oForm,oTargetElement,xsltproc,callback){try{Sarissa.updateCursor(oTargetElement,"wait");var params=Sarissa.formToQueryString(oForm)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true";var xmlhttp=new XMLHttpRequest();var bUseGet=oForm.getAttribute("method")&&oForm.getAttribute("method").toLowerCase()=="get";if(bUseGet){xmlhttp.open("GET",oForm.getAttribute("action")+"?"+params,true);}
else{xmlhttp.open('POST',oForm.getAttribute("action"),true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.setRequestHeader("Content-length",params.length);xmlhttp.setRequestHeader("Connection","close");}
xmlhttp.onreadystatechange=function(){try{if(xmlhttp.readyState==4){var oDomDoc=xmlhttp.responseXML;if(oDomDoc&&Sarissa.getParseErrorText(oDomDoc)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(xmlhttp.responseXML,oTargetElement,xsltproc);if(callback){callback(oForm,oTargetElement);}}
else{throw Sarissa.getParseErrorText(oDomDoc);}}}
catch(e){if(callback){callback(oForm,oTargetElement,e);}
else{throw e;}}};xmlhttp.send(bUseGet?"":params);}
catch(e){Sarissa.updateCursor(oTargetElement,"auto");if(callback){callback(oForm,oTargetElement,e);}
else{throw e;}}
return false;};Sarissa.FUNCTION_NAME_REGEXP=new RegExp("");Sarissa.getFunctionName=function(oFunc,bForce){var name;if(!name){if(bForce){name="SarissaAnonymous"+Sarissa._getUniqueSuffix();window[name]=oFunc;}
else{name=null;}}
if(name){window[name]=oFunc;}
return name;};Sarissa.setRemoteJsonCallback=function(url,callback,callbackParam){if(!callbackParam){callbackParam="callback";}
var callbackFunctionName=Sarissa.getFunctionName(callback,true);var id="sarissa_json_script_id_"+Sarissa._getUniqueSuffix();var oHead=document.getElementsByTagName("head")[0];var scriptTag=document.createElement('script');scriptTag.type='text/javascript';scriptTag.id=id;scriptTag.onload=function(){};if(url.indexOf("?")!=-1){url+=("&"+callbackParam+"="+callbackFunctionName);}
else{url+=("?"+callbackParam+"="+callbackFunctionName);}
scriptTag.src=url;oHead.appendChild(scriptTag);return id;};

// sarissa_ieemu_xpath.js

if(Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")){SarissaNodeList=function(i){this.length=i;};SarissaNodeList.prototype=[];SarissaNodeList.prototype.constructor=Array;SarissaNodeList.prototype.item=function(i){return(i<0||i>=this.length)?null:this[i];};SarissaNodeList.prototype.expr="";if(window.XMLDocument&&(!XMLDocument.prototype.setProperty)){XMLDocument.prototype.setProperty=function(x,y){};}
Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc._sarissa_useCustomResolver=true;var namespaces=sNsSet.indexOf(" ")>-1?sNsSet.split(" "):[sNsSet];oDoc._sarissa_xpathNamespaces=[];for(var i=0;i<namespaces.length;i++){var ns=namespaces[i];var colonPos=ns.indexOf(":");var assignPos=ns.indexOf("=");if(colonPos>0&&assignPos>colonPos+1){var prefix=ns.substring(colonPos+1,assignPos);var uri=ns.substring(assignPos+2,ns.length-1);oDoc._sarissa_xpathNamespaces[prefix]=uri;}else{throw"Bad format on namespace declaration(s) given";}}};XMLDocument.prototype._sarissa_useCustomResolver=false;XMLDocument.prototype._sarissa_xpathNamespaces=[];XMLDocument.prototype.selectNodes=function(sExpr,contextNode,returnSingle){var nsDoc=this;var nsresolver;if(this._sarissa_useCustomResolver){nsresolver=function(prefix){var s=nsDoc._sarissa_xpathNamespaces[prefix];if(s){return s;}
else{throw"No namespace URI found for prefix: '"+prefix+"'";}};}
else{nsresolver=this.createNSResolver(this.documentElement);}
var result=null;if(!returnSingle){var oResult=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var nodeList=new SarissaNodeList(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=0;i<nodeList.length;i++){nodeList[i]=oResult.snapshotItem(i);}
result=nodeList;}
else{result=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;}
return result;};Element.prototype.selectNodes=function(sExpr){var doc=this.ownerDocument;if(doc.selectNodes){return doc.selectNodes(sExpr,this);}
else{throw"Method selectNodes is only supported by XML Elements";}};XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var ctx=contextNode?contextNode:null;return this.selectNodes(sExpr,ctx,true);};Element.prototype.selectSingleNode=function(sExpr){var doc=this.ownerDocument;if(doc.selectSingleNode){return doc.selectSingleNode(sExpr,this);}
else{throw"Method selectNodes is only supported by XML Elements";}};Sarissa.IS_ENABLED_SELECT_NODES=true;}

// jquery.xslt.js

var xslTransform={version:20071203,debug:false,init:function(){try{parseFloat(jQuery.fn.jquery)>=1;}catch(e){alert('xslTransform requires jQuery 1.0.4 or greater ... please load it prior to xslTransform');}
try{Sarissa;}catch(e){alert('Missing Sarissa ... please load it prior to xslTransform');}
if(!jQuery.log){jQuery.log=function(){};jQuery.fn.debug=function(){};}
if(this.debug)jQuery.log('xslTransform:init(): version '+xslTransform.version);},XMLSerializer:new XMLSerializer(),serialize:function(data){if(this.debug)jQuery.log('serialize(): received '+typeof(data));if(typeof(data)=='string'){return data;}
return this.XMLSerializer.serializeToString(data);},load:function(xml,meth){if(this.debug)jQuery.log('load(): received '+typeof(xml));var r;if(typeof(xml)=='object'){return xml;}
if(xml.substring(0,1)=='<'){r=this.loadString(xml);}else{r=this.loadFile(xml,meth);}
if(r){r.setProperty('SelectionNamespaces','xmlns:xsl="http://www.w3.org/1999/XSL/Transform"');r.setProperty('SelectionLanguage','XPath');return r;}else{if(this.debug)$.log('Unable to load '+xml);return false;}},loadString:function(str){if(this.debug)jQuery.log('loadString(): '+str+'::'+typeof(str));var p=new DOMParser();var xml=p.parseFromString(str,'text/xml');if(!xml){if(this.debug)jQuery.log('loadString(): parseFromString() failed');return false;}
return xml;},loadFile:function(url,meth){if(this.debug)jQuery.log('loadFile(): '+url+'::'+typeof(url));if(!url){if(this.debug)jQuery.log('ERROR: loadFile() missing url');return false;}
var doc;this.xhrsuccess=function(data,str){if(this.debug)jQuery.log('loadFile() completed successfully ('+str+')');doc=data;return true;};this.xhrerror=function(xhr,err){window.DEBUG=true;if(this.debug)jQuery.log('loadFile() failed to load the requested file: ('+err+') - xml: '+xhr.responseXML+' - text: '+xhr.responseText);doc=null;return false;};if(!meth)meth="GET";$.ajax({type:meth,url:url,async:false,success:this.xhrsuccess,error:this.xhrerror});if(!doc){if(this.debug)jQuery.log('ERROR: document '+url+' not found (404), or unable to load');return false;}
if(doc.length==0){if(this.debug)jQuery.log('ERROR: document '+url+' loaded in loadFile() has no data');return false;}
return doc;},transform:function(xsl,xml,options){var log={'xsl':xsl,'xml':xml,'options':options};if(this.debug)jQuery.log('transform(): '+xsl+'::'+xml+'::'+options.toString());options=options||{};var xml={'request':xml,'doc':this.load(xml,options.meth)};if(options.xpath&&xml.doc&&!jQuery.browser.msie){xml.doc=xml.doc.selectSingleNode(options.xpath.toString());if(this.debug)$.log('transform(): xpath has been run...resulting doc: '+(this.serialize(xml.doc)));}
var result={'xsl':this.load(xsl,options.meth)};result.json=false;if(options.json&&xml.doc){result.json=xml.doc.selectSingleNode(options.json.toString());}
var processor=new XSLTProcessor();processor.importStylesheet(result.xsl);if(options.params&&processor){if(this.debug)jQuery.log('transform(): received xsl params: '+options.params.toString());for(key in options.params){processor.setParameter(null,key.toString(),options.params[key].toString());}}
result.doc=processor.transformToDocument(xml.doc);var errorTxt=Sarissa.getParseErrorText(result.doc);if(this.debug)jQuery.log('transform(): Sarissa parse text: '+errorTxt);if(errorTxt!=Sarissa.PARSED_OK){result.string=Sarissa.getParseErrorText(result.doc)+' :: using '+xsl+' => '+xml.request;if(this.debug)jQuery.log('transform(): error in transformation: '+Sarissa.getParseErrorText(result.doc));return result;}
result.string=this.serialize(result.doc);result.scripts=jQuery('script',result.doc).text();return result;}};xslTransform.init();jQuery.fn.getTransform=function(xsl,xml,options){var settings={append:false,params:{},xpath:'',eval:true,callback:'',json:false,meth:"GET"};jQuery.extend(settings,options);if(xslTransform.debug)jQuery.log('getTransform: '+xsl+'::'+xml+'::'+settings.toString());if(!xsl||!xml){if(xslTransform.debug)jQuery.log('getTransform: missing xsl or xml');return;}
return this.each(function(){var trans=xslTransform.transform(xsl,xml,settings);var re=trans.string.match(/<\?xml.*?\?>/);if(re){trans.string=trans.string.replace(re,'');if(xslTransform.debug)jQuery.log('getTransform(): found an xml declaration and removed it');}
try{if(settings.append)$(this).append(trans.string);else if(settings.repl)$(this).replaceWith(trans.string);else $(this).html(trans.string);}catch(e){if(xslTransform.debug)$.log('getTransform: error placing results of transform into element, falling back to innerHTML: '+e.toString());$(this)[0].innerHTML=trans.string;}
if(settings.eval&&trans.scripts){if(trans.scripts.length>0){if(xslTransform.debug)jQuery.log('Found text/javascript in transformed result');eval.call(window,trans.scripts);}}
if(settings.callback&&jQuery.isFunction(settings.callback)){var json=false;if(settings.json&&trans.json)eval("json = "+trans.json.firstChild.data);settings.callback.apply(window,[trans.string,json]);}});};

// jquery.metadata.js

(function($){$.extend({metadata:{defaults:{type:'class',name:'metadata',cre:/({.*})/,single:'metadata'},setType:function(type,name){this.defaults.type=type;this.defaults.name=name;},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length)settings.single='metadata';var data=$.data(elem,settings.single);if(data)return data;data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m)
data=m[1];}else if(settings.type=="elem"){if(!elem.getElementsByTagName)
return undefined;var e=elem.getElementsByTagName(settings.name);if(e.length)
data=$.trim(e[0].innerHTML);}else if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr)
data=attr;}
if(data.indexOf('{')<0)
data="{"+data+"}";data=eval("("+data+")");$.data(elem,settings.single,data);return data;}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts);};})(jQuery);

// jquery.cookie.js

jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}};
/*
 * jsTree 0.9.5
 *
 * Copyright (c) 2008 Ivan Bozhanov (vakata.com)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Date: 2009-01-03
 *
 */
//jshint ignore:start
//jscs:disable

// browser fix
(function ($) {
    $.browser = {};
    $.browser.mozilla = /mozilla/.test(navigator.userAgent.toLowerCase()) && !/webkit/.test(navigator.userAgent.toLowerCase());
    $.browser.webkit = /webkit/.test(navigator.userAgent.toLowerCase());
    $.browser.opera = /opera/.test(navigator.userAgent.toLowerCase());
    $.browser.msie = /msie/.test(navigator.userAgent.toLowerCase());

    // jQuery plugin
    $.fn.tree = function (opts) {
        return this.each(function() {
            if(tree_component.inst && tree_component.inst[$(this).attr('id')]) {
                tree_component.inst[$(this).attr('id')].destroy();
            }
            if(opts !== false) {
                var tmp = new tree_component();
                tmp.init(this, opts);
            }
        });
    };
    // core
    window.tree_component = function () {
        // instance manager
        if(typeof tree_component.inst == "undefined") {
            tree_component.cntr = 0;
            tree_component.inst = [];
            tree_component.drop = [];

            tree_component.focusInst = function () {
                return tree_component.inst[tree_component.focused];
            }
            tree_component.mousedown = function(event) {
                $('html').attr('data-touch-action', 'none');
                var _this = tree_component.focusInst();
                if(!_this) return;

                var tmp = $(event.target);
                if(tree_component.drop.length && tmp.is("." + tree_component.drop.join(", .")) ) {
                    _this.drag = $("<li id='dragged' class='dragged foreign " + event.target.className + "'><a href='#'>" + tmp.text() + "</a></li>");
                    _this._drag = _this.drag;
                    _this.isdown    = true;
                    _this.foreign    = tmp;
                    tmp.blur();
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
                event.stopPropagation();
                return true;
            };
            tree_component.mouseup = function(event) {
                $('html').removeAttr('data-touch-action');
                var _this = tree_component.focusInst();
                if(!_this) return;


                // CLEAR TIMEOUT FOR OPENING HOVERED NODES WHILE DRAGGING
                if(tree_component.to)    clearTimeout(tree_component.to);
                if(tree_component.sto)    clearTimeout(tree_component.sto);
                if(_this.foreign === false && _this.drag && _this.drag.parentNode && _this.drag.parentNode == $(_this.container).children("ul:eq(0)").get(0)) {
                    $(_this.drag).remove();
                    // CALL FUNCTION FOR COMPLETING MOVE
                    if(_this.moveType) {
                        var tmp = tree_component.inst[$(_this.moveRef).parents(".tree:eq(0)").attr("id")];
                        if(tmp) {
                            tmp.moved(_this.container.find("li.dragged"), _this.moveRef, _this.moveType, false, (_this.settings.rules.drag_copy == "on" || (_this.settings.rules.drag_copy == "ctrl" && event.ctrlKey) ) );
                        }
                    }
                    _this.moveType = false;
                    _this.moveRef = false;
                }
                if(_this.drag && _this.foreign !== false) {
                    $(_this.drag).remove();
                    if(_this.moveType) {
                        var tmp = tree_component.inst[$(_this.moveRef).parents(".tree:eq(0)").attr("id")];
                        if(tmp) {
                            tmp.settings.callback.ondrop.call(null, _this.foreign.get(0), _this.get_node( _this.moveRef).get(0), _this.moveType, _this);
                        }
                    }
                    _this.foreign = false;
                    _this.moveType = false;
                    _this.moveRef = false;
                }
                // RESET EVERYTHING
                $("#marker").hide();
                _this._drag        = false;
                _this.drag        = false;
                _this.isdown    = false;
                _this.appended    = false;
                _this.container.find("li.dragged").removeClass("dragged");
                event.preventDefault();
                event.stopPropagation();
                return false;
            };
            tree_component.mousemove = function(event) {
                var _this = tree_component.focusInst();
                if(!_this) return;

                if(_this.locked) return _this.error("LOCKED");
                if(_this.isdown) {
                    // CLEAR TIMEOUT FOR OPENING HOVERED NODES WHILE DRAGGING
                    if(tree_component.to) clearTimeout(tree_component.to);
                    if(!_this.appended) {
                        _this.container.children("ul:eq(0)").append(_this.drag);
                        var tmp = $(_this.drag).offsetParent();
                        if(tmp.is("html")) tmp = $("body");
                        _this.po = tmp.offset();
                        _this.appended = true;
                    }
                    $(_this.drag).css({ "left" : (event.originalEvent.pageX - _this.po.left - (_this.settings.ui.rtl ? $(_this.drag).width() : -5 ) ), "top" : (event.originalEvent.pageY - _this.po.top  + ($.browser.opera ? _this.container.scrollTop() : 0) + 15) });

                    if(event.target.tagName == "IMG" && event.target.id == "marker") return false;

                    var cnt = $(event.target).parents(".tree:eq(0)");

                    // if not moving over a tree
                    if(cnt.size() == 0) {
                        if(tree_component.sto) clearTimeout(tree_component.sto);
                        if($(_this.drag).children("IMG").size() == 0) {
                            $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right" : "left" ) + ":4px; top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef  = false;
                        $("#marker").hide();
                        return false;
                    }

                    tree_component.inst[cnt.attr("id")].off_height();

                    // if moving over another tree and multitree is false
                    if( _this.foreign === false && cnt.get(0) != _this.container.get(0) && (!_this.settings.rules.multitree || !tree_component.inst[cnt.attr("id")].settings.rules.multitree) ) {
                        if($(_this.drag).children("IMG").size() == 0) {
                            $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right" : "left" ) + ":4px; top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef  = false;
                        $("#marker").hide();
                        return false;
                    }

                    if(tree_component.sto) clearTimeout(tree_component.sto);
                    tree_component.sto = setTimeout( function() { tree_component.inst[cnt.attr("id")].scrollCheck(event.originalEvent.pageX,event.originalEvent.pageY); }, 50);

                    var mov = false;
                    var st = cnt.scrollTop();

                    if(event.target.tagName == "A" && event.target.className=="title") {
                        // just in case if hover is over the draggable
                        if($(event.target).is("#dragged")) return false;

                        var goTo = {
                            x : ($(event.target).offset().left - 1),
                            y : (event.originalEvent.pageY - tree_component.inst[cnt.attr("id")].offset.top)
                        }
                        if(cnt.hasClass("rtl")) {
                            goTo.x += $(event.target).width() - 8;
                        }
                        if( (goTo.y + st)%_this.li_height < _this.li_height/3 + 1 ) {
                            mov = "before";
                            goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height - 2 ;
                        }
                        else if((goTo.y + st)%_this.li_height > _this.li_height*2/3 - 1 ) {
                            mov = "after";
                            goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height + _this.li_height - 2 ;
                        }
                        else {
                            mov = "inside";
                            goTo.x -= 2;
                            if(cnt.hasClass("rtl")) {
                                goTo.x += 36;
                            }
                            goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height + Math.floor(_this.li_height/2) - 2 ;
                            if(_this.get_node(event.target).hasClass("closed")) {
                                tree_component.to = setTimeout( function () { _this.open_branch(_this.get_node(event.target)); }, 500);
                            }
                        }

                        if(tree_component.inst[cnt.attr("id")].checkMove(_this.container.find("li.dragged"), $(event.target), mov)) {
                            if(mov == "inside")    $("#marker").attr("src", _this.settings.ui.theme_path + "default/plus.gif").width(14);
                            else {
                                if(cnt.hasClass("rtl"))    { $("#marker").attr("src", _this.settings.ui.theme_path + "default/marker_rtl.gif").width(40); }
                                else                    { $("#marker").attr("src", _this.settings.ui.theme_path + "default/marker.gif").width(40); }
                            }
                            _this.moveType    = mov;
                            _this.moveRef    = event.target;
                            $(_this.drag).children("IMG").remove();
                            $("#marker").css({ "left" : goTo.x-1 , "top" : goTo.y-2 }).show();
                        }
                        else {
                            if($(_this.drag).children("IMG").size() == 0) {
                                $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right:0px;" : "left:4px;" ) + " top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                            }
                            _this.moveType = false;
                            _this.moveRef = false;
                            $("#marker").hide();
                        }
                    }
                    else {
                        if($(_this.drag).children("IMG").size() == 0) {
                            $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right:0px;" : "left:4px;" ) + " top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef = false;
                        $("#marker").hide();
                    }
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
                return true;
            };
        }
        return {
            cntr : tree_component.cntr ++,
            settings : {
                data    : {
                    type    : "predefined",    // ENUM [json, xml_flat, xml_nested, predefined]
                    method    : "GET",        // HOW TO REQUEST FILES
                    async    : false,        // BOOL - async loading onopen
                    async_data : function (NODE) { return { id : $(NODE).attr("id") || 0 } }, // PARAMETERS PASSED TO SERVER
                    url        : false,        // FALSE or STRING - url to document to be used (async or not)
                    json    : false            // FALSE or OBJECT if type is JSON and async is false - the tree dump as json
                },
                selected    : false,        // FALSE or STRING or ARRAY
                opened        : [],            // ARRAY OF INITIALLY OPENED NODES
                languages    : [],            // ARRAY of string values (which will be used as CSS classes - si they must be valid)
                path        : false,        // FALSE or STRING (if false - will be autodetected)
                cookies        : false,        // FALSE or OBJECT (prefix, opts - from jqCookie - expires, path, domain, secure)
                ui        : {
                    dots        : true,        // BOOL - dots or no dots
                    rtl            : false,    // BOOL - is the tree right-to-left
                    animation    : 0,        // INT - duration of open/close animations in miliseconds
                    hover_mode    : true,        // SHOULD get_* functions chage focus or change hovered item
                    scroll_spd    : 4,
                    theme_path    : false,    // Path to themes
                    theme_name    : "default",// Name of theme
                    context        : [
                        {
                            id        : "create",
                            label    : "Create",
                            icon    : "create.png",
                            visible    : function (NODE, TREE_OBJ) { if(NODE.length != 1) return false; return TREE_OBJ.check("creatable", NODE); },
                            action    : function (NODE, TREE_OBJ) { TREE_OBJ.create(false, NODE); }
                        },
                        "separator",
                        {
                            id        : "rename",
                            label    : "Rename",
                            icon    : "rename.png",
                            visible    : function (NODE, TREE_OBJ) { if(NODE.length != 1) return false; return TREE_OBJ.check("renameable", NODE); },
                            action    : function (NODE, TREE_OBJ) { TREE_OBJ.rename(); }
                        },
                        {
                            id        : "delete",
                            label    : "Delete",
                            icon    : "remove.gif",
                            visible    : function (NODE, TREE_OBJ) { return TREE_OBJ.check("deletable", NODE); },
                            action    : function (NODE, TREE_OBJ) { NODE.each( function () { TREE_OBJ.remove(this); }); }
                        }
                    ]
                },
                rules    : {
                    multiple    : false,    // FALSE | CTRL | ON - multiple selection off/ with or without holding Ctrl
                    metadata    : false,    // FALSE or STRING - attribute name (use metadata plugin)
                    type_attr    : "rel",    // STRING attribute name (where is the type stored if no metadata)
                    multitree    : false,    // BOOL - is drag n drop between trees allowed
                    createat    : "bottom",    // STRING (top or bottom) new nodes get inserted at top or bottom
                    use_inline    : false,    // CHECK FOR INLINE RULES - REQUIRES METADATA
                    clickable    : "all",    // which node types can the user select | default - all
                    renameable    : "all",    // which node types can the user select | default - all
                    deletable    : "all",    // which node types can the user delete | default - all
                    creatable    : "all",    // which node types can the user create in | default - all
                    draggable    : "none",    // which node types can the user move | default - none | "all"
                    dragrules    : "all",    // what move operations between nodes are allowed | default - none | "all"
                    drag_copy    : false,    // FALSE | CTRL | ON - drag to copy off/ with or without holding Ctrl
                    droppable    : []
                },
                lang : {
                    new_node    : "New folder",
                    loading        : "Loading ..."
                },
                callback    : {                // various callbacks to attach custom logic to
                    // before focus  - should return true | false
                    beforechange: function(NODE,TREE_OBJ) { return true },
                    // before move   - should return true | false
                    beforemove  : function(NODE,REF_NODE,TYPE,TREE_OBJ) { return true },
                    // before create - should return true | false
                    beforecreate: function(NODE,REF_NODE,TYPE,TREE_OBJ) { return true },
                    // before rename - should return true | false
                    beforerename: function(NODE,LANG,TREE_OBJ) { return true },
                    // before delete - should return true | false
                    beforedelete: function(NODE,TREE_OBJ) { return true },

                    onchange    : function(NODE,TREE_OBJ) { },                    // focus changed
                    onrename    : function(NODE,LANG,TREE_OBJ) { },                // node renamed ISNEW - TRUE|FALSE, current language
                    onmove        : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // move completed (TYPE is BELOW|ABOVE|INSIDE)
                    oncopy        : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // copy completed (TYPE is BELOW|ABOVE|INSIDE)
                    oncreate    : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // node created, parent node (TYPE is insertAt)
                    ondelete    : function(NODE, TREE_OBJ) { },                    // node deleted
                    onopen        : function(NODE, TREE_OBJ) { },                    // node opened
                    onclose        : function(NODE, TREE_OBJ) { },                    // node closed
                    error        : function(TEXT, TREE_OBJ) { },                    // error occured
                    // double click on node - defaults to open/close & select
                    ondblclk    : function(NODE, TREE_OBJ) { TREE_OBJ.toggle_branch.call(TREE_OBJ, NODE); TREE_OBJ.select_branch.call(TREE_OBJ, NODE); },
                    // right click - to prevent use: EV.preventDefault(); EV.stopPropagation(); return false
                    onrgtclk    : function(NODE, TREE_OBJ, EV) { },
                    onload        : function(TREE_OBJ) { },
                    onfocus        : function(TREE_OBJ) { },
                    ondrop        : function(NODE,REF_NODE,TYPE,TREE_OBJ) {}
                }
            },
            // INITIALIZATION
            init : function(elem, opts) {
                var _this = this;
                this.container        = $(elem);
                if(this.container.size == 0) { alert("Invalid container node!"); return }

                tree_component.inst[this.cntr] = this;
                if(!this.container.attr("id")) this.container.attr("id","jstree_" + this.cntr);
                tree_component.inst[this.container.attr("id")] = tree_component.inst[this.cntr];
                tree_component.focused = this.cntr;

                // MERGE OPTIONS WITH DEFAULTS
                if(opts && opts.cookies) {
                    this.settings.cookies = $.extend({},this.settings.cookies,opts.cookies);
                    delete opts.cookies;
                    if(!this.settings.cookies.opts) this.settings.cookies.opts = {};
                }
                if(opts && opts.callback) {
                    this.settings.callback = $.extend({},this.settings.callback,opts.callback);
                    delete opts.callback;
                }
                if(opts && opts.data) {
                    this.settings.data = $.extend({},this.settings.data,opts.data);
                    delete opts.data;
                }
                if(opts && opts.ui) {
                    this.settings.ui = $.extend({},this.settings.ui,opts.ui);
                    delete opts.ui;
                }
                if(opts && opts.rules) {
                    this.settings.rules = $.extend({},this.settings.rules,opts.rules);
                    delete opts.rules;
                }
                if(opts && opts.lang) {
                    this.settings.lang = $.extend({},this.settings.lang,opts.lang);
                    delete opts.lang;
                }
                this.settings        = $.extend({},this.settings,opts);

                // PATH TO IMAGES AND XSL
                if(this.settings.path == false) {
                    this.path = "";
                    $("script").each( function () {
                        if(this.src.toString().match(/tree_component.*?js.*$/)) {
                            _this.path = this.src.toString().replace(/tree_component.*?js.*$/, "");
                        }
                    });
                }
                else this.path = this.settings.path;

                // DEAL WITH LANGUAGE VERSIONS
                this.current_lang    = this.settings.languages && this.settings.languages.length ? this.settings.languages[0] : false;
                if(this.settings.languages && this.settings.languages.length) {
                    this.sn = get_sheet_num("tree_component.css");
                    var st = false;
                    var id = this.container.attr("id") ? "#" + this.container.attr("id") : ".tree";
                    for(var ln = 0; ln < this.settings.languages.length; ln++) {
                        st = add_css(id + " ." + this.settings.languages[ln], this.sn);
                        if(st !== false) {
                            if(this.settings.languages[ln] == this.current_lang)    st.style.display = "inline";
                            else                                                    st.style.display = "none";
                        }
                    }
                }

                // DROPPABLES
                if(this.settings.rules.droppable.length) {
                    for(i in this.settings.rules.droppable) {
                        tree_component.drop.push(this.settings.rules.droppable[i]);
                        tree_component.drop = $.unique(tree_component.drop);
                    }
                }

                // THEMES
                if(this.settings.ui.theme_path === false) this.settings.ui.theme_path = this.path + "themes/";
                this.theme = this.settings.ui.theme_path + _this.settings.ui.theme_name + "/";
                add_sheet(_this.settings.ui.theme_path + "default/style.css");
                if(this.settings.ui.theme_name != "default") add_sheet(_this.theme + "style.css");

                this.container.addClass("tree");
                if(this.settings.ui.rtl) this.container.addClass("rtl");
                if(this.settings.rules.multiple) this.selected_arr = [];
                this.offset = false;

                if(this.settings.ui.dots == false) this.container.addClass("no_dots");

                // CONTEXT MENU
                this.context = false;
                if(this.settings.ui.context != false) {
                    var str = '<div class="context">';
                    for(i in this.settings.ui.context) {
                        if(this.settings.ui.context[i] == "separator") {
                            str += "<span class='separator'>&nbsp;</span>";
                            continue;
                        }
                        var icn = "";
                        if(this.settings.ui.context[i].icon) icn = 'background-image:url(\'' + ( this.settings.ui.context[i].icon.indexOf("/") == -1 ? this.theme + this.settings.ui.context[i].icon : this.settings.ui.context[i].icon ) + '\');';
                        str += '<a rel="' + this.settings.ui.context[i].id + '" href="#" style="' + icn + '">' + this.settings.ui.context[i].label + '</a>';
                    }
                    str += '</div>';
                    this.context = $(str);
                    this.context.hide();
                    this.context.append = false;
                }

                this.hovered = false;
                this.locked = false;

                // CREATE DUMMY FOR MOVING
                if(this.settings.rules.draggable != "none" && this.settings.rules.dragrules != "none") {
                    var _this = this;
                    $("<img>")
                        .attr({
                            id        : "marker",
                            src    : _this.settings.ui.theme_path + "default/marker.gif"
                        })
                        .css({
                            height        : "8px",
                            width        : "42px",
                            display        : "block",
                            position    : "absolute",
                            left        : "30px",
                            top            : "30px",
                            zIndex        : "1000"
                        }).hide().appendTo("body");
                }
                this.refresh();
                this.attachEvents();
                this.focus();
            },
            off_height : function () {
                if(this.offset === false) {
                    this.container.css({ position : "relative" });
                    this.offset = this.container.offset();
                    var tmp = 0;
                    tmp = parseInt($.css(this.container.get(0), "paddingTop", true),10);
                    if(tmp) this.offset.top += tmp;
                    tmp = parseInt($.css(this.container.get(0), "borderTopWidth", true),10);
                    if(tmp) this.offset.top += tmp;
                    this.container.css({ position : "" });
                }
                if(!this.li_height) {
                    var tmp = this.container.find("ul li:eq(0)");
                    this.li_height = tmp.find('.title:first').height() + 1;
                    if(!this.li_height) this.li_height = 18;
                }
            },
            // REPAINT TREE
            refresh : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;

                // SAVE OPENED
                this.opened = Array();
                if(this.settings.cookies && $.cookie(this.settings.cookies.prefix + '_open')) {
                    var str = $.cookie(this.settings.cookies.prefix + '_open');
                    var tmp = str.split(",");
                    $.each(tmp, function () {
                        _this.opened.push("#" + this.replace(/^#/,""));
                    });
                    this.settings.opened = false;
                }
                else if(this.settings.opened != false) {
                    $.each(this.settings.opened, function (i, item) {
                        _this.opened.push("#" + this.replace(/^#/,""));
                    });
                    this.settings.opened = false;
                }
                else {
                    this.container.find("li.open").each(function (i) { _this.opened.push("#" + this.id); });
                }

                // SAVE SELECTED
                if(this.selected) {
                    this.settings.selected = Array();
                    if(this.selected_arr) {
                        $.each(this.selected_arr, function () {
                            _this.settings.selected.push("#" + this.attr("id"));
                        });
                    }
                    else this.settings.selected.push("#" + this.selected.attr("id"));
                }
                /*else if(this.settings.cookies && jQuery.cookie(this.settings.cookies.prefix + '_selected')) {
                    this.settings.selected = Array();
                    var str = jQuery.cookie(this.settings.cookies.prefix + '_selected');
                    var tmp = str.split(",");
                    jQuery.each(tmp, function () {
                        _this.settings.selected.push("#" + this.replace(/^#/,""));
                    });
                }*/
                else if(this.settings.selected !== false) {
                    var tmp = Array();
                    if((typeof this.settings.selected).toLowerCase() == "object") {
                        $.each(this.settings.selected, function () {
                            tmp.push("#" + this.replace(/^#/,""));
                        });
                    }
                    else tmp.push("#" + this.settings.selected.replace(/^#/,""));
                    this.settings.selected = tmp;
                }

                if(obj && this.settings.data.async) {
                    this.opened = Array();
                    obj = this.get_node(obj);
                    obj.find("li.open").each(function (i) { _this.opened.push("#" + this.id); });
                    this.close_branch(obj, true);
                    obj.children("ul:eq(0)").html("");
                    return this.open_branch(obj, true, function () { _this.reselect.apply(_this); });
                }

                var cls = "tree-default";
                if(this.settings.ui.theme_name != "default") cls += " tree-" + _this.settings.ui.theme_name;

                if(this.settings.data.type == "xml_flat" || this.settings.data.type == "xml_nested") {
                    this.scrtop = this.container.get(0).scrollTop;
                    var xsl = (this.settings.data.type == "xml_flat") ? "flat.xsl" : "nested.xsl";
                    this.container.getTransform(this.path + xsl, this.settings.data.url, { params : { theme_name : cls, theme_path : _this.theme }, meth : _this.settings.data.method ,callback: function () { _this.reselect.apply(_this); } });
                    return;
                }
                else if(this.settings.data.type == "json") {
                    if(this.settings.data.json) {
                        var str = "";
                        if(this.settings.data.json.length) {
                            for(var i = 0; i < this.settings.data.json.length; i++) {
                                str += this.parseJSON(this.settings.data.json[i]);
                            }
                        } else str = this.parseJSON(this.settings.data.json);
                        this.container.html("<ul class='" + cls + "'>" + str + "</ul>");
                        this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                        this.container.find("li").not(".open").not(".closed").addClass("leaf");
                        this.reselect();
                    }
                    else {
                        var _this = this;
                        $.ajax({
                            type        : this.settings.data.method,
                            url            : this.settings.data.url,
                            data        : this.settings.data.async_data(false),
                            dataType    : "json",
                            success        : function (data) {
                                var str = "";
                                if(data.length) {
                                    for(var i = 0; i < data.length; i++) {
                                        str += _this.parseJSON(data[i]);
                                    }
                                } else str = _this.parseJSON(data);
                                _this.container.html("<ul class='" + cls + "'>" + str + "</ul>");
                                _this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                                _this.container.find("li").not(".open").not(".closed").addClass("leaf");
                                _this.reselect.apply(_this);
                            }
                        });
                    }
                }
                else {
                    this.container.children("ul:eq(0)").attr("class", cls);
                    this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                    this.container.find("li").not(".open").not(".closed").addClass("leaf");
                    this.reselect();
                }
            },
            // CONVERT JSON TO HTML
            parseJSON : function (data) {
                var str = "";
                str += "<li ";
                var cls = false;
                for(i in data.attributes) {
                    if(i == "class") {
                        str += " class='" + data.attributes[i] + " ";
                        if(data.state == "closed" || data.state == "open") str += " " + data.state + " ";
                        str += "' ";
                        cls = true;
                    }
                    else str += " " + i + "='" + data.attributes[i] + "' ";
                }
                if(!cls && (data.state == "closed" || data.state == "open")) str += " class='" + data.state + "' ";
                str += ">";
                if(this.settings.languages.length) {
                    for(var i = 0; i < this.settings.languages.length; i++) {
                        var attr = [];
                        attr["href"] = "#";
                        attr["style"] = "";
                        attr["class"] = this.settings.languages[i];
                        if(data.data[this.settings.languages[i]] && (typeof data.data[this.settings.languages[i]].attributes).toLowerCase() != "undefined") {
                            for(j in data.data[this.settings.languages[i]].attributes) {
                                if(j == "style" || j == "class")    attr[j] += " " + data.data[this.settings.languages[i]].attributes[j];
                                else                                attr[j]  = data.data[this.settings.languages[i]].attributes[j];
                            }
                        }
                        if(data.data[this.settings.languages[i]] && data.data[this.settings.languages[i]].icon) {
                            var icn = data.data[this.settings.languages[i]].icon.indexOf("/") == -1 ? this.theme + data.data[this.settings.languages[i]].icon : data.data[this.settings.languages[i]].icon;
                            attr["style"] += " ; background-image:url('" + icn + "'); ";
                        }
                        str += "<a";
                        for(j in attr) str += ' ' + j + '="' + attr[j] + '" ';
                        str += ">" + ( (typeof data.data[this.settings.languages[i]].title).toLowerCase() != "undefined" ? data.data[this.settings.languages[i]].title : data.data[this.settings.languages[i]] ) + "</a>";
                    }
                }
                else {
                    var attr = [];
                    attr["href"] = "#";
                    attr["style"] = "";
                    attr["class"] = "";
                    if((typeof data.data.attributes).toLowerCase() != "undefined") {
                        for(i in data.data.attributes) {
                            if(i == "style" || i == "class")    attr[i] += " " + data.data.attributes[i];
                            else                                attr[i]  = data.data.attributes[i];
                        }
                    }
                    if(data.data.icon) {
                        var icn = data.data.icon.indexOf("/") == -1 ? this.theme + data.data.icon : data.data.icon;
                        attr["style"] += " ; background-image:url('" + icn + "');";
                    }
                    str += "<a";
                    for(i in attr) str += ' ' + i + '="' + attr[i] + '" ';
                    str += ">" + ( (typeof data.data.title).toLowerCase() != "undefined" ? data.data.title : data.data ) + "</a>";
                }
                if(data.children && data.children.length) {
                    str += '<ul>';
                    for(var i = 0; i < data.children.length; i++) {
                        str += this.parseJSON(data.children[i]);
                    }
                    str += '</ul>';
                }
                str += "</li>";
                return str;
            },
            // getJSON from HTML
            getJSON : function (nod, outer_attrib, inner_attrib, force) {
                var _this = this;
                if(!nod || $(nod).size() == 0) {
                    nod = this.container.children("ul").children("li");
                }
                else nod = $(nod);

                if(nod.size() > 1) {
                    var arr = [];
                    nod.each(function () {
                        arr.push(_this.getJSON(this, outer_attrib, inner_attrib));
                    });
                    return arr;
                }

                if(!outer_attrib) outer_attrib = [ "id", "rel", "class" ];
                if(!inner_attrib) inner_attrib = [ ];
                var obj = { attributes : {}, data : false };
                for(i in outer_attrib) {
                    obj.attributes[outer_attrib[i]] = nod.attr(outer_attrib[i]);
                }
                if(this.settings.languages.length) {
                    obj.data = {};
                    for(i in this.settings.languages) {
                        var a = nod.children("a." + this.settings.languages[i]);
                        if(force || inner_attrib.length || a.get(0).style.backgroundImage.toString().length) {
                            obj.data[this.settings.languages[i]] = {};
                            obj.data[this.settings.languages[i]].title = a.text();
                            if(a.get(0).style.backgroundImage.length) {
                                obj.data[this.settings.languages[i]].icon = a.get(0).style.backgroundImage.replace("url(","").replace(")","");
                            }
                            if(inner_attrib.length) {
                                obj.data[this.settings.languages[i]].attributes = {};
                                for(j in inner_attrib) {
                                    obj.data[this.settings.languages[i]].attributes[inner_attrib[j]] = a.attr(inner_attrib[j]);
                                }
                            }
                        }
                        else {
                            obj.data[this.settings.languages[i]] = a.text();
                        }
                    }
                }
                else {
                    var a = nod.children("a");
                    if(force || inner_attrib.length || a.get(0).style.backgroundImage.toString().length) {
                        obj.data = {};
                        obj.data.title = a.text();
                        if(a.get(0).style.backgroundImage.length) {
                            obj.data.icon = a.get(0).style.backgroundImage.replace("url(","").replace(")","");
                        }
                        if(inner_attrib.length) {
                            obj.data.attributes = {};
                            for(j in inner_attrib) {
                                obj.data.attributes[inner_attrib[j]] = a.attr(inner_attrib[j]);
                            }
                        }
                    }
                    else {
                        obj.data = a.text();
                    }
                }

                if(nod.children("ul").size() > 0) {
                    obj.children = [];
                    nod.children("ul").children("li").each(function () {
                        obj.children.push(_this.getJSON(this, outer_attrib, inner_attrib));
                    });
                }
                return obj;
            },
            focus : function () {
                if(this.locked) return false;
                if(tree_component.focused != this.cntr) {
                    tree_component.focused = this.cntr;
                    this.settings.callback.onfocus.call(null, this);
                }
            },
            show_context : function (obj, x, y) {
                var tmp = this.context.show().offsetParent();
                if(tmp.is("html")) tmp = $("body");
                tmp = tmp.offset();
                this.context.css({ "left" : (x - tmp.left - (this.settings.ui.rtl ? $(this.context).width() : -5 ) ), "top" : (y - tmp.top  + ($.browser.opera ? this.container.scrollTop() : 0) + 15) });
            },
            hide_context : function () {
                this.context.hide();
            },
            // ALL EVENTS
            attachEvents : function () {
                var _this = this;

                this.container
                    .listen("click", "li", function(event) { // WHEN CLICK IS ON THE ARROW
                        event.stopPropagation();
                        _this.toggle_branch.apply(_this, [event.target]);
                    })
                    .listen("click", "a.title", function (event) { // WHEN CLICK IS ON THE TEXT OR ICON
                        if(_this.locked) {
                            event.preventDefault();
                            event.target.blur();
                            return _this.error("LOCKED");
                        }
                        _this.select_branch.apply(_this, [event.target, event.ctrlKey || _this.settings.rules.multiple == "on"]);
                        if(_this.inp) { _this.inp.blur(); }
                        event.preventDefault();
                        event.target.blur();
                        return false;
                    })
                    .listen("dblclick", "a.title", function (event) { // WHEN DOUBLECLICK ON TEXT OR ICON
                        if(_this.locked) {
                            event.preventDefault();
                            event.stopPropagation();
                            event.target.blur();
                            return _this.error("LOCKED");
                        }
                        _this.settings.callback.ondblclk.call(null, _this.get_node(event.target).get(0), _this);
                        event.preventDefault();
                        event.stopPropagation();
                        event.target.blur();
                    })
                    .listen("contextmenu", "a.title", function (event) {
                        if(_this.locked) {
                            event.target.blur();
                            return _this.error("LOCKED");
                        }
                        _this.settings.callback.onrgtclk.call(null, _this.get_node(event.target).get(0), _this, event);
                        if(_this.context) {
                            if(_this.context.append == false) {
                                _this.container.find("ul:eq(0)").append(_this.context);
                                _this.context.append = true;
                                for(i in _this.settings.ui.context) {
                                    if(_this.settings.ui.context[i] == "separator") continue;
                                    (function () {
                                        var func = _this.settings.ui.context[i].action;
                                        _this.context.children("[rel=" + _this.settings.ui.context[i].id +"]").bind("click", function (event) {
                                            func.call(null, _this.selected_arr || _this.selected, _this);
                                            _this.hide_context();
                                            event.stopPropagation();
                                            event.preventDefault();
                                            return false;
                                        });
                                    })();
                                }
                            }
                            var obj = _this.get_node(event.target);
                            if(_this.inp) { _this.inp.blur(); }
                            if(obj) {
                                if(!obj.children("a:eq(0)").hasClass("clicked")) {
                                    _this.select_branch.apply(_this, [event.target, event.ctrlKey || _this.settings.rules.multiple == "on"]);
                                    event.target.blur();
                                }
                                _this.context.children("li").show();
                                var go = false;
                                for(i in _this.settings.ui.context) {
                                    if(_this.settings.ui.context[i] == "separator") continue;
                                    if(!_this.settings.ui.context[i].visible.call(null, _this.selected_arr || _this.selected, _this)) _this.context.children("[rel=" + _this.settings.ui.context[i].id +"]").hide();
                                    else go = true;
                                }
                                if(go == true) _this.show_context(obj, event.originalEvent.pageX, event.originalEvent.pageY);
                                event.preventDefault();
                                event.stopPropagation();
                                return false;
                            }
                        }
                        return true;
                    })
                    .listen("pointerenter", "a.title", function (event) {
                        if(_this.locked) {
                            event.preventDefault();
                            event.stopPropagation();
                            return _this.error("LOCKED");
                        }
                        if(_this.settings.ui.hover_mode && _this.hovered !== false && event.target.tagName == "A") {
                            _this.hovered.children("a").removeClass("hover");
                            _this.hovered = false;
                        }
                    });

                    // ATTACH DRAG & DROP ONLY IF NEEDED
                    if(this.settings.rules.draggable != "none" && this.settings.rules.dragrules != "none") {
                        this.container
                            .on('pointerup pointerdown', '.col2', function (e) {
                                if (!_this._drag) {
                                    e.stopPropagation();
                                }
                            })
                            .on("pointerdown", "a.title", function (event) {
                                _this.focus.apply(_this);
                                if(_this.locked) return _this.error("LOCKED");
                                // SELECT LIST ITEM NODE
                                var obj = _this.get_node(event.target);
                                // IF ITEM IS DRAGGABLE
                                if(_this.settings.rules.multiple != false && _this.selected_arr.length > 1 && obj.children("a:eq(0)").hasClass("clicked")) {
                                    var counter = 0;
                                    for(i in _this.selected_arr) {
                                        if(_this.check("draggable", _this.selected_arr[i])) {
                                            _this.selected_arr[i].addClass("dragged");
                                            counter ++;
                                        }
                                    }
                                    if(counter > 0) {
                                        if(_this.check("draggable", obj))    _this._drag = obj;
                                        else                                _this._drag = _this.container.find("li.dragged:eq(0)");
                                        _this.isdown    = true;
                                        _this.drag        = _this._drag.get(0).cloneNode(true);
                                        _this.drag.id    = "dragged";
                                        $(_this.drag).children("a").html("Multiple selection").end().children("ul").remove();
                                    }
                                }
                                else {
                                    if(_this.check("draggable", obj)) {
                                        _this._drag        = obj;
                                        _this.drag        = obj.get(0).cloneNode(true);
                                        _this.drag.id    = "dragged";
                                        _this.isdown    = true;
                                        _this.foreign    = false;
                                        obj.addClass("dragged");
                                    }
                                }
                                obj.blur();
                                event.preventDefault();
                                event.stopPropagation();
                                return false;
                            })
                            .listen("pointerup", "li", function (e) {
                                e.stopPropagation();
                            })
                            .listen("pointerup", "a.title", function (e) {
                                if (!_this._drag) {
                                    e.stopPropagation();
                                }
                            })

                        $('html')
                            .bind("pointerdown",    tree_component.mousedown)
                            .bind("pointerup",    tree_component.mouseup)
                            .bind("pointermove",    tree_component.mousemove);
                    }
                    // ENDIF OF DRAG & DROP FUNCTIONS
                if(_this.context) $('html').bind("pointerup", function() { _this.hide_context(); });
            },
            checkMove : function (NODES, REF_NODE, TYPE) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                // OVER SELF OR CHILDREN
                if(REF_NODE.parents("li.dragged").size() > 0 || REF_NODE.is(".dragged")) return this.error("MOVE: NODE OVER SELF");
                // CHECK AGAINST DRAG_RULES
                if(NODES.size() == 1) {
                    var NODE = NODES.eq(0);
                    if(NODE.hasClass("foreign")) {
                        if(this.settings.rules.droppable.length == 0) return false;
                        if(!NODE.is("." + this.settings.rules.droppable.join(", ."))) return false;
                        var ok = false;
                        for(i in this.settings.rules.droppable) {
                            if(NODE.is("." + this.settings.rules.droppable[i])) {
                                if(this.settings.rules.metadata) {
                                    $.metadata.setType("attr", this.settings.rules.metadata);
                                    NODE.attr(this.settings.rules.metadata, "type: '" + this.settings.rules.droppable[i] + "'");
                                }
                                else {
                                    NODE.attr(this.settings.rules.type_attr, this.settings.rules.droppable[i]);
                                }
                                ok = true;
                                break;
                            }
                        }
                        if(!ok) return false;
                    }
                    if(!this.check("dragrules", [NODE, TYPE, REF_NODE.parents("li:eq(0)")])) return this.error("MOVE: AGAINST DRAG RULES");
                }
                else {
                    var ok = true;
                    NODES.each(function (i) {
                        if(ok == false) return false;
                        if(i > 0) {
                            var ref = NODES.eq( (i - 1) );
                            var mv = "after";
                        }
                        else {
                            var ref = REF_NODE;
                            var mv = TYPE;
                        }
                        if(!_this.check.apply(_this,["dragrules", [$(this), mv, ref]])) ok = false;
                    });
                    if(ok == false) return this.error("MOVE: AGAINST DRAG RULES");
                }
                // CHECK AGAINST METADATA
                if(this.settings.rules.use_inline && this.settings.rules.metadata) {
                    var nd = false;
                    if(TYPE == "inside")    nd = REF_NODE.parents("li:eq(0)");
                    else                    nd = REF_NODE.parents("li:eq(1)");
                    if(nd.size()) {
                        // VALID CHILDREN CHECK
                        if(typeof nd.metadata()["valid_children"] != "undefined") {
                            var tmp = nd.metadata()["valid_children"];
                            var ok = true;
                            NODES.each(function (i) {
                                if(ok == false) return false;
                                if($.inArray(_this.get_type(this), tmp) == -1) ok = false;
                            });
                            if(ok == false) return this.error("MOVE: NOT A VALID CHILD");
                        }
                        // CHECK IF PARENT HAS FREE SLOTS FOR CHILDREN
                        if(typeof nd.metadata()["max_children"] != "undefined") {
                            if((nd.children("ul:eq(0)").children("li").not(".dragged").size() + NODES.size()) > nd.metadata().max_children) return this.error("MOVE: MAX CHILDREN REACHED");
                        }
                        // CHECK FOR MAXDEPTH UP THE CHAIN
                        var incr = 0;
                        NODES.each(function (i) {
                            var i = 1;
                            var t = $(this);
                            while(i < 100) {
                                t = t.children("ul:eq(0)");
                                if(t.size() == 0) break;
                                i ++
                            }
                            incr = Math.max(i,incr);
                        });
                        var ok = true;
                        nd.parents("li").each(function(i) {
                            if(ok == false) return false;
                            if($(this).metadata().max_depth) {
                                if( (i + incr) >= $(this).metadata().max_depth) ok = false;
                            }
                        });
                        if(ok == false) return this.error("MOVE: MAX_DEPTH REACHED");
                    }
                }
                return true;
            },
            // USED AFTER REFRESH
            reselect : function () {
                var _this = this;
                // REOPEN BRANCHES
                if(this.opened && this.opened.length) {
                    var opn = false;
                    for(var j = 0; j < this.opened.length; j++) {
                        if(this.settings.data.async) {
                            if(this.get_node(this.opened[j]).size() > 0) {
                                opn = true;
                                var tmp = this.opened[j];
                                delete this.opened[j];
                                this.open_branch(tmp, true, function () { _this.reselect.apply(_this); } )
                            }
                        }
                        else this.open_branch(this.opened[j], true);
                    }
                    if(this.settings.data.async && opn) return;
                    delete this.opened;
                }
                // REPOSITION SCROLL
                if(this.scrtop) {
                    this.container.scrollTop(_this.scrtop);
                    delete this.scrtop;
                }
                // RESELECT PREVIOUSLY SELECTED
                if(this.settings.selected !== false) {
                    $.each(this.settings.selected, function (i) {
                        _this.select_branch($(_this.settings.selected[i]), (_this.settings.rules.multiple !== false && i > 0) );
                    });
                    this.settings.selected = false;
                }
                this.settings.callback.onload.call(null, _this);
            },
            // GET THE EXTENDED LI ELEMENT
            get_node : function (obj) {
                var obj = $(obj);
                return obj.is("li") ? obj : obj.parents("li:eq(0)");
            },
            // GET THE TYPE OF THE NODE
            get_type : function (obj) {
                obj = !obj ? this.selected : this.get_node(obj);
                if(!obj) return;
                if(this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    var tmp = obj.metadata().type;
                    if(tmp) return tmp;
                }
                return obj.attr(this.settings.rules.type_attr);
            },
            // SCROLL CONTAINER WHILE DRAGGING
            scrollCheck : function (x,y) {
                var _this = this;
                var cnt = _this.container;
                var off = _this.offset;

                var st = cnt.scrollTop();
                var sl = cnt.scrollLeft();
                // DETECT HORIZONTAL SCROLL
                var h_cor = (cnt.get(0).scrollWidth > cnt.width()) ? 40 : 20;

                if(y - off.top < 20)                        cnt.scrollTop(Math.max( (st - _this.settings.ui.scroll_spd) ,0));    // NEAR TOP
                if(cnt.height() - (y - off.top) < h_cor)    cnt.scrollTop(st + _this.settings.ui.scroll_spd);                    // NEAR BOTTOM
                if(x - off.left < 20)                        cnt.scrollLeft(Math.max( (sl - _this.settings.ui.scroll_spd),0));    // NEAR LEFT
                if(cnt.width() - (x - off.left) < 40)        cnt.scrollLeft(sl + _this.settings.ui.scroll_spd);                    // NEAR RIGHT

                if(cnt.scrollLeft() != sl || cnt.scrollTop() != st) {
                    _this.moveType = false;
                    _this.moveRef = false;
                    $("#marker").hide();
                }
                tree_component.sto = setTimeout( function() { _this.scrollCheck(x,y); }, 50);
            },
            check : function (rule, nodes) {
                if(this.locked) return this.error("LOCKED");
                // CHECK LOCAL RULES IF METADATA
                if(rule != "dragrules" && this.settings.rules.use_inline && this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    if(typeof this.get_node(nodes).metadata()[rule] != "undefined") return this.get_node(nodes).metadata()[rule];
                }
                if(!this.settings.rules[rule])            return false;
                if(this.settings.rules[rule] == "none")    return false;
                if(this.settings.rules[rule] == "all")    return true;
                if(rule == "dragrules") {
                    var nds = new Array();
                    nds[0] = this.get_type(nodes[0]);
                    nds[1] = nodes[1];
                    nds[2] = this.get_type(nodes[2]);
                    for(var i = 0; i < this.settings.rules.dragrules.length; i++) {
                        var r = this.settings.rules.dragrules[i];
                        var n = (r.indexOf("!") === 0) ? false : true;
                        if(!n) r = r.replace("!","");
                        var tmp = r.split(" ");
                        for(var j = 0; j < 3; j++) {
                            if(tmp[j] == nds[j] || tmp[j] == "*") tmp[j] = true;
                        }
                        if(tmp[0] === true && tmp[1] === true && tmp[2] === true) return n;
                    }
                    return false;
                }
                else
                    return ($.inArray(this.get_type(nodes),this.settings.rules[rule]) != -1) ? true : false;
            },
            hover_branch : function (obj) {
                if(this.locked) return this.error("LOCKED");
                if(this.settings.ui.hover_mode == false) return this.select_branch(obj);
                var _this = this;
                var obj = _this.get_node(obj);
                if(!obj.size()) return this.error("HOVER: NOT A VALID NODE");
                // CHECK AGAINST RULES FOR SELECTABLE NODES
                if(!_this.check("clickable", obj)) return this.error("SELECT: NODE NOT SELECTABLE");
                if(this.hovered) this.hovered.children("A").removeClass("hover");

                // SAVE NEWLY SELECTED
                this.hovered = obj;

                // FOCUS NEW NODE AND OPEN ALL PARENT NODES IF CLOSED
                this.hovered.children("a").removeClass("hover").addClass("hover");

                // SCROLL SELECTED NODE INTO VIEW
                var off_t = this.hovered.offset().top;
                var beg_t = this.container.offset().top;
                var end_t = beg_t + this.container.height();
                var h_cor = (this.container.get(0).scrollWidth > this.container.width()) ? 40 : 20;
                if(off_t + 5 < beg_t) this.container.scrollTop(this.container.scrollTop() - (beg_t - off_t + 5) );
                if(off_t + h_cor > end_t) this.container.scrollTop(this.container.scrollTop() + (off_t + h_cor - end_t) );
            },
            select_branch : function (obj, multiple) {
                if(this.locked) return this.error("LOCKED");
                if(!obj && this.hovered !== false) obj = this.hovered;
                var _this = this;
                obj = _this.get_node(obj);
                if(!obj.size()) return this.error("SELECT: NOT A VALID NODE");
                obj.children("a").removeClass("hover");
                // CHECK AGAINST RULES FOR SELECTABLE NODES
                if(!_this.check("clickable", obj)) return this.error("SELECT: NODE NOT SELECTABLE");
                if(_this.settings.callback.beforechange.call(null,obj.get(0),_this) === false) return this.error("SELECT: STOPPED BY USER");
                // IF multiple AND obj IS ALREADY SELECTED - DESELECT IT
                if(this.settings.rules.multiple != false && multiple && obj.children("a.clicked").size() > 0) {
                    return this.deselect_branch(obj);
                }
                if(this.settings.rules.multiple != false && multiple) {
                    this.selected_arr.push(obj);
                }
                if(this.settings.rules.multiple != false && !multiple) {
                    for(i in this.selected_arr) {
                        this.selected_arr[i].children("A").removeClass("clicked");
                    }
                    this.selected_arr = [];
                    this.selected_arr.push(obj);
                    if(this.selected) this.selected.children("A").removeClass("clicked");
                }
                if(!this.settings.rules.multiple) {
                    if(this.selected) this.selected.children("A").removeClass("clicked");
                }
                // SAVE NEWLY SELECTED
                this.selected = obj;
                if(this.settings.ui.hover_mode && this.hovered !== false) {
                    this.hovered.children("A").removeClass("hover");
                    this.hovered = obj;
                }

                // FOCUS NEW NODE AND OPEN ALL PARENT NODES IF CLOSED
                this.selected.children("a").removeClass("clicked").addClass("clicked").end().parents("li.closed").each( function () { _this.open_branch(this, true); });

                // SCROLL SELECTED NODE INTO VIEW
                var off_t = this.selected.offset().top;
                var beg_t = this.container.offset().top;
                var end_t = beg_t + this.container.height();
                var h_cor = (this.container.get(0).scrollWidth > this.container.width()) ? 40 : 20;
                if(off_t + 5 < beg_t) this.container.scrollTop(this.container.scrollTop() - (beg_t - off_t + 5) );
                if(off_t + h_cor > end_t) this.container.scrollTop(this.container.scrollTop() + (off_t + h_cor - end_t) );

                this.set_cookie("selected");
                this.settings.callback.onchange.call(null, this.selected.get(0), _this);
            },
            deselect_branch : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                var obj = this.get_node(obj);
                obj.children("a").removeClass("clicked");
                if(this.settings.rules.multiple != false && this.selected_arr.length > 1) {
                    this.selected_arr = [];
                    this.container.find("a.clicked").filter(":first-child").parent().each(function () {
                        _this.selected_arr.push($(this));
                    });
                    if(obj.get(0) == this.selected.get(0)) {
                        this.selected = this.selected_arr[0];
                        this.set_cookie("selected");
                    }
                }
                else {
                    if(this.settings.rules.multiple != false) this.selected_arr = [];
                    this.selected = false;
                    this.set_cookie("selected");
                }
                if(this.selected)    this.settings.callback.onchange.call(null, this.selected.get(0), _this);
                else                this.settings.callback.onchange.call(null, false, _this);
            },
            toggle_branch : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var obj = this.get_node(obj);
                if(obj.hasClass("closed"))    return this.open_branch(obj);
                if(obj.hasClass("open"))    return this.close_branch(obj);
            },
            open_branch : function (obj, disable_animation, callback) {
                if(this.locked) return this.error("LOCKED");
                var obj = this.get_node(obj);
                if(!obj.size()) return this.error("OPEN: NO SUCH NODE");
                if(obj.hasClass("leaf")) return this.error("OPEN: OPENING LEAF NODE");

                if(this.settings.data.async && obj.find("li").size() == 0) {
                    var _this = this;
                    obj.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a style='background-image:url(" + _this.settings.ui.theme_path + "default/throbber.gif)' href='#'>" + (_this.settings.lang.loading || "Loading ...") + "</a></li></ul>");
                    obj.removeClass("closed").addClass("open");
                    if(this.settings.data.type == "xml_flat" || this.settings.data.type == "xml_nested") {
                        var xsl = (this.settings.data.type == "xml_flat") ? "flat.xsl" : "nested.xsl";
                        var str = (this.settings.data.url.indexOf("?") == -1) ? "?id=" + encodeURIComponent(obj.attr("id")) : "&id=" + encodeURIComponent(obj.attr("id"));
                        obj.children("ul:eq(0)").getTransform(this.path + xsl, this.settings.data.url + str, { params : { theme_path : _this.theme }, meth : this.settings.data.method, repl : true, callback: function (str, json) {
                                if(str.length < 15) {
                                    obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();
                                    if(callback) callback.call();
                                    return;
                                }
                                _this.open_branch.apply(_this, [obj]);
                                if(callback) callback.call();
                            }
                        });
                    }
                    else {
                        $.ajax({
                            type        : this.settings.data.method,
                            url            : this.settings.data.url,
                            data        : this.settings.data.async_data(obj),
                            dataType    : "json",
                            success        : function (data, textStatus) {
                                if(!data || data.length == 0) {
                                    obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();
                                    if(callback) callback.call();
                                    return;
                                }
                                var str = "";
                                if(data.length) {
                                    for(var i = 0; i < data.length; i++) {
                                        str += _this.parseJSON(data[i]);
                                    }
                                }
                                else str = _this.parseJSON(data);
                                obj.children("ul:eq(0)").replaceWith("<ul>" + str + "</ul>");
                                obj.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                                obj.find("li").not(".open").not(".closed").addClass("leaf");
                                _this.open_branch.apply(_this, [obj]);
                                if(callback) callback.call();
                            }
                        });
                    }
                    return true;
                }
                else {
                    if(parseInt(this.settings.ui.animation) > 0 && !disable_animation && !($.browser.msie && $.browser.version < 7) ) {
                        obj.children("ul:eq(0)").css("display","none");
                        obj.removeClass("closed").addClass("open");
                        obj.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation), function() {
                            $(this).css("display","");
                            if(callback) callback.call();
                        });
                    } else {
                        obj.removeClass("closed").addClass("open");
                        if(callback) callback.call();
                    }
                    this.set_cookie("open");
                    this.settings.callback.onopen.call(null, obj.get(0), this);
                    return true;
                }
            },
            close_branch : function (obj, disable_animation) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                var obj = this.get_node(obj);
                if(parseInt(this.settings.ui.animation) > 0 && !disable_animation && !($.browser.msie && $.browser.version < 7) && obj.children("ul:eq(0)").size() == 1) {
                    obj.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation), function() {
                        obj.removeClass("open").addClass("closed");
                        _this.set_cookie("open");
                        $(this).css("display","");
                    });
                }
                else {
                    obj.removeClass("open").addClass("closed");
                    this.set_cookie("open");
                }
                if(this.selected && obj.children("ul:eq(0)").find("a.clicked").size() > 0) {
                    obj.find("li:has(a.clicked)").each(function() {
                        _this.deselect_branch(this);
                    });
                    if(obj.children("a.clicked").size() == 0) this.select_branch(obj, (this.settings.rules.multiple != false && this.selected_arr.length > 0) );
                }
                this.settings.callback.onclose.call(null, obj.get(0), this);
            },
            open_all : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                obj = obj ? $(obj) : this.container;
                obj.find("li.closed").each( function () { var __this = this; _this.open_branch.apply(_this, [this, true, function() { _this.open_all.apply(_this, [__this]); } ]); });
            },
            close_all : function () {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                $(this.container).find("li.open").each( function () { _this.close_branch(this, true); });
            },
            show_lang : function (i) {
                if(this.locked) return this.error("LOCKED");
                if(this.settings.languages[i] == this.current_lang) return true;
                var st = false;
                var id = this.container.attr("id") ? "#" + this.container.attr("id") : ".tree";
                st = get_css(id + " ." + this.current_lang, this.sn);
                if(st !== false) st.style.display = "none";
                st = get_css(id + " ." + this.settings.languages[i], this.sn);
                if(st !== false) st.style.display = "block";
                this.current_lang = this.settings.languages[i];
                return true;
            },
            cycle_lang : function() {
                if(this.locked) return this.error("LOCKED");
                var i = $.inArray(this.current_lang, this.settings.languages);
                i ++;
                if(i > this.settings.languages.length - 1) i = 0;
                this.show_lang(i);
            },
            create : function (type, obj, data, icon, id ) {
                if(this.locked) return this.error("LOCKED");
                // NOTHING SELECTED
                obj = obj ? this.get_node(obj) : this.selected;
                if(!obj || !obj.size()) return this.error("CREATE: NO NODE SELECTED");
                if(!this.check("creatable", obj)) return this.error("CREATE: CANNOT CREATE IN NODE");

                var t = type || this.get_type(obj) || "";
                if(this.settings.rules.use_inline && this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    if(typeof obj.metadata()["valid_children"] != "undefined") {
                        if($.inArray(t, obj.metadata()["valid_children"]) == -1) return this.error("CREATE: NODE NOT A VALID CHILD");
                    }
                    if(typeof obj.metadata()["max_children"] != "undefined") {
                        if( (obj.children("ul:eq(0)").children("li").size() + 1) > obj.metadata().max_children) return this.error("CREATE: MAX_CHILDREN REACHED");
                    }
                    var ok = true;
                    obj.parents("li").each(function(i) {
                        if($(this).metadata().max_depth) {
                            if( (i + 1) >= $(this).metadata().max_depth) {
                                ok = false;
                            }
                        }
                    });
                    if(!ok) return this.error("CREATE: MAX_DEPTH REACHED");
                }
                if(obj.hasClass("closed")) {
                    var _this = this;
                    return this.open_branch(obj, true, function () { _this.create.apply(_this, [type, obj, data, icon, id]); } );
                }

                if(id)    $li = $("<li id='" + id + "' />");
                else    $li = $("<li />");
                // NEW NODE IS OF PASSED TYPE OR PARENT'S TYPE
                if(this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    $li.attr(this.settings.rules.metadata, "type: '" + t + "'");
                }
                else {
                    $li.attr(this.settings.rules.type_attr, t)
                }

                var icn = "";
                if((typeof icon).toLowerCase() == "string") {
                    icn = icon;
                    icn = icn.indexOf("/") == -1 ? this.theme + icn : icn;
                }
                if(this.settings.languages.length) {
                    for(i = 0; i < this.settings.languages.length; i++) {
                        if((typeof data).toLowerCase() == "string") val = data;
                        else if(data && data[i]) {
                            val = data[i];
                        }
                        else if(this.settings.lang.new_node) {
                            if((typeof this.settings.lang.new_node).toLowerCase() != "string" && this.settings.lang.new_node[i])
                                val = this.settings.lang.new_node[i];
                            else
                                val = this.settings.lang.new_node;
                        }
                        else {
                            val = "New folder";
                        }
                        if((typeof icon).toLowerCase() != "string" && icon && icon[i]) {
                            icn = icon[i];
                            icn = icn.indexOf("/") == -1 ? this.theme + icn : icn;
                        }
                        $li.append("<a href='#'" + ( icn.length ? " style='background-image:url(\"" + icn + "\");' " : " ") + "class='" + this.settings.languages[i] + "'>" + val + "</a>");
                    }
                }
                else { $li.append("<a href='#'" + ( icn.length ? " style='background-image:url(\"" + icn + "\");' " : " ") + ">" + (data || this.settings.lang.new_node || "New folder") + "</a>"); }
                $li.addClass("leaf");
                if(this.settings.rules.createat == "top" || obj.children("ul").size() == 0) {
                    this.moved($li,obj.children("a:eq(0)"),"inside", true);
                }
                else {
                    this.moved($li,obj.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",true);
                }
                this.select_branch($li.children("a:eq(0)"));
                if(!data) this.rename();
                return $li;
            },
            rename : function () {
                if(this.locked) return this.error("LOCKED");
                if(this.selected) {
                    var _this = this;
                    if(!this.check("renameable", this.selected)) return this.error("RENAME: NODE NOT RENAMABLE");
                    if(!this.settings.callback.beforerename.call(null,this.selected.get(0), _this.current_lang, _this)) return this.error("RENAME: STOPPED BY USER");
                    var obj = this.selected;
                    if(this.current_lang)    obj = obj.find("a." + this.current_lang).get(0);
                    else                    obj = obj.find("a:first").get(0);
                    last_value = obj.innerHTML;
                    _this.inp = $("<input type='text' />");
                    _this.inp
                        .val(last_value)
                        .bind("pointerdown",        function (event) { event.stopPropagation(); })
                        .bind("pointerup",        function (event) { event.stopPropagation(); })
                        .bind("click",            function (event) { event.stopPropagation(); })
                        .bind("keyup",            function (event) {
                                var key = event.keyCode || event.which;
                                if(key == 27) { this.value = last_value; this.blur(); return }
                                if(key == 13) { this.blur(); return }
                            });
                    _this.inp.blur(function(event) {
                            if(this.value == "") this.value == last_value;
                            $(obj).html( $(obj).parent().find("input").eq(0).attr("value") ).get(0).style.display = "";
                            $(obj).prevAll("span").remove();
                            if(this.value != last_value) _this.settings.callback.onrename.call(null, _this.get_node(obj).get(0), _this.current_lang, _this);
                            _this.inp = false;
                        });
                    var spn = $("<span />").addClass(obj.className).append(_this.inp);
                    spn.attr("style", $(obj).attr("style"));
                    obj.style.display = "none";
                    $(obj).parent().prepend(spn);
                    _this.inp.get(0).focus();
                    _this.inp.get(0).select();
                }
                else return this.error("RENAME: NO NODE SELECTED");
            },
            // REMOVE NODES
            remove : function(obj) {
                if(this.locked) return this.error("LOCKED");
                if(obj) {
                    obj = this.get_node(obj);
                    if(obj.size()) {
                        if(!this.check("deletable", obj)) return this.error("DELETE: NODE NOT DELETABLE");
                        if(!this.settings.callback.beforedelete.call(null,obj.get(0), _this)) return this.error("DELETE: STOPPED BY USER");
                        $parent = obj.parent();
                        obj = obj.remove();
                        $parent.children("li:last").addClass("last");
                        if($parent.children("li").size() == 0) {
                            $li = $parent.parents("li:eq(0)");
                            $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                            this.set_cookie("open");
                        }
                        this.settings.callback.ondelete.call(null, obj, this);
                    }
                }
                else if(this.selected) {
                    if(!this.check("deletable", this.selected)) return this.error("DELETE: NODE NOT DELETABLE");
                    if(!this.settings.callback.beforedelete.call(null,this.selected.get(0), _this)) return this.error("DELETE: STOPPED BY USER");
                    $parent = this.selected.parent();
                    var obj = this.selected;
                    if(this.settings.rules.multiple == false || this.selected_arr.length == 1) {
                        var stop = true;
                        var tmp = (this.selected.prev("li:eq(0)").size()) ? this.selected.prev("li:eq(0)") : this.selected.parents("li:eq(0)");
                        // this.get_prev(true);
                    }
                    obj = obj.remove();
                    $parent.children("li:last").addClass("last");
                    if($parent.children("li").size() == 0) {
                        $li = $parent.parents("li:eq(0)");
                        $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                        this.set_cookie("open");
                    }
                    //this.selected = false;
                    this.settings.callback.ondelete.call(null, obj, this);
                    if(stop && tmp) this.select_branch(tmp);
                    if(this.settings.rules.multiple != false && !stop) {
                        var _this = this;
                        this.selected_arr = [];
                        this.container.find("a.clicked").filter(":first-child").parent().each(function () {
                            _this.selected_arr.push($(this));
                        });
                        if(this.selected_arr.length > 0) {
                            this.selected = this.selected_arr[0];
                            this.remove();
                        }
                    }
                }
                else return this.error("DELETE: NO NODE SELECTED");
            },
            // FOR EXPLORER-LIKE KEYBOARD SHORTCUTS
            get_next : function(force) {
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.hasClass("open"))                        return force ? this.select_branch(obj.find("li:eq(0)")) : this.hover_branch(obj.find("li:eq(0)"));
                    else if($(obj).nextAll("li").size() > 0)    return force ? this.select_branch(obj.nextAll("li:eq(0)")) : this.hover_branch(obj.nextAll("li:eq(0)"));
                    else                                            return force ? this.select_branch(obj.parents("li").next("li").eq(0)) : this.hover_branch(obj.parents("li").next("li").eq(0));
                }
            },
            get_prev : function(force) {
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.prev("li").size()) {
                        var obj = obj.prev("li").eq(0);
                        while(obj.hasClass("open")) obj = obj.children("ul:eq(0)").children("li:last");
                        return force ? this.select_branch(obj) : this.hover_branch(obj);
                    }
                    else { return force ? this.select_branch(obj.parents("li:eq(0)")) : this.hover_branch(obj.parents("li:eq(0)")); }
                }
            },
            get_left : function(force, rtl) {
                if(this.settings.ui.rtl && !rtl) return this.get_right(force, true);
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.hasClass("open"))    this.close_branch(obj);
                    else {
                        return force ? this.select_branch(obj.parents("li:eq(0)")) : this.hover_branch(obj.parents("li:eq(0)"));
                    }
                }
            },
            get_right : function(force, rtl) {
                if(this.settings.ui.rtl && !rtl) return this.get_left(force, true);
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.hasClass("closed"))    this.open_branch(obj);
                    else {
                        return force ? this.select_branch(obj.find("li:eq(0)")) : this.hover_branch(obj.find("li:eq(0)"));
                    }
                }
            },
            toggleDots : function () {
                this.container.toggleClass("no_dots");
            },
            set_cookie : function (type) {
                if(this.settings.cookies === false) return false;
                switch(type) {
                    /*case "selected":
                        if(this.settings.rules.multiple != false && this.selected_arr.length > 1) {
                            var val = Array();
                            jQuery.each(this.selected_arr, function () {
                                val.push(this.attr("id"));
                            });
                            val = val.join(",");
                        }
                        else var val = this.selected ? this.selected.attr("id") : false;
                        jQuery.cookie(this.settings.cookies.prefix + '_selected',val,this.settings.cookies.opts);
                        break;*/
                    case "open":
                        var str = "";
                        this.container.find("li.open").each(function (i) { str += this.id + ","; });
                        $.cookie(this.settings.cookies.prefix + '_open',str.replace(/,$/ig,""),this.settings.cookies.opts);
                        break;
                }
            },
            moved : function (what, where, how, is_new, is_copy) {
                var what    = $(what);
                var $parent    = $(what).parents("ul:eq(0)");
                var $where    = $(where);
                // IF MULTIPLE
                if(what.size() > 1) {
                    var _this = this;
                    var tmp = this.moved(what.eq(0),where,how, false, is_copy);
                    what.each(function (i) {
                        if(i == 0) return;
                        tmp = _this.moved(this, tmp.children("a:eq(0)"), "after", false, is_copy);
                    })
                    return;
                }
                if(is_copy) {
                    what = what.clone();
                    what.each(function (i) {
                        this.id = this.id + "_copy";
                        $(this).find("li").each(function () {
                            this.id = this.id + "_copy";
                        })
                        $(this).find("a.clicked").removeClass("clicked");
                    });
                }
                if(is_new) {
                    if(!this.settings.callback.beforecreate.call(null,this.get_node(what).get(0), this.get_node(where).get(0),how,this)) return;
                }
                else {
                    if(!this.settings.callback.beforemove.call(null,this.get_node(what).get(0), this.get_node(where).get(0),how,this)) return;
                }

                if(!is_new) {
                    var tmp = $(what).parents(".tree:eq(0)");
                    // if different trees
                    if(tmp.get(0) != this.container.get(0)) {
                        tmp = tree_component.inst[tmp.attr("id")];
                        // if there are languages - otherwise - no cleanup needed
                        if(tmp.settings.languages.length) {
                            var res = [];
                            // if new tree has no languages - use current visible
                            if(this.settings.languages.length == 0) res.push("." + tmp.current_lang);
                            else {
                                for(i in this.settings.languages) {
                                    for(j in tmp.settings.languages) {
                                        if(this.settings.languages[i] == tmp.settings.languages[j]) res.push("." + this.settings.languages[i]);
                                    }
                                }
                            }
                            if(res.length == 0) return this.error("MOVE: NO COMMON LANGUAGES");
                            what.find("a").removeClass("clicked").not(res.join(",")).remove();
                        }
                    }
                }

                // ADD NODE TO NEW PLACE
                switch(how) {
                    case "before":
                        $where.parents("ul:eq(0)").children("li.last").removeClass("last");
                        $where.parents("li:eq(0)").before(what.removeClass("last"));
                        $where.parents("ul:eq(0)").children("li:last").addClass("last");
                        break;
                    case "after":
                        $where.parents("ul:eq(0)").children("li.last").removeClass("last");
                        $where.parents("li:eq(0)").after(what.removeClass("last"));
                        $where.parents("ul:eq(0)").children("li:last").addClass("last");
                        break;
                    case "inside":
                        if(this.settings.data.async) {
                            var obj = this.get_node($where);
                            if(obj.hasClass("closed")) {
                                var _this = this;
                                return this.open_branch(obj, true, function () { _this.moved.apply(_this, [what, where, how, is_new, is_copy]); })
                            }
                        }
                        if($where.parents("li:eq(0)").children("ul:first").size()) {
                            if(this.settings.rules.createat == "top")    $where.parents("li:eq(0)").children("ul:first").prepend(what.removeClass("last")).children("li:last").addClass("last");
                            else                                        $where.parents("li:eq(0)").children("ul:first").children(".last").removeClass("last").end().append(what.removeClass("last")).children("li:last").addClass("last");
                        }
                        else {
                            what.addClass("last");
                            $where.parents("li:eq(0)").append("<ul/>").removeClass("leaf").addClass("closed");
                            $where.parents("li:eq(0)").children("ul:first").prepend(what);
                        }
                        if(!this.settings.data.async) {
                            this.open_branch($where);
                        }
                        break;
                    default:
                        break;
                }
                // CLEANUP OLD PARENT
                if($parent.find("li").size() == 0) {
                    var $li = $parent.parent();
                    $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                    $li.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last");
                    this.set_cookie("open");
                }
                else {
                    $parent.children("li.last").removeClass("last");
                    $parent.children("li:last").addClass("last");
                }
                if(is_new && how != "inside") where = this.get_node(where).parents("li:eq(0)");
                if(is_copy)        this.settings.callback.oncopy.call(null, this.get_node(what).get(0), this.get_node(where).get(0), how, this)
                else if(is_new)    this.settings.callback.oncreate.call(null, this.get_node(what).get(0), this.get_node(where).get(0), this.settings.insertAt, this);
                else            this.settings.callback.onmove.call(null, this.get_node(what).get(0), this.get_node(where).get(0), how, this);
                return what;
            },
            error : function (code) {
                this.settings.callback.error.call(null,code,this);
                return false;
            },
            lock : function (state) {
                this.locked = state;
                if(this.locked)    this.container.addClass("locked");
                else            this.container.removeClass("locked");
            },
            cut : function () {
                if(this.locked) return this.error("LOCKED");
                if(!this.selected) return this.error("CUT: NO NODE SELECTED");
                this.copy_nodes = false;
                this.cut_nodes = this.container.find("a.clicked").filter(":first-child").parent();
            },
            copy : function () {
                if(this.locked) return this.error("LOCKED");
                if(!this.selected) return this.error("COPY: NO NODE SELECTED");
                this.copy_nodes = this.container.find("a.clicked").filter(":first-child").parent();
                this.cut_nodes = false;
            },
            paste : function () {
                if(this.locked) return this.error("LOCKED");
                if(!this.selected) return this.error("PASTE: NO NODE SELECTED");
                if(!this.copy_nodes && !this.cut_nodes) return this.error("PASTE: NOTHING TO DO");
                if(this.copy_nodes && this.copy_nodes.size()) {
                    if(!this.checkMove(this.copy_nodes, this.selected.children("a:eq(0)"), "inside")) return false;
                    this.moved(this.copy_nodes, this.selected.children("a:eq(0)"), "inside", false, true);
                    this.copy_nodes = false;
                }
                if(this.cut_nodes && this.cut_nodes.size()) {
                    if(!this.checkMove(this.cut_nodes, this.selected.children("a:eq(0)"), "inside")) return false;
                    this.moved(this.cut_nodes, this.selected.children("a:eq(0)"), "inside");
                    this.cut_nodes = false;
                }
            },
            search : function(str) {
                var _this = this;
                if(!str || (this.srch && str != this.srch) ) {
                    this.srch = "";
                    this.srch_opn = false;
                    this.container.find("a.search").removeClass("search");
                }
                this.srch = str;
                if(!str) return;
                if(this.settings.data.async) {
                    if(!this.srch_opn) {
                        var dd = $.extend( { "search" : str } , this.settings.data.async_data(false) );
                        $.ajax({
                            type        : this.settings.data.method,
                            url            : this.settings.data.url,
                            data        : dd,
                            dataType    : "text",
                            success        : function (data) {
                                _this.srch_opn = $.unique(data.split(","));
                                _this.search.apply(_this,[str]);
                            }
                        });
                    }
                    else if(this.srch_opn.length) {
                        if(this.srch_opn && this.srch_opn.length) {
                            var opn = false;
                            for(var j = 0; j < this.srch_opn.length; j++) {
                                if(this.get_node("#" + this.srch_opn[j]).size() > 0) {
                                    opn = true;
                                    var tmp = "#" + this.srch_opn[j];
                                    delete this.srch_opn[j];
                                    this.open_branch(tmp, true, function () { _this.search.apply(_this,[str]); } );
                                }
                            }
                            if(!opn) {
                                this.srch_opn = [];
                                 _this.search.apply(_this,[str]);
                            }
                        }
                    }
                    else {
                        var selector = "a";
                        // IF LANGUAGE VERSIONS
                        if(this.settings.languages.length) selector += "." + this.current_lang;
                        this.container.find(selector + ":contains('" + str + "')").addClass("search");
                        this.srch_opn = false;
                    }
                }
                else {
                    var selector = "a";
                    // IF LANGUAGE VERSIONS
                    if(this.settings.languages.length) selector += "." + this.current_lang;
                    this.container.find(selector + ":contains('" + str + "')").addClass("search").parents("li.closed").each( function () { _this.open_branch(this, true); });
                }
            },

            destroy : function() {
                try {
                    var evts = ["click","dblclick","contextmenu","pointerover","pointerdown"];
                    for(i in evts) {
                        var idxer = this.container.indexer(evts[i]);
                        idxer.stop();
                        $.removeData( idxer.listener, idxer.event + '.indexer' );
                    }
                } catch(err) { }
                this.container.unbind();

                this.container.removeClass("tree").children("ul").removeClass("tree-" + this.settings.ui.theme_name).find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked");

                if(this.cntr == tree_component.focused) {
                    for(i in tree_component.inst) {
                        if(i != this.cntr && i != this.container.attr("id")) {
                            tree_component.inst[i].focus();
                            break;
                        }
                    }
                }
                delete tree_component.inst[this.cntr];
                delete tree_component.inst[this.container.attr("id")];
                tree_component.cntr --;
            }
        }
    };
}(CMS.$));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS51aS5jdXN0b20uanMiLCJjbXMuY2hhbmdlbGlzdC5qcyIsIl9hbGwuanMiLCJ0cmVlX2NvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYnVuZGxlLmFkbWluLmNoYW5nZWxpc3QubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohIGpRdWVyeSBVSSAtIHYxLjExLjQgLSAyMDE1LTExLTEzXG4qIGh0dHA6Ly9qcXVlcnl1aS5jb21cbiogSW5jbHVkZXM6IGNvcmUuanMsIHdpZGdldC5qcywgbW91c2UuanMsIHNvcnRhYmxlLmpzLCBlZmZlY3QuanNcbiogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVCAqL1xuXG4oZnVuY3Rpb24oZSl7XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXCJqcXVlcnlcIl0sZSk6ZShqUXVlcnkpfSkoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCh0LHMpe3ZhciBuLGEsbyxyPXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm5cImFyZWFcIj09PXI/KG49dC5wYXJlbnROb2RlLGE9bi5uYW1lLHQuaHJlZiYmYSYmXCJtYXBcIj09PW4ubm9kZU5hbWUudG9Mb3dlckNhc2UoKT8obz1lKFwiaW1nW3VzZW1hcD0nI1wiK2ErXCInXVwiKVswXSwhIW8mJmkobykpOiExKTooL14oaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QpJC8udGVzdChyKT8hdC5kaXNhYmxlZDpcImFcIj09PXI/dC5ocmVmfHxzOnMpJiZpKHQpfWZ1bmN0aW9uIGkodCl7cmV0dXJuIGUuZXhwci5maWx0ZXJzLnZpc2libGUodCkmJiFlKHQpLnBhcmVudHMoKS5hZGRCYWNrKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuXCJoaWRkZW5cIj09PWUuY3NzKHRoaXMsXCJ2aXNpYmlsaXR5XCIpfSkubGVuZ3RofWUudWk9ZS51aXx8e30sZS5leHRlbmQoZS51aSx7dmVyc2lvbjpcIjEuMTEuNFwiLGtleUNvZGU6e0JBQ0tTUEFDRTo4LENPTU1BOjE4OCxERUxFVEU6NDYsRE9XTjo0MCxFTkQ6MzUsRU5URVI6MTMsRVNDQVBFOjI3LEhPTUU6MzYsTEVGVDozNyxQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFJJR0hUOjM5LFNQQUNFOjMyLFRBQjo5LFVQOjM4fX0pLGUuZm4uZXh0ZW5kKHtzY3JvbGxQYXJlbnQ6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5jc3MoXCJwb3NpdGlvblwiKSxzPVwiYWJzb2x1dGVcIj09PWksbj10Py8oYXV0b3xzY3JvbGx8aGlkZGVuKS86LyhhdXRvfHNjcm9sbCkvLGE9dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIHQ9ZSh0aGlzKTtyZXR1cm4gcyYmXCJzdGF0aWNcIj09PXQuY3NzKFwicG9zaXRpb25cIik/ITE6bi50ZXN0KHQuY3NzKFwib3ZlcmZsb3dcIikrdC5jc3MoXCJvdmVyZmxvdy15XCIpK3QuY3NzKFwib3ZlcmZsb3cteFwiKSl9KS5lcSgwKTtyZXR1cm5cImZpeGVkXCIhPT1pJiZhLmxlbmd0aD9hOmUodGhpc1swXS5vd25lckRvY3VtZW50fHxkb2N1bWVudCl9LHVuaXF1ZUlkOmZ1bmN0aW9uKCl7dmFyIGU9MDtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5pZHx8KHRoaXMuaWQ9XCJ1aS1pZC1cIisgKytlKX0pfX0oKSxyZW1vdmVVbmlxdWVJZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsvXnVpLWlkLVxcZCskLy50ZXN0KHRoaXMuaWQpJiZlKHRoaXMpLnJlbW92ZUF0dHIoXCJpZFwiKX0pfX0pLGUuZXh0ZW5kKGUuZXhwcltcIjpcIl0se2RhdGE6ZS5leHByLmNyZWF0ZVBzZXVkbz9lLmV4cHIuY3JlYXRlUHNldWRvKGZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4hIWUuZGF0YShpLHQpfX0pOmZ1bmN0aW9uKHQsaSxzKXtyZXR1cm4hIWUuZGF0YSh0LHNbM10pfSxmb2N1c2FibGU6ZnVuY3Rpb24oaSl7cmV0dXJuIHQoaSwhaXNOYU4oZS5hdHRyKGksXCJ0YWJpbmRleFwiKSkpfSx0YWJiYWJsZTpmdW5jdGlvbihpKXt2YXIgcz1lLmF0dHIoaSxcInRhYmluZGV4XCIpLG49aXNOYU4ocyk7cmV0dXJuKG58fHM+PTApJiZ0KGksIW4pfX0pLGUoXCI8YT5cIikub3V0ZXJXaWR0aCgxKS5qcXVlcnl8fGUuZWFjaChbXCJXaWR0aFwiLFwiSGVpZ2h0XCJdLGZ1bmN0aW9uKHQsaSl7ZnVuY3Rpb24gcyh0LGkscyxhKXtyZXR1cm4gZS5lYWNoKG4sZnVuY3Rpb24oKXtpLT1wYXJzZUZsb2F0KGUuY3NzKHQsXCJwYWRkaW5nXCIrdGhpcykpfHwwLHMmJihpLT1wYXJzZUZsb2F0KGUuY3NzKHQsXCJib3JkZXJcIit0aGlzK1wiV2lkdGhcIikpfHwwKSxhJiYoaS09cGFyc2VGbG9hdChlLmNzcyh0LFwibWFyZ2luXCIrdGhpcykpfHwwKX0pLGl9dmFyIG49XCJXaWR0aFwiPT09aT9bXCJMZWZ0XCIsXCJSaWdodFwiXTpbXCJUb3BcIixcIkJvdHRvbVwiXSxhPWkudG9Mb3dlckNhc2UoKSxvPXtpbm5lcldpZHRoOmUuZm4uaW5uZXJXaWR0aCxpbm5lckhlaWdodDplLmZuLmlubmVySGVpZ2h0LG91dGVyV2lkdGg6ZS5mbi5vdXRlcldpZHRoLG91dGVySGVpZ2h0OmUuZm4ub3V0ZXJIZWlnaHR9O2UuZm5bXCJpbm5lclwiK2ldPWZ1bmN0aW9uKHQpe3JldHVybiB2b2lkIDA9PT10P29bXCJpbm5lclwiK2ldLmNhbGwodGhpcyk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZSh0aGlzKS5jc3MoYSxzKHRoaXMsdCkrXCJweFwiKX0pfSxlLmZuW1wib3V0ZXJcIitpXT1mdW5jdGlvbih0LG4pe3JldHVyblwibnVtYmVyXCIhPXR5cGVvZiB0P29bXCJvdXRlclwiK2ldLmNhbGwodGhpcyx0KTp0aGlzLmVhY2goZnVuY3Rpb24oKXtlKHRoaXMpLmNzcyhhLHModGhpcyx0LCEwLG4pK1wicHhcIil9KX19KSxlLmZuLmFkZEJhY2t8fChlLmZuLmFkZEJhY2s9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuYWRkKG51bGw9PWU/dGhpcy5wcmV2T2JqZWN0OnRoaXMucHJldk9iamVjdC5maWx0ZXIoZSkpfSksZShcIjxhPlwiKS5kYXRhKFwiYS1iXCIsXCJhXCIpLnJlbW92ZURhdGEoXCJhLWJcIikuZGF0YShcImEtYlwiKSYmKGUuZm4ucmVtb3ZlRGF0YT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dC5jYWxsKHRoaXMsZS5jYW1lbENhc2UoaSkpOnQuY2FsbCh0aGlzKX19KGUuZm4ucmVtb3ZlRGF0YSkpLGUudWkuaWU9ISEvbXNpZSBbXFx3Ll0rLy5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSksZS5mbi5leHRlbmQoe2ZvY3VzOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihpLHMpe3JldHVyblwibnVtYmVyXCI9PXR5cGVvZiBpP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PXRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe2UodCkuZm9jdXMoKSxzJiZzLmNhbGwodCl9LGkpfSk6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fShlLmZuLmZvY3VzKSxkaXNhYmxlU2VsZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGU9XCJvbnNlbGVjdHN0YXJ0XCJpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpP1wic2VsZWN0c3RhcnRcIjpcIm1vdXNlZG93blwiO3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmJpbmQoZStcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIsZnVuY3Rpb24oZSl7ZS5wcmV2ZW50RGVmYXVsdCgpfSl9fSgpLGVuYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVuYmluZChcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIpfSx6SW5kZXg6ZnVuY3Rpb24odCl7aWYodm9pZCAwIT09dClyZXR1cm4gdGhpcy5jc3MoXCJ6SW5kZXhcIix0KTtpZih0aGlzLmxlbmd0aClmb3IodmFyIGkscyxuPWUodGhpc1swXSk7bi5sZW5ndGgmJm5bMF0hPT1kb2N1bWVudDspe2lmKGk9bi5jc3MoXCJwb3NpdGlvblwiKSwoXCJhYnNvbHV0ZVwiPT09aXx8XCJyZWxhdGl2ZVwiPT09aXx8XCJmaXhlZFwiPT09aSkmJihzPXBhcnNlSW50KG4uY3NzKFwiekluZGV4XCIpLDEwKSwhaXNOYU4ocykmJjAhPT1zKSlyZXR1cm4gcztuPW4ucGFyZW50KCl9cmV0dXJuIDB9fSksZS51aS5wbHVnaW49e2FkZDpmdW5jdGlvbih0LGkscyl7dmFyIG4sYT1lLnVpW3RdLnByb3RvdHlwZTtmb3IobiBpbiBzKWEucGx1Z2luc1tuXT1hLnBsdWdpbnNbbl18fFtdLGEucGx1Z2luc1tuXS5wdXNoKFtpLHNbbl1dKX0sY2FsbDpmdW5jdGlvbihlLHQsaSxzKXt2YXIgbixhPWUucGx1Z2luc1t0XTtpZihhJiYoc3x8ZS5lbGVtZW50WzBdLnBhcmVudE5vZGUmJjExIT09ZS5lbGVtZW50WzBdLnBhcmVudE5vZGUubm9kZVR5cGUpKWZvcihuPTA7YS5sZW5ndGg+bjtuKyspZS5vcHRpb25zW2Fbbl1bMF1dJiZhW25dWzFdLmFwcGx5KGUuZWxlbWVudCxpKX19O3ZhciBzPTAsbj1BcnJheS5wcm90b3R5cGUuc2xpY2U7ZS5jbGVhbkRhdGE9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkpe3ZhciBzLG4sYTtmb3IoYT0wO251bGwhPShuPWlbYV0pO2ErKyl0cnl7cz1lLl9kYXRhKG4sXCJldmVudHNcIikscyYmcy5yZW1vdmUmJmUobikudHJpZ2dlckhhbmRsZXIoXCJyZW1vdmVcIil9Y2F0Y2gobyl7fXQoaSl9fShlLmNsZWFuRGF0YSksZS53aWRnZXQ9ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGEsbyxyLGg9e30sbD10LnNwbGl0KFwiLlwiKVswXTtyZXR1cm4gdD10LnNwbGl0KFwiLlwiKVsxXSxuPWwrXCItXCIrdCxzfHwocz1pLGk9ZS5XaWRnZXQpLGUuZXhwcltcIjpcIl1bbi50b0xvd2VyQ2FzZSgpXT1mdW5jdGlvbih0KXtyZXR1cm4hIWUuZGF0YSh0LG4pfSxlW2xdPWVbbF18fHt9LGE9ZVtsXVt0XSxvPWVbbF1bdF09ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5fY3JlYXRlV2lkZ2V0Pyhhcmd1bWVudHMubGVuZ3RoJiZ0aGlzLl9jcmVhdGVXaWRnZXQoZSx0KSx2b2lkIDApOm5ldyBvKGUsdCl9LGUuZXh0ZW5kKG8sYSx7dmVyc2lvbjpzLnZlcnNpb24sX3Byb3RvOmUuZXh0ZW5kKHt9LHMpLF9jaGlsZENvbnN0cnVjdG9yczpbXX0pLHI9bmV3IGksci5vcHRpb25zPWUud2lkZ2V0LmV4dGVuZCh7fSxyLm9wdGlvbnMpLGUuZWFjaChzLGZ1bmN0aW9uKHQscyl7cmV0dXJuIGUuaXNGdW5jdGlvbihzKT8oaFt0XT1mdW5jdGlvbigpe3ZhciBlPWZ1bmN0aW9uKCl7cmV0dXJuIGkucHJvdG90eXBlW3RdLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sbj1mdW5jdGlvbihlKXtyZXR1cm4gaS5wcm90b3R5cGVbdF0uYXBwbHkodGhpcyxlKX07cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIHQsaT10aGlzLl9zdXBlcixhPXRoaXMuX3N1cGVyQXBwbHk7cmV0dXJuIHRoaXMuX3N1cGVyPWUsdGhpcy5fc3VwZXJBcHBseT1uLHQ9cy5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fc3VwZXI9aSx0aGlzLl9zdXBlckFwcGx5PWEsdH19KCksdm9pZCAwKTooaFt0XT1zLHZvaWQgMCl9KSxvLnByb3RvdHlwZT1lLndpZGdldC5leHRlbmQocix7d2lkZ2V0RXZlbnRQcmVmaXg6YT9yLndpZGdldEV2ZW50UHJlZml4fHx0OnR9LGgse2NvbnN0cnVjdG9yOm8sbmFtZXNwYWNlOmwsd2lkZ2V0TmFtZTp0LHdpZGdldEZ1bGxOYW1lOm59KSxhPyhlLmVhY2goYS5fY2hpbGRDb25zdHJ1Y3RvcnMsZnVuY3Rpb24odCxpKXt2YXIgcz1pLnByb3RvdHlwZTtlLndpZGdldChzLm5hbWVzcGFjZStcIi5cIitzLndpZGdldE5hbWUsbyxpLl9wcm90byl9KSxkZWxldGUgYS5fY2hpbGRDb25zdHJ1Y3RvcnMpOmkuX2NoaWxkQ29uc3RydWN0b3JzLnB1c2gobyksZS53aWRnZXQuYnJpZGdlKHQsbyksb30sZS53aWRnZXQuZXh0ZW5kPWZ1bmN0aW9uKHQpe2Zvcih2YXIgaSxzLGE9bi5jYWxsKGFyZ3VtZW50cywxKSxvPTAscj1hLmxlbmd0aDtyPm87bysrKWZvcihpIGluIGFbb10pcz1hW29dW2ldLGFbb10uaGFzT3duUHJvcGVydHkoaSkmJnZvaWQgMCE9PXMmJih0W2ldPWUuaXNQbGFpbk9iamVjdChzKT9lLmlzUGxhaW5PYmplY3QodFtpXSk/ZS53aWRnZXQuZXh0ZW5kKHt9LHRbaV0scyk6ZS53aWRnZXQuZXh0ZW5kKHt9LHMpOnMpO3JldHVybiB0fSxlLndpZGdldC5icmlkZ2U9ZnVuY3Rpb24odCxpKXt2YXIgcz1pLnByb3RvdHlwZS53aWRnZXRGdWxsTmFtZXx8dDtlLmZuW3RdPWZ1bmN0aW9uKGEpe3ZhciBvPVwic3RyaW5nXCI9PXR5cGVvZiBhLHI9bi5jYWxsKGFyZ3VtZW50cywxKSxoPXRoaXM7cmV0dXJuIG8/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGksbj1lLmRhdGEodGhpcyxzKTtyZXR1cm5cImluc3RhbmNlXCI9PT1hPyhoPW4sITEpOm4/ZS5pc0Z1bmN0aW9uKG5bYV0pJiZcIl9cIiE9PWEuY2hhckF0KDApPyhpPW5bYV0uYXBwbHkobixyKSxpIT09biYmdm9pZCAwIT09aT8oaD1pJiZpLmpxdWVyeT9oLnB1c2hTdGFjayhpLmdldCgpKTppLCExKTp2b2lkIDApOmUuZXJyb3IoXCJubyBzdWNoIG1ldGhvZCAnXCIrYStcIicgZm9yIFwiK3QrXCIgd2lkZ2V0IGluc3RhbmNlXCIpOmUuZXJyb3IoXCJjYW5ub3QgY2FsbCBtZXRob2RzIG9uIFwiK3QrXCIgcHJpb3IgdG8gaW5pdGlhbGl6YXRpb247IFwiK1wiYXR0ZW1wdGVkIHRvIGNhbGwgbWV0aG9kICdcIithK1wiJ1wiKX0pOihyLmxlbmd0aCYmKGE9ZS53aWRnZXQuZXh0ZW5kLmFwcGx5KG51bGwsW2FdLmNvbmNhdChyKSkpLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PWUuZGF0YSh0aGlzLHMpO3Q/KHQub3B0aW9uKGF8fHt9KSx0Ll9pbml0JiZ0Ll9pbml0KCkpOmUuZGF0YSh0aGlzLHMsbmV3IGkoYSx0aGlzKSl9KSksaH19LGUuV2lkZ2V0PWZ1bmN0aW9uKCl7fSxlLldpZGdldC5fY2hpbGRDb25zdHJ1Y3RvcnM9W10sZS5XaWRnZXQucHJvdG90eXBlPXt3aWRnZXROYW1lOlwid2lkZ2V0XCIsd2lkZ2V0RXZlbnRQcmVmaXg6XCJcIixkZWZhdWx0RWxlbWVudDpcIjxkaXY+XCIsb3B0aW9uczp7ZGlzYWJsZWQ6ITEsY3JlYXRlOm51bGx9LF9jcmVhdGVXaWRnZXQ6ZnVuY3Rpb24odCxpKXtpPWUoaXx8dGhpcy5kZWZhdWx0RWxlbWVudHx8dGhpcylbMF0sdGhpcy5lbGVtZW50PWUoaSksdGhpcy51dWlkPXMrKyx0aGlzLmV2ZW50TmFtZXNwYWNlPVwiLlwiK3RoaXMud2lkZ2V0TmFtZSt0aGlzLnV1aWQsdGhpcy5iaW5kaW5ncz1lKCksdGhpcy5ob3ZlcmFibGU9ZSgpLHRoaXMuZm9jdXNhYmxlPWUoKSxpIT09dGhpcyYmKGUuZGF0YShpLHRoaXMud2lkZ2V0RnVsbE5hbWUsdGhpcyksdGhpcy5fb24oITAsdGhpcy5lbGVtZW50LHtyZW1vdmU6ZnVuY3Rpb24oZSl7ZS50YXJnZXQ9PT1pJiZ0aGlzLmRlc3Ryb3koKX19KSx0aGlzLmRvY3VtZW50PWUoaS5zdHlsZT9pLm93bmVyRG9jdW1lbnQ6aS5kb2N1bWVudHx8aSksdGhpcy53aW5kb3c9ZSh0aGlzLmRvY3VtZW50WzBdLmRlZmF1bHRWaWV3fHx0aGlzLmRvY3VtZW50WzBdLnBhcmVudFdpbmRvdykpLHRoaXMub3B0aW9ucz1lLndpZGdldC5leHRlbmQoe30sdGhpcy5vcHRpb25zLHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSx0KSx0aGlzLl9jcmVhdGUoKSx0aGlzLl90cmlnZ2VyKFwiY3JlYXRlXCIsbnVsbCx0aGlzLl9nZXRDcmVhdGVFdmVudERhdGEoKSksdGhpcy5faW5pdCgpfSxfZ2V0Q3JlYXRlT3B0aW9uczplLm5vb3AsX2dldENyZWF0ZUV2ZW50RGF0YTplLm5vb3AsX2NyZWF0ZTplLm5vb3AsX2luaXQ6ZS5ub29wLGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLl9kZXN0cm95KCksdGhpcy5lbGVtZW50LnVuYmluZCh0aGlzLmV2ZW50TmFtZXNwYWNlKS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0RnVsbE5hbWUpLnJlbW92ZURhdGEoZS5jYW1lbENhc2UodGhpcy53aWRnZXRGdWxsTmFtZSkpLHRoaXMud2lkZ2V0KCkudW5iaW5kKHRoaXMuZXZlbnROYW1lc3BhY2UpLnJlbW92ZUF0dHIoXCJhcmlhLWRpc2FibGVkXCIpLnJlbW92ZUNsYXNzKHRoaXMud2lkZ2V0RnVsbE5hbWUrXCItZGlzYWJsZWQgXCIrXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKSx0aGlzLmJpbmRpbmdzLnVuYmluZCh0aGlzLmV2ZW50TmFtZXNwYWNlKSx0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLHRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9LF9kZXN0cm95OmUubm9vcCx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50fSxvcHRpb246ZnVuY3Rpb24odCxpKXt2YXIgcyxuLGEsbz10O2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKXJldHVybiBlLndpZGdldC5leHRlbmQoe30sdGhpcy5vcHRpb25zKTtpZihcInN0cmluZ1wiPT10eXBlb2YgdClpZihvPXt9LHM9dC5zcGxpdChcIi5cIiksdD1zLnNoaWZ0KCkscy5sZW5ndGgpe2ZvcihuPW9bdF09ZS53aWRnZXQuZXh0ZW5kKHt9LHRoaXMub3B0aW9uc1t0XSksYT0wO3MubGVuZ3RoLTE+YTthKyspbltzW2FdXT1uW3NbYV1dfHx7fSxuPW5bc1thXV07aWYodD1zLnBvcCgpLDE9PT1hcmd1bWVudHMubGVuZ3RoKXJldHVybiB2b2lkIDA9PT1uW3RdP251bGw6blt0XTtuW3RdPWl9ZWxzZXtpZigxPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4gdm9pZCAwPT09dGhpcy5vcHRpb25zW3RdP251bGw6dGhpcy5vcHRpb25zW3RdO29bdF09aX1yZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyhvKSx0aGlzfSxfc2V0T3B0aW9uczpmdW5jdGlvbihlKXt2YXIgdDtmb3IodCBpbiBlKXRoaXMuX3NldE9wdGlvbih0LGVbdF0pO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMub3B0aW9uc1tlXT10LFwiZGlzYWJsZWRcIj09PWUmJih0aGlzLndpZGdldCgpLnRvZ2dsZUNsYXNzKHRoaXMud2lkZ2V0RnVsbE5hbWUrXCItZGlzYWJsZWRcIiwhIXQpLHQmJih0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLHRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIikpKSx0aGlzfSxlbmFibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyh7ZGlzYWJsZWQ6ITF9KX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb25zKHtkaXNhYmxlZDohMH0pfSxfb246ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGE9dGhpcztcImJvb2xlYW5cIiE9dHlwZW9mIHQmJihzPWksaT10LHQ9ITEpLHM/KGk9bj1lKGkpLHRoaXMuYmluZGluZ3M9dGhpcy5iaW5kaW5ncy5hZGQoaSkpOihzPWksaT10aGlzLmVsZW1lbnQsbj10aGlzLndpZGdldCgpKSxlLmVhY2gocyxmdW5jdGlvbihzLG8pe2Z1bmN0aW9uIHIoKXtyZXR1cm4gdHx8YS5vcHRpb25zLmRpc2FibGVkIT09ITAmJiFlKHRoaXMpLmhhc0NsYXNzKFwidWktc3RhdGUtZGlzYWJsZWRcIik/KFwic3RyaW5nXCI9PXR5cGVvZiBvP2Fbb106bykuYXBwbHkoYSxhcmd1bWVudHMpOnZvaWQgMH1cInN0cmluZ1wiIT10eXBlb2YgbyYmKHIuZ3VpZD1vLmd1aWQ9by5ndWlkfHxyLmd1aWR8fGUuZ3VpZCsrKTt2YXIgaD1zLm1hdGNoKC9eKFtcXHc6LV0qKVxccyooLiopJC8pLGw9aFsxXSthLmV2ZW50TmFtZXNwYWNlLHU9aFsyXTt1P24uZGVsZWdhdGUodSxsLHIpOmkuYmluZChsLHIpfSl9LF9vZmY6ZnVuY3Rpb24odCxpKXtpPShpfHxcIlwiKS5zcGxpdChcIiBcIikuam9pbih0aGlzLmV2ZW50TmFtZXNwYWNlK1wiIFwiKSt0aGlzLmV2ZW50TmFtZXNwYWNlLHQudW5iaW5kKGkpLnVuZGVsZWdhdGUoaSksdGhpcy5iaW5kaW5ncz1lKHRoaXMuYmluZGluZ3Mubm90KHQpLmdldCgpKSx0aGlzLmZvY3VzYWJsZT1lKHRoaXMuZm9jdXNhYmxlLm5vdCh0KS5nZXQoKSksdGhpcy5ob3ZlcmFibGU9ZSh0aGlzLmhvdmVyYWJsZS5ub3QodCkuZ2V0KCkpfSxfZGVsYXk6ZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKCl7cmV0dXJuKFwic3RyaW5nXCI9PXR5cGVvZiBlP3NbZV06ZSkuYXBwbHkocyxhcmd1bWVudHMpfXZhciBzPXRoaXM7cmV0dXJuIHNldFRpbWVvdXQoaSx0fHwwKX0sX2hvdmVyYWJsZTpmdW5jdGlvbih0KXt0aGlzLmhvdmVyYWJsZT10aGlzLmhvdmVyYWJsZS5hZGQodCksdGhpcy5fb24odCx7bW91c2VlbnRlcjpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sbW91c2VsZWF2ZTpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX19KX0sX2ZvY3VzYWJsZTpmdW5jdGlvbih0KXt0aGlzLmZvY3VzYWJsZT10aGlzLmZvY3VzYWJsZS5hZGQodCksdGhpcy5fb24odCx7Zm9jdXNpbjpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0sZm9jdXNvdXQ6ZnVuY3Rpb24odCl7ZSh0LmN1cnJlbnRUYXJnZXQpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9fSl9LF90cmlnZ2VyOmZ1bmN0aW9uKHQsaSxzKXt2YXIgbixhLG89dGhpcy5vcHRpb25zW3RdO2lmKHM9c3x8e30saT1lLkV2ZW50KGkpLGkudHlwZT0odD09PXRoaXMud2lkZ2V0RXZlbnRQcmVmaXg/dDp0aGlzLndpZGdldEV2ZW50UHJlZml4K3QpLnRvTG93ZXJDYXNlKCksaS50YXJnZXQ9dGhpcy5lbGVtZW50WzBdLGE9aS5vcmlnaW5hbEV2ZW50KWZvcihuIGluIGEpbiBpbiBpfHwoaVtuXT1hW25dKTtyZXR1cm4gdGhpcy5lbGVtZW50LnRyaWdnZXIoaSxzKSwhKGUuaXNGdW5jdGlvbihvKSYmby5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2ldLmNvbmNhdChzKSk9PT0hMXx8aS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fSxlLmVhY2goe3Nob3c6XCJmYWRlSW5cIixoaWRlOlwiZmFkZU91dFwifSxmdW5jdGlvbih0LGkpe2UuV2lkZ2V0LnByb3RvdHlwZVtcIl9cIit0XT1mdW5jdGlvbihzLG4sYSl7XCJzdHJpbmdcIj09dHlwZW9mIG4mJihuPXtlZmZlY3Q6bn0pO3ZhciBvLHI9bj9uPT09ITB8fFwibnVtYmVyXCI9PXR5cGVvZiBuP2k6bi5lZmZlY3R8fGk6dDtuPW58fHt9LFwibnVtYmVyXCI9PXR5cGVvZiBuJiYobj17ZHVyYXRpb246bn0pLG89IWUuaXNFbXB0eU9iamVjdChuKSxuLmNvbXBsZXRlPWEsbi5kZWxheSYmcy5kZWxheShuLmRlbGF5KSxvJiZlLmVmZmVjdHMmJmUuZWZmZWN0cy5lZmZlY3Rbcl0/c1t0XShuKTpyIT09dCYmc1tyXT9zW3JdKG4uZHVyYXRpb24sbi5lYXNpbmcsYSk6cy5xdWV1ZShmdW5jdGlvbihpKXtlKHRoaXMpW3RdKCksYSYmYS5jYWxsKHNbMF0pLGkoKX0pfX0pLGUud2lkZ2V0O3ZhciBhPSExO2UoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24oKXthPSExfSksZS53aWRnZXQoXCJ1aS5tb3VzZVwiLHt2ZXJzaW9uOlwiMS4xMS40XCIsb3B0aW9uczp7Y2FuY2VsOlwiaW5wdXQsdGV4dGFyZWEsYnV0dG9uLHNlbGVjdCxvcHRpb25cIixkaXN0YW5jZToxLGRlbGF5OjB9LF9tb3VzZUluaXQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzO3RoaXMuZWxlbWVudC5iaW5kKFwibW91c2Vkb3duLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihlKXtyZXR1cm4gdC5fbW91c2VEb3duKGUpfSkuYmluZChcImNsaWNrLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihpKXtyZXR1cm4hMD09PWUuZGF0YShpLnRhcmdldCx0LndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIik/KGUucmVtb3ZlRGF0YShpLnRhcmdldCx0LndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIiksaS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwhMSk6dm9pZCAwfSksdGhpcy5zdGFydGVkPSExfSxfbW91c2VEZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnVuYmluZChcIi5cIit0aGlzLndpZGdldE5hbWUpLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlJiZ0aGlzLmRvY3VtZW50LnVuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSl9LF9tb3VzZURvd246ZnVuY3Rpb24odCl7aWYoIWEpe3RoaXMuX21vdXNlTW92ZWQ9ITEsdGhpcy5fbW91c2VTdGFydGVkJiZ0aGlzLl9tb3VzZVVwKHQpLHRoaXMuX21vdXNlRG93bkV2ZW50PXQ7dmFyIGk9dGhpcyxzPTE9PT10LndoaWNoLG49XCJzdHJpbmdcIj09dHlwZW9mIHRoaXMub3B0aW9ucy5jYW5jZWwmJnQudGFyZ2V0Lm5vZGVOYW1lP2UodC50YXJnZXQpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmNhbmNlbCkubGVuZ3RoOiExO3JldHVybiBzJiYhbiYmdGhpcy5fbW91c2VDYXB0dXJlKHQpPyh0aGlzLm1vdXNlRGVsYXlNZXQ9IXRoaXMub3B0aW9ucy5kZWxheSx0aGlzLm1vdXNlRGVsYXlNZXR8fCh0aGlzLl9tb3VzZURlbGF5VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2kubW91c2VEZWxheU1ldD0hMH0sdGhpcy5vcHRpb25zLmRlbGF5KSksdGhpcy5fbW91c2VEaXN0YW5jZU1ldCh0KSYmdGhpcy5fbW91c2VEZWxheU1ldCh0KSYmKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHQpIT09ITEsIXRoaXMuX21vdXNlU3RhcnRlZCk/KHQucHJldmVudERlZmF1bHQoKSwhMCk6KCEwPT09ZS5kYXRhKHQudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSYmZS5yZW1vdmVEYXRhKHQudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZT1mdW5jdGlvbihlKXtyZXR1cm4gaS5fbW91c2VNb3ZlKGUpfSx0aGlzLl9tb3VzZVVwRGVsZWdhdGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGkuX21vdXNlVXAoZSl9LHRoaXMuZG9jdW1lbnQuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLmJpbmQoXCJtb3VzZXVwLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpLHQucHJldmVudERlZmF1bHQoKSxhPSEwLCEwKSk6ITB9fSxfbW91c2VNb3ZlOmZ1bmN0aW9uKHQpe2lmKHRoaXMuX21vdXNlTW92ZWQpe2lmKGUudWkuaWUmJighZG9jdW1lbnQuZG9jdW1lbnRNb2RlfHw5PmRvY3VtZW50LmRvY3VtZW50TW9kZSkmJiF0LmJ1dHRvbilyZXR1cm4gdGhpcy5fbW91c2VVcCh0KTtpZighdC53aGljaClyZXR1cm4gdGhpcy5fbW91c2VVcCh0KX1yZXR1cm4odC53aGljaHx8dC5idXR0b24pJiYodGhpcy5fbW91c2VNb3ZlZD0hMCksdGhpcy5fbW91c2VTdGFydGVkPyh0aGlzLl9tb3VzZURyYWcodCksdC5wcmV2ZW50RGVmYXVsdCgpKToodGhpcy5fbW91c2VEaXN0YW5jZU1ldCh0KSYmdGhpcy5fbW91c2VEZWxheU1ldCh0KSYmKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LHQpIT09ITEsdGhpcy5fbW91c2VTdGFydGVkP3RoaXMuX21vdXNlRHJhZyh0KTp0aGlzLl9tb3VzZVVwKHQpKSwhdGhpcy5fbW91c2VTdGFydGVkKX0sX21vdXNlVXA6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuZG9jdW1lbnQudW5iaW5kKFwibW91c2Vtb3ZlLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkudW5iaW5kKFwibW91c2V1cC5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKSx0aGlzLl9tb3VzZVN0YXJ0ZWQmJih0aGlzLl9tb3VzZVN0YXJ0ZWQ9ITEsdC50YXJnZXQ9PT10aGlzLl9tb3VzZURvd25FdmVudC50YXJnZXQmJmUuZGF0YSh0LnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIiwhMCksdGhpcy5fbW91c2VTdG9wKHQpKSxhPSExLCExfSxfbW91c2VEaXN0YW5jZU1ldDpmdW5jdGlvbihlKXtyZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVgtZS5wYWdlWCksTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVktZS5wYWdlWSkpPj10aGlzLm9wdGlvbnMuZGlzdGFuY2V9LF9tb3VzZURlbGF5TWV0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubW91c2VEZWxheU1ldH0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oKXt9LF9tb3VzZURyYWc6ZnVuY3Rpb24oKXt9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oKXt9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oKXtyZXR1cm4hMH19KSxlLndpZGdldChcInVpLnNvcnRhYmxlXCIsZS51aS5tb3VzZSx7dmVyc2lvbjpcIjEuMTEuNFwiLHdpZGdldEV2ZW50UHJlZml4Olwic29ydFwiLHJlYWR5OiExLG9wdGlvbnM6e2FwcGVuZFRvOlwicGFyZW50XCIsYXhpczohMSxjb25uZWN0V2l0aDohMSxjb250YWlubWVudDohMSxjdXJzb3I6XCJhdXRvXCIsY3Vyc29yQXQ6ITEsZHJvcE9uRW1wdHk6ITAsZm9yY2VQbGFjZWhvbGRlclNpemU6ITEsZm9yY2VIZWxwZXJTaXplOiExLGdyaWQ6ITEsaGFuZGxlOiExLGhlbHBlcjpcIm9yaWdpbmFsXCIsaXRlbXM6XCI+ICpcIixvcGFjaXR5OiExLHBsYWNlaG9sZGVyOiExLHJldmVydDohMSxzY3JvbGw6ITAsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc2NvcGU6XCJkZWZhdWx0XCIsdG9sZXJhbmNlOlwiaW50ZXJzZWN0XCIsekluZGV4OjFlMyxhY3RpdmF0ZTpudWxsLGJlZm9yZVN0b3A6bnVsbCxjaGFuZ2U6bnVsbCxkZWFjdGl2YXRlOm51bGwsb3V0Om51bGwsb3ZlcjpudWxsLHJlY2VpdmU6bnVsbCxyZW1vdmU6bnVsbCxzb3J0Om51bGwsc3RhcnQ6bnVsbCxzdG9wOm51bGwsdXBkYXRlOm51bGx9LF9pc092ZXJBeGlzOmZ1bmN0aW9uKGUsdCxpKXtyZXR1cm4gZT49dCYmdCtpPmV9LF9pc0Zsb2F0aW5nOmZ1bmN0aW9uKGUpe3JldHVybi9sZWZ0fHJpZ2h0Ly50ZXN0KGUuY3NzKFwiZmxvYXRcIikpfHwvaW5saW5lfHRhYmxlLWNlbGwvLnRlc3QoZS5jc3MoXCJkaXNwbGF5XCIpKX0sX2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMuY29udGFpbmVyQ2FjaGU9e30sdGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktc29ydGFibGVcIiksdGhpcy5yZWZyZXNoKCksdGhpcy5vZmZzZXQ9dGhpcy5lbGVtZW50Lm9mZnNldCgpLHRoaXMuX21vdXNlSW5pdCgpLHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpLHRoaXMucmVhZHk9ITB9LF9zZXRPcHRpb246ZnVuY3Rpb24oZSx0KXt0aGlzLl9zdXBlcihlLHQpLFwiaGFuZGxlXCI9PT1lJiZ0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKX0sX3NldEhhbmRsZUNsYXNzTmFtZTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5maW5kKFwiLnVpLXNvcnRhYmxlLWhhbmRsZVwiKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhhbmRsZVwiKSxlLmVhY2godGhpcy5pdGVtcyxmdW5jdGlvbigpeyh0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGFuZGxlP3RoaXMuaXRlbS5maW5kKHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oYW5kbGUpOnRoaXMuaXRlbSkuYWRkQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oYW5kbGVcIil9KX0sX2Rlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZSB1aS1zb3J0YWJsZS1kaXNhYmxlZFwiKS5maW5kKFwiLnVpLXNvcnRhYmxlLWhhbmRsZVwiKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhhbmRsZVwiKSx0aGlzLl9tb3VzZURlc3Ryb3koKTtmb3IodmFyIGU9dGhpcy5pdGVtcy5sZW5ndGgtMTtlPj0wO2UtLSl0aGlzLml0ZW1zW2VdLml0ZW0ucmVtb3ZlRGF0YSh0aGlzLndpZGdldE5hbWUrXCItaXRlbVwiKTtyZXR1cm4gdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbih0LGkpe3ZhciBzPW51bGwsbj0hMSxhPXRoaXM7cmV0dXJuIHRoaXMucmV2ZXJ0aW5nPyExOnRoaXMub3B0aW9ucy5kaXNhYmxlZHx8XCJzdGF0aWNcIj09PXRoaXMub3B0aW9ucy50eXBlPyExOih0aGlzLl9yZWZyZXNoSXRlbXModCksZSh0LnRhcmdldCkucGFyZW50cygpLmVhY2goZnVuY3Rpb24oKXtyZXR1cm4gZS5kYXRhKHRoaXMsYS53aWRnZXROYW1lK1wiLWl0ZW1cIik9PT1hPyhzPWUodGhpcyksITEpOnZvaWQgMH0pLGUuZGF0YSh0LnRhcmdldCxhLndpZGdldE5hbWUrXCItaXRlbVwiKT09PWEmJihzPWUodC50YXJnZXQpKSxzPyF0aGlzLm9wdGlvbnMuaGFuZGxlfHxpfHwoZSh0aGlzLm9wdGlvbnMuaGFuZGxlLHMpLmZpbmQoXCIqXCIpLmFkZEJhY2soKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcz09PXQudGFyZ2V0JiYobj0hMCl9KSxuKT8odGhpcy5jdXJyZW50SXRlbT1zLHRoaXMuX3JlbW92ZUN1cnJlbnRzRnJvbUl0ZW1zKCksITApOiExOiExKX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGEsbz10aGlzLm9wdGlvbnM7aWYodGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMsdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksdGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKHQpLHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSx0aGlzLl9jYWNoZU1hcmdpbnMoKSx0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKSx0aGlzLm9mZnNldD10aGlzLmN1cnJlbnRJdGVtLm9mZnNldCgpLHRoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fSxlLmV4dGVuZCh0aGlzLm9mZnNldCx7Y2xpY2s6e2xlZnQ6dC5wYWdlWC10aGlzLm9mZnNldC5sZWZ0LHRvcDp0LnBhZ2VZLXRoaXMub2Zmc2V0LnRvcH0scGFyZW50OnRoaXMuX2dldFBhcmVudE9mZnNldCgpLHJlbGF0aXZlOnRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCl9KSx0aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiLFwiYWJzb2x1dGVcIiksdGhpcy5jc3NQb3NpdGlvbj10aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiKSx0aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLm9yaWdpbmFsUGFnZVg9dC5wYWdlWCx0aGlzLm9yaWdpbmFsUGFnZVk9dC5wYWdlWSxvLmN1cnNvckF0JiZ0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKG8uY3Vyc29yQXQpLHRoaXMuZG9tUG9zaXRpb249e3ByZXY6dGhpcy5jdXJyZW50SXRlbS5wcmV2KClbMF0scGFyZW50OnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF19LHRoaXMuaGVscGVyWzBdIT09dGhpcy5jdXJyZW50SXRlbVswXSYmdGhpcy5jdXJyZW50SXRlbS5oaWRlKCksdGhpcy5fY3JlYXRlUGxhY2Vob2xkZXIoKSxvLmNvbnRhaW5tZW50JiZ0aGlzLl9zZXRDb250YWlubWVudCgpLG8uY3Vyc29yJiZcImF1dG9cIiE9PW8uY3Vyc29yJiYoYT10aGlzLmRvY3VtZW50LmZpbmQoXCJib2R5XCIpLHRoaXMuc3RvcmVkQ3Vyc29yPWEuY3NzKFwiY3Vyc29yXCIpLGEuY3NzKFwiY3Vyc29yXCIsby5jdXJzb3IpLHRoaXMuc3RvcmVkU3R5bGVzaGVldD1lKFwiPHN0eWxlPip7IGN1cnNvcjogXCIrby5jdXJzb3IrXCIgIWltcG9ydGFudDsgfTwvc3R5bGU+XCIpLmFwcGVuZFRvKGEpKSxvLm9wYWNpdHkmJih0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpJiYodGhpcy5fc3RvcmVkT3BhY2l0eT10aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpKSx0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsby5vcGFjaXR5KSksby56SW5kZXgmJih0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIikmJih0aGlzLl9zdG9yZWRaSW5kZXg9dGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIpKSx0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIixvLnpJbmRleCkpLHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmXCJIVE1MXCIhPT10aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lJiYodGhpcy5vdmVyZmxvd09mZnNldD10aGlzLnNjcm9sbFBhcmVudC5vZmZzZXQoKSksdGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsdCx0aGlzLl91aUhhc2goKSksdGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpLCFzKWZvcihuPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtuPj0wO24tLSl0aGlzLmNvbnRhaW5lcnNbbl0uX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKTtyZXR1cm4gZS51aS5kZG1hbmFnZXImJihlLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXMpLGUudWkuZGRtYW5hZ2VyJiYhby5kcm9wQmVoYXZpb3VyJiZlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLHQpLHRoaXMuZHJhZ2dpbmc9ITAsdGhpcy5oZWxwZXIuYWRkQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIiksdGhpcy5fbW91c2VEcmFnKHQpLCEwfSxfbW91c2VEcmFnOmZ1bmN0aW9uKHQpe3ZhciBpLHMsbixhLG89dGhpcy5vcHRpb25zLHI9ITE7Zm9yKHRoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIiksdGhpcy5sYXN0UG9zaXRpb25BYnN8fCh0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzKSx0aGlzLm9wdGlvbnMuc2Nyb2xsJiYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPT10aGlzLmRvY3VtZW50WzBdJiZcIkhUTUxcIiE9PXRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWU/KHRoaXMub3ZlcmZsb3dPZmZzZXQudG9wK3RoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodC10LnBhZ2VZPG8uc2Nyb2xsU2Vuc2l0aXZpdHk/dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPXI9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wK28uc2Nyb2xsU3BlZWQ6dC5wYWdlWS10aGlzLm92ZXJmbG93T2Zmc2V0LnRvcDxvLnNjcm9sbFNlbnNpdGl2aXR5JiYodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPXI9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wLW8uc2Nyb2xsU3BlZWQpLHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC10LnBhZ2VYPG8uc2Nyb2xsU2Vuc2l0aXZpdHk/dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1yPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrby5zY3JvbGxTcGVlZDp0LnBhZ2VYLXRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdDxvLnNjcm9sbFNlbnNpdGl2aXR5JiYodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1yPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtby5zY3JvbGxTcGVlZCkpOih0LnBhZ2VZLXRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCk8by5zY3JvbGxTZW5zaXRpdml0eT9yPXRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCktby5zY3JvbGxTcGVlZCk6dGhpcy53aW5kb3cuaGVpZ2h0KCktKHQucGFnZVktdGhpcy5kb2N1bWVudC5zY3JvbGxUb3AoKSk8by5zY3JvbGxTZW5zaXRpdml0eSYmKHI9dGhpcy5kb2N1bWVudC5zY3JvbGxUb3AodGhpcy5kb2N1bWVudC5zY3JvbGxUb3AoKStvLnNjcm9sbFNwZWVkKSksdC5wYWdlWC10aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKTxvLnNjcm9sbFNlbnNpdGl2aXR5P3I9dGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KHRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpLW8uc2Nyb2xsU3BlZWQpOnRoaXMud2luZG93LndpZHRoKCktKHQucGFnZVgtdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KCkpPG8uc2Nyb2xsU2Vuc2l0aXZpdHkmJihyPXRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCh0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKStvLnNjcm9sbFNwZWVkKSkpLHIhPT0hMSYmZS51aS5kZG1hbmFnZXImJiFvLmRyb3BCZWhhdmlvdXImJmUudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsdCkpLHRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oXCJhYnNvbHV0ZVwiKSx0aGlzLm9wdGlvbnMuYXhpcyYmXCJ5XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8KHRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIiksdGhpcy5vcHRpb25zLmF4aXMmJlwieFwiPT09dGhpcy5vcHRpb25zLmF4aXN8fCh0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiKSxpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aT49MDtpLS0paWYocz10aGlzLml0ZW1zW2ldLG49cy5pdGVtWzBdLGE9dGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKHMpLGEmJnMuaW5zdGFuY2U9PT10aGlzLmN1cnJlbnRDb250YWluZXImJm4hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLnBsYWNlaG9sZGVyWzE9PT1hP1wibmV4dFwiOlwicHJldlwiXSgpWzBdIT09biYmIWUuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSxuKSYmKFwic2VtaS1keW5hbWljXCI9PT10aGlzLm9wdGlvbnMudHlwZT8hZS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sbik6ITApKXtpZih0aGlzLmRpcmVjdGlvbj0xPT09YT9cImRvd25cIjpcInVwXCIsXCJwb2ludGVyXCIhPT10aGlzLm9wdGlvbnMudG9sZXJhbmNlJiYhdGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhzKSlicmVhazt0aGlzLl9yZWFycmFuZ2UodCxzKSx0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsdCx0aGlzLl91aUhhc2goKSk7YnJlYWt9cmV0dXJuIHRoaXMuX2NvbnRhY3RDb250YWluZXJzKHQpLGUudWkuZGRtYW5hZ2VyJiZlLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsdCksdGhpcy5fdHJpZ2dlcihcInNvcnRcIix0LHRoaXMuX3VpSGFzaCgpKSx0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzLCExfSxfbW91c2VTdG9wOmZ1bmN0aW9uKHQsaSl7aWYodCl7aWYoZS51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmZS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLHQpLHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBzPXRoaXMsbj10aGlzLnBsYWNlaG9sZGVyLm9mZnNldCgpLGE9dGhpcy5vcHRpb25zLmF4aXMsbz17fTthJiZcInhcIiE9PWF8fChvLmxlZnQ9bi5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0Kyh0aGlzLm9mZnNldFBhcmVudFswXT09PXRoaXMuZG9jdW1lbnRbMF0uYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbExlZnQpKSxhJiZcInlcIiE9PWF8fChvLnRvcD1uLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLXRoaXMubWFyZ2lucy50b3ArKHRoaXMub2Zmc2V0UGFyZW50WzBdPT09dGhpcy5kb2N1bWVudFswXS5ib2R5PzA6dGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsVG9wKSksdGhpcy5yZXZlcnRpbmc9ITAsZSh0aGlzLmhlbHBlcikuYW5pbWF0ZShvLHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnQsMTApfHw1MDAsZnVuY3Rpb24oKXtzLl9jbGVhcih0KX0pfWVsc2UgdGhpcy5fY2xlYXIodCxpKTtyZXR1cm4hMX19LGNhbmNlbDpmdW5jdGlvbigpe2lmKHRoaXMuZHJhZ2dpbmcpe3RoaXMuX21vdXNlVXAoe3RhcmdldDpudWxsfSksXCJvcmlnaW5hbFwiPT09dGhpcy5vcHRpb25zLmhlbHBlcj90aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpOnRoaXMuY3VycmVudEl0ZW0uc2hvdygpO2Zvcih2YXIgdD10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7dD49MDt0LS0pdGhpcy5jb250YWluZXJzW3RdLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLG51bGwsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbdF0uY29udGFpbmVyQ2FjaGUub3ZlciYmKHRoaXMuY29udGFpbmVyc1t0XS5fdHJpZ2dlcihcIm91dFwiLG51bGwsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbdF0uY29udGFpbmVyQ2FjaGUub3Zlcj0wKX1yZXR1cm4gdGhpcy5wbGFjZWhvbGRlciYmKHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pLFwib3JpZ2luYWxcIiE9PXRoaXMub3B0aW9ucy5oZWxwZXImJnRoaXMuaGVscGVyJiZ0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlJiZ0aGlzLmhlbHBlci5yZW1vdmUoKSxlLmV4dGVuZCh0aGlzLHtoZWxwZXI6bnVsbCxkcmFnZ2luZzohMSxyZXZlcnRpbmc6ITEsX25vRmluYWxTb3J0Om51bGx9KSx0aGlzLmRvbVBvc2l0aW9uLnByZXY/ZSh0aGlzLmRvbVBvc2l0aW9uLnByZXYpLmFmdGVyKHRoaXMuY3VycmVudEl0ZW0pOmUodGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQpLnByZXBlbmQodGhpcy5jdXJyZW50SXRlbSkpLHRoaXN9LHNlcmlhbGl6ZTpmdW5jdGlvbih0KXt2YXIgaT10aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KHQmJnQuY29ubmVjdGVkKSxzPVtdO3JldHVybiB0PXR8fHt9LGUoaSkuZWFjaChmdW5jdGlvbigpe3ZhciBpPShlKHQuaXRlbXx8dGhpcykuYXR0cih0LmF0dHJpYnV0ZXx8XCJpZFwiKXx8XCJcIikubWF0Y2godC5leHByZXNzaW9ufHwvKC4rKVtcXC09X10oLispLyk7aSYmcy5wdXNoKCh0LmtleXx8aVsxXStcIltdXCIpK1wiPVwiKyh0LmtleSYmdC5leHByZXNzaW9uP2lbMV06aVsyXSkpfSksIXMubGVuZ3RoJiZ0LmtleSYmcy5wdXNoKHQua2V5K1wiPVwiKSxzLmpvaW4oXCImXCIpfSx0b0FycmF5OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkodCYmdC5jb25uZWN0ZWQpLHM9W107cmV0dXJuIHQ9dHx8e30saS5lYWNoKGZ1bmN0aW9uKCl7cy5wdXNoKGUodC5pdGVtfHx0aGlzKS5hdHRyKHQuYXR0cmlidXRlfHxcImlkXCIpfHxcIlwiKX0pLHN9LF9pbnRlcnNlY3RzV2l0aDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnBvc2l0aW9uQWJzLmxlZnQsaT10K3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgscz10aGlzLnBvc2l0aW9uQWJzLnRvcCxuPXMrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsYT1lLmxlZnQsbz1hK2Uud2lkdGgscj1lLnRvcCxoPXIrZS5oZWlnaHQsbD10aGlzLm9mZnNldC5jbGljay50b3AsdT10aGlzLm9mZnNldC5jbGljay5sZWZ0LGQ9XCJ4XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8cytsPnImJmg+cytsLGM9XCJ5XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8dCt1PmEmJm8+dCt1LHA9ZCYmYztyZXR1cm5cInBvaW50ZXJcIj09PXRoaXMub3B0aW9ucy50b2xlcmFuY2V8fHRoaXMub3B0aW9ucy5mb3JjZVBvaW50ZXJGb3JDb250YWluZXJzfHxcInBvaW50ZXJcIiE9PXRoaXMub3B0aW9ucy50b2xlcmFuY2UmJnRoaXMuaGVscGVyUHJvcG9ydGlvbnNbdGhpcy5mbG9hdGluZz9cIndpZHRoXCI6XCJoZWlnaHRcIl0+ZVt0aGlzLmZsb2F0aW5nP1wid2lkdGhcIjpcImhlaWdodFwiXT9wOnQrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yPmEmJm8+aS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzImJnMrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMj5yJiZoPm4tdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMn0sX2ludGVyc2VjdHNXaXRoUG9pbnRlcjpmdW5jdGlvbihlKXt2YXIgdD1cInhcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCxlLnRvcCxlLmhlaWdodCksaT1cInlcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGUubGVmdCxlLndpZHRoKSxzPXQmJmksbj10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSxhPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7cmV0dXJuIHM/dGhpcy5mbG9hdGluZz9hJiZcInJpZ2h0XCI9PT1hfHxcImRvd25cIj09PW4/MjoxOm4mJihcImRvd25cIj09PW4/MjoxKTohMX0sX2ludGVyc2VjdHNXaXRoU2lkZXM6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCt0aGlzLm9mZnNldC5jbGljay50b3AsZS50b3ArZS5oZWlnaHQvMixlLmhlaWdodCksaT10aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGUubGVmdCtlLndpZHRoLzIsZS53aWR0aCkscz10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSxuPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7cmV0dXJuIHRoaXMuZmxvYXRpbmcmJm4/XCJyaWdodFwiPT09biYmaXx8XCJsZWZ0XCI9PT1uJiYhaTpzJiYoXCJkb3duXCI9PT1zJiZ0fHxcInVwXCI9PT1zJiYhdCl9LF9nZXREcmFnVmVydGljYWxEaXJlY3Rpb246ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnBvc2l0aW9uQWJzLnRvcC10aGlzLmxhc3RQb3NpdGlvbkFicy50b3A7cmV0dXJuIDAhPT1lJiYoZT4wP1wiZG93blwiOlwidXBcIil9LF9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbjpmdW5jdGlvbigpe3ZhciBlPXRoaXMucG9zaXRpb25BYnMubGVmdC10aGlzLmxhc3RQb3NpdGlvbkFicy5sZWZ0O3JldHVybiAwIT09ZSYmKGU+MD9cInJpZ2h0XCI6XCJsZWZ0XCIpfSxyZWZyZXNoOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9yZWZyZXNoSXRlbXMoZSksdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCksdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksdGhpc30sX2Nvbm5lY3RXaXRoOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcHRpb25zO3JldHVybiBlLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yPT09U3RyaW5nP1tlLmNvbm5lY3RXaXRoXTplLmNvbm5lY3RXaXRofSxfZ2V0SXRlbXNBc2pRdWVyeTpmdW5jdGlvbih0KXtmdW5jdGlvbiBpKCl7ci5wdXNoKHRoaXMpfXZhciBzLG4sYSxvLHI9W10saD1bXSxsPXRoaXMuX2Nvbm5lY3RXaXRoKCk7aWYobCYmdClmb3Iocz1sLmxlbmd0aC0xO3M+PTA7cy0tKWZvcihhPWUobFtzXSx0aGlzLmRvY3VtZW50WzBdKSxuPWEubGVuZ3RoLTE7bj49MDtuLS0pbz1lLmRhdGEoYVtuXSx0aGlzLndpZGdldEZ1bGxOYW1lKSxvJiZvIT09dGhpcyYmIW8ub3B0aW9ucy5kaXNhYmxlZCYmaC5wdXNoKFtlLmlzRnVuY3Rpb24oby5vcHRpb25zLml0ZW1zKT9vLm9wdGlvbnMuaXRlbXMuY2FsbChvLmVsZW1lbnQpOmUoby5vcHRpb25zLml0ZW1zLG8uZWxlbWVudCkubm90KFwiLnVpLXNvcnRhYmxlLWhlbHBlclwiKS5ub3QoXCIudWktc29ydGFibGUtcGxhY2Vob2xkZXJcIiksb10pO2ZvcihoLnB1c2goW2UuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCxudWxsLHtvcHRpb25zOnRoaXMub3B0aW9ucyxpdGVtOnRoaXMuY3VycmVudEl0ZW19KTplKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLHRoaXNdKSxzPWgubGVuZ3RoLTE7cz49MDtzLS0paFtzXVswXS5lYWNoKGkpO3JldHVybiBlKHIpfSxfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmN1cnJlbnRJdGVtLmZpbmQoXCI6ZGF0YShcIit0aGlzLndpZGdldE5hbWUrXCItaXRlbSlcIik7dGhpcy5pdGVtcz1lLmdyZXAodGhpcy5pdGVtcyxmdW5jdGlvbihlKXtmb3IodmFyIGk9MDt0Lmxlbmd0aD5pO2krKylpZih0W2ldPT09ZS5pdGVtWzBdKXJldHVybiExO3JldHVybiEwfSl9LF9yZWZyZXNoSXRlbXM6ZnVuY3Rpb24odCl7dGhpcy5pdGVtcz1bXSx0aGlzLmNvbnRhaW5lcnM9W3RoaXNdO3ZhciBpLHMsbixhLG8scixoLGwsdT10aGlzLml0ZW1zLGQ9W1tlLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sdCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KSx0aGlzXV0sYz10aGlzLl9jb25uZWN0V2l0aCgpO2lmKGMmJnRoaXMucmVhZHkpZm9yKGk9Yy5sZW5ndGgtMTtpPj0wO2ktLSlmb3Iobj1lKGNbaV0sdGhpcy5kb2N1bWVudFswXSkscz1uLmxlbmd0aC0xO3M+PTA7cy0tKWE9ZS5kYXRhKG5bc10sdGhpcy53aWRnZXRGdWxsTmFtZSksYSYmYSE9PXRoaXMmJiFhLm9wdGlvbnMuZGlzYWJsZWQmJihkLnB1c2goW2UuaXNGdW5jdGlvbihhLm9wdGlvbnMuaXRlbXMpP2Eub3B0aW9ucy5pdGVtcy5jYWxsKGEuZWxlbWVudFswXSx0LHtpdGVtOnRoaXMuY3VycmVudEl0ZW19KTplKGEub3B0aW9ucy5pdGVtcyxhLmVsZW1lbnQpLGFdKSx0aGlzLmNvbnRhaW5lcnMucHVzaChhKSk7Zm9yKGk9ZC5sZW5ndGgtMTtpPj0wO2ktLSlmb3Iobz1kW2ldWzFdLHI9ZFtpXVswXSxzPTAsbD1yLmxlbmd0aDtsPnM7cysrKWg9ZShyW3NdKSxoLmRhdGEodGhpcy53aWRnZXROYW1lK1wiLWl0ZW1cIixvKSx1LnB1c2goe2l0ZW06aCxpbnN0YW5jZTpvLHdpZHRoOjAsaGVpZ2h0OjAsbGVmdDowLHRvcDowfSl9LHJlZnJlc2hQb3NpdGlvbnM6ZnVuY3Rpb24odCl7dGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD9cInhcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuaXRlbXNbMF0uaXRlbSk6ITEsdGhpcy5vZmZzZXRQYXJlbnQmJnRoaXMuaGVscGVyJiYodGhpcy5vZmZzZXQucGFyZW50PXRoaXMuX2dldFBhcmVudE9mZnNldCgpKTt2YXIgaSxzLG4sYTtmb3IoaT10aGlzLml0ZW1zLmxlbmd0aC0xO2k+PTA7aS0tKXM9dGhpcy5pdGVtc1tpXSxzLmluc3RhbmNlIT09dGhpcy5jdXJyZW50Q29udGFpbmVyJiZ0aGlzLmN1cnJlbnRDb250YWluZXImJnMuaXRlbVswXSE9PXRoaXMuY3VycmVudEl0ZW1bMF18fChuPXRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50P2UodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQscy5pdGVtKTpzLml0ZW0sdHx8KHMud2lkdGg9bi5vdXRlcldpZHRoKCkscy5oZWlnaHQ9bi5vdXRlckhlaWdodCgpKSxhPW4ub2Zmc2V0KCkscy5sZWZ0PWEubGVmdCxzLnRvcD1hLnRvcCk7aWYodGhpcy5vcHRpb25zLmN1c3RvbSYmdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycyl0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzLmNhbGwodGhpcyk7ZWxzZSBmb3IoaT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aT49MDtpLS0pYT10aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudC5vZmZzZXQoKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUubGVmdD1hLmxlZnQsdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLnRvcD1hLnRvcCx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUud2lkdGg9dGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub3V0ZXJXaWR0aCgpLHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5oZWlnaHQ9dGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub3V0ZXJIZWlnaHQoKTtyZXR1cm4gdGhpc30sX2NyZWF0ZVBsYWNlaG9sZGVyOmZ1bmN0aW9uKHQpe3Q9dHx8dGhpczt2YXIgaSxzPXQub3B0aW9ucztzLnBsYWNlaG9sZGVyJiZzLnBsYWNlaG9sZGVyLmNvbnN0cnVjdG9yIT09U3RyaW5nfHwoaT1zLnBsYWNlaG9sZGVyLHMucGxhY2Vob2xkZXI9e2VsZW1lbnQ6ZnVuY3Rpb24oKXt2YXIgcz10LmN1cnJlbnRJdGVtWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksbj1lKFwiPFwiK3MrXCI+XCIsdC5kb2N1bWVudFswXSkuYWRkQ2xhc3MoaXx8dC5jdXJyZW50SXRlbVswXS5jbGFzc05hbWUrXCIgdWktc29ydGFibGUtcGxhY2Vob2xkZXJcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIik7cmV0dXJuXCJ0Ym9keVwiPT09cz90Ll9jcmVhdGVUclBsYWNlaG9sZGVyKHQuY3VycmVudEl0ZW0uZmluZChcInRyXCIpLmVxKDApLGUoXCI8dHI+XCIsdC5kb2N1bWVudFswXSkuYXBwZW5kVG8obikpOlwidHJcIj09PXM/dC5fY3JlYXRlVHJQbGFjZWhvbGRlcih0LmN1cnJlbnRJdGVtLG4pOlwiaW1nXCI9PT1zJiZuLmF0dHIoXCJzcmNcIix0LmN1cnJlbnRJdGVtLmF0dHIoXCJzcmNcIikpLGl8fG4uY3NzKFwidmlzaWJpbGl0eVwiLFwiaGlkZGVuXCIpLG59LHVwZGF0ZTpmdW5jdGlvbihlLG4peyghaXx8cy5mb3JjZVBsYWNlaG9sZGVyU2l6ZSkmJihuLmhlaWdodCgpfHxuLmhlaWdodCh0LmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nVG9wXCIpfHwwLDEwKS1wYXJzZUludCh0LmN1cnJlbnRJdGVtLmNzcyhcInBhZGRpbmdCb3R0b21cIil8fDAsMTApKSxuLndpZHRoKCl8fG4ud2lkdGgodC5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nTGVmdFwiKXx8MCwxMCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nUmlnaHRcIil8fDAsMTApKSl9fSksdC5wbGFjZWhvbGRlcj1lKHMucGxhY2Vob2xkZXIuZWxlbWVudC5jYWxsKHQuZWxlbWVudCx0LmN1cnJlbnRJdGVtKSksdC5jdXJyZW50SXRlbS5hZnRlcih0LnBsYWNlaG9sZGVyKSxzLnBsYWNlaG9sZGVyLnVwZGF0ZSh0LHQucGxhY2Vob2xkZXIpfSxfY3JlYXRlVHJQbGFjZWhvbGRlcjpmdW5jdGlvbih0LGkpe3ZhciBzPXRoaXM7dC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKXtlKFwiPHRkPiYjMTYwOzwvdGQ+XCIscy5kb2N1bWVudFswXSkuYXR0cihcImNvbHNwYW5cIixlKHRoaXMpLmF0dHIoXCJjb2xzcGFuXCIpfHwxKS5hcHBlbmRUbyhpKX0pfSxfY29udGFjdENvbnRhaW5lcnM6ZnVuY3Rpb24odCl7dmFyIGkscyxuLGEsbyxyLGgsbCx1LGQsYz1udWxsLHA9bnVsbDtmb3IoaT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aT49MDtpLS0paWYoIWUuY29udGFpbnModGhpcy5jdXJyZW50SXRlbVswXSx0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudFswXSkpaWYodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlKSl7aWYoYyYmZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudFswXSxjLmVsZW1lbnRbMF0pKWNvbnRpbnVlO2M9dGhpcy5jb250YWluZXJzW2ldLHA9aX1lbHNlIHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyJiYodGhpcy5jb250YWluZXJzW2ldLl90cmlnZ2VyKFwib3V0XCIsdCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyPTApO2lmKGMpaWYoMT09PXRoaXMuY29udGFpbmVycy5sZW5ndGgpdGhpcy5jb250YWluZXJzW3BdLmNvbnRhaW5lckNhY2hlLm92ZXJ8fCh0aGlzLmNvbnRhaW5lcnNbcF0uX3RyaWdnZXIoXCJvdmVyXCIsdCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1twXS5jb250YWluZXJDYWNoZS5vdmVyPTEpO2Vsc2V7Zm9yKG49MWU0LGE9bnVsbCx1PWMuZmxvYXRpbmd8fHRoaXMuX2lzRmxvYXRpbmcodGhpcy5jdXJyZW50SXRlbSksbz11P1wibGVmdFwiOlwidG9wXCIscj11P1wid2lkdGhcIjpcImhlaWdodFwiLGQ9dT9cImNsaWVudFhcIjpcImNsaWVudFlcIixzPXRoaXMuaXRlbXMubGVuZ3RoLTE7cz49MDtzLS0pZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbcF0uZWxlbWVudFswXSx0aGlzLml0ZW1zW3NdLml0ZW1bMF0pJiZ0aGlzLml0ZW1zW3NdLml0ZW1bMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiYoaD10aGlzLml0ZW1zW3NdLml0ZW0ub2Zmc2V0KClbb10sbD0hMSx0W2RdLWg+dGhpcy5pdGVtc1tzXVtyXS8yJiYobD0hMCksbj5NYXRoLmFicyh0W2RdLWgpJiYobj1NYXRoLmFicyh0W2RdLWgpLGE9dGhpcy5pdGVtc1tzXSx0aGlzLmRpcmVjdGlvbj1sP1widXBcIjpcImRvd25cIikpO2lmKCFhJiYhdGhpcy5vcHRpb25zLmRyb3BPbkVtcHR5KXJldHVybjtpZih0aGlzLmN1cnJlbnRDb250YWluZXI9PT10aGlzLmNvbnRhaW5lcnNbcF0pcmV0dXJuIHRoaXMuY3VycmVudENvbnRhaW5lci5jb250YWluZXJDYWNoZS5vdmVyfHwodGhpcy5jb250YWluZXJzW3BdLl90cmlnZ2VyKFwib3ZlclwiLHQsdGhpcy5fdWlIYXNoKCkpLHRoaXMuY3VycmVudENvbnRhaW5lci5jb250YWluZXJDYWNoZS5vdmVyPTEpLHZvaWQgMDthP3RoaXMuX3JlYXJyYW5nZSh0LGEsbnVsbCwhMCk6dGhpcy5fcmVhcnJhbmdlKHQsbnVsbCx0aGlzLmNvbnRhaW5lcnNbcF0uZWxlbWVudCwhMCksdGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLHQsdGhpcy5fdWlIYXNoKCkpLHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcihcImNoYW5nZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpcy5jb250YWluZXJzW3BdLHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlci51cGRhdGUodGhpcy5jdXJyZW50Q29udGFpbmVyLHRoaXMucGxhY2Vob2xkZXIpLHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcihcIm92ZXJcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSksdGhpcy5jb250YWluZXJzW3BdLmNvbnRhaW5lckNhY2hlLm92ZXI9MX19LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5vcHRpb25zLHM9ZS5pc0Z1bmN0aW9uKGkuaGVscGVyKT9lKGkuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSxbdCx0aGlzLmN1cnJlbnRJdGVtXSkpOlwiY2xvbmVcIj09PWkuaGVscGVyP3RoaXMuY3VycmVudEl0ZW0uY2xvbmUoKTp0aGlzLmN1cnJlbnRJdGVtO3JldHVybiBzLnBhcmVudHMoXCJib2R5XCIpLmxlbmd0aHx8ZShcInBhcmVudFwiIT09aS5hcHBlbmRUbz9pLmFwcGVuZFRvOnRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSlbMF0uYXBwZW5kQ2hpbGQoc1swXSksc1swXT09PXRoaXMuY3VycmVudEl0ZW1bMF0mJih0aGlzLl9zdG9yZWRDU1M9e3dpZHRoOnRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUud2lkdGgsaGVpZ2h0OnRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUuaGVpZ2h0LHBvc2l0aW9uOnRoaXMuY3VycmVudEl0ZW0uY3NzKFwicG9zaXRpb25cIiksdG9wOnRoaXMuY3VycmVudEl0ZW0uY3NzKFwidG9wXCIpLGxlZnQ6dGhpcy5jdXJyZW50SXRlbS5jc3MoXCJsZWZ0XCIpfSksKCFzWzBdLnN0eWxlLndpZHRofHxpLmZvcmNlSGVscGVyU2l6ZSkmJnMud2lkdGgodGhpcy5jdXJyZW50SXRlbS53aWR0aCgpKSwoIXNbMF0uc3R5bGUuaGVpZ2h0fHxpLmZvcmNlSGVscGVyU2l6ZSkmJnMuaGVpZ2h0KHRoaXMuY3VycmVudEl0ZW0uaGVpZ2h0KCkpLHN9LF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOmZ1bmN0aW9uKHQpe1wic3RyaW5nXCI9PXR5cGVvZiB0JiYodD10LnNwbGl0KFwiIFwiKSksZS5pc0FycmF5KHQpJiYodD17bGVmdDordFswXSx0b3A6K3RbMV18fDB9KSxcImxlZnRcImluIHQmJih0aGlzLm9mZnNldC5jbGljay5sZWZ0PXQubGVmdCt0aGlzLm1hcmdpbnMubGVmdCksXCJyaWdodFwiaW4gdCYmKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10LnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0KSxcInRvcFwiaW4gdCYmKHRoaXMub2Zmc2V0LmNsaWNrLnRvcD10LnRvcCt0aGlzLm1hcmdpbnMudG9wKSxcImJvdHRvbVwiaW4gdCYmKHRoaXMub2Zmc2V0LmNsaWNrLnRvcD10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10LmJvdHRvbSt0aGlzLm1hcmdpbnMudG9wKX0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PXRoaXMuaGVscGVyLm9mZnNldFBhcmVudCgpO3ZhciB0PXRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpO3JldHVyblwiYWJzb2x1dGVcIj09PXRoaXMuY3NzUG9zaXRpb24mJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkmJih0LmxlZnQrPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSx0LnRvcCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkpLCh0aGlzLm9mZnNldFBhcmVudFswXT09PXRoaXMuZG9jdW1lbnRbMF0uYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmXCJodG1sXCI9PT10aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkmJmUudWkuaWUpJiYodD17dG9wOjAsbGVmdDowfSkse3RvcDp0LnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OnQubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZihcInJlbGF0aXZlXCI9PT10aGlzLmNzc1Bvc2l0aW9uKXt2YXIgZT10aGlzLmN1cnJlbnRJdGVtLnBvc2l0aW9uKCk7cmV0dXJue3RvcDplLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDplLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fXJldHVybnt0b3A6MCxsZWZ0OjB9fSxfY2FjaGVNYXJnaW5zOmZ1bmN0aW9uKCl7dGhpcy5tYXJnaW5zPXtsZWZ0OnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luTGVmdFwiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MH19LF9jYWNoZUhlbHBlclByb3BvcnRpb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXJQcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpfX0sX3NldENvbnRhaW5tZW50OmZ1bmN0aW9uKCl7dmFyIHQsaSxzLG49dGhpcy5vcHRpb25zO1wicGFyZW50XCI9PT1uLmNvbnRhaW5tZW50JiYobi5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlKSwoXCJkb2N1bWVudFwiPT09bi5jb250YWlubWVudHx8XCJ3aW5kb3dcIj09PW4uY29udGFpbm1lbnQpJiYodGhpcy5jb250YWlubWVudD1bMC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LDAtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsXCJkb2N1bWVudFwiPT09bi5jb250YWlubWVudD90aGlzLmRvY3VtZW50LndpZHRoKCk6dGhpcy53aW5kb3cud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChcImRvY3VtZW50XCI9PT1uLmNvbnRhaW5tZW50P3RoaXMuZG9jdW1lbnQud2lkdGgoKTp0aGlzLndpbmRvdy5oZWlnaHQoKXx8dGhpcy5kb2N1bWVudFswXS5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXSksL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KG4uY29udGFpbm1lbnQpfHwodD1lKG4uY29udGFpbm1lbnQpWzBdLGk9ZShuLmNvbnRhaW5tZW50KS5vZmZzZXQoKSxzPVwiaGlkZGVuXCIhPT1lKHQpLmNzcyhcIm92ZXJmbG93XCIpLHRoaXMuY29udGFpbm1lbnQ9W2kubGVmdCsocGFyc2VJbnQoZSh0KS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoZSh0KS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy5sZWZ0LGkudG9wKyhwYXJzZUludChlKHQpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ1RvcFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy50b3AsaS5sZWZ0KyhzP01hdGgubWF4KHQuc2Nyb2xsV2lkdGgsdC5vZmZzZXRXaWR0aCk6dC5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGUodCkuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCxpLnRvcCsocz9NYXRoLm1heCh0LnNjcm9sbEhlaWdodCx0Lm9mZnNldEhlaWdodCk6dC5vZmZzZXRIZWlnaHQpLShwYXJzZUludChlKHQpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ0JvdHRvbVwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3BdKVxufSxfY29udmVydFBvc2l0aW9uVG86ZnVuY3Rpb24odCxpKXtpfHwoaT10aGlzLnBvc2l0aW9uKTt2YXIgcz1cImFic29sdXRlXCI9PT10PzE6LTEsbj1cImFic29sdXRlXCIhPT10aGlzLmNzc1Bvc2l0aW9ufHx0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMuZG9jdW1lbnRbMF0mJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pP3RoaXMuc2Nyb2xsUGFyZW50OnRoaXMub2Zmc2V0UGFyZW50LGE9LyhodG1sfGJvZHkpL2kudGVzdChuWzBdLnRhZ05hbWUpO3JldHVybnt0b3A6aS50b3ArdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wKnMrdGhpcy5vZmZzZXQucGFyZW50LnRvcCpzLShcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTphPzA6bi5zY3JvbGxUb3AoKSkqcyxsZWZ0OmkubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KnMrdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqcy0oXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmE/MDpuLnNjcm9sbExlZnQoKSkqc319LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpLHMsbj10aGlzLm9wdGlvbnMsYT10LnBhZ2VYLG89dC5wYWdlWSxyPVwiYWJzb2x1dGVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSk/dGhpcy5zY3JvbGxQYXJlbnQ6dGhpcy5vZmZzZXRQYXJlbnQsaD0vKGh0bWx8Ym9keSkvaS50ZXN0KHJbMF0udGFnTmFtZSk7cmV0dXJuXCJyZWxhdGl2ZVwiIT09dGhpcy5jc3NQb3NpdGlvbnx8dGhpcy5zY3JvbGxQYXJlbnRbMF0hPT10aGlzLmRvY3VtZW50WzBdJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMub2Zmc2V0UGFyZW50WzBdfHwodGhpcy5vZmZzZXQucmVsYXRpdmU9dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKSksdGhpcy5vcmlnaW5hbFBvc2l0aW9uJiYodGhpcy5jb250YWlubWVudCYmKHQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDx0aGlzLmNvbnRhaW5tZW50WzBdJiYoYT10aGlzLmNvbnRhaW5tZW50WzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLHQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV0mJihvPXRoaXMuY29udGFpbm1lbnRbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wKSx0LnBhZ2VYLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+dGhpcy5jb250YWlubWVudFsyXSYmKGE9dGhpcy5jb250YWlubWVudFsyXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0KSx0LnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD50aGlzLmNvbnRhaW5tZW50WzNdJiYobz10aGlzLmNvbnRhaW5tZW50WzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCkpLG4uZ3JpZCYmKGk9dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKG8tdGhpcy5vcmlnaW5hbFBhZ2VZKS9uLmdyaWRbMV0pKm4uZ3JpZFsxXSxvPXRoaXMuY29udGFpbm1lbnQ/aS10aGlzLm9mZnNldC5jbGljay50b3A+PXRoaXMuY29udGFpbm1lbnRbMV0mJmktdGhpcy5vZmZzZXQuY2xpY2sudG9wPD10aGlzLmNvbnRhaW5tZW50WzNdP2k6aS10aGlzLm9mZnNldC5jbGljay50b3A+PXRoaXMuY29udGFpbm1lbnRbMV0/aS1uLmdyaWRbMV06aStuLmdyaWRbMV06aSxzPXRoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChhLXRoaXMub3JpZ2luYWxQYWdlWCkvbi5ncmlkWzBdKSpuLmdyaWRbMF0sYT10aGlzLmNvbnRhaW5tZW50P3MtdGhpcy5vZmZzZXQuY2xpY2subGVmdD49dGhpcy5jb250YWlubWVudFswXSYmcy10aGlzLm9mZnNldC5jbGljay5sZWZ0PD10aGlzLmNvbnRhaW5tZW50WzJdP3M6cy10aGlzLm9mZnNldC5jbGljay5sZWZ0Pj10aGlzLmNvbnRhaW5tZW50WzBdP3Mtbi5ncmlkWzBdOnMrbi5ncmlkWzBdOnMpKSx7dG9wOm8tdGhpcy5vZmZzZXQuY2xpY2sudG9wLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wKyhcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpoPzA6ci5zY3JvbGxUb3AoKSksbGVmdDphLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmg/MDpyLnNjcm9sbExlZnQoKSl9fSxfcmVhcnJhbmdlOmZ1bmN0aW9uKGUsdCxpLHMpe2k/aVswXS5hcHBlbmRDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTp0Lml0ZW1bMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlclswXSxcImRvd25cIj09PXRoaXMuZGlyZWN0aW9uP3QuaXRlbVswXTp0Lml0ZW1bMF0ubmV4dFNpYmxpbmcpLHRoaXMuY291bnRlcj10aGlzLmNvdW50ZXI/Kyt0aGlzLmNvdW50ZXI6MTt2YXIgbj10aGlzLmNvdW50ZXI7dGhpcy5fZGVsYXkoZnVuY3Rpb24oKXtuPT09dGhpcy5jb3VudGVyJiZ0aGlzLnJlZnJlc2hQb3NpdGlvbnMoIXMpfSl9LF9jbGVhcjpmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIGkoZSx0LGkpe3JldHVybiBmdW5jdGlvbihzKXtpLl90cmlnZ2VyKGUscyx0Ll91aUhhc2godCkpfX10aGlzLnJldmVydGluZz0hMTt2YXIgcyxuPVtdO2lmKCF0aGlzLl9ub0ZpbmFsU29ydCYmdGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKS5sZW5ndGgmJnRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKHRoaXMuY3VycmVudEl0ZW0pLHRoaXMuX25vRmluYWxTb3J0PW51bGwsdGhpcy5oZWxwZXJbMF09PT10aGlzLmN1cnJlbnRJdGVtWzBdKXtmb3IocyBpbiB0aGlzLl9zdG9yZWRDU1MpKFwiYXV0b1wiPT09dGhpcy5fc3RvcmVkQ1NTW3NdfHxcInN0YXRpY1wiPT09dGhpcy5fc3RvcmVkQ1NTW3NdKSYmKHRoaXMuX3N0b3JlZENTU1tzXT1cIlwiKTt0aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpfWVsc2UgdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7Zm9yKHRoaXMuZnJvbU91dHNpZGUmJiF0JiZuLnB1c2goZnVuY3Rpb24oZSl7dGhpcy5fdHJpZ2dlcihcInJlY2VpdmVcIixlLHRoaXMuX3VpSGFzaCh0aGlzLmZyb21PdXRzaWRlKSl9KSwhdGhpcy5mcm9tT3V0c2lkZSYmdGhpcy5kb21Qb3NpdGlvbi5wcmV2PT09dGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KFwiLnVpLXNvcnRhYmxlLWhlbHBlclwiKVswXSYmdGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQ9PT10aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdfHx0fHxuLnB1c2goZnVuY3Rpb24oZSl7dGhpcy5fdHJpZ2dlcihcInVwZGF0ZVwiLGUsdGhpcy5fdWlIYXNoKCkpfSksdGhpcyE9PXRoaXMuY3VycmVudENvbnRhaW5lciYmKHR8fChuLnB1c2goZnVuY3Rpb24oZSl7dGhpcy5fdHJpZ2dlcihcInJlbW92ZVwiLGUsdGhpcy5fdWlIYXNoKCkpfSksbi5wdXNoKGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtlLl90cmlnZ2VyKFwicmVjZWl2ZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmN1cnJlbnRDb250YWluZXIpKSxuLnB1c2goZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe2UuX3RyaWdnZXIoXCJ1cGRhdGVcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jdXJyZW50Q29udGFpbmVyKSkpKSxzPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtzPj0wO3MtLSl0fHxuLnB1c2goaShcImRlYWN0aXZhdGVcIix0aGlzLHRoaXMuY29udGFpbmVyc1tzXSkpLHRoaXMuY29udGFpbmVyc1tzXS5jb250YWluZXJDYWNoZS5vdmVyJiYobi5wdXNoKGkoXCJvdXRcIix0aGlzLHRoaXMuY29udGFpbmVyc1tzXSkpLHRoaXMuY29udGFpbmVyc1tzXS5jb250YWluZXJDYWNoZS5vdmVyPTApO2lmKHRoaXMuc3RvcmVkQ3Vyc29yJiYodGhpcy5kb2N1bWVudC5maW5kKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIix0aGlzLnN0b3JlZEN1cnNvciksdGhpcy5zdG9yZWRTdHlsZXNoZWV0LnJlbW92ZSgpKSx0aGlzLl9zdG9yZWRPcGFjaXR5JiZ0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsdGhpcy5fc3RvcmVkT3BhY2l0eSksdGhpcy5fc3RvcmVkWkluZGV4JiZ0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIixcImF1dG9cIj09PXRoaXMuX3N0b3JlZFpJbmRleD9cIlwiOnRoaXMuX3N0b3JlZFpJbmRleCksdGhpcy5kcmFnZ2luZz0hMSx0fHx0aGlzLl90cmlnZ2VyKFwiYmVmb3JlU3RvcFwiLGUsdGhpcy5fdWlIYXNoKCkpLHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKSx0aGlzLmNhbmNlbEhlbHBlclJlbW92YWx8fCh0aGlzLmhlbHBlclswXSE9PXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMuaGVscGVyLnJlbW92ZSgpLHRoaXMuaGVscGVyPW51bGwpLCF0KXtmb3Iocz0wO24ubGVuZ3RoPnM7cysrKW5bc10uY2FsbCh0aGlzLGUpO3RoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZSx0aGlzLl91aUhhc2goKSl9cmV0dXJuIHRoaXMuZnJvbU91dHNpZGU9ITEsIXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbH0sX3RyaWdnZXI6ZnVuY3Rpb24oKXtlLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpPT09ITEmJnRoaXMuY2FuY2VsKCl9LF91aUhhc2g6ZnVuY3Rpb24odCl7dmFyIGk9dHx8dGhpcztyZXR1cm57aGVscGVyOmkuaGVscGVyLHBsYWNlaG9sZGVyOmkucGxhY2Vob2xkZXJ8fGUoW10pLHBvc2l0aW9uOmkucG9zaXRpb24sb3JpZ2luYWxQb3NpdGlvbjppLm9yaWdpbmFsUG9zaXRpb24sb2Zmc2V0OmkucG9zaXRpb25BYnMsaXRlbTppLmN1cnJlbnRJdGVtLHNlbmRlcjp0P3QuZWxlbWVudDpudWxsfX19KTt2YXIgbz1cInVpLWVmZmVjdHMtXCIscj1lO2UuZWZmZWN0cz17ZWZmZWN0Ont9fSxmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIGkoZSx0LGkpe3ZhciBzPWRbdC50eXBlXXx8e307cmV0dXJuIG51bGw9PWU/aXx8IXQuZGVmP251bGw6dC5kZWY6KGU9cy5mbG9vcj9+fmU6cGFyc2VGbG9hdChlKSxpc05hTihlKT90LmRlZjpzLm1vZD8oZStzLm1vZCklcy5tb2Q6MD5lPzA6ZT5zLm1heD9zLm1heDplKX1mdW5jdGlvbiBzKGkpe3ZhciBzPWwoKSxuPXMuX3JnYmE9W107cmV0dXJuIGk9aS50b0xvd2VyQ2FzZSgpLGYoaCxmdW5jdGlvbihlLGEpe3ZhciBvLHI9YS5yZS5leGVjKGkpLGg9ciYmYS5wYXJzZShyKSxsPWEuc3BhY2V8fFwicmdiYVwiO3JldHVybiBoPyhvPXNbbF0oaCksc1t1W2xdLmNhY2hlXT1vW3VbbF0uY2FjaGVdLG49cy5fcmdiYT1vLl9yZ2JhLCExKTp0fSksbi5sZW5ndGg/KFwiMCwwLDAsMFwiPT09bi5qb2luKCkmJmUuZXh0ZW5kKG4sYS50cmFuc3BhcmVudCkscyk6YVtpXX1mdW5jdGlvbiBuKGUsdCxpKXtyZXR1cm4gaT0oaSsxKSUxLDE+NippP2UrNioodC1lKSppOjE+MippP3Q6Mj4zKmk/ZSs2Kih0LWUpKigyLzMtaSk6ZX12YXIgYSxvPVwiYmFja2dyb3VuZENvbG9yIGJvcmRlckJvdHRvbUNvbG9yIGJvcmRlckxlZnRDb2xvciBib3JkZXJSaWdodENvbG9yIGJvcmRlclRvcENvbG9yIGNvbG9yIGNvbHVtblJ1bGVDb2xvciBvdXRsaW5lQ29sb3IgdGV4dERlY29yYXRpb25Db2xvciB0ZXh0RW1waGFzaXNDb2xvclwiLHI9L14oW1xcLStdKT1cXHMqKFxcZCtcXC4/XFxkKikvLGg9W3tyZTovcmdiYT9cXChcXHMqKFxcZHsxLDN9KVxccyosXFxzKihcXGR7MSwzfSlcXHMqLFxccyooXFxkezEsM30pXFxzKig/OixcXHMqKFxcZD8oPzpcXC5cXGQrKT8pXFxzKik/XFwpLyxwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bZVsxXSxlWzJdLGVbM10sZVs0XV19fSx7cmU6L3JnYmE/XFwoXFxzKihcXGQrKD86XFwuXFxkKyk/KVxcJVxccyosXFxzKihcXGQrKD86XFwuXFxkKyk/KVxcJVxccyosXFxzKihcXGQrKD86XFwuXFxkKyk/KVxcJVxccyooPzosXFxzKihcXGQ/KD86XFwuXFxkKyk/KVxccyopP1xcKS8scGFyc2U6ZnVuY3Rpb24oZSl7cmV0dXJuWzIuNTUqZVsxXSwyLjU1KmVbMl0sMi41NSplWzNdLGVbNF1dfX0se3JlOi8jKFthLWYwLTldezJ9KShbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pLyxwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bcGFyc2VJbnQoZVsxXSwxNikscGFyc2VJbnQoZVsyXSwxNikscGFyc2VJbnQoZVszXSwxNildfX0se3JlOi8jKFthLWYwLTldKShbYS1mMC05XSkoW2EtZjAtOV0pLyxwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bcGFyc2VJbnQoZVsxXStlWzFdLDE2KSxwYXJzZUludChlWzJdK2VbMl0sMTYpLHBhcnNlSW50KGVbM10rZVszXSwxNildfX0se3JlOi9oc2xhP1xcKFxccyooXFxkKyg/OlxcLlxcZCspPylcXHMqLFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqLFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqKD86LFxccyooXFxkPyg/OlxcLlxcZCspPylcXHMqKT9cXCkvLHNwYWNlOlwiaHNsYVwiLHBhcnNlOmZ1bmN0aW9uKGUpe3JldHVybltlWzFdLGVbMl0vMTAwLGVbM10vMTAwLGVbNF1dfX1dLGw9ZS5Db2xvcj1mdW5jdGlvbih0LGkscyxuKXtyZXR1cm4gbmV3IGUuQ29sb3IuZm4ucGFyc2UodCxpLHMsbil9LHU9e3JnYmE6e3Byb3BzOntyZWQ6e2lkeDowLHR5cGU6XCJieXRlXCJ9LGdyZWVuOntpZHg6MSx0eXBlOlwiYnl0ZVwifSxibHVlOntpZHg6Mix0eXBlOlwiYnl0ZVwifX19LGhzbGE6e3Byb3BzOntodWU6e2lkeDowLHR5cGU6XCJkZWdyZWVzXCJ9LHNhdHVyYXRpb246e2lkeDoxLHR5cGU6XCJwZXJjZW50XCJ9LGxpZ2h0bmVzczp7aWR4OjIsdHlwZTpcInBlcmNlbnRcIn19fX0sZD17XCJieXRlXCI6e2Zsb29yOiEwLG1heDoyNTV9LHBlcmNlbnQ6e21heDoxfSxkZWdyZWVzOnttb2Q6MzYwLGZsb29yOiEwfX0sYz1sLnN1cHBvcnQ9e30scD1lKFwiPHA+XCIpWzBdLGY9ZS5lYWNoO3Auc3R5bGUuY3NzVGV4dD1cImJhY2tncm91bmQtY29sb3I6cmdiYSgxLDEsMSwuNSlcIixjLnJnYmE9cC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IuaW5kZXhPZihcInJnYmFcIik+LTEsZih1LGZ1bmN0aW9uKGUsdCl7dC5jYWNoZT1cIl9cIitlLHQucHJvcHMuYWxwaGE9e2lkeDozLHR5cGU6XCJwZXJjZW50XCIsZGVmOjF9fSksbC5mbj1lLmV4dGVuZChsLnByb3RvdHlwZSx7cGFyc2U6ZnVuY3Rpb24obixvLHIsaCl7aWYobj09PXQpcmV0dXJuIHRoaXMuX3JnYmE9W251bGwsbnVsbCxudWxsLG51bGxdLHRoaXM7KG4uanF1ZXJ5fHxuLm5vZGVUeXBlKSYmKG49ZShuKS5jc3Mobyksbz10KTt2YXIgZD10aGlzLGM9ZS50eXBlKG4pLHA9dGhpcy5fcmdiYT1bXTtyZXR1cm4gbyE9PXQmJihuPVtuLG8scixoXSxjPVwiYXJyYXlcIiksXCJzdHJpbmdcIj09PWM/dGhpcy5wYXJzZShzKG4pfHxhLl9kZWZhdWx0KTpcImFycmF5XCI9PT1jPyhmKHUucmdiYS5wcm9wcyxmdW5jdGlvbihlLHQpe3BbdC5pZHhdPWkoblt0LmlkeF0sdCl9KSx0aGlzKTpcIm9iamVjdFwiPT09Yz8obiBpbnN0YW5jZW9mIGw/Zih1LGZ1bmN0aW9uKGUsdCl7blt0LmNhY2hlXSYmKGRbdC5jYWNoZV09blt0LmNhY2hlXS5zbGljZSgpKX0pOmYodSxmdW5jdGlvbih0LHMpe3ZhciBhPXMuY2FjaGU7ZihzLnByb3BzLGZ1bmN0aW9uKGUsdCl7aWYoIWRbYV0mJnMudG8pe2lmKFwiYWxwaGFcIj09PWV8fG51bGw9PW5bZV0pcmV0dXJuO2RbYV09cy50byhkLl9yZ2JhKX1kW2FdW3QuaWR4XT1pKG5bZV0sdCwhMCl9KSxkW2FdJiYwPmUuaW5BcnJheShudWxsLGRbYV0uc2xpY2UoMCwzKSkmJihkW2FdWzNdPTEscy5mcm9tJiYoZC5fcmdiYT1zLmZyb20oZFthXSkpKX0pLHRoaXMpOnR9LGlzOmZ1bmN0aW9uKGUpe3ZhciBpPWwoZSkscz0hMCxuPXRoaXM7cmV0dXJuIGYodSxmdW5jdGlvbihlLGEpe3ZhciBvLHI9aVthLmNhY2hlXTtyZXR1cm4gciYmKG89blthLmNhY2hlXXx8YS50byYmYS50byhuLl9yZ2JhKXx8W10sZihhLnByb3BzLGZ1bmN0aW9uKGUsaSl7cmV0dXJuIG51bGwhPXJbaS5pZHhdP3M9cltpLmlkeF09PT1vW2kuaWR4XTp0fSkpLHN9KSxzfSxfc3BhY2U6ZnVuY3Rpb24oKXt2YXIgZT1bXSx0PXRoaXM7cmV0dXJuIGYodSxmdW5jdGlvbihpLHMpe3Rbcy5jYWNoZV0mJmUucHVzaChpKX0pLGUucG9wKCl9LHRyYW5zaXRpb246ZnVuY3Rpb24oZSx0KXt2YXIgcz1sKGUpLG49cy5fc3BhY2UoKSxhPXVbbl0sbz0wPT09dGhpcy5hbHBoYSgpP2woXCJ0cmFuc3BhcmVudFwiKTp0aGlzLHI9b1thLmNhY2hlXXx8YS50byhvLl9yZ2JhKSxoPXIuc2xpY2UoKTtyZXR1cm4gcz1zW2EuY2FjaGVdLGYoYS5wcm9wcyxmdW5jdGlvbihlLG4pe3ZhciBhPW4uaWR4LG89clthXSxsPXNbYV0sdT1kW24udHlwZV18fHt9O251bGwhPT1sJiYobnVsbD09PW8/aFthXT1sOih1Lm1vZCYmKGwtbz51Lm1vZC8yP28rPXUubW9kOm8tbD51Lm1vZC8yJiYoby09dS5tb2QpKSxoW2FdPWkoKGwtbykqdCtvLG4pKSl9KSx0aGlzW25dKGgpfSxibGVuZDpmdW5jdGlvbih0KXtpZigxPT09dGhpcy5fcmdiYVszXSlyZXR1cm4gdGhpczt2YXIgaT10aGlzLl9yZ2JhLnNsaWNlKCkscz1pLnBvcCgpLG49bCh0KS5fcmdiYTtyZXR1cm4gbChlLm1hcChpLGZ1bmN0aW9uKGUsdCl7cmV0dXJuKDEtcykqblt0XStzKmV9KSl9LHRvUmdiYVN0cmluZzpmdW5jdGlvbigpe3ZhciB0PVwicmdiYShcIixpPWUubWFwKHRoaXMuX3JnYmEsZnVuY3Rpb24oZSx0KXtyZXR1cm4gbnVsbD09ZT90PjI/MTowOmV9KTtyZXR1cm4gMT09PWlbM10mJihpLnBvcCgpLHQ9XCJyZ2IoXCIpLHQraS5qb2luKCkrXCIpXCJ9LHRvSHNsYVN0cmluZzpmdW5jdGlvbigpe3ZhciB0PVwiaHNsYShcIixpPWUubWFwKHRoaXMuaHNsYSgpLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGw9PWUmJihlPXQ+Mj8xOjApLHQmJjM+dCYmKGU9TWF0aC5yb3VuZCgxMDAqZSkrXCIlXCIpLGV9KTtyZXR1cm4gMT09PWlbM10mJihpLnBvcCgpLHQ9XCJoc2woXCIpLHQraS5qb2luKCkrXCIpXCJ9LHRvSGV4U3RyaW5nOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuX3JnYmEuc2xpY2UoKSxzPWkucG9wKCk7cmV0dXJuIHQmJmkucHVzaCh+figyNTUqcykpLFwiI1wiK2UubWFwKGksZnVuY3Rpb24oZSl7cmV0dXJuIGU9KGV8fDApLnRvU3RyaW5nKDE2KSwxPT09ZS5sZW5ndGg/XCIwXCIrZTplfSkuam9pbihcIlwiKX0sdG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gMD09PXRoaXMuX3JnYmFbM10/XCJ0cmFuc3BhcmVudFwiOnRoaXMudG9SZ2JhU3RyaW5nKCl9fSksbC5mbi5wYXJzZS5wcm90b3R5cGU9bC5mbix1LmhzbGEudG89ZnVuY3Rpb24oZSl7aWYobnVsbD09ZVswXXx8bnVsbD09ZVsxXXx8bnVsbD09ZVsyXSlyZXR1cm5bbnVsbCxudWxsLG51bGwsZVszXV07dmFyIHQsaSxzPWVbMF0vMjU1LG49ZVsxXS8yNTUsYT1lWzJdLzI1NSxvPWVbM10scj1NYXRoLm1heChzLG4sYSksaD1NYXRoLm1pbihzLG4sYSksbD1yLWgsdT1yK2gsZD0uNSp1O3JldHVybiB0PWg9PT1yPzA6cz09PXI/NjAqKG4tYSkvbCszNjA6bj09PXI/NjAqKGEtcykvbCsxMjA6NjAqKHMtbikvbCsyNDAsaT0wPT09bD8wOi41Pj1kP2wvdTpsLygyLXUpLFtNYXRoLnJvdW5kKHQpJTM2MCxpLGQsbnVsbD09bz8xOm9dfSx1LmhzbGEuZnJvbT1mdW5jdGlvbihlKXtpZihudWxsPT1lWzBdfHxudWxsPT1lWzFdfHxudWxsPT1lWzJdKXJldHVybltudWxsLG51bGwsbnVsbCxlWzNdXTt2YXIgdD1lWzBdLzM2MCxpPWVbMV0scz1lWzJdLGE9ZVszXSxvPS41Pj1zP3MqKDEraSk6cytpLXMqaSxyPTIqcy1vO3JldHVybltNYXRoLnJvdW5kKDI1NSpuKHIsbyx0KzEvMykpLE1hdGgucm91bmQoMjU1Km4ocixvLHQpKSxNYXRoLnJvdW5kKDI1NSpuKHIsbyx0LTEvMykpLGFdfSxmKHUsZnVuY3Rpb24ocyxuKXt2YXIgYT1uLnByb3BzLG89bi5jYWNoZSxoPW4udG8sdT1uLmZyb207bC5mbltzXT1mdW5jdGlvbihzKXtpZihoJiYhdGhpc1tvXSYmKHRoaXNbb109aCh0aGlzLl9yZ2JhKSkscz09PXQpcmV0dXJuIHRoaXNbb10uc2xpY2UoKTt2YXIgbixyPWUudHlwZShzKSxkPVwiYXJyYXlcIj09PXJ8fFwib2JqZWN0XCI9PT1yP3M6YXJndW1lbnRzLGM9dGhpc1tvXS5zbGljZSgpO3JldHVybiBmKGEsZnVuY3Rpb24oZSx0KXt2YXIgcz1kW1wib2JqZWN0XCI9PT1yP2U6dC5pZHhdO251bGw9PXMmJihzPWNbdC5pZHhdKSxjW3QuaWR4XT1pKHMsdCl9KSx1PyhuPWwodShjKSksbltvXT1jLG4pOmwoYyl9LGYoYSxmdW5jdGlvbih0LGkpe2wuZm5bdF18fChsLmZuW3RdPWZ1bmN0aW9uKG4pe3ZhciBhLG89ZS50eXBlKG4pLGg9XCJhbHBoYVwiPT09dD90aGlzLl9oc2xhP1wiaHNsYVwiOlwicmdiYVwiOnMsbD10aGlzW2hdKCksdT1sW2kuaWR4XTtyZXR1cm5cInVuZGVmaW5lZFwiPT09bz91OihcImZ1bmN0aW9uXCI9PT1vJiYobj1uLmNhbGwodGhpcyx1KSxvPWUudHlwZShuKSksbnVsbD09biYmaS5lbXB0eT90aGlzOihcInN0cmluZ1wiPT09byYmKGE9ci5leGVjKG4pLGEmJihuPXUrcGFyc2VGbG9hdChhWzJdKSooXCIrXCI9PT1hWzFdPzE6LTEpKSksbFtpLmlkeF09bix0aGlzW2hdKGwpKSl9KX0pfSksbC5ob29rPWZ1bmN0aW9uKHQpe3ZhciBpPXQuc3BsaXQoXCIgXCIpO2YoaSxmdW5jdGlvbih0LGkpe2UuY3NzSG9va3NbaV09e3NldDpmdW5jdGlvbih0LG4pe3ZhciBhLG8scj1cIlwiO2lmKFwidHJhbnNwYXJlbnRcIiE9PW4mJihcInN0cmluZ1wiIT09ZS50eXBlKG4pfHwoYT1zKG4pKSkpe2lmKG49bChhfHxuKSwhYy5yZ2JhJiYxIT09bi5fcmdiYVszXSl7Zm9yKG89XCJiYWNrZ3JvdW5kQ29sb3JcIj09PWk/dC5wYXJlbnROb2RlOnQ7KFwiXCI9PT1yfHxcInRyYW5zcGFyZW50XCI9PT1yKSYmbyYmby5zdHlsZTspdHJ5e3I9ZS5jc3MobyxcImJhY2tncm91bmRDb2xvclwiKSxvPW8ucGFyZW50Tm9kZX1jYXRjaChoKXt9bj1uLmJsZW5kKHImJlwidHJhbnNwYXJlbnRcIiE9PXI/cjpcIl9kZWZhdWx0XCIpfW49bi50b1JnYmFTdHJpbmcoKX10cnl7dC5zdHlsZVtpXT1ufWNhdGNoKGgpe319fSxlLmZ4LnN0ZXBbaV09ZnVuY3Rpb24odCl7dC5jb2xvckluaXR8fCh0LnN0YXJ0PWwodC5lbGVtLGkpLHQuZW5kPWwodC5lbmQpLHQuY29sb3JJbml0PSEwKSxlLmNzc0hvb2tzW2ldLnNldCh0LmVsZW0sdC5zdGFydC50cmFuc2l0aW9uKHQuZW5kLHQucG9zKSl9fSl9LGwuaG9vayhvKSxlLmNzc0hvb2tzLmJvcmRlckNvbG9yPXtleHBhbmQ6ZnVuY3Rpb24oZSl7dmFyIHQ9e307cmV0dXJuIGYoW1wiVG9wXCIsXCJSaWdodFwiLFwiQm90dG9tXCIsXCJMZWZ0XCJdLGZ1bmN0aW9uKGkscyl7dFtcImJvcmRlclwiK3MrXCJDb2xvclwiXT1lfSksdH19LGE9ZS5Db2xvci5uYW1lcz17YXF1YTpcIiMwMGZmZmZcIixibGFjazpcIiMwMDAwMDBcIixibHVlOlwiIzAwMDBmZlwiLGZ1Y2hzaWE6XCIjZmYwMGZmXCIsZ3JheTpcIiM4MDgwODBcIixncmVlbjpcIiMwMDgwMDBcIixsaW1lOlwiIzAwZmYwMFwiLG1hcm9vbjpcIiM4MDAwMDBcIixuYXZ5OlwiIzAwMDA4MFwiLG9saXZlOlwiIzgwODAwMFwiLHB1cnBsZTpcIiM4MDAwODBcIixyZWQ6XCIjZmYwMDAwXCIsc2lsdmVyOlwiI2MwYzBjMFwiLHRlYWw6XCIjMDA4MDgwXCIsd2hpdGU6XCIjZmZmZmZmXCIseWVsbG93OlwiI2ZmZmYwMFwiLHRyYW5zcGFyZW50OltudWxsLG51bGwsbnVsbCwwXSxfZGVmYXVsdDpcIiNmZmZmZmZcIn19KHIpLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXt2YXIgaSxzLG49dC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3P3Qub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHQsbnVsbCk6dC5jdXJyZW50U3R5bGUsYT17fTtpZihuJiZuLmxlbmd0aCYmblswXSYmbltuWzBdXSlmb3Iocz1uLmxlbmd0aDtzLS07KWk9bltzXSxcInN0cmluZ1wiPT10eXBlb2YgbltpXSYmKGFbZS5jYW1lbENhc2UoaSldPW5baV0pO2Vsc2UgZm9yKGkgaW4gbilcInN0cmluZ1wiPT10eXBlb2YgbltpXSYmKGFbaV09bltpXSk7cmV0dXJuIGF9ZnVuY3Rpb24gaSh0LGkpe3ZhciBzLGEsbz17fTtmb3IocyBpbiBpKWE9aVtzXSx0W3NdIT09YSYmKG5bc118fChlLmZ4LnN0ZXBbc118fCFpc05hTihwYXJzZUZsb2F0KGEpKSkmJihvW3NdPWEpKTtyZXR1cm4gb312YXIgcz1bXCJhZGRcIixcInJlbW92ZVwiLFwidG9nZ2xlXCJdLG49e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2UuZWFjaChbXCJib3JkZXJMZWZ0U3R5bGVcIixcImJvcmRlclJpZ2h0U3R5bGVcIixcImJvcmRlckJvdHRvbVN0eWxlXCIsXCJib3JkZXJUb3BTdHlsZVwiXSxmdW5jdGlvbih0LGkpe2UuZnguc3RlcFtpXT1mdW5jdGlvbihlKXsoXCJub25lXCIhPT1lLmVuZCYmIWUuc2V0QXR0cnx8MT09PWUucG9zJiYhZS5zZXRBdHRyKSYmKHIuc3R5bGUoZS5lbGVtLGksZS5lbmQpLGUuc2V0QXR0cj0hMCl9fSksZS5mbi5hZGRCYWNrfHwoZS5mbi5hZGRCYWNrPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmFkZChudWxsPT1lP3RoaXMucHJldk9iamVjdDp0aGlzLnByZXZPYmplY3QuZmlsdGVyKGUpKX0pLGUuZWZmZWN0cy5hbmltYXRlQ2xhc3M9ZnVuY3Rpb24obixhLG8scil7dmFyIGg9ZS5zcGVlZChhLG8scik7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYSxvPWUodGhpcykscj1vLmF0dHIoXCJjbGFzc1wiKXx8XCJcIixsPWguY2hpbGRyZW4/by5maW5kKFwiKlwiKS5hZGRCYWNrKCk6bztsPWwubWFwKGZ1bmN0aW9uKCl7dmFyIGk9ZSh0aGlzKTtyZXR1cm57ZWw6aSxzdGFydDp0KHRoaXMpfX0pLGE9ZnVuY3Rpb24oKXtlLmVhY2gocyxmdW5jdGlvbihlLHQpe25bdF0mJm9bdCtcIkNsYXNzXCJdKG5bdF0pfSl9LGEoKSxsPWwubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZW5kPXQodGhpcy5lbFswXSksdGhpcy5kaWZmPWkodGhpcy5zdGFydCx0aGlzLmVuZCksdGhpc30pLG8uYXR0cihcImNsYXNzXCIsciksbD1sLm1hcChmdW5jdGlvbigpe3ZhciB0PXRoaXMsaT1lLkRlZmVycmVkKCkscz1lLmV4dGVuZCh7fSxoLHtxdWV1ZTohMSxjb21wbGV0ZTpmdW5jdGlvbigpe2kucmVzb2x2ZSh0KX19KTtyZXR1cm4gdGhpcy5lbC5hbmltYXRlKHRoaXMuZGlmZixzKSxpLnByb21pc2UoKX0pLGUud2hlbi5hcHBseShlLGwuZ2V0KCkpLmRvbmUoZnVuY3Rpb24oKXthKCksZS5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbigpe3ZhciB0PXRoaXMuZWw7ZS5lYWNoKHRoaXMuZGlmZixmdW5jdGlvbihlKXt0LmNzcyhlLFwiXCIpfSl9KSxoLmNvbXBsZXRlLmNhbGwob1swXSl9KX0pfSxlLmZuLmV4dGVuZCh7YWRkQ2xhc3M6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkscyxuLGEpe3JldHVybiBzP2UuZWZmZWN0cy5hbmltYXRlQ2xhc3MuY2FsbCh0aGlzLHthZGQ6aX0scyxuLGEpOnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oZS5mbi5hZGRDbGFzcykscmVtb3ZlQ2xhc3M6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkscyxuLGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjE/ZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMse3JlbW92ZTppfSxzLG4sYSk6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fShlLmZuLnJlbW92ZUNsYXNzKSx0b2dnbGVDbGFzczpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSxzLG4sYSxvKXtyZXR1cm5cImJvb2xlYW5cIj09dHlwZW9mIHN8fHZvaWQgMD09PXM/bj9lLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyxzP3thZGQ6aX06e3JlbW92ZTppfSxuLGEsbyk6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMse3RvZ2dsZTppfSxzLG4sYSl9fShlLmZuLnRvZ2dsZUNsYXNzKSxzd2l0Y2hDbGFzczpmdW5jdGlvbih0LGkscyxuLGEpe3JldHVybiBlLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyx7YWRkOmkscmVtb3ZlOnR9LHMsbixhKX19KX0oKSxmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxpLHMsbil7cmV0dXJuIGUuaXNQbGFpbk9iamVjdCh0KSYmKGk9dCx0PXQuZWZmZWN0KSx0PXtlZmZlY3Q6dH0sbnVsbD09aSYmKGk9e30pLGUuaXNGdW5jdGlvbihpKSYmKG49aSxzPW51bGwsaT17fSksKFwibnVtYmVyXCI9PXR5cGVvZiBpfHxlLmZ4LnNwZWVkc1tpXSkmJihuPXMscz1pLGk9e30pLGUuaXNGdW5jdGlvbihzKSYmKG49cyxzPW51bGwpLGkmJmUuZXh0ZW5kKHQsaSkscz1zfHxpLmR1cmF0aW9uLHQuZHVyYXRpb249ZS5meC5vZmY/MDpcIm51bWJlclwiPT10eXBlb2Ygcz9zOnMgaW4gZS5meC5zcGVlZHM/ZS5meC5zcGVlZHNbc106ZS5meC5zcGVlZHMuX2RlZmF1bHQsdC5jb21wbGV0ZT1ufHxpLmNvbXBsZXRlLHR9ZnVuY3Rpb24gaSh0KXtyZXR1cm4hdHx8XCJudW1iZXJcIj09dHlwZW9mIHR8fGUuZnguc3BlZWRzW3RdPyEwOlwic3RyaW5nXCIhPXR5cGVvZiB0fHxlLmVmZmVjdHMuZWZmZWN0W3RdP2UuaXNGdW5jdGlvbih0KT8hMDpcIm9iamVjdFwiIT10eXBlb2YgdHx8dC5lZmZlY3Q/ITE6ITA6ITB9ZS5leHRlbmQoZS5lZmZlY3RzLHt2ZXJzaW9uOlwiMS4xMS40XCIsc2F2ZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgaT0wO3QubGVuZ3RoPmk7aSsrKW51bGwhPT10W2ldJiZlLmRhdGEobyt0W2ldLGVbMF0uc3R5bGVbdFtpXV0pfSxyZXN0b3JlOmZ1bmN0aW9uKGUsdCl7dmFyIGkscztmb3Iocz0wO3QubGVuZ3RoPnM7cysrKW51bGwhPT10W3NdJiYoaT1lLmRhdGEobyt0W3NdKSx2b2lkIDA9PT1pJiYoaT1cIlwiKSxlLmNzcyh0W3NdLGkpKX0sc2V0TW9kZTpmdW5jdGlvbihlLHQpe3JldHVyblwidG9nZ2xlXCI9PT10JiYodD1lLmlzKFwiOmhpZGRlblwiKT9cInNob3dcIjpcImhpZGVcIiksdH0sZ2V0QmFzZWxpbmU6ZnVuY3Rpb24oZSx0KXt2YXIgaSxzO3N3aXRjaChlWzBdKXtjYXNlXCJ0b3BcIjppPTA7YnJlYWs7Y2FzZVwibWlkZGxlXCI6aT0uNTticmVhaztjYXNlXCJib3R0b21cIjppPTE7YnJlYWs7ZGVmYXVsdDppPWVbMF0vdC5oZWlnaHR9c3dpdGNoKGVbMV0pe2Nhc2VcImxlZnRcIjpzPTA7YnJlYWs7Y2FzZVwiY2VudGVyXCI6cz0uNTticmVhaztjYXNlXCJyaWdodFwiOnM9MTticmVhaztkZWZhdWx0OnM9ZVsxXS90LndpZHRofXJldHVybnt4OnMseTppfX0sY3JlYXRlV3JhcHBlcjpmdW5jdGlvbih0KXtpZih0LnBhcmVudCgpLmlzKFwiLnVpLWVmZmVjdHMtd3JhcHBlclwiKSlyZXR1cm4gdC5wYXJlbnQoKTt2YXIgaT17d2lkdGg6dC5vdXRlcldpZHRoKCEwKSxoZWlnaHQ6dC5vdXRlckhlaWdodCghMCksXCJmbG9hdFwiOnQuY3NzKFwiZmxvYXRcIil9LHM9ZShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwidWktZWZmZWN0cy13cmFwcGVyXCIpLmNzcyh7Zm9udFNpemU6XCIxMDAlXCIsYmFja2dyb3VuZDpcInRyYW5zcGFyZW50XCIsYm9yZGVyOlwibm9uZVwiLG1hcmdpbjowLHBhZGRpbmc6MH0pLG49e3dpZHRoOnQud2lkdGgoKSxoZWlnaHQ6dC5oZWlnaHQoKX0sYT1kb2N1bWVudC5hY3RpdmVFbGVtZW50O3RyeXthLmlkfWNhdGNoKG8pe2E9ZG9jdW1lbnQuYm9keX1yZXR1cm4gdC53cmFwKHMpLCh0WzBdPT09YXx8ZS5jb250YWlucyh0WzBdLGEpKSYmZShhKS5mb2N1cygpLHM9dC5wYXJlbnQoKSxcInN0YXRpY1wiPT09dC5jc3MoXCJwb3NpdGlvblwiKT8ocy5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIn0pLHQuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCJ9KSk6KGUuZXh0ZW5kKGkse3Bvc2l0aW9uOnQuY3NzKFwicG9zaXRpb25cIiksekluZGV4OnQuY3NzKFwiei1pbmRleFwiKX0pLGUuZWFjaChbXCJ0b3BcIixcImxlZnRcIixcImJvdHRvbVwiLFwicmlnaHRcIl0sZnVuY3Rpb24oZSxzKXtpW3NdPXQuY3NzKHMpLGlzTmFOKHBhcnNlSW50KGlbc10sMTApKSYmKGlbc109XCJhdXRvXCIpfSksdC5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIix0b3A6MCxsZWZ0OjAscmlnaHQ6XCJhdXRvXCIsYm90dG9tOlwiYXV0b1wifSkpLHQuY3NzKG4pLHMuY3NzKGkpLnNob3coKX0scmVtb3ZlV3JhcHBlcjpmdW5jdGlvbih0KXt2YXIgaT1kb2N1bWVudC5hY3RpdmVFbGVtZW50O3JldHVybiB0LnBhcmVudCgpLmlzKFwiLnVpLWVmZmVjdHMtd3JhcHBlclwiKSYmKHQucGFyZW50KCkucmVwbGFjZVdpdGgodCksKHRbMF09PT1pfHxlLmNvbnRhaW5zKHRbMF0saSkpJiZlKGkpLmZvY3VzKCkpLHR9LHNldFRyYW5zaXRpb246ZnVuY3Rpb24odCxpLHMsbil7cmV0dXJuIG49bnx8e30sZS5lYWNoKGksZnVuY3Rpb24oZSxpKXt2YXIgYT10LmNzc1VuaXQoaSk7YVswXT4wJiYobltpXT1hWzBdKnMrYVsxXSl9KSxufX0pLGUuZm4uZXh0ZW5kKHtlZmZlY3Q6ZnVuY3Rpb24oKXtmdW5jdGlvbiBpKHQpe2Z1bmN0aW9uIGkoKXtlLmlzRnVuY3Rpb24oYSkmJmEuY2FsbChuWzBdKSxlLmlzRnVuY3Rpb24odCkmJnQoKX12YXIgbj1lKHRoaXMpLGE9cy5jb21wbGV0ZSxyPXMubW9kZTsobi5pcyhcIjpoaWRkZW5cIik/XCJoaWRlXCI9PT1yOlwic2hvd1wiPT09cik/KG5bcl0oKSxpKCkpOm8uY2FsbChuWzBdLHMsaSl9dmFyIHM9dC5hcHBseSh0aGlzLGFyZ3VtZW50cyksbj1zLm1vZGUsYT1zLnF1ZXVlLG89ZS5lZmZlY3RzLmVmZmVjdFtzLmVmZmVjdF07cmV0dXJuIGUuZngub2ZmfHwhbz9uP3RoaXNbbl0ocy5kdXJhdGlvbixzLmNvbXBsZXRlKTp0aGlzLmVhY2goZnVuY3Rpb24oKXtzLmNvbXBsZXRlJiZzLmNvbXBsZXRlLmNhbGwodGhpcyl9KTphPT09ITE/dGhpcy5lYWNoKGkpOnRoaXMucXVldWUoYXx8XCJmeFwiLGkpfSxzaG93OmZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbihzKXtpZihpKHMpKXJldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgbj10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbi5tb2RlPVwic2hvd1wiLHRoaXMuZWZmZWN0LmNhbGwodGhpcyxuKX19KGUuZm4uc2hvdyksaGlkZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24ocyl7aWYoaShzKSlyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIG4ubW9kZT1cImhpZGVcIix0aGlzLmVmZmVjdC5jYWxsKHRoaXMsbil9fShlLmZuLmhpZGUpLHRvZ2dsZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24ocyl7aWYoaShzKXx8XCJib29sZWFuXCI9PXR5cGVvZiBzKXJldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgbj10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbi5tb2RlPVwidG9nZ2xlXCIsdGhpcy5lZmZlY3QuY2FsbCh0aGlzLG4pfX0oZS5mbi50b2dnbGUpLGNzc1VuaXQ6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5jc3ModCkscz1bXTtyZXR1cm4gZS5lYWNoKFtcImVtXCIsXCJweFwiLFwiJVwiLFwicHRcIl0sZnVuY3Rpb24oZSx0KXtpLmluZGV4T2YodCk+MCYmKHM9W3BhcnNlRmxvYXQoaSksdF0pfSksc319KX0oKSxmdW5jdGlvbigpe3ZhciB0PXt9O2UuZWFjaChbXCJRdWFkXCIsXCJDdWJpY1wiLFwiUXVhcnRcIixcIlF1aW50XCIsXCJFeHBvXCJdLGZ1bmN0aW9uKGUsaSl7dFtpXT1mdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5wb3codCxlKzIpfX0pLGUuZXh0ZW5kKHQse1NpbmU6ZnVuY3Rpb24oZSl7cmV0dXJuIDEtTWF0aC5jb3MoZSpNYXRoLlBJLzIpfSxDaXJjOmZ1bmN0aW9uKGUpe3JldHVybiAxLU1hdGguc3FydCgxLWUqZSl9LEVsYXN0aWM6ZnVuY3Rpb24oZSl7cmV0dXJuIDA9PT1lfHwxPT09ZT9lOi1NYXRoLnBvdygyLDgqKGUtMSkpKk1hdGguc2luKCg4MCooZS0xKS03LjUpKk1hdGguUEkvMTUpfSxCYWNrOmZ1bmN0aW9uKGUpe3JldHVybiBlKmUqKDMqZS0yKX0sQm91bmNlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxpPTQ7KCh0PU1hdGgucG93KDIsLS1pKSktMSkvMTE+ZTspO3JldHVybiAxL01hdGgucG93KDQsMy1pKS03LjU2MjUqTWF0aC5wb3coKDMqdC0yKS8yMi1lLDIpfX0pLGUuZWFjaCh0LGZ1bmN0aW9uKHQsaSl7ZS5lYXNpbmdbXCJlYXNlSW5cIit0XT1pLGUuZWFzaW5nW1wiZWFzZU91dFwiK3RdPWZ1bmN0aW9uKGUpe3JldHVybiAxLWkoMS1lKX0sZS5lYXNpbmdbXCJlYXNlSW5PdXRcIit0XT1mdW5jdGlvbihlKXtyZXR1cm4uNT5lP2koMiplKS8yOjEtaSgtMiplKzIpLzJ9fSl9KCksZS5lZmZlY3RzfSk7XG4iLCIvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gQ0hBTkdFTElTVFxuLyogZ2xvYmFsIENNUywgdHJlZV9jb21wb25lbnQgKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8vIENNUy4kIHdpbGwgYmUgcGFzc2VkIGZvciAkXG4gICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIC8qIVxuICAgICAgICAgKiBUcmVlTWFuYWdlclxuICAgICAgICAgKiBIYW5kbGVzIHRyZWV2aWV3XG4gICAgICAgICAqIFRPRE8gdGhpcyB3aWxsIGJlIHJlZmFjdG9yZWQgaW4gMy4yXG4gICAgICAgICAqL1xuICAgICAgICBDTVMuVHJlZU1hbmFnZXIgPSBuZXcgQ01TLkNsYXNzKHtcblxuICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICdsYW5nJzoge31cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwRnVuY3Rpb25zKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cFRyZWVQdWJsaXNoaW5nKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cEluZm9Ub29sdGlwKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cFVJSGFja3MoKTtcblxuICAgICAgICAgICAgICAgIC8vIGxvYWQgaW50ZXJuYWwgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2V0dGluZ3MuZmlsdGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cEdsb2JhbHMoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cFRyZWUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpbml0IHRyZWUgY29tcG9uZW50XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5pbml0VHJlZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gZmlsdGVyZWQgaXMgYWN0aXZlLCBwcmV2ZW50IHRyZWUgYWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICAkLnN5bmNDb2xzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2V0dXBGdW5jdGlvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICAkLnN5bmNDb2xzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2l0ZW1hcCAuY29sLXNvZnRyb290Jykuc3luY1dpZHRoKDApO1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2l0ZW1hcCAuY29sLWFwcGhvb2snKS5zeW5jV2lkdGgoMCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtbGFuZ3VhZ2UnKS5zeW5jV2lkdGgoMCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtbmF2aWdhdGlvbicpLnN5bmNXaWR0aCgwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpdGVtYXAgLmNvbC1hY3Rpb25zJykuc3luY1dpZHRoKDApO1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2l0ZW1hcCAuY29sLWluZm8nKS5zeW5jV2lkdGgoMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5yZWZyZXNoQ29sdW1ucy5jYWxsKCQoJ3VsLnRyZWUtZGVmYXVsdCBsaScpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyogQ29sdW1zIHdpZHRoIHN5bmMgKi9cbiAgICAgICAgICAgICAgICAkLmZuLnN5bmNXaWR0aCA9IGZ1bmN0aW9uIChtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gJCh0aGlzKS53aWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPiBtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gdmFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2aXNpYmxlICYmIG1heCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ3dpZHRoJywgbWF4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIGpxdWVyeS5mdW5jdGlvbmFsXG4gICAgICAgICAgICAgICAgJC5jdXJyeSA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9ICQubWFrZUFycmF5KGFyZ3VtZW50cykuc2xpY2UoMSwgYXJndW1lbnRzLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJncy5jb25jYXQoJC5tYWtlQXJyYXkoYXJndW1lbnRzKSkpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAkLl9fY2FsbGJhY2tQb29sID0ge307XG5cbiAgICAgICAgICAgICAgICAkLmNhbGxiYWNrUmVnaXN0ZXIgPSBmdW5jdGlvbiAobmFtZSwgZm4gLyosIGFyZzAsIGFyZzEsIC4uKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgY3VycmllZCBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgZm4gPSAkLmN1cnJ5LmFwcGx5KHRoaXMsICQubWFrZUFycmF5KGFyZ3VtZW50cykuc2xpY2UoMSwgYXJndW1lbnRzLmxlbmd0aCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICQuX19jYWxsYmFja1Bvb2xbbmFtZV0gPSBmbjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICQuY2FsbGJhY2tDYWxsID0gZnVuY3Rpb24gKG5hbWUvKiwgZXh0cmEgYXJnMCwgZXh0cmEgYXJnMSwgLi4qLykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUgfHwgIShuYW1lIGluICQuX19jYWxsYmFja1Bvb2wpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAnTm8gY2FsbGJhY2sgcmVnaXN0ZXJlZCB3aXRoIG5hbWU6ICcgKyBuYW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICQuX19jYWxsYmFja1Bvb2xbbmFtZV0uYXBwbHkodGhpcywgJC5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxLCBhcmd1bWVudHMubGVuZ3RoKSk7XG4gICAgICAgICAgICAgICAgICAgICQuY2FsbGJhY2tSZW1vdmUobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAkLmNhbGxiYWNrUmVtb3ZlID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICQuX19jYWxsYmFja1Bvb2xbbmFtZV07XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIHZlcnkgc2ltcGxlIHllbGxvdyBmYWRlIHBsdWdpbi4uXG4gICAgICAgICAgICAgICAgJC5mbi55ZnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWZmZWN0KCdoaWdobGlnaHQnLCB7fSwgMTAwMCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIGpxdWVyeSByZXBsYWNlIHBsdWdpbiA6KVxuICAgICAgICAgICAgICAgICQuZm4ucmVwbGFjZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFmdGVyKG8pLnJlbW92ZSgpLmVuZCgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldHVwSW5mb1Rvb2x0aXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdHJlZSA9ICQoJy50cmVlJyk7XG4gICAgICAgICAgICAgICAgdmFyIGluZm9UcmlnZ2VyID0gJy5jb2wtaW5mbyAuaW5mbyc7XG4gICAgICAgICAgICAgICAgdmFyIGluZm9Ub29sdGlwcyA9ICcuaW5mby1kZXRhaWxzJztcbiAgICAgICAgICAgICAgICB2YXIgaW5mb1RpbWVyID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgdmFyIGluZm9EZWxheSA9IDEwMDtcbiAgICAgICAgICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciB0aGUgaW5mbyB0b29sdGlwIG9uIHRvdWNoIGRldmljZXNcbiAgICAgICAgICAgICAgICB2YXIgdG91Y2hVc2VkSW5mb1Rvb2x0aXA7XG5cbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGluZm9UcmlnZ2VyLCAncG9pbnRlcm92ZXIgdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b29sdGlwID0gJCh0aGlzKS5jbG9zZXN0KCcuY29sLWluZm8nKS5maW5kKCcuaW5mby1kZXRhaWxzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGluZm9UaW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHRvb2x0aXAgYWxyZWFkeSB2aXNpYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b29sdGlwLmlzKCc6dmlzaWJsZScpICYmICF0b3VjaFVzZWRJbmZvVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJChpbmZvVG9vbHRpcHMpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJChpbmZvVHJpZ2dlcikucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoaW5mb1RyaWdnZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hVc2VkSW5mb1Rvb2x0aXAgPSB0b3VjaFVzZWRJbmZvVG9vbHRpcCAmJiB0b3VjaFVzZWRJbmZvVG9vbHRpcC5pcyh0YXJnZXQpID8gZmFsc2UgOiB0YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG91Y2hVc2VkSW5mb1Rvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpbmZvVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXAuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChpbmZvVHJpZ2dlcikuYWRkQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwLmNsb3Nlc3QoJy5tb3ZlYWJsZScpLmFkZENsYXNzKCdob3ZlcicpO1xuICAgICAgICAgICAgICAgICAgICB9LCBpbmZvRGVsYXkpO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gaGlkZSB0aGUgdG9vbHRpcCB3aGVuIGxlYXZpbmcgdGhlIGFyZWFcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGluZm9UcmlnZ2VyLCAncG9pbnRlcm91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdWNoVXNlZEluZm9Ub29sdGlwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciB0aW1lclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoaW5mb1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgaW5mb1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGluZm9Ub29sdGlwcykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vdmVhYmxlJykucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGluZm9EZWxheSAqIDIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IGhpZGluZyB3aGVuIGVudGVyaW5nIHRoZSB0b29sdGlwIGl0c2VsZlxuICAgICAgICAgICAgICAgIHRyZWUuZGVsZWdhdGUoaW5mb1Rvb2x0aXBzLCAncG9pbnRlcm92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHRpbWVyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChpbmZvVGltZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRyZWUuZGVsZWdhdGUoaW5mb1Rvb2x0aXBzLCAncG9pbnRlcm91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgaW5mb1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGluZm9Ub29sdGlwcykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vdmVhYmxlJykucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGluZm9EZWxheSAqIDIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5vbigndG91Y2hlbmQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISQoZS50YXJnZXQpLmhhc0NsYXNzKCdpbmZvJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaW5mb1Rvb2x0aXBzKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGluZm9UcmlnZ2VyKS5yZW1vdmVDbGFzcygnaG92ZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzZXR1cFRyZWVQdWJsaXNoaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gQUREIERJUkVDVCBQVUJMSVNISU5HXG4gICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciB0cmVlID0gJCgnLnRyZWUnKTtcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1RyaWdnZXIgPSAnLmNvbC1sYW5ndWFnZSAudHJpZ2dlci10b29sdGlwJztcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1Rvb2x0aXBzID0gJy5sYW5ndWFnZS10b29sdGlwJztcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1RpbWVyID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgdmFyIGxhbmdEZWxheSA9IDEwMDtcbiAgICAgICAgICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciB0aGUgcHVibGlzaGluZyB0b29sdGlwIG9uIHRvdWNoIGRldmljZXNcbiAgICAgICAgICAgICAgICB2YXIgdG91Y2hVc2VkTm9kZTtcblxuICAgICAgICAgICAgICAgIC8vIHNob3cgdGhlIHRvb2x0aXBcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGxhbmdUcmlnZ2VyLCAncG9pbnRlcm92ZXIgdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcykuY2xvc2VzdCgnLmNvbC1sYW5ndWFnZScpLmZpbmQoJy5sYW5ndWFnZS10b29sdGlwJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxhbmdUaW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHRvb2x0aXAgYWxyZWFkeSB2aXNpYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5pcygnOnZpc2libGUnKSAmJiAhdG91Y2hVc2VkTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvcnJlY3QgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgZWwuY3NzKCdyaWdodCcsIDMyICsgJCh0aGlzKS5wb3NpdGlvbigpLmxlZnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgYWxsIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgICQobGFuZ1Rvb2x0aXBzKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QobGFuZ1RyaWdnZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hVc2VkTm9kZSA9IHRvdWNoVXNlZE5vZGUgJiYgdG91Y2hVc2VkTm9kZS5pcyh0YXJnZXQpID8gZmFsc2UgOiB0YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG91Y2hVc2VkTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZSBhIHRpbWVvdXQgdG8gZGlzcGxheSB0aGUgdG9vbHRpcFxuICAgICAgICAgICAgICAgICAgICBsYW5nVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmNsb3Nlc3QoJy5tb3ZlYWJsZScpLmFkZENsYXNzKCdob3ZlcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9LCBsYW5nRGVsYXkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIGhpZGUgdGhlIHRvb2x0aXAgd2hlbiBsZWF2aW5nIHRoZSBhcmVhXG4gICAgICAgICAgICAgICAgdHJlZS5kZWxlZ2F0ZShsYW5nVHJpZ2dlciwgJ3BvaW50ZXJvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaFVzZWROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciB0aW1lclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobGFuZ1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgbGFuZ1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGxhbmdUb29sdGlwcykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vdmVhYmxlJykucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGxhbmdEZWxheSAqIDIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IGhpZGluZyB3aGVuIGVudGVyaW5nIHRoZSB0b29sdGlwIGl0c2VsZlxuICAgICAgICAgICAgICAgIHRyZWUuZGVsZWdhdGUobGFuZ1Rvb2x0aXBzLCAncG9pbnRlcm92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHRpbWVyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChsYW5nVGltZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRyZWUuZGVsZWdhdGUobGFuZ1Rvb2x0aXBzLCAncG9pbnRlcm91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgbGFuZ1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGxhbmdUb29sdGlwcykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vdmVhYmxlJykucmVtb3ZlQ2xhc3MoJ2hvdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGxhbmdEZWxheSAqIDIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIGF0dGFjaCBkb3VibGUgY2hlY2sgZXZlbnQgaWYgcHVibGlzaCBvciB1bnB1Ymxpc2ggc2hvdWxkIGJlIHRyaWdnZXJlZFxuICAgICAgICAgICAgICAgIHRyZWUuZGVsZWdhdGUoJy5sYW5ndWFnZS10b29sdGlwIGEnLCAnY2xpY2sgdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgaWYgbm90IGNvbmZpcm1lZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIUNNUy5BUEkuSGVscGVycy5zZWN1cmVDb25maXJtKHRoYXQub3B0aW9ucy5sYW5nLnB1Ymxpc2hcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCfCpycsICQodGhpcykudGV4dCgpLnRvTG93ZXJDYXNlKCkpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCBwb3N0IHJlcXVlc3QgdG8gcHJldmVudCB4c3MgYXR0YWNrc1xuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAkKHRoaXMpLnByb3AoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLkhlbHBlcnMucmVsb2FkQnJvd3NlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLm9uKCd0b3VjaGVuZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJChlLnRhcmdldCkuaGFzQ2xhc3MoJ3VucHVibGlzaGVkJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICEkKGUudGFyZ2V0KS5oYXNDbGFzcygncHVibGlzaGVkJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICEkKGUudGFyZ2V0KS5oYXNDbGFzcygnZGlydHknKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChsYW5nVG9vbHRpcHMpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzZXR1cFVJSGFja3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBhZGRzIGZ1bmN0aW9uYWxpdHkgdG8gdGhlIGZpbHRlclxuICAgICAgICAgICAgICAgICQoJyNjaGFuZ2VsaXN0LWZpbHRlci1idXR0b24nKS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI2NoYW5nZWxpc3QtZmlsdGVyJykudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgY29ycmVjdCBhY3RpdmUgZW50cnlcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LnBhcmVudCAmJiB3aW5kb3cucGFyZW50LkNNUyAmJiB3aW5kb3cucGFyZW50LkNNUy5jb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VfaWQgPSB3aW5kb3cucGFyZW50LkNNUy5jb25maWcucmVxdWVzdC5wYWdlX2lkO1xuXG4gICAgICAgICAgICAgICAgICAgICQoJ2RpdltkYXRhLXBhZ2VfaWQ9XCInICsgcGFnZV9pZCArICdcIl0nKS5hZGRDbGFzcygnY29udC1hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzZXR1cEdsb2JhbHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9ICcnO1xuICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgd2luZG93Lm1vdmVTdWNjZXNzID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5zeW5jQ29scygpO1xuXG4gICAgICAgICAgICAgICAgICAgIG1zZyA9ICQoJzxzcGFuIGNsYXNzPVwic3VjY2Vzc1wiPicgKyB0aGF0Lm9wdGlvbnMubGFuZy5zdWNjZXNzICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gd2luZG93LnBhcmVudDtcblxuICAgICAgICAgICAgICAgICAgICBub2RlLmFmdGVyKG1zZyk7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUucGFyZW50KCkuZmluZCgnLmNvbDInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIG1zZy5mYWRlT3V0KDEwMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucGFyZW50KCkuZmluZCgnLmNvbDInKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgcmVsb2FkIGNoYW5nZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5zZWxmICE9PSB3aW5kb3cudG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LkNNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LkNNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogdGhhdC5vcHRpb25zLmxhbmcuY2hhbmdlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgd2luZG93Lm1vdmVFcnJvciA9IGZ1bmN0aW9uIChub2RlLCBtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlICYmIG1lc3NhZ2UgIT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZyA9ICQoJzxzcGFuIGNsYXNzPVwic3VjY2Vzc1wiPicgKyBtZXNzYWdlICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZyA9ICQoJzxzcGFuIGNsYXNzPVwic3VjY2Vzc1wiPicgKyB0aGF0Lm9wdGlvbnMubGFuZy5lcnJvciArICc8L3NwYW4+Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQoKS5maW5kKCcuY29sMicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5hZnRlcihtc2cpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldHVwVHJlZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgdHJlZTtcbiAgICAgICAgICAgICAgICB2YXIgb3JpZ2luID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArXG4gICAgICAgICAgICAgICAgICAgICh3aW5kb3cubG9jYXRpb24ucG9ydCA/ICc6JyArIHdpbmRvdy5sb2NhdGlvbi5wb3J0IDogJycpO1xuICAgICAgICAgICAgICAgIC8vIGdsb2JhbCBpbml0VHJlZSBmdW5jdGlvblxuICAgICAgICAgICAgICAgIHdpbmRvdy5pbml0VHJlZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8ganNoaW50IG5ld2NhcDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgLy8ganNjczpkaXNhYmxlIHJlcXVpcmVDYXBpdGFsaXplZENvbnN0cnVjdG9yc1xuICAgICAgICAgICAgICAgICAgICB0cmVlID0gbmV3IHRyZWVfY29tcG9uZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGpzY3M6ZW5hYmxlIHJlcXVpcmVDYXBpdGFsaXplZENvbnN0cnVjdG9yc1xuICAgICAgICAgICAgICAgICAgICAvLyBqc2hpbnQgbmV3Y2FwOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja2FibGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmFtZWFibGU6ICdub25lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGFibGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0YWJsZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFncnVsZXM6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BwYWJsZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEgOiAnbWRhdGEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZV9pbmxpbmU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2Ryb3BwYWJsZSA6IFsndHJlZV9kcm9wJ11cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoYXMgdG8gYmUgYWJzb2x1dGUgZnVsbCBwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBvcmlnaW4gKyB0aGF0Lm9wdGlvbnMuc2V0dGluZ3Muc3RhdGljUGF0aCArICdjbXMvanMvanN0cmVlLycsXG4gICAgICAgICAgICAgICAgICAgICAgICB1aToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvdHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnRsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfbW9kZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoZW1lX3BhdGg6IHNjcmlwdF91cmxfcGF0aCgpICsgJy8uLi9qc3RyZWUvdGhlbWVzLycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYV9jbGFzczogJ3RpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXMgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4OiAnZGphbmdvY21zX25vZGVzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlbW92ZSAgOiBmdW5jdGlvbiAod2hhdCwgd2hlcmUsIHBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5pdGVtX2lkID0gd2hhdC5pZC5zcGxpdCgncGFnZV8nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhcmdldF9pZCA9IHdoZXJlLmlkLnNwbGl0KCdwYWdlXycpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX25vZGUgPSB3aGF0O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHdoYXQpLnBhcmVudCgpLmNoaWxkcmVuKCdsaScpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHdoYXQpLm5leHQoJ2xpJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF90YXJnZXQgPSAkKHdoYXQpLm5leHQoJ2xpJylbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF9wb3NpdGlvbiA9ICdyaWdodCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh3aGF0KS5wcmV2KCdsaScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRfdGFyZ2V0ID0gJCh3aGF0KS5wcmV2KCdsaScpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRfcG9zaXRpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh3aGF0KS5hdHRyKCdyZWwnKSAhPT0gJ3RvcG5vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF90YXJnZXQgPSAkKHdoYXQpLnBhcmVudCgpLnBhcmVudCgpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRfcG9zaXRpb24gPSAnaW5zaWRlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFVuZG8od2hhdCwgd2hlcmUsIHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbm1vdmU6IGZ1bmN0aW9uICh3aGF0LCB3aGVyZSwgcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lml0ZW1faWQgPSB3aGF0LmlkLnNwbGl0KCdwYWdlXycpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0X2lkID0gd2hlcmUuaWQuc3BsaXQoJ3BhZ2VfJylbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uID09PSAnYmVmb3JlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09ICdhZnRlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ2luc2lkZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gJ2xhc3QtY2hpbGQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVUcmVlSXRlbSh3aGF0LCB3aW5kb3cuaXRlbV9pZCwgd2luZG93LnRhcmdldF9pZCwgcG9zaXRpb24sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25sb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVDYWxjKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDI1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkKCQoJ2Rpdi50cmVlJykuZ2V0KDApKS5oYXNDbGFzcygncm9vdF9hbGxvd19jaGlsZHJlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkaXNhbG93IHBvc3NpYmlsaXR5IGZvciBhZGRpbmcgc3Vibm9kZXMgdG8gbWFpbiB0cmVlLCB1c2VyIGRvZXNuJ3RcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhdmUgcGVybWlzc2lvbnMgZm9yIHRoaXNcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucnVsZXMuZHJhZ3J1bGVzID0gWydub2RlIGluc2lkZSB0b3Bub2RlJywgJ3RvcG5vZGUgaW5zaWRlIHRvcG5vZGUnLCAnbm9kZSAqIG5vZGUnXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRyZWUuaW5pdCgkKCdkaXYudHJlZScpLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNlbGVjdGVkX3BhZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBhY3Rpb24gPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHZhciBfb2xkQWpheCA9ICQuYWpheDtcblxuICAgICAgICAgICAgICAgICQuYWpheCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGp1c3Qgb3ZlcnJpZGUgYWpheCBmdW5jdGlvbiwgc28gdGhlIGxvYWRlciBtZXNzYWdlIGdldHMgZGlzcGxheWVkXG4gICAgICAgICAgICAgICAgICAgIC8vIGFsd2F5c1xuICAgICAgICAgICAgICAgICAgICAkKCcjbG9hZGVyLW1lc3NhZ2UnKS5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gcy5zdWNjZXNzIHx8IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzLnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvYWRlci1tZXNzYWdlJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGp1c3QgZm9yIGRlYnVnaW5nISFcbiAgICAgICAgICAgICAgICAgICAgLypzLmNvbXBsZXRlID0gZnVuY3Rpb24gKHhociwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09ICdlcnJvcicgJiYgdGhhdC5vcHRpb25zLnNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmJlZm9yZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSovXG4gICAgICAgICAgICAgICAgICAgIC8vIGVuZCBqdXN0IGZvciBkZWJ1Z2luZ1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGFkZCBlcnJvciBzdGF0ZSFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9vbGRBamF4KHMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLyAvLyBkZWZpbmVkIGJ1dCBuZXZlciB1c2VkXG4gICAgICAgICAgICAgICAgLy8gZnVuY3Rpb24gcmVmcmVzaCgpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAgICAgLy8gLy8gZGVmaW5lZCBidXQgbmV2ZXIgdXNlZFxuICAgICAgICAgICAgICAgIC8vIGZ1bmN0aW9uIHJlZnJlc2hJZkNoaWxkcmVuKHBhZ2VJZCkge1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJCgnI3BhZ2VfJyArIHBhZ2VJZCkuZmluZCgnbGlbaWRePXBhZ2VfXScpLmxlbmd0aCA/XG4gICAgICAgICAgICAgICAgLy8gICAgIHJlZnJlc2ggOlxuICAgICAgICAgICAgICAgIC8vICAgICBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9O1xuICAgICAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIExvYWRzIHJlbW90ZSBkaWFsb2cgdG8gZGlhbG9ncyBkaXYuXG4gICAgICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgRGF0YSB0byBiZSBzZW5kIG92ZXIgcG9zdFxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG5vRGlhbG9nQ2FsbGJhY2sgR2V0cyBjYWxsZWQgd2hlbiByZXNwb25zZSBpcyBlbXB0eS5cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBTdGFuZGFyZCBjYWxsYmFjayBmdW5jdGlvbi5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsb2FkRGlhbG9nKHVybCwgZGF0YSwgbm9EaWFsb2dDYWxsYmFjaywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICQucG9zdCh1cmwsIGRhdGEsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlID09PSAnJyAmJiBub0RpYWxvZ0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9EaWFsb2dDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2RpYWxvZ3MnKS5lbXB0eSgpLmFwcGVuZChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtfY29weV9ub2RlKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2EubW92ZS10YXJnZXQsIHNwYW4ubW92ZS10YXJnZXQtY29udGFpbmVyLCBzcGFuLmxpbmUnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNwYWdlXycgKyBpZCkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNwYWdlXycgKyBpZCkucGFyZW50KCkucGFyZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbignZGl2LmNvbnQnKS5maW5kKCdhLm1vdmUtdGFyZ2V0LmZpcnN0LWNoaWxkLCBzcGFuLnNlY29uZCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIGlkKS5wYXJlbnQoKS5wYXJlbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKCd1bCcpLmNoaWxkcmVuKCdsaScpLmNoaWxkcmVuKCdkaXYuY29udCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnYS5tb3ZlLXRhcmdldC5sZWZ0LCBhLm1vdmUtdGFyZ2V0LnJpZ2h0LCBzcGFuLmZpcnN0LCBzcGFuLnNlY29uZCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdjb3B5JztcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgIC8vIGxldCdzIHN0YXJ0IGV2ZW50IGRlbGVnYXRpb25cbiAgICAgICAgICAgICAgICAkKCcjY2hhbmdlbGlzdCBsaScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEkgd2FudCBhIGxpbmsgdG8gY2hlY2sgdGhlIGNsYXNzXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC50YWdOYW1lID09PSAnSU1HJyB8fCBlLnRhcmdldC50YWdOYW1lID09PSAnU1BBTicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy50YXJnZXQgPSBlLnRhcmdldC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBqdGFyZ2V0ID0gJCh3aW5kb3cudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZV9pZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ21vdmUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlcGFyZSB0cmVlIGZvciBtb3ZlIC8gY3V0IHBhc3RlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IGUudGFyZ2V0LmlkLnNwbGl0KCdtb3ZlLWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBlLnRhcmdldC5wYXJlbnROb2RlLmlkLnNwbGl0KCdtb3ZlLWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlX2lkID0gaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IHBhZ2VfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAnbW92ZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdzcGFuLm1vdmUtdGFyZ2V0LWNvbnRhaW5lciwgc3Bhbi5saW5lLCBhLm1vdmUtdGFyZ2V0Jykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIHBhZ2VfaWQpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIHBhZ2VfaWQgKyAnIHNwYW4ubW92ZS10YXJnZXQtY29udGFpbmVyJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdjb3B5JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXBhcmUgdHJlZSBmb3IgY29weVxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBlLnRhcmdldC5pZC5zcGxpdCgnY29weS1saW5rLScpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gZS50YXJnZXQucGFyZW50Tm9kZS5pZC5zcGxpdCgnY29weS1saW5rLScpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNlbGVjdGVkX3BhZ2UgPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IG1hcmtfY29weV9ub2RlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygndmlld3BhZ2UnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZpZXdfcGFnZV91cmwgPSAkKCcjJyArIHdpbmRvdy50YXJnZXQuaWQgKyAnLXNlbGVjdCcpLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXdfcGFnZV91cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih2aWV3X3BhZ2VfdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdhZGRsaW5rJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghLyMkL2cudGVzdChqdGFyZ2V0LmF0dHIoJ2hyZWYnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyB1cmwgaW5zdGVhZCBvZiAjIGluc2lkZSBocmVmLCBmb2xsb3cgdGhpcyB1cmxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2VkIGlmIHVzZXIgaGF2ZXMgYWRkX3BhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgJCgndHInKS5yZW1vdmVDbGFzcygndGFyZ2V0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjY2hhbmdlbGlzdCB0YWJsZScpLnJlbW92ZUNsYXNzKCd0YWJsZS1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9pZCA9IHdpbmRvdy50YXJnZXQuaWQuc3BsaXQoJ2FkZC1saW5rLScpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNlbGVjdGVkX3BhZ2UgPSBwYWdlX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCd0cicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2Utcm93LScgKyBwYWdlX2lkKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdhLm1vdmUtdGFyZ2V0LCBzcGFuLmxpbmUsICNtb3ZlLXRhcmdldC0nICsgcGFnZV9pZCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvbid0IGFzc3VtZSBhZG1pbiBzaXRlIGlzIHJvb3QtbGV2ZWxcbiAgICAgICAgICAgICAgICAgICAgLy8gZ3JhYiBiYXNlIHVybCB0byBjb25zdHJ1Y3QgZnVsbCBhYnNvbHV0ZSBVUkxzXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZG1pbl9iYXNlX3VybCA9IGRvY3VtZW50LlVSTC5zcGxpdCgnL2Ntcy9wYWdlLycpWzBdICsgJy8nO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlSWQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYW5ndWFnZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaW4gbmF2aWdhdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnbmF2aWdhdGlvbi1jaGVja2JveCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlSWQgPSBqdGFyZ2V0LmF0dHIoJ25hbWUnKS5zcGxpdCgnbmF2aWdhdGlvbi0nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlID0ganRhcmdldC5jbG9zZXN0KCcuY29udCcpLmZpbmQoJ2FbbGFuZ10nKS5hdHRyKCdsYW5nJykgfHwgJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIEkgZG9uJ3QgcHV0IGRhdGEgaW4gdGhlIHBvc3QsIGRqYW5nbyBkb2Vzbid0IGdldCBpdFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVsb2FkSXRlbShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZG1pbl9iYXNlX3VybCArICdjbXMvcGFnZS8nICsgcGFnZUlkICsgJy9jaGFuZ2UtbmF2aWdhdGlvbi8/bGFuZ3VhZ2U9JyArIGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgMTogMSB9XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbGF6eSBsb2FkIGRlc2NlbmRhbnRzIG9uIHRyZWUgb3BlblxuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnY2xvc2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgbG9hZCB0aGVtIG9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0LmZpbmQoJ3VsID4gbGknKS5sZW5ndGggPT09IDAgJiYgIWp0YXJnZXQuaGFzQ2xhc3MoJ2xvYWRpbmcnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGtlZXBzIHRoaXMgZXZlbnQgZnJvbSBmaXJpbmcgbXVsdGlwbGUgdGltZXMgYmVmb3JlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGRvbSBhcyBjaGFuZ2VkLiBpdCBzdGlsbCBuZWVkcyB0byBwcm9wYWdhdGUgZm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG90aGVyIGNsaWNrIGV2ZW50IG9uIHRoaXMgZWxlbWVudCB0byBmaXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAganRhcmdldC5hZGRDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZCA9ICQoanRhcmdldCkuYXR0cignaWQnKS5zcGxpdCgncGFnZV8nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZSA9ICQoanRhcmdldClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKCdkaXYuY29udCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbignZGl2LmNvbDEnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oJy50aXRsZScpLmF0dHIoJ2xhbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmdldChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkbWluX2Jhc2VfdXJsICsgJ2Ntcy9wYWdlLycgKyBwYWdlSWQgKyAnLycgKyBsYW5ndWFnZSArICcvZGVzY2VuZGFudHMvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LmNoaWxkcmVuKCd1bCcpLmFwcGVuZChyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3cgbW92ZSB0YXJnZXRzIGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJ3NwYW4ubW92ZS10YXJnZXQtY29udGFpbmVyOnZpc2libGUnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganRhcmdldC5jaGlsZHJlbigndWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnYS5tb3ZlLXRhcmdldCwgc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXIsIHNwYW4ubGluZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZUNhbGMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlQ2FsYygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ21vdmUtdGFyZ2V0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdsZWZ0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucG9zaXRpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygncmlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wb3NpdGlvbiA9ICdyaWdodCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnbGFzdC1jaGlsZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnBvc2l0aW9uID0gJ2xhc3QtY2hpbGQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhcmdldF9pZCA9IHdpbmRvdy50YXJnZXQucGFyZW50Tm9kZS5pZC5zcGxpdCgnbW92ZS10YXJnZXQtJylbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdtb3ZlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVUcmVlSXRlbShudWxsLCB3aW5kb3cuc2VsZWN0ZWRfcGFnZSwgd2luZG93LnRhcmdldF9pZCwgd2luZG93LnBvc2l0aW9uLCB0cmVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubW92ZS10YXJnZXQtY29udGFpbmVyJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdjb3B5Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zaXRlID0gJCgnI3NpdGUtc2VsZWN0JylbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29weVRyZWVJdGVtKHdpbmRvdy5zZWxlY3RlZF9wYWdlLCB3aW5kb3cudGFyZ2V0X2lkLCB3aW5kb3cucG9zaXRpb24sIHdpbmRvdy5zaXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubW92ZS10YXJnZXQtY29udGFpbmVyJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdhZGQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNpdGUgPSAkKCcjc2l0ZS1zZWxlY3QnKVswXS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMF0uc3BsaXQoJyMnKVswXSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGQvP3RhcmdldD0nICsgd2luZG93LnRhcmdldF9pZCArICcmYW1wO3Bvc2l0aW9uPScgKyB3aW5kb3cucG9zaXRpb24gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJmFtcDtzaXRlPScgKyB3aW5kb3cuc2l0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJCgnZGl2I3NpdGVtYXAnKS5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZUNhbGMoKSB7XG4gICAgICAgICAgICAgICAgICAgICQuc3luY0NvbHMoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKHdpbmRvdykuYmluZCgncmVzaXplJywgcmVDYWxjKTtcbiAgICAgICAgICAgICAgICAvKiBTaXRlIFNlbGVjdG9yICovXG4gICAgICAgICAgICAgICAgJCgnI3NpdGUtc2VsZWN0JykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm0gPSAkKHRoaXMpLmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGNvcnJlY3QgdmFsdWUgZm9yIGNvcHlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2NvcHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2l0ZS1jb3B5JykudmFsKHdpbmRvdy5zZWxlY3RlZF9wYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBzdWJtaXQgZm9ybVxuICAgICAgICAgICAgICAgICAgICBmb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBJZiBhbiBBIGVsZW1lbnQgaGFzIGEgZGF0YS1hdHRyaWJ1dGUgJ2FsdC1jbGFzcycuIEF0IHRoaXMgdGltZSxcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG9ubHkgdGhlIGVkaXQgYnV0dG9uIGluIHRoZSBwYWdlLXRyZWUsIGJ1dCBjb3VsZCBiZVxuICAgICAgICAgICAgICAgIC8vIG1vcmUgaW4gZnV0dXJlLiBJdCBpcyBpbXBvcnRhbnQgdGhhdCB0aGUgQ1NTIGJlIHdyaXR0ZW4gaW4gc3VjaFxuICAgICAgICAgICAgICAgIC8vIGEgbWFubmVyIHRoYXQgdGhlIGFsdC1jbGFzcyBpcyBkZWZpbmVkIGFmdGVyIHRoZSBub3JtYWwgY2xhc3MsXG4gICAgICAgICAgICAgICAgLy8gc28gdGhhdCBpdCBjYW4gYmUgb3ZlcnJpZGRlbiB3aGVuIHRoZSBhbHQta2V5IGlzIGRlcHJlc3NlZC5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIE5PVEU6IFRoaXMgJ3ByZXZpZXcnIHBhcnQgb2YgdGhlICdhbHQtY2xpY2sgdG8gW2FsdGVybmF0aXZlXG4gICAgICAgICAgICAgICAgLy8gZnVuY3Rpb25dJyBmZWF0dXJlIG1heSBub3Qgd29yayBpbiBzb21lIGVudmlyb25tZW50cyAoV2luZG93c1xuICAgICAgICAgICAgICAgIC8vIGluIGEgc29tZSB2aXJ0dWFsIG1hY2hpbmUgZW52aXJvbm1lbnRzLCBub3RhYmx5KSwgYnV0IGlzIG9ubHkgYVxuICAgICAgICAgICAgICAgIC8vIG5pY2UtJ2V4dHJhJywgbm90IGEgcmVxdWlyZW1lbnQgZm9yIHRoZSBmZWF0dXJlLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2tleWRvd24ga2V5dXAnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldnQud2hpY2ggPT09IDE4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdhW2RhdGEtYWx0LWNsYXNzXScpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWxmID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRvZ2dsZUNsYXNzKHNlbGYuZGF0YSgnYWx0LWNsYXNzJyksIGV2dC50eXBlID09PSAna2V5ZG93bicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIEEtZWxlbWVudCBoYXMgYSBkYXRhLWF0dHJpYnV0ZSAnYWx0LWhyZWYnLCB0aGVuIHRoaXNcbiAgICAgICAgICAgICAgICAvLyBjbGljay1oYW5kbGVyIHVzZXMgdGhhdCBpbnN0ZWFkIG9mIHRoZSBub3JtYWwgaHJlZiBhdHRyaWJ1dGUgYXNcbiAgICAgICAgICAgICAgICAvLyB0aGUgY2xpY2stZGVzdGluYXRpb24uIEFnYWluLCBjdXJyZW50bHkgdGhpcyBpcyBvbmx5IG9uIHRoZVxuICAgICAgICAgICAgICAgIC8vIGVkaXQgYnV0dG9uLCBidXQgY291bGQgYmUgbW9yZSBpbiBmdXR1cmUuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAkKCdhW2RhdGEtYWx0LWhyZWZdJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHJlZjtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhyZWYgPSAkKHRoaXMpLmRhdGEoJ2FsdC1ocmVmJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBocmVmID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gaHJlZjtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBjb3B5X3NwbGl0cyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCdjb3B5PScpO1xuICAgICAgICAgICAgICAgIGlmIChjb3B5X3NwbGl0cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IGNvcHlfc3BsaXRzWzFdLnNwbGl0KCcmJylbMF07XG4gICAgICAgICAgICAgICAgICAgIC8vIGpzaGludCBsYXRlZGVmOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gbWFya19jb3B5X25vZGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBqc2hpbnQgbGF0ZWRlZjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IGlkO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNvcHlUcmVlSXRlbShpdGVtX2lkLCB0YXJnZXRfaWQsIHBvc2l0aW9uLCBzaXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMuc2V0dGluZ3MucGVybWlzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYWREaWFsb2coJy4vJyArIGl0ZW1faWQgKyAnL2RpYWxvZy9jb3B5LycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXRfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l0ZTogc2l0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogJC5jYWxsYmFja1JlZ2lzdGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnX2NvcHlUcmVlSXRlbScsIF9jb3B5VHJlZUl0ZW0sIGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHNpdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvcHlUcmVlSXRlbShpdGVtX2lkLCB0YXJnZXRfaWQsIHBvc2l0aW9uLCBzaXRlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBfY29weVRyZWVJdGVtKGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHNpdGUsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldF9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpdGU6IHNpdGVcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICQuZXh0ZW5kKGRhdGEsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgICAgICQucG9zdCgnLi8nICsgaXRlbV9pZCArICcvY29weS1wYWdlLycsIGRhdGEsIGZ1bmN0aW9uIChkZWNvZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBkZWNvZGVkLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gZGVjb2RlZC5zdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZWxvYWQgdHJlZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1vdmVFcnJvcigkKCcjcGFnZV8nICsgaXRlbV9pZCArICcgZGl2LmNvbDE6ZXEoMCknKSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBSZWxvYWRzIHRyZWUgaXRlbSAob25lIGxpbmUpLiBJZiBzb21lIGZpbHRlcmluZyBpcyBmb3VuZCwgYWRkc1xuICAgICAgICAgICAgICAgICAqIGZpbHRlcmVkIHZhcmlhYmxlIGludG8gcG9zdGVkIGRhdGEuXG4gICAgICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbCBBbnkgY2hpbGQgZWxlbWVudCBvZiB0cmVlIGl0ZW1cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIFJlcXVlc3RlZCB1cmxcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBPcHRpb25hbCBwb3N0ZWQgZGF0YVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIE9wdGlvbmFsIGNhbGJhY2sgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZWxvYWRJdGVtKGVsLCB1cmwsIGRhdGEsIGNhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICgvXFwvXFw/L2lnLnRlc3Qod2luZG93LmxvY2F0aW9uLmhyZWYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwcm9iYWJseSBzb21lIGZpbHRlciBoZXJlLCB0ZWxsIGJhY2tlbmQsIHdlIG5lZWQgYSBmaWx0ZXJlZFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmVyc2lvbiBvZiBpdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmZpdGxlcmVkID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9uU3VjY2VzcyhyZXNwb25zZSwgdGV4dFN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gY2FsbGJhY2socmVzcG9uc2UsIHRleHRTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvcGFnZV9cXGQrLy50ZXN0KCQoZWwpLmF0dHIoJ2lkJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uZSBsZXZlbCBoaWdoZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gJChlbCkuZmluZCgnZGl2LmNvbnQ6Zmlyc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKGVsKS5wYXJlbnRzKCdkaXYuY29udDpmaXJzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSB0YXJnZXQucGFyZW50KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhlIGVsZW1lbnQgaWYgc29tZXRoaW5nIHdlbnQgd3JvbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgPT09ICdOb3RGb3VuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZ2luID0gJCgnLm1lc3NhZ2VsaXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnJlcGxhY2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gJChwYXJlbnQpLmZpbmQoJy5tZXNzYWdlbGlzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlcy5pbnNlcnRBZnRlcignLmJyZWFkY3J1bWJzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5maW5kKCdkaXYuY29udDpmaXJzdCcpLnlmdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5zdXJlIGFmdGVyIHJlbW92YWwgZXZlcnl0aGluZyBpcyBhbGlnbmVkIGFnYWluXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEnOiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJzogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVycm9yQ2FsbGJhY2sgaXMgcGFzc2VkIHRocm91Z2ggdGhlIHJlbG9hZEl0ZW0gZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKFhNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICd4aHInOiAod2luZG93LkFjdGl2ZVhPYmplY3QpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MSFRUUCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG1vdmVUcmVlSXRlbShqdGFyZ2V0LCBpdGVtX2lkLCB0YXJnZXRfaWQsIHBvc2l0aW9uLCB0cmVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZEl0ZW0oXG4gICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LCAnLi8nICsgaXRlbV9pZCArICcvbW92ZS1wYWdlLycsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgcG9zaXRpb246IHBvc2l0aW9uLCB0YXJnZXQ6IHRhcmdldF9pZCB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbiBzdWNjZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGVjb2RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGRlY29kZWQuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gZGVjb2RlZC5zdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJlZV9wb3MgPSB7ICdsZWZ0JzogJ2JlZm9yZScsICdyaWdodCc6ICdhZnRlcicgfVtwb3NpdGlvbl0gfHwgJ2luc2lkZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlLm1vdmVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcjcGFnZV8nICsgaXRlbV9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgdGFyZ2V0X2lkICsgJyBhLnRpdGxlJylbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZV9wb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubW92ZVN1Y2Nlc3MoJCgnI3BhZ2VfJyArIGl0ZW1faWQgKyAnIGRpdi5jb2wxOmVxKDApJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubW92ZUVycm9yKCQoJyNwYWdlXycgKyBpdGVtX2lkICsgJyBkaXYuY29sMTplcSgwKScpLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHVuZG9zID0gW107XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRVbmRvKG5vZGUsIHRhcmdldCwgcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdW5kb3MucHVzaCh7IG5vZGU6IG5vZGUsIHRhcmdldDogdGFyZ2V0LCBwb3NpdGlvbjogcG9zaXRpb24gfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVmcmVzaENvbHVtbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCdkaXYuY29sMicpLmNoaWxkcmVuKCdkaXYnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBtaW5fd2lkdGggPSAxMDAwMDA7XG4gICAgICAgICAgICAgICAgdmFyIG1heF9jb2wyX3dpZHRoID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgbWF4X2NvbDIgPSBudWxsO1xuICAgICAgICAgICAgICAgICQodGhpcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ID0gJCh0aGlzKS5jaGlsZHJlbignZGl2LmNvbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250LmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbDEgPSBjb250LmNoaWxkcmVuKCdkaXYuY29sMScpLmZpbmQoJy50aXRsZSBzcGFuJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2wyID0gY29udC5jaGlsZHJlbignZGl2LmNvbDInKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbDFfd2lkdGggPSBjb2wxLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2wyX3dpZHRoID0gY29sMi5vdXRlcldpZHRoKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG90YWxfd2lkdGggPSBjb250Lm91dGVyV2lkdGgodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpZiA9IHRvdGFsX3dpZHRoIC0gY29sMV93aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpZiA8IG1pbl93aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWluX3dpZHRoID0gZGlmO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2wyX3dpZHRoID4gbWF4X2NvbDJfd2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heF9jb2wyX3dpZHRoID0gY29sMl93aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heF9jb2wyID0gY29sMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IDUwO1xuICAgICAgICAgICAgICAgIHZhciB3ID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgaGlkZGVuX2NvdW50ID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgbWF4X3JlYWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAobWF4X2NvbDIpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF4X2NvbDIuY2hpbGRyZW4oJ2RpdicpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXhfcmVhY2hlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgKz0gJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF4X3JlYWNoZWQgfHwgdyA+IChtaW5fd2lkdGggLSBvZmZzZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuX2NvdW50ID0gaGlkZGVuX2NvdW50ICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfcmVhY2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChoaWRkZW5fY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbignZGl2LmNvbnQnKS5jaGlsZHJlbignZGl2LmNvbDInKS5jaGlsZHJlbignZGl2JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNsaWNlKC1oaWRkZW5fY291bnQpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnZGl2I3NpdGVtYXAgdWwuaGVhZGVyIGRpdi5jb2wyJykuY2hpbGRyZW4oKS5zbGljZSgtaGlkZGVuX2NvdW50KS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgIH0pO1xufSkoQ01TLiQpO1xuIiwiLy8gYWxsLCBidXQgd2l0aG91dCBqcXVlcnkgISEgKG1vZGlmaWVkIGJ5IFBldGVyIENpY21hbilcblxuLy8gY3NzLmpzXG5cbmZ1bmN0aW9uIGdldF9jc3MocnVsZV9uYW1lLHN0eWxlc2hlZXQsZGVsZXRlX2ZsYWcpe2lmKCFkb2N1bWVudC5zdHlsZVNoZWV0cylyZXR1cm4gZmFsc2U7cnVsZV9uYW1lPXJ1bGVfbmFtZS50b0xvd2VyQ2FzZSgpO3N0eWxlc2hlZXQ9c3R5bGVzaGVldHx8MDtmb3IodmFyIGk9c3R5bGVzaGVldDtpPGRvY3VtZW50LnN0eWxlU2hlZXRzLmxlbmd0aDtpKyspe3ZhciBzdHlsZVNoZWV0PWRvY3VtZW50LnN0eWxlU2hlZXRzW2ldO2Nzc19ydWxlcz1kb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5jc3NSdWxlc3x8ZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0ucnVsZXM7aWYoIWNzc19ydWxlcyljb250aW51ZTt2YXIgaj0wO2Rve2lmKGNzc19ydWxlc1tqXS5zZWxlY3RvclRleHQudG9Mb3dlckNhc2UoKT09cnVsZV9uYW1lKXtpZihkZWxldGVfZmxhZz09dHJ1ZSl7aWYoZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0ucmVtb3ZlUnVsZSlkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5yZW1vdmVSdWxlKGopO2lmKGRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmRlbGV0ZVJ1bGUpZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uZGVsZXRlUnVsZShqKTtyZXR1cm4gdHJ1ZTt9XG5lbHNlIHJldHVybiBjc3NfcnVsZXNbal07fX1cbndoaWxlKGNzc19ydWxlc1srK2pdKTt9XG5yZXR1cm4gZmFsc2U7fVxuZnVuY3Rpb24gYWRkX2NzcyhydWxlX25hbWUsc3R5bGVzaGVldCl7cnVsZV9uYW1lPXJ1bGVfbmFtZS50b0xvd2VyQ2FzZSgpO3N0eWxlc2hlZXQ9c3R5bGVzaGVldHx8MDtpZighZG9jdW1lbnQuc3R5bGVTaGVldHN8fGdldF9jc3MocnVsZV9uYW1lLHN0eWxlc2hlZXQpKXJldHVybiBmYWxzZTsoZG9jdW1lbnQuc3R5bGVTaGVldHNbc3R5bGVzaGVldF0uYWRkUnVsZSk/ZG9jdW1lbnQuc3R5bGVTaGVldHNbc3R5bGVzaGVldF0uYWRkUnVsZShydWxlX25hbWUsbnVsbCwwKTpkb2N1bWVudC5zdHlsZVNoZWV0c1tzdHlsZXNoZWV0XS5pbnNlcnRSdWxlKHJ1bGVfbmFtZSsnIHsgfScsMCk7cmV0dXJuIGdldF9jc3MocnVsZV9uYW1lKTt9XG5mdW5jdGlvbiBnZXRfc2hlZXRfbnVtKGhyZWZfbmFtZSl7aWYoIWRvY3VtZW50LnN0eWxlU2hlZXRzKXJldHVybiBmYWxzZTtmb3IodmFyIGk9MDtpPGRvY3VtZW50LnN0eWxlU2hlZXRzLmxlbmd0aDtpKyspe2lmKGRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmhyZWYmJmRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmhyZWYudG9TdHJpbmcoKS5tYXRjaChocmVmX25hbWUpKXJldHVybiBpO31cbnJldHVybiBmYWxzZTt9XG5mdW5jdGlvbiByZW1vdmVfY3NzKHJ1bGVfbmFtZSxzdHlsZXNoZWV0KXtyZXR1cm4gZ2V0X2NzcyhydWxlX25hbWUsc3R5bGVzaGVldCx0cnVlKTt9XG5mdW5jdGlvbiBhZGRfc2hlZXQodXJsKXtpZihkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KXtkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KHVybCk7fVxuZWxzZXt2YXIgc3R5bGVzPVwiQGltcG9ydCB1cmwoJyBcIit1cmwrXCIgJyk7XCI7dmFyIG5ld1NTPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtuZXdTUy5yZWw9J3N0eWxlc2hlZXQnO25ld1NTLmhyZWY9J2RhdGE6dGV4dC9jc3MsJytlc2NhcGUoc3R5bGVzKTtkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQobmV3U1MpO319XG5cbi8vIGpxdWVyeS5saXN0ZW4uanNcbjsoZnVuY3Rpb24oJCl7dmFyIGE9J2luZGV4ZXInLGg9JC5ldmVudCxqPWguc3BlY2lhbCxrPSQubGlzdGVuPWZ1bmN0aW9uKGMsZCxlLGYpe2lmKHR5cGVvZiBkIT0nb2JqZWN0Jyl7Zj1lO2U9ZDtkPWRvY3VtZW50fW8oYy5zcGxpdCgvXFxzKy8pLGZ1bmN0aW9uKGEpe2E9ay5maXhlc1thXXx8YTt2YXIgYj1tKGQsYSl8fG0oZCxhLG5ldyBuKGEsZCkpO2IuYXBwZW5kKGUsZik7Yi5zdGFydCgpfSl9LG09ZnVuY3Rpb24oYixjLGQpe3JldHVybiAkLmRhdGEoYixjKycuJythLGQpfTskLmZuW2FdPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzWzBdJiZtKHRoaXNbMF0sYSl8fG51bGx9OyRbYV09ZnVuY3Rpb24oYSl7cmV0dXJuIG0oZG9jdW1lbnQsYSl9OyQuZXh0ZW5kKGsse3JlZ2V4Oi9eKCg/Olxcdyo/fFxcKikpKD86KFsjLl0pKFtcXHctXSspKT8kLyxmaXhlczp7Zm9jdXM6J2ZvY3VzaW4nLGJsdXI6J2ZvY3Vzb3V0J30sY2FjaGU6ZnVuY3Rpb24oYSl7dGhpcy5jYWNoaW5nPWF9fSk7JC5lYWNoKGsuZml4ZXMsZnVuY3Rpb24oYSxiKXtqW2JdPXtzZXR1cDpmdW5jdGlvbigpe2lmKCQuYnJvd3Nlci5tc2llKXJldHVybiExO3RoaXMuYWRkRXZlbnRMaXN0ZW5lcihhLGpbYl0uaGFuZGxlciwhMCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7aWYoJC5icm93c2VyLm1zaWUpcmV0dXJuITE7dGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKGEsaltiXS5oYW5kbGVyLCEwKX0saGFuZGxlcjpmdW5jdGlvbihlKXthcmd1bWVudHNbMF09ZT1oLmZpeChlKTtlLnR5cGU9YjtyZXR1cm4gaC5oYW5kbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfX19KTskLmZuLmxpc3Rlbj1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2soYSx0aGlzLGIsYyl9KX07ZnVuY3Rpb24gbihhLGIpeyQuZXh0ZW5kKHRoaXMse2lkczp7fSx0YWdzOnt9LGxpc3RlbmVyOmIsZXZlbnQ6YX0pO3RoaXMuaWQ9bi5pbnN0YW5jZXMucHVzaCh0aGlzKX07bi5pbnN0YW5jZXM9W107bi5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOm4saGFuZGxlOmZ1bmN0aW9uKGUpe3ZhciBhPWUuc3RvcFByb3BhZ2F0aW9uO2Uuc3RvcFByb3BhZ2F0aW9uPWZ1bmN0aW9uKCl7ZS5zdG9wcGVkPTE7YS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O20odGhpcyxlLnR5cGUpLnBhcnNlKGUpO2Uuc3RvcFByb3BhZ2F0aW9uPWE7YT1lLmRhdGE9bnVsbH0sb246MCxidWJibGVzOjAsc3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2lmKCFhLm9uKXtoLmFkZChhLmxpc3RlbmVyLGEuZXZlbnQsYS5oYW5kbGUpO2Eub249MX19LHN0b3A6ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2lmKGEub24pe2gucmVtb3ZlKGEubGlzdGVuZXIsYS5ldmVudCxhLmhhbmRsZSk7YS5vbj0wfX0sY2FjaGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gJC5kYXRhKGEsJ2xpc3RlbkNhY2hlXycrdGhpcy5pZCxiKX0scGFyc2U6ZnVuY3Rpb24oZSl7dmFyIHo9dGhpcyxjPWUuZGF0YXx8ZS50YXJnZXQsZD1hcmd1bWVudHMsZjtpZighay5jYWNoaW5nfHwhKGY9ei5jYWNoZShjKSkpe2Y9W107aWYoYy5pZCYmei5pZHNbYy5pZF0pcChmLHouaWRzW2MuaWRdKTtvKFtjLm5vZGVOYW1lLCcqJ10sZnVuY3Rpb24oYSl7dmFyIGI9ei50YWdzW2FdO2lmKGIpbygoYy5jbGFzc05hbWUrJyAqJykuc3BsaXQoJyAnKSxmdW5jdGlvbihhKXtpZihhJiZiW2FdKXAoZixiW2FdKX0pfSk7aWYoay5jYWNoaW5nKXouY2FjaGUoYyxmKX1pZihmWzBdKXtvKGYsZnVuY3Rpb24oYSl7aWYoYS5hcHBseShjLGQpPT09ITEpe2UucHJldmVudERlZmF1bHQoKTtlLnN0b3BQcm9wYWdhdGlvbigpfX0pfWlmKCFlLnN0b3BwZWQmJihjPWMucGFyZW50Tm9kZSkmJihjLm5vZGVOYW1lPT0nQSd8fHouYnViYmxlcyYmYyE9ei5saXN0ZW5lcikpe2UuZGF0YT1jO3oucGFyc2UoZSl9Zj1kPWM9bnVsbH0sYXBwZW5kOmZ1bmN0aW9uKGYsZyl7dmFyIHo9dGhpcztvKGYuc3BsaXQoL1xccyosXFxzKi8pLGZ1bmN0aW9uKGEpe3ZhciBiPWsucmVnZXguZXhlYyhhKTtpZighYil0aHJvdyckLmxpc3RlbiA+IFwiJythKydcIiBpcyBub3QgYSBzdXBwb3J0ZWQgc2VsZWN0b3IuJzt2YXIgYz1iWzJdPT0nIycmJmJbM10sZD1iWzFdLnRvVXBwZXJDYXNlKCl8fCcqJyxlPWJbM118fCcqJztpZihjKSh6Lmlkc1tjXXx8KHouaWRzW2NdPVtdKSkucHVzaChnKTtlbHNlIGlmKGQpe2Q9ei50YWdzW2RdPXoudGFnc1tkXXx8e307KGRbZV18fChkW2VdPVtdKSkucHVzaChnKX19KX19O2Z1bmN0aW9uIG8oYSxiLGMpe2Zvcih2YXIgaT0wLGw9YS5sZW5ndGg7aTxsO2krKyliLmNhbGwoYyxhW2ldLGkpfTtmdW5jdGlvbiBwKGEsYil7YS5wdXNoLmFwcGx5KGEsYik7cmV0dXJuIGF9OyQod2luZG93KS51bmxvYWQoZnVuY3Rpb24oKXtpZih0eXBlb2Ygbj09J2Z1bmN0aW9uJylvKG4uaW5zdGFuY2VzLGZ1bmN0aW9uKGIpe2Iuc3RvcCgpOyQucmVtb3ZlRGF0YShiLmxpc3RlbmVyLGIuZXZlbnQrJy4nK2EpO2IuaWRzPWIubmFtZXM9Yi5saXN0ZW5lcj1udWxsfSl9KX0pKGpRdWVyeSk7XG5cbi8vIHNhcmlzc2EuanNcblxuZnVuY3Rpb24gU2FyaXNzYSgpe31cblNhcmlzc2EuVkVSU0lPTj1cIjAuOS45LjRcIjtTYXJpc3NhLlBBUlNFRF9PSz1cIkRvY3VtZW50IGNvbnRhaW5zIG5vIHBhcnNpbmcgZXJyb3JzXCI7U2FyaXNzYS5QQVJTRURfRU1QVFk9XCJEb2N1bWVudCBpcyBlbXB0eVwiO1Nhcmlzc2EuUEFSU0VEX1VOS05PV05fRVJST1I9XCJOb3Qgd2VsbC1mb3JtZWQgb3Igb3RoZXIgZXJyb3JcIjtTYXJpc3NhLklTX0VOQUJMRURfVFJBTlNGT1JNX05PREU9ZmFsc2U7U2FyaXNzYS5SRU1PVEVfQ0FMTF9GTEFHPVwiZ3IuYWJpc3Muc2FyaXNzYS5SRU1PVEVfQ0FMTF9GTEFHXCI7U2FyaXNzYS5fbGFzdFVuaXF1ZVN1ZmZpeD0wO1Nhcmlzc2EuX2dldFVuaXF1ZVN1ZmZpeD1mdW5jdGlvbigpe3JldHVybiBTYXJpc3NhLl9sYXN0VW5pcXVlU3VmZml4Kys7fTtTYXJpc3NhLl9TQVJJU1NBX0lFUFJFRklYNFhTTFBBUkFNPVwiXCI7U2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0lNUExFTUVOVEFUSU9OPWRvY3VtZW50LmltcGxlbWVudGF0aW9uJiZ0cnVlO1Nhcmlzc2EuX1NBUklTU0FfSEFTX0RPTV9DUkVBVEVfRE9DVU1FTlQ9U2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0lNUExFTUVOVEFUSU9OJiZkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudDtTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fRkVBVFVSRT1TYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fSU1QTEVNRU5UQVRJT04mJmRvY3VtZW50LmltcGxlbWVudGF0aW9uLmhhc0ZlYXR1cmU7U2FyaXNzYS5fU0FSSVNTQV9JU19NT1o9U2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0NSRUFURV9ET0NVTUVOVCYmU2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0ZFQVRVUkU7U2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUkk9bmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJzYWZhcmlcIikhPS0xfHxuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImtvbnF1ZXJvclwiKSE9LTE7U2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUklfT0xEPVNhcmlzc2EuX1NBUklTU0FfSVNfU0FGQVJJJiYocGFyc2VJbnQoKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0FwcGxlV2ViS2l0XFwvKFxcZCspLyl8fHt9KVsxXSwxMCk8NDIwKTtTYXJpc3NhLl9TQVJJU1NBX0lTX0lFPWRvY3VtZW50LmFsbCYmd2luZG93LkFjdGl2ZVhPYmplY3QmJm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwibXNpZVwiKT4tMSYmbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJvcGVyYVwiKT09LTE7U2FyaXNzYS5fU0FSSVNTQV9JU19PUEVSQT1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIm9wZXJhXCIpIT0tMTtpZighd2luZG93Lk5vZGV8fCFOb2RlLkVMRU1FTlRfTk9ERSl7Tm9kZT17RUxFTUVOVF9OT0RFOjEsQVRUUklCVVRFX05PREU6MixURVhUX05PREU6MyxDREFUQV9TRUNUSU9OX05PREU6NCxFTlRJVFlfUkVGRVJFTkNFX05PREU6NSxFTlRJVFlfTk9ERTo2LFBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERTo3LENPTU1FTlRfTk9ERTo4LERPQ1VNRU5UX05PREU6OSxET0NVTUVOVF9UWVBFX05PREU6MTAsRE9DVU1FTlRfRlJBR01FTlRfTk9ERToxMSxOT1RBVElPTl9OT0RFOjEyfTt9XG5pZihTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSSV9PTEQpe0hUTUxIdG1sRWxlbWVudD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaHRtbFwiKS5jb25zdHJ1Y3RvcjtOb2RlPUhUTUxFbGVtZW50PXt9O0hUTUxFbGVtZW50LnByb3RvdHlwZT1IVE1MSHRtbEVsZW1lbnQuX19wcm90b19fLl9fcHJvdG9fXztIVE1MRG9jdW1lbnQ9RG9jdW1lbnQ9ZG9jdW1lbnQuY29uc3RydWN0b3I7dmFyIHg9bmV3IERPTVBhcnNlcigpO1hNTERvY3VtZW50PXguY29uc3RydWN0b3I7RWxlbWVudD14LnBhcnNlRnJvbVN0cmluZyhcIjxTaW5nbGUgLz5cIixcInRleHQveG1sXCIpLmRvY3VtZW50RWxlbWVudC5jb25zdHJ1Y3Rvcjt4PW51bGw7fVxuaWYodHlwZW9mIFhNTERvY3VtZW50PT1cInVuZGVmaW5lZFwiJiZ0eXBlb2YgRG9jdW1lbnQhPVwidW5kZWZpbmVkXCIpe1hNTERvY3VtZW50PURvY3VtZW50O31cbmlmKFNhcmlzc2EuX1NBUklTU0FfSVNfSUUpe1Nhcmlzc2EuX1NBUklTU0FfSUVQUkVGSVg0WFNMUEFSQU09XCJ4c2w6XCI7dmFyIF9TQVJJU1NBX0RPTV9QUk9HSUQ9XCJcIjt2YXIgX1NBUklTU0FfWE1MSFRUUF9QUk9HSUQ9XCJcIjt2YXIgX1NBUklTU0FfRE9NX1hNTFdSSVRFUj1cIlwiO1Nhcmlzc2EucGlja1JlY2VudFByb2dJRD1mdW5jdGlvbihpZExpc3Qpe3ZhciBiRm91bmQ9ZmFsc2UsZTt2YXIgbzJTdG9yZTtmb3IodmFyIGk9MDtpPGlkTGlzdC5sZW5ndGgmJiFiRm91bmQ7aSsrKXt0cnl7dmFyIG9Eb2M9bmV3IEFjdGl2ZVhPYmplY3QoaWRMaXN0W2ldKTtvMlN0b3JlPWlkTGlzdFtpXTtiRm91bmQ9dHJ1ZTt9Y2F0Y2gob2JqRXhjZXB0aW9uKXtlPW9iakV4Y2VwdGlvbjt9fVxuaWYoIWJGb3VuZCl7dGhyb3dcIkNvdWxkIG5vdCByZXRyaWV2ZSBhIHZhbGlkIHByb2dJRCBvZiBDbGFzczogXCIraWRMaXN0W2lkTGlzdC5sZW5ndGgtMV0rXCIuIChvcmlnaW5hbCBleGNlcHRpb246IFwiK2UrXCIpXCI7fVxuaWRMaXN0PW51bGw7cmV0dXJuIG8yU3RvcmU7fTtfU0FSSVNTQV9ET01fUFJPR0lEPW51bGw7X1NBUklTU0FfVEhSRUFERURET01fUFJPR0lEPW51bGw7X1NBUklTU0FfWFNMVEVNUExBVEVfUFJPR0lEPW51bGw7X1NBUklTU0FfWE1MSFRUUF9QUk9HSUQ9bnVsbDtYTUxIdHRwUmVxdWVzdD1mdW5jdGlvbigpe2lmKCFfU0FSSVNTQV9YTUxIVFRQX1BST0dJRCl7X1NBUklTU0FfWE1MSFRUUF9QUk9HSUQ9U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEKFtcIk1zeG1sMi5YTUxIVFRQLjYuMFwiLFwiTVNYTUwyLlhNTEhUVFAuMy4wXCIsXCJNU1hNTDIuWE1MSFRUUFwiLFwiTWljcm9zb2Z0LlhNTEhUVFBcIl0pO31cbnJldHVybiBuZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9YTUxIVFRQX1BST0dJRCk7fTtTYXJpc3NhLmdldERvbURvY3VtZW50PWZ1bmN0aW9uKHNVcmksc05hbWUpe2lmKCFfU0FSSVNTQV9ET01fUFJPR0lEKXtfU0FSSVNTQV9ET01fUFJPR0lEPVNhcmlzc2EucGlja1JlY2VudFByb2dJRChbXCJNc3htbDIuRE9NRG9jdW1lbnQuNi4wXCIsXCJNc3htbDIuRE9NRG9jdW1lbnQuMy4wXCIsXCJNU1hNTDIuRE9NRG9jdW1lbnRcIixcIk1TWE1MLkRPTURvY3VtZW50XCIsXCJNaWNyb3NvZnQuWE1MRE9NXCJdKTt9XG52YXIgb0RvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fUFJPR0lEKTtpZihzTmFtZSl7dmFyIHByZWZpeD1cIlwiO2lmKHNVcmkpe2lmKHNOYW1lLmluZGV4T2YoXCI6XCIpPjEpe3ByZWZpeD1zTmFtZS5zdWJzdHJpbmcoMCxzTmFtZS5pbmRleE9mKFwiOlwiKSk7c05hbWU9c05hbWUuc3Vic3RyaW5nKHNOYW1lLmluZGV4T2YoXCI6XCIpKzEpO31lbHNle3ByZWZpeD1cImFcIitTYXJpc3NhLl9nZXRVbmlxdWVTdWZmaXgoKTt9fVxuaWYoc1VyaSl7b0RvYy5sb2FkWE1MKCc8JytwcmVmaXgrJzonK3NOYW1lK1wiIHhtbG5zOlwiK3ByZWZpeCtcIj1cXFwiXCIrc1VyaStcIlxcXCJcIitcIiAvPlwiKTt9ZWxzZXtvRG9jLmxvYWRYTUwoJzwnK3NOYW1lK1wiIC8+XCIpO319XG5yZXR1cm4gb0RvYzt9O1Nhcmlzc2EuZ2V0UGFyc2VFcnJvclRleHQ9ZnVuY3Rpb24ob0RvYyl7dmFyIHBhcnNlRXJyb3JUZXh0PVNhcmlzc2EuUEFSU0VEX09LO2lmKG9Eb2MmJm9Eb2MucGFyc2VFcnJvciYmb0RvYy5wYXJzZUVycm9yLmVycm9yQ29kZSYmb0RvYy5wYXJzZUVycm9yLmVycm9yQ29kZSE9MCl7cGFyc2VFcnJvclRleHQ9XCJYTUwgUGFyc2luZyBFcnJvcjogXCIrb0RvYy5wYXJzZUVycm9yLnJlYXNvbitcIlxcbkxvY2F0aW9uOiBcIitvRG9jLnBhcnNlRXJyb3IudXJsK1wiXFxuTGluZSBOdW1iZXIgXCIrb0RvYy5wYXJzZUVycm9yLmxpbmUrXCIsIENvbHVtbiBcIitcbm9Eb2MucGFyc2VFcnJvci5saW5lcG9zK1wiOlxcblwiK29Eb2MucGFyc2VFcnJvci5zcmNUZXh0K1wiXFxuXCI7Zm9yKHZhciBpPTA7aTxvRG9jLnBhcnNlRXJyb3IubGluZXBvcztpKyspe3BhcnNlRXJyb3JUZXh0Kz1cIi1cIjt9XG5wYXJzZUVycm9yVGV4dCs9XCJeXFxuXCI7fVxuZWxzZSBpZihvRG9jLmRvY3VtZW50RWxlbWVudD09PW51bGwpe3BhcnNlRXJyb3JUZXh0PVNhcmlzc2EuUEFSU0VEX0VNUFRZO31cbnJldHVybiBwYXJzZUVycm9yVGV4dDt9O1Nhcmlzc2Euc2V0WHBhdGhOYW1lc3BhY2VzPWZ1bmN0aW9uKG9Eb2Msc05zU2V0KXtvRG9jLnNldFByb3BlcnR5KFwiU2VsZWN0aW9uTGFuZ3VhZ2VcIixcIlhQYXRoXCIpO29Eb2Muc2V0UHJvcGVydHkoXCJTZWxlY3Rpb25OYW1lc3BhY2VzXCIsc05zU2V0KTt9O1hTTFRQcm9jZXNzb3I9ZnVuY3Rpb24oKXtpZighX1NBUklTU0FfWFNMVEVNUExBVEVfUFJPR0lEKXtfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQ9U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEKFtcIk1zeG1sMi5YU0xUZW1wbGF0ZS42LjBcIixcIk1TWE1MMi5YU0xUZW1wbGF0ZS4zLjBcIl0pO31cbnRoaXMudGVtcGxhdGU9bmV3IEFjdGl2ZVhPYmplY3QoX1NBUklTU0FfWFNMVEVNUExBVEVfUFJPR0lEKTt0aGlzLnByb2Nlc3Nvcj1udWxsO307WFNMVFByb2Nlc3Nvci5wcm90b3R5cGUuaW1wb3J0U3R5bGVzaGVldD1mdW5jdGlvbih4c2xEb2Mpe2lmKCFfU0FSSVNTQV9USFJFQURFRERPTV9QUk9HSUQpe19TQVJJU1NBX1RIUkVBREVERE9NX1BST0dJRD1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTVNYTUwyLkZyZWVUaHJlYWRlZERPTURvY3VtZW50LjYuMFwiLFwiTVNYTUwyLkZyZWVUaHJlYWRlZERPTURvY3VtZW50LjMuMFwiXSk7fVxueHNsRG9jLnNldFByb3BlcnR5KFwiU2VsZWN0aW9uTGFuZ3VhZ2VcIixcIlhQYXRoXCIpO3hzbERvYy5zZXRQcm9wZXJ0eShcIlNlbGVjdGlvbk5hbWVzcGFjZXNcIixcInhtbG5zOnhzbD0naHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtJ1wiKTt2YXIgY29udmVydGVkPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX1RIUkVBREVERE9NX1BST0dJRCk7dHJ5e2NvbnZlcnRlZC5yZXNvbHZlRXh0ZXJuYWxzPXRydWU7Y29udmVydGVkLnNldFByb3BlcnR5KFwiQWxsb3dEb2N1bWVudEZ1bmN0aW9uXCIsdHJ1ZSk7fVxuY2F0Y2goZSl7fVxuaWYoeHNsRG9jLnVybCYmeHNsRG9jLnNlbGVjdFNpbmdsZU5vZGUoXCIvL3hzbDoqW2xvY2FsLW5hbWUoKSA9ICdpbXBvcnQnIG9yIGxvY2FsLW5hbWUoKSA9ICdpbmNsdWRlJ11cIikhPW51bGwpe2NvbnZlcnRlZC5hc3luYz1mYWxzZTtjb252ZXJ0ZWQubG9hZCh4c2xEb2MudXJsKTt9XG5lbHNle2NvbnZlcnRlZC5sb2FkWE1MKHhzbERvYy54bWwpO31cbmNvbnZlcnRlZC5zZXRQcm9wZXJ0eShcIlNlbGVjdGlvbk5hbWVzcGFjZXNcIixcInhtbG5zOnhzbD0naHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtJ1wiKTt2YXIgb3V0cHV0PWNvbnZlcnRlZC5zZWxlY3RTaW5nbGVOb2RlKFwiLy94c2w6b3V0cHV0XCIpO2lmKG91dHB1dCl7dGhpcy5vdXRwdXRNZXRob2Q9b3V0cHV0LmdldEF0dHJpYnV0ZShcIm1ldGhvZFwiKTt9XG5lbHNle2RlbGV0ZSB0aGlzLm91dHB1dE1ldGhvZDt9XG50aGlzLnRlbXBsYXRlLnN0eWxlc2hlZXQ9Y29udmVydGVkO3RoaXMucHJvY2Vzc29yPXRoaXMudGVtcGxhdGUuY3JlYXRlUHJvY2Vzc29yKCk7dGhpcy5wYXJhbXNTZXQ9W107fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS50cmFuc2Zvcm1Ub0RvY3VtZW50PWZ1bmN0aW9uKHNvdXJjZURvYyl7dmFyIG91dERvYztpZihfU0FSSVNTQV9USFJFQURFRERPTV9QUk9HSUQpe3RoaXMucHJvY2Vzc29yLmlucHV0PXNvdXJjZURvYztvdXREb2M9bmV3IEFjdGl2ZVhPYmplY3QoX1NBUklTU0FfRE9NX1BST0dJRCk7dGhpcy5wcm9jZXNzb3Iub3V0cHV0PW91dERvYzt0aGlzLnByb2Nlc3Nvci50cmFuc2Zvcm0oKTtyZXR1cm4gb3V0RG9jO31cbmVsc2V7aWYoIV9TQVJJU1NBX0RPTV9YTUxXUklURVIpe19TQVJJU1NBX0RPTV9YTUxXUklURVI9U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEKFtcIk1zeG1sMi5NWFhNTFdyaXRlci42LjBcIixcIk1zeG1sMi5NWFhNTFdyaXRlci4zLjBcIixcIk1TWE1MMi5NWFhNTFdyaXRlclwiLFwiTVNYTUwuTVhYTUxXcml0ZXJcIixcIk1pY3Jvc29mdC5YTUxET01cIl0pO31cbnRoaXMucHJvY2Vzc29yLmlucHV0PXNvdXJjZURvYztvdXREb2M9bmV3IEFjdGl2ZVhPYmplY3QoX1NBUklTU0FfRE9NX1hNTFdSSVRFUik7dGhpcy5wcm9jZXNzb3Iub3V0cHV0PW91dERvYzt0aGlzLnByb2Nlc3Nvci50cmFuc2Zvcm0oKTt2YXIgb0RvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fUFJPR0lEKTtvRG9jLmxvYWRYTUwob3V0RG9jLm91dHB1dCtcIlwiKTtyZXR1cm4gb0RvYzt9fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS50cmFuc2Zvcm1Ub0ZyYWdtZW50PWZ1bmN0aW9uKHNvdXJjZURvYyxvd25lckRvYyl7dGhpcy5wcm9jZXNzb3IuaW5wdXQ9c291cmNlRG9jO3RoaXMucHJvY2Vzc29yLnRyYW5zZm9ybSgpO3ZhciBzPXRoaXMucHJvY2Vzc29yLm91dHB1dDt2YXIgZj1vd25lckRvYy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7dmFyIGNvbnRhaW5lcjtpZih0aGlzLm91dHB1dE1ldGhvZD09J3RleHQnKXtmLmFwcGVuZENoaWxkKG93bmVyRG9jLmNyZWF0ZVRleHROb2RlKHMpKTt9ZWxzZSBpZihvd25lckRvYy5ib2R5JiZvd25lckRvYy5ib2R5LmlubmVySFRNTCl7Y29udGFpbmVyPW93bmVyRG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO2NvbnRhaW5lci5pbm5lckhUTUw9czt3aGlsZShjb250YWluZXIuaGFzQ2hpbGROb2RlcygpKXtmLmFwcGVuZENoaWxkKGNvbnRhaW5lci5maXJzdENoaWxkKTt9fVxuZWxzZXt2YXIgb0RvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fUFJPR0lEKTtpZihzLnN1YnN0cmluZygwLDUpPT0nPD94bWwnKXtzPXMuc3Vic3RyaW5nKHMuaW5kZXhPZignPz4nKSsyKTt9XG52YXIgeG1sPScnLmNvbmNhdCgnPG15PicscywnPC9teT4nKTtvRG9jLmxvYWRYTUwoeG1sKTtjb250YWluZXI9b0RvYy5kb2N1bWVudEVsZW1lbnQ7d2hpbGUoY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSl7Zi5hcHBlbmRDaGlsZChjb250YWluZXIuZmlyc3RDaGlsZCk7fX1cbnJldHVybiBmO307WFNMVFByb2Nlc3Nvci5wcm90b3R5cGUuc2V0UGFyYW1ldGVyPWZ1bmN0aW9uKG5zVVJJLG5hbWUsdmFsdWUpe3ZhbHVlPXZhbHVlP3ZhbHVlOlwiXCI7aWYobnNVUkkpe3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLHZhbHVlLG5zVVJJKTt9ZWxzZXt0aGlzLnByb2Nlc3Nvci5hZGRQYXJhbWV0ZXIobmFtZSx2YWx1ZSk7fVxubnNVUkk9XCJcIisobnNVUkl8fFwiXCIpO2lmKCF0aGlzLnBhcmFtc1NldFtuc1VSSV0pe3RoaXMucGFyYW1zU2V0W25zVVJJXT1bXTt9XG50aGlzLnBhcmFtc1NldFtuc1VSSV1bbmFtZV09dmFsdWU7fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS5nZXRQYXJhbWV0ZXI9ZnVuY3Rpb24obnNVUkksbmFtZSl7bnNVUkk9XCJcIisobnNVUkl8fFwiXCIpO2lmKHRoaXMucGFyYW1zU2V0W25zVVJJXSYmdGhpcy5wYXJhbXNTZXRbbnNVUkldW25hbWVdKXtyZXR1cm4gdGhpcy5wYXJhbXNTZXRbbnNVUkldW25hbWVdO31lbHNle3JldHVybiBudWxsO319O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLmNsZWFyUGFyYW1ldGVycz1mdW5jdGlvbigpe2Zvcih2YXIgbnNVUkkgaW4gdGhpcy5wYXJhbXNTZXQpe2Zvcih2YXIgbmFtZSBpbiB0aGlzLnBhcmFtc1NldFtuc1VSSV0pe2lmKG5zVVJJIT1cIlwiKXt0aGlzLnByb2Nlc3Nvci5hZGRQYXJhbWV0ZXIobmFtZSxcIlwiLG5zVVJJKTt9ZWxzZXt0aGlzLnByb2Nlc3Nvci5hZGRQYXJhbWV0ZXIobmFtZSxcIlwiKTt9fX1cbnRoaXMucGFyYW1zU2V0PVtdO307fWVsc2V7aWYoU2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0NSRUFURV9ET0NVTUVOVCl7U2FyaXNzYS5fX2hhbmRsZUxvYWRfXz1mdW5jdGlvbihvRG9jKXtTYXJpc3NhLl9fc2V0UmVhZHlTdGF0ZV9fKG9Eb2MsNCk7fTtfc2FyaXNzYV9YTUxEb2N1bWVudF9vbmxvYWQ9ZnVuY3Rpb24oKXtTYXJpc3NhLl9faGFuZGxlTG9hZF9fKHRoaXMpO307U2FyaXNzYS5fX3NldFJlYWR5U3RhdGVfXz1mdW5jdGlvbihvRG9jLGlSZWFkeVN0YXRlKXtvRG9jLnJlYWR5U3RhdGU9aVJlYWR5U3RhdGU7b0RvYy5yZWFkeXN0YXRlPWlSZWFkeVN0YXRlO2lmKG9Eb2Mub25yZWFkeXN0YXRlY2hhbmdlIT1udWxsJiZ0eXBlb2Ygb0RvYy5vbnJlYWR5c3RhdGVjaGFuZ2U9PVwiZnVuY3Rpb25cIil7b0RvYy5vbnJlYWR5c3RhdGVjaGFuZ2UoKTt9fTtTYXJpc3NhLmdldERvbURvY3VtZW50PWZ1bmN0aW9uKHNVcmksc05hbWUpe3ZhciBvRG9jPWRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50KHNVcmk/c1VyaTpudWxsLHNOYW1lP3NOYW1lOm51bGwsbnVsbCk7aWYoIW9Eb2Mub25yZWFkeXN0YXRlY2hhbmdlKXtvRG9jLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsO31cbmlmKCFvRG9jLnJlYWR5U3RhdGUpe29Eb2MucmVhZHlTdGF0ZT0wO31cbm9Eb2MuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIixfc2FyaXNzYV9YTUxEb2N1bWVudF9vbmxvYWQsZmFsc2UpO3JldHVybiBvRG9jO307aWYod2luZG93LlhNTERvY3VtZW50KXt9XG5lbHNlIGlmKFNhcmlzc2EuX1NBUklTU0FfSEFTX0RPTV9GRUFUVVJFJiZ3aW5kb3cuRG9jdW1lbnQmJiFEb2N1bWVudC5wcm90b3R5cGUubG9hZCYmZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZSgnTFMnLCczLjAnKSl7U2FyaXNzYS5nZXREb21Eb2N1bWVudD1mdW5jdGlvbihzVXJpLHNOYW1lKXt2YXIgb0RvYz1kb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudChzVXJpP3NVcmk6bnVsbCxzTmFtZT9zTmFtZTpudWxsLG51bGwpO3JldHVybiBvRG9jO307fVxuZWxzZXtTYXJpc3NhLmdldERvbURvY3VtZW50PWZ1bmN0aW9uKHNVcmksc05hbWUpe3ZhciBvRG9jPWRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50KHNVcmk/c1VyaTpudWxsLHNOYW1lP3NOYW1lOm51bGwsbnVsbCk7aWYob0RvYyYmKHNVcml8fHNOYW1lKSYmIW9Eb2MuZG9jdW1lbnRFbGVtZW50KXtvRG9jLmFwcGVuZENoaWxkKG9Eb2MuY3JlYXRlRWxlbWVudE5TKHNVcmksc05hbWUpKTt9XG5yZXR1cm4gb0RvYzt9O319fVxuaWYoIXdpbmRvdy5ET01QYXJzZXIpe2lmKFNhcmlzc2EuX1NBUklTU0FfSVNfU0FGQVJJKXtET01QYXJzZXI9ZnVuY3Rpb24oKXt9O0RPTVBhcnNlci5wcm90b3R5cGUucGFyc2VGcm9tU3RyaW5nPWZ1bmN0aW9uKHNYbWwsY29udGVudFR5cGUpe3ZhciB4bWxodHRwPW5ldyBYTUxIdHRwUmVxdWVzdCgpO3htbGh0dHAub3BlbihcIkdFVFwiLFwiZGF0YTp0ZXh0L3htbDtjaGFyc2V0PXV0Zi04LFwiK2VuY29kZVVSSUNvbXBvbmVudChzWG1sKSxmYWxzZSk7eG1saHR0cC5zZW5kKG51bGwpO3JldHVybiB4bWxodHRwLnJlc3BvbnNlWE1MO307fWVsc2UgaWYoU2FyaXNzYS5nZXREb21Eb2N1bWVudCYmU2FyaXNzYS5nZXREb21Eb2N1bWVudCgpJiZTYXJpc3NhLmdldERvbURvY3VtZW50KG51bGwsXCJiYXJcIikueG1sKXtET01QYXJzZXI9ZnVuY3Rpb24oKXt9O0RPTVBhcnNlci5wcm90b3R5cGUucGFyc2VGcm9tU3RyaW5nPWZ1bmN0aW9uKHNYbWwsY29udGVudFR5cGUpe3ZhciBkb2M9U2FyaXNzYS5nZXREb21Eb2N1bWVudCgpO2RvYy5sb2FkWE1MKHNYbWwpO3JldHVybiBkb2M7fTt9fVxuaWYoKHR5cGVvZihkb2N1bWVudC5pbXBvcnROb2RlKT09XCJ1bmRlZmluZWRcIikmJlNhcmlzc2EuX1NBUklTU0FfSVNfSUUpe3RyeXtkb2N1bWVudC5pbXBvcnROb2RlPWZ1bmN0aW9uKG9Ob2RlLGJDaGlsZHJlbil7dmFyIHRtcDtpZihvTm9kZS5ub2RlTmFtZT09JyN0ZXh0Jyl7cmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG9Ob2RlLmRhdGEpO31cbmVsc2V7aWYob05vZGUubm9kZU5hbWU9PVwidGJvZHlcInx8b05vZGUubm9kZU5hbWU9PVwidHJcIil7dG1wPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTt9XG5lbHNlIGlmKG9Ob2RlLm5vZGVOYW1lPT1cInRkXCIpe3RtcD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7fVxuZWxzZSBpZihvTm9kZS5ub2RlTmFtZT09XCJvcHRpb25cIil7dG1wPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7fVxuZWxzZXt0bXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTt9XG5pZihiQ2hpbGRyZW4pe3RtcC5pbm5lckhUTUw9b05vZGUueG1sP29Ob2RlLnhtbDpvTm9kZS5vdXRlckhUTUw7fWVsc2V7dG1wLmlubmVySFRNTD1vTm9kZS54bWw/b05vZGUuY2xvbmVOb2RlKGZhbHNlKS54bWw6b05vZGUuY2xvbmVOb2RlKGZhbHNlKS5vdXRlckhUTUw7fVxucmV0dXJuIHRtcC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIilbMF07fX07fWNhdGNoKGUpe319XG5pZighU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dCl7U2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dD1mdW5jdGlvbihvRG9jKXt2YXIgcGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfT0s7aWYoKCFvRG9jKXx8KCFvRG9jLmRvY3VtZW50RWxlbWVudCkpe3BhcnNlRXJyb3JUZXh0PVNhcmlzc2EuUEFSU0VEX0VNUFRZO31lbHNlIGlmKG9Eb2MuZG9jdW1lbnRFbGVtZW50LnRhZ05hbWU9PVwicGFyc2VyZXJyb3JcIil7cGFyc2VFcnJvclRleHQ9b0RvYy5kb2N1bWVudEVsZW1lbnQuZmlyc3RDaGlsZC5kYXRhO3BhcnNlRXJyb3JUZXh0Kz1cIlxcblwiK29Eb2MuZG9jdW1lbnRFbGVtZW50LmZpcnN0Q2hpbGQubmV4dFNpYmxpbmcuZmlyc3RDaGlsZC5kYXRhO31lbHNlIGlmKG9Eb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwYXJzZXJlcnJvclwiKS5sZW5ndGg+MCl7dmFyIHBhcnNlcmVycm9yPW9Eb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwYXJzZXJlcnJvclwiKVswXTtwYXJzZUVycm9yVGV4dD1TYXJpc3NhLmdldFRleHQocGFyc2VyZXJyb3IsdHJ1ZSkrXCJcXG5cIjt9ZWxzZSBpZihvRG9jLnBhcnNlRXJyb3ImJm9Eb2MucGFyc2VFcnJvci5lcnJvckNvZGUhPTApe3BhcnNlRXJyb3JUZXh0PVNhcmlzc2EuUEFSU0VEX1VOS05PV05fRVJST1I7fVxucmV0dXJuIHBhcnNlRXJyb3JUZXh0O307fVxuU2FyaXNzYS5nZXRUZXh0PWZ1bmN0aW9uKG9Ob2RlLGRlZXApe3ZhciBzPVwiXCI7dmFyIG5vZGVzPW9Ob2RlLmNoaWxkTm9kZXM7Zm9yKHZhciBpPTA7aTxub2Rlcy5sZW5ndGg7aSsrKXt2YXIgbm9kZT1ub2Rlc1tpXTt2YXIgbm9kZVR5cGU9bm9kZS5ub2RlVHlwZTtpZihub2RlVHlwZT09Tm9kZS5URVhUX05PREV8fG5vZGVUeXBlPT1Ob2RlLkNEQVRBX1NFQ1RJT05fTk9ERSl7cys9bm9kZS5kYXRhO31lbHNlIGlmKGRlZXA9PT10cnVlJiYobm9kZVR5cGU9PU5vZGUuRUxFTUVOVF9OT0RFfHxub2RlVHlwZT09Tm9kZS5ET0NVTUVOVF9OT0RFfHxub2RlVHlwZT09Tm9kZS5ET0NVTUVOVF9GUkFHTUVOVF9OT0RFKSl7cys9U2FyaXNzYS5nZXRUZXh0KG5vZGUsdHJ1ZSk7fX1cbnJldHVybiBzO307aWYoIXdpbmRvdy5YTUxTZXJpYWxpemVyJiZTYXJpc3NhLmdldERvbURvY3VtZW50JiZTYXJpc3NhLmdldERvbURvY3VtZW50KFwiXCIsXCJmb29cIixudWxsKS54bWwpe1hNTFNlcmlhbGl6ZXI9ZnVuY3Rpb24oKXt9O1hNTFNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVRvU3RyaW5nPWZ1bmN0aW9uKG9Ob2RlKXtyZXR1cm4gb05vZGUueG1sO307fVxuU2FyaXNzYS5zdHJpcFRhZ3M9ZnVuY3Rpb24ocyl7cmV0dXJuIHM/cy5yZXBsYWNlKC88W14+XSs+L2csXCJcIik6czt9O1Nhcmlzc2EuY2xlYXJDaGlsZE5vZGVzPWZ1bmN0aW9uKG9Ob2RlKXt3aGlsZShvTm9kZS5maXJzdENoaWxkKXtvTm9kZS5yZW1vdmVDaGlsZChvTm9kZS5maXJzdENoaWxkKTt9fTtTYXJpc3NhLmNvcHlDaGlsZE5vZGVzPWZ1bmN0aW9uKG5vZGVGcm9tLG5vZGVUbyxiUHJlc2VydmVFeGlzdGluZyl7aWYoU2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUkkmJm5vZGVUby5ub2RlVHlwZT09Tm9kZS5ET0NVTUVOVF9OT0RFKXtub2RlVG89bm9kZVRvLmRvY3VtZW50RWxlbWVudDt9XG5pZigoIW5vZGVGcm9tKXx8KCFub2RlVG8pKXt0aHJvd1wiQm90aCBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uIG5vZGVzIG11c3QgYmUgcHJvdmlkZWRcIjt9XG5pZighYlByZXNlcnZlRXhpc3Rpbmcpe1Nhcmlzc2EuY2xlYXJDaGlsZE5vZGVzKG5vZGVUbyk7fVxudmFyIG93bmVyRG9jPW5vZGVUby5ub2RlVHlwZT09Tm9kZS5ET0NVTUVOVF9OT0RFP25vZGVUbzpub2RlVG8ub3duZXJEb2N1bWVudDt2YXIgbm9kZXM9bm9kZUZyb20uY2hpbGROb2Rlczt2YXIgaTtpZih0eXBlb2Yob3duZXJEb2MuaW1wb3J0Tm9kZSkhPVwidW5kZWZpbmVkXCIpe2ZvcihpPTA7aTxub2Rlcy5sZW5ndGg7aSsrKXtub2RlVG8uYXBwZW5kQ2hpbGQob3duZXJEb2MuaW1wb3J0Tm9kZShub2Rlc1tpXSx0cnVlKSk7fX1lbHNle2ZvcihpPTA7aTxub2Rlcy5sZW5ndGg7aSsrKXtub2RlVG8uYXBwZW5kQ2hpbGQobm9kZXNbaV0uY2xvbmVOb2RlKHRydWUpKTt9fX07U2FyaXNzYS5tb3ZlQ2hpbGROb2Rlcz1mdW5jdGlvbihub2RlRnJvbSxub2RlVG8sYlByZXNlcnZlRXhpc3Rpbmcpe2lmKCghbm9kZUZyb20pfHwoIW5vZGVUbykpe3Rocm93XCJCb3RoIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gbm9kZXMgbXVzdCBiZSBwcm92aWRlZFwiO31cbmlmKCFiUHJlc2VydmVFeGlzdGluZyl7U2FyaXNzYS5jbGVhckNoaWxkTm9kZXMobm9kZVRvKTt9XG52YXIgbm9kZXM9bm9kZUZyb20uY2hpbGROb2RlcztpZihub2RlRnJvbS5vd25lckRvY3VtZW50PT1ub2RlVG8ub3duZXJEb2N1bWVudCl7d2hpbGUobm9kZUZyb20uZmlyc3RDaGlsZCl7bm9kZVRvLmFwcGVuZENoaWxkKG5vZGVGcm9tLmZpcnN0Q2hpbGQpO319ZWxzZXt2YXIgb3duZXJEb2M9bm9kZVRvLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREU/bm9kZVRvOm5vZGVUby5vd25lckRvY3VtZW50O3ZhciBpO2lmKHR5cGVvZihvd25lckRvYy5pbXBvcnROb2RlKSE9XCJ1bmRlZmluZWRcIil7Zm9yKGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe25vZGVUby5hcHBlbmRDaGlsZChvd25lckRvYy5pbXBvcnROb2RlKG5vZGVzW2ldLHRydWUpKTt9fWVsc2V7Zm9yKGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe25vZGVUby5hcHBlbmRDaGlsZChub2Rlc1tpXS5jbG9uZU5vZGUodHJ1ZSkpO319XG5TYXJpc3NhLmNsZWFyQ2hpbGROb2Rlcyhub2RlRnJvbSk7fX07U2FyaXNzYS54bWxpemU9ZnVuY3Rpb24oYW55T2JqZWN0LG9iamVjdE5hbWUsaW5kZW50U3BhY2Upe2luZGVudFNwYWNlPWluZGVudFNwYWNlP2luZGVudFNwYWNlOicnO3ZhciBzPWluZGVudFNwYWNlKyc8JytvYmplY3ROYW1lKyc+Jzt2YXIgaXNMZWFmPWZhbHNlO2lmKCEoYW55T2JqZWN0IGluc3RhbmNlb2YgT2JqZWN0KXx8YW55T2JqZWN0IGluc3RhbmNlb2YgTnVtYmVyfHxhbnlPYmplY3QgaW5zdGFuY2VvZiBTdHJpbmd8fGFueU9iamVjdCBpbnN0YW5jZW9mIEJvb2xlYW58fGFueU9iamVjdCBpbnN0YW5jZW9mIERhdGUpe3MrPVNhcmlzc2EuZXNjYXBlKFwiXCIrYW55T2JqZWN0KTtpc0xlYWY9dHJ1ZTt9ZWxzZXtzKz1cIlxcblwiO3ZhciBpc0FycmF5SXRlbT1hbnlPYmplY3QgaW5zdGFuY2VvZiBBcnJheTtmb3IodmFyIG5hbWUgaW4gYW55T2JqZWN0KXtzKz1TYXJpc3NhLnhtbGl6ZShhbnlPYmplY3RbbmFtZV0sKGlzQXJyYXlJdGVtP1wiYXJyYXktaXRlbSBrZXk9XFxcIlwiK25hbWUrXCJcXFwiXCI6bmFtZSksaW5kZW50U3BhY2UrXCIgICBcIik7fVxucys9aW5kZW50U3BhY2U7fVxucmV0dXJuKHMrPShvYmplY3ROYW1lLmluZGV4T2YoJyAnKSE9LTE/XCI8L2FycmF5LWl0ZW0+XFxuXCI6XCI8L1wiK29iamVjdE5hbWUrXCI+XFxuXCIpKTt9O1Nhcmlzc2EuZXNjYXBlPWZ1bmN0aW9uKHNYbWwpe3JldHVybiBzWG1sLnJlcGxhY2UoLyYvZyxcIiZhbXA7XCIpLnJlcGxhY2UoLzwvZyxcIiZsdDtcIikucmVwbGFjZSgvPi9nLFwiJmd0O1wiKS5yZXBsYWNlKC9cIi9nLFwiJnF1b3Q7XCIpLnJlcGxhY2UoLycvZyxcIiZhcG9zO1wiKTt9O1Nhcmlzc2EudW5lc2NhcGU9ZnVuY3Rpb24oc1htbCl7cmV0dXJuIHNYbWwucmVwbGFjZSgvJmFwb3M7L2csXCInXCIpLnJlcGxhY2UoLyZxdW90Oy9nLFwiXFxcIlwiKS5yZXBsYWNlKC8mZ3Q7L2csXCI+XCIpLnJlcGxhY2UoLyZsdDsvZyxcIjxcIikucmVwbGFjZSgvJmFtcDsvZyxcIiZcIik7fTtTYXJpc3NhLnVwZGF0ZUN1cnNvcj1mdW5jdGlvbihvVGFyZ2V0RWxlbWVudCxzVmFsdWUpe2lmKG9UYXJnZXRFbGVtZW50JiZvVGFyZ2V0RWxlbWVudC5zdHlsZSYmb1RhcmdldEVsZW1lbnQuc3R5bGUuY3Vyc29yIT11bmRlZmluZWQpe29UYXJnZXRFbGVtZW50LnN0eWxlLmN1cnNvcj1zVmFsdWU7fX07U2FyaXNzYS51cGRhdGVDb250ZW50RnJvbVVSST1mdW5jdGlvbihzRnJvbVVybCxvVGFyZ2V0RWxlbWVudCx4c2x0cHJvYyxjYWxsYmFjayxza2lwQ2FjaGUpe3RyeXtTYXJpc3NhLnVwZGF0ZUN1cnNvcihvVGFyZ2V0RWxlbWVudCxcIndhaXRcIik7dmFyIHhtbGh0dHA9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7eG1saHR0cC5vcGVuKFwiR0VUXCIsc0Zyb21VcmwsdHJ1ZSk7eG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtpZih4bWxodHRwLnJlYWR5U3RhdGU9PTQpe3RyeXt2YXIgb0RvbURvYz14bWxodHRwLnJlc3BvbnNlWE1MO2lmKG9Eb21Eb2MmJlNhcmlzc2EuZ2V0UGFyc2VFcnJvclRleHQob0RvbURvYyk9PVNhcmlzc2EuUEFSU0VEX09LKXtTYXJpc3NhLnVwZGF0ZUNvbnRlbnRGcm9tTm9kZSh4bWxodHRwLnJlc3BvbnNlWE1MLG9UYXJnZXRFbGVtZW50LHhzbHRwcm9jKTtpZihjYWxsYmFjayl7Y2FsbGJhY2soc0Zyb21Vcmwsb1RhcmdldEVsZW1lbnQpO319XG5lbHNle3Rocm93IFNhcmlzc2EuZ2V0UGFyc2VFcnJvclRleHQob0RvbURvYyk7fX1cbmNhdGNoKGUpe2lmKGNhbGxiYWNrKXtjYWxsYmFjayhzRnJvbVVybCxvVGFyZ2V0RWxlbWVudCxlKTt9XG5lbHNle3Rocm93IGU7fX19fTtpZihza2lwQ2FjaGUpe3ZhciBvbGRhZ2U9XCJTYXQsIDEgSmFuIDIwMDAgMDA6MDA6MDAgR01UXCI7eG1saHR0cC5zZXRSZXF1ZXN0SGVhZGVyKFwiSWYtTW9kaWZpZWQtU2luY2VcIixvbGRhZ2UpO31cbnhtbGh0dHAuc2VuZChcIlwiKTt9XG5jYXRjaChlKXtTYXJpc3NhLnVwZGF0ZUN1cnNvcihvVGFyZ2V0RWxlbWVudCxcImF1dG9cIik7aWYoY2FsbGJhY2spe2NhbGxiYWNrKHNGcm9tVXJsLG9UYXJnZXRFbGVtZW50LGUpO31cbmVsc2V7dGhyb3cgZTt9fX07U2FyaXNzYS51cGRhdGVDb250ZW50RnJvbU5vZGU9ZnVuY3Rpb24ob05vZGUsb1RhcmdldEVsZW1lbnQseHNsdHByb2Mpe3RyeXtTYXJpc3NhLnVwZGF0ZUN1cnNvcihvVGFyZ2V0RWxlbWVudCxcIndhaXRcIik7U2FyaXNzYS5jbGVhckNoaWxkTm9kZXMob1RhcmdldEVsZW1lbnQpO3ZhciBvd25lckRvYz1vTm9kZS5ub2RlVHlwZT09Tm9kZS5ET0NVTUVOVF9OT0RFP29Ob2RlOm9Ob2RlLm93bmVyRG9jdW1lbnQ7aWYob3duZXJEb2MucGFyc2VFcnJvciYmb3duZXJEb2MucGFyc2VFcnJvci5lcnJvckNvZGUhPTApe3ZhciBwcmU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtwcmUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvd25lckRvYykpKTtvVGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChwcmUpO31cbmVsc2V7aWYoeHNsdHByb2Mpe29Ob2RlPXhzbHRwcm9jLnRyYW5zZm9ybVRvRG9jdW1lbnQob05vZGUpO31cbmlmKG9UYXJnZXRFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKT09XCJ0ZXh0YXJlYVwifHxvVGFyZ2V0RWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk9PVwiaW5wdXRcIil7b1RhcmdldEVsZW1lbnQudmFsdWU9bmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhvTm9kZSk7fVxuZWxzZXt0cnl7b1RhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQob1RhcmdldEVsZW1lbnQub3duZXJEb2N1bWVudC5pbXBvcnROb2RlKG9Ob2RlLHRydWUpKTt9XG5jYXRjaChlKXtvVGFyZ2V0RWxlbWVudC5pbm5lckhUTUw9bmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhvTm9kZSk7fX19fVxuY2F0Y2goZSl7dGhyb3cgZTt9XG5maW5hbGx5e1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwiYXV0b1wiKTt9fTtTYXJpc3NhLmZvcm1Ub1F1ZXJ5U3RyaW5nPWZ1bmN0aW9uKG9Gb3JtKXt2YXIgcXM9XCJcIjtmb3IodmFyIGk9MDtpPG9Gb3JtLmVsZW1lbnRzLmxlbmd0aDtpKyspe3ZhciBvRmllbGQ9b0Zvcm0uZWxlbWVudHNbaV07dmFyIHNGaWVsZE5hbWU9b0ZpZWxkLmdldEF0dHJpYnV0ZShcIm5hbWVcIik/b0ZpZWxkLmdldEF0dHJpYnV0ZShcIm5hbWVcIik6b0ZpZWxkLmdldEF0dHJpYnV0ZShcImlkXCIpO2lmKHNGaWVsZE5hbWUmJigoIW9GaWVsZC5kaXNhYmxlZCl8fG9GaWVsZC50eXBlPT1cImhpZGRlblwiKSl7c3dpdGNoKG9GaWVsZC50eXBlKXtjYXNlXCJoaWRkZW5cIjpjYXNlXCJ0ZXh0XCI6Y2FzZVwidGV4dGFyZWFcIjpjYXNlXCJwYXNzd29yZFwiOnFzKz1zRmllbGROYW1lK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChvRmllbGQudmFsdWUpK1wiJlwiO2JyZWFrO2Nhc2VcInNlbGVjdC1vbmVcIjpxcys9c0ZpZWxkTmFtZStcIj1cIitlbmNvZGVVUklDb21wb25lbnQob0ZpZWxkLm9wdGlvbnNbb0ZpZWxkLnNlbGVjdGVkSW5kZXhdLnZhbHVlKStcIiZcIjticmVhaztjYXNlXCJzZWxlY3QtbXVsdGlwbGVcIjpmb3IodmFyIGo9MDtqPG9GaWVsZC5sZW5ndGg7aisrKXt2YXIgb3B0RWxlbT1vRmllbGQub3B0aW9uc1tqXTtpZihvcHRFbGVtLnNlbGVjdGVkPT09dHJ1ZSl7cXMrPXNGaWVsZE5hbWUrXCJbXVwiK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChvcHRFbGVtLnZhbHVlKStcIiZcIjt9fVxuYnJlYWs7Y2FzZVwiY2hlY2tib3hcIjpjYXNlXCJyYWRpb1wiOmlmKG9GaWVsZC5jaGVja2VkKXtxcys9c0ZpZWxkTmFtZStcIj1cIitlbmNvZGVVUklDb21wb25lbnQob0ZpZWxkLnZhbHVlKStcIiZcIjt9XG5icmVhazt9fX1cbnJldHVybiBxcy5zdWJzdHIoMCxxcy5sZW5ndGgtMSk7fTtTYXJpc3NhLnVwZGF0ZUNvbnRlbnRGcm9tRm9ybT1mdW5jdGlvbihvRm9ybSxvVGFyZ2V0RWxlbWVudCx4c2x0cHJvYyxjYWxsYmFjayl7dHJ5e1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwid2FpdFwiKTt2YXIgcGFyYW1zPVNhcmlzc2EuZm9ybVRvUXVlcnlTdHJpbmcob0Zvcm0pK1wiJlwiK1Nhcmlzc2EuUkVNT1RFX0NBTExfRkxBRytcIj10cnVlXCI7dmFyIHhtbGh0dHA9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7dmFyIGJVc2VHZXQ9b0Zvcm0uZ2V0QXR0cmlidXRlKFwibWV0aG9kXCIpJiZvRm9ybS5nZXRBdHRyaWJ1dGUoXCJtZXRob2RcIikudG9Mb3dlckNhc2UoKT09XCJnZXRcIjtpZihiVXNlR2V0KXt4bWxodHRwLm9wZW4oXCJHRVRcIixvRm9ybS5nZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIikrXCI/XCIrcGFyYW1zLHRydWUpO31cbmVsc2V7eG1saHR0cC5vcGVuKCdQT1NUJyxvRm9ybS5nZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIiksdHJ1ZSk7eG1saHR0cC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC10eXBlXCIsXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIik7eG1saHR0cC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1sZW5ndGhcIixwYXJhbXMubGVuZ3RoKTt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb25uZWN0aW9uXCIsXCJjbG9zZVwiKTt9XG54bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe3RyeXtpZih4bWxodHRwLnJlYWR5U3RhdGU9PTQpe3ZhciBvRG9tRG9jPXhtbGh0dHAucmVzcG9uc2VYTUw7aWYob0RvbURvYyYmU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvRG9tRG9jKT09U2FyaXNzYS5QQVJTRURfT0spe1Nhcmlzc2EudXBkYXRlQ29udGVudEZyb21Ob2RlKHhtbGh0dHAucmVzcG9uc2VYTUwsb1RhcmdldEVsZW1lbnQseHNsdHByb2MpO2lmKGNhbGxiYWNrKXtjYWxsYmFjayhvRm9ybSxvVGFyZ2V0RWxlbWVudCk7fX1cbmVsc2V7dGhyb3cgU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvRG9tRG9jKTt9fX1cbmNhdGNoKGUpe2lmKGNhbGxiYWNrKXtjYWxsYmFjayhvRm9ybSxvVGFyZ2V0RWxlbWVudCxlKTt9XG5lbHNle3Rocm93IGU7fX19O3htbGh0dHAuc2VuZChiVXNlR2V0P1wiXCI6cGFyYW1zKTt9XG5jYXRjaChlKXtTYXJpc3NhLnVwZGF0ZUN1cnNvcihvVGFyZ2V0RWxlbWVudCxcImF1dG9cIik7aWYoY2FsbGJhY2spe2NhbGxiYWNrKG9Gb3JtLG9UYXJnZXRFbGVtZW50LGUpO31cbmVsc2V7dGhyb3cgZTt9fVxucmV0dXJuIGZhbHNlO307U2FyaXNzYS5GVU5DVElPTl9OQU1FX1JFR0VYUD1uZXcgUmVnRXhwKFwiXCIpO1Nhcmlzc2EuZ2V0RnVuY3Rpb25OYW1lPWZ1bmN0aW9uKG9GdW5jLGJGb3JjZSl7dmFyIG5hbWU7aWYoIW5hbWUpe2lmKGJGb3JjZSl7bmFtZT1cIlNhcmlzc2FBbm9ueW1vdXNcIitTYXJpc3NhLl9nZXRVbmlxdWVTdWZmaXgoKTt3aW5kb3dbbmFtZV09b0Z1bmM7fVxuZWxzZXtuYW1lPW51bGw7fX1cbmlmKG5hbWUpe3dpbmRvd1tuYW1lXT1vRnVuYzt9XG5yZXR1cm4gbmFtZTt9O1Nhcmlzc2Euc2V0UmVtb3RlSnNvbkNhbGxiYWNrPWZ1bmN0aW9uKHVybCxjYWxsYmFjayxjYWxsYmFja1BhcmFtKXtpZighY2FsbGJhY2tQYXJhbSl7Y2FsbGJhY2tQYXJhbT1cImNhbGxiYWNrXCI7fVxudmFyIGNhbGxiYWNrRnVuY3Rpb25OYW1lPVNhcmlzc2EuZ2V0RnVuY3Rpb25OYW1lKGNhbGxiYWNrLHRydWUpO3ZhciBpZD1cInNhcmlzc2FfanNvbl9zY3JpcHRfaWRfXCIrU2FyaXNzYS5fZ2V0VW5pcXVlU3VmZml4KCk7dmFyIG9IZWFkPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXTt2YXIgc2NyaXB0VGFnPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO3NjcmlwdFRhZy50eXBlPSd0ZXh0L2phdmFzY3JpcHQnO3NjcmlwdFRhZy5pZD1pZDtzY3JpcHRUYWcub25sb2FkPWZ1bmN0aW9uKCl7fTtpZih1cmwuaW5kZXhPZihcIj9cIikhPS0xKXt1cmwrPShcIiZcIitjYWxsYmFja1BhcmFtK1wiPVwiK2NhbGxiYWNrRnVuY3Rpb25OYW1lKTt9XG5lbHNle3VybCs9KFwiP1wiK2NhbGxiYWNrUGFyYW0rXCI9XCIrY2FsbGJhY2tGdW5jdGlvbk5hbWUpO31cbnNjcmlwdFRhZy5zcmM9dXJsO29IZWFkLmFwcGVuZENoaWxkKHNjcmlwdFRhZyk7cmV0dXJuIGlkO307XG5cbi8vIHNhcmlzc2FfaWVlbXVfeHBhdGguanNcblxuaWYoU2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0ZFQVRVUkUmJmRvY3VtZW50LmltcGxlbWVudGF0aW9uLmhhc0ZlYXR1cmUoXCJYUGF0aFwiLFwiMy4wXCIpKXtTYXJpc3NhTm9kZUxpc3Q9ZnVuY3Rpb24oaSl7dGhpcy5sZW5ndGg9aTt9O1Nhcmlzc2FOb2RlTGlzdC5wcm90b3R5cGU9W107U2FyaXNzYU5vZGVMaXN0LnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1BcnJheTtTYXJpc3NhTm9kZUxpc3QucHJvdG90eXBlLml0ZW09ZnVuY3Rpb24oaSl7cmV0dXJuKGk8MHx8aT49dGhpcy5sZW5ndGgpP251bGw6dGhpc1tpXTt9O1Nhcmlzc2FOb2RlTGlzdC5wcm90b3R5cGUuZXhwcj1cIlwiO2lmKHdpbmRvdy5YTUxEb2N1bWVudCYmKCFYTUxEb2N1bWVudC5wcm90b3R5cGUuc2V0UHJvcGVydHkpKXtYTUxEb2N1bWVudC5wcm90b3R5cGUuc2V0UHJvcGVydHk9ZnVuY3Rpb24oeCx5KXt9O31cblNhcmlzc2Euc2V0WHBhdGhOYW1lc3BhY2VzPWZ1bmN0aW9uKG9Eb2Msc05zU2V0KXtvRG9jLl9zYXJpc3NhX3VzZUN1c3RvbVJlc29sdmVyPXRydWU7dmFyIG5hbWVzcGFjZXM9c05zU2V0LmluZGV4T2YoXCIgXCIpPi0xP3NOc1NldC5zcGxpdChcIiBcIik6W3NOc1NldF07b0RvYy5fc2FyaXNzYV94cGF0aE5hbWVzcGFjZXM9W107Zm9yKHZhciBpPTA7aTxuYW1lc3BhY2VzLmxlbmd0aDtpKyspe3ZhciBucz1uYW1lc3BhY2VzW2ldO3ZhciBjb2xvblBvcz1ucy5pbmRleE9mKFwiOlwiKTt2YXIgYXNzaWduUG9zPW5zLmluZGV4T2YoXCI9XCIpO2lmKGNvbG9uUG9zPjAmJmFzc2lnblBvcz5jb2xvblBvcysxKXt2YXIgcHJlZml4PW5zLnN1YnN0cmluZyhjb2xvblBvcysxLGFzc2lnblBvcyk7dmFyIHVyaT1ucy5zdWJzdHJpbmcoYXNzaWduUG9zKzIsbnMubGVuZ3RoLTEpO29Eb2MuX3Nhcmlzc2FfeHBhdGhOYW1lc3BhY2VzW3ByZWZpeF09dXJpO31lbHNle3Rocm93XCJCYWQgZm9ybWF0IG9uIG5hbWVzcGFjZSBkZWNsYXJhdGlvbihzKSBnaXZlblwiO319fTtYTUxEb2N1bWVudC5wcm90b3R5cGUuX3Nhcmlzc2FfdXNlQ3VzdG9tUmVzb2x2ZXI9ZmFsc2U7WE1MRG9jdW1lbnQucHJvdG90eXBlLl9zYXJpc3NhX3hwYXRoTmFtZXNwYWNlcz1bXTtYTUxEb2N1bWVudC5wcm90b3R5cGUuc2VsZWN0Tm9kZXM9ZnVuY3Rpb24oc0V4cHIsY29udGV4dE5vZGUscmV0dXJuU2luZ2xlKXt2YXIgbnNEb2M9dGhpczt2YXIgbnNyZXNvbHZlcjtpZih0aGlzLl9zYXJpc3NhX3VzZUN1c3RvbVJlc29sdmVyKXtuc3Jlc29sdmVyPWZ1bmN0aW9uKHByZWZpeCl7dmFyIHM9bnNEb2MuX3Nhcmlzc2FfeHBhdGhOYW1lc3BhY2VzW3ByZWZpeF07aWYocyl7cmV0dXJuIHM7fVxuZWxzZXt0aHJvd1wiTm8gbmFtZXNwYWNlIFVSSSBmb3VuZCBmb3IgcHJlZml4OiAnXCIrcHJlZml4K1wiJ1wiO319O31cbmVsc2V7bnNyZXNvbHZlcj10aGlzLmNyZWF0ZU5TUmVzb2x2ZXIodGhpcy5kb2N1bWVudEVsZW1lbnQpO31cbnZhciByZXN1bHQ9bnVsbDtpZighcmV0dXJuU2luZ2xlKXt2YXIgb1Jlc3VsdD10aGlzLmV2YWx1YXRlKHNFeHByLChjb250ZXh0Tm9kZT9jb250ZXh0Tm9kZTp0aGlzKSxuc3Jlc29sdmVyLFhQYXRoUmVzdWx0Lk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFLG51bGwpO3ZhciBub2RlTGlzdD1uZXcgU2FyaXNzYU5vZGVMaXN0KG9SZXN1bHQuc25hcHNob3RMZW5ndGgpO25vZGVMaXN0LmV4cHI9c0V4cHI7Zm9yKHZhciBpPTA7aTxub2RlTGlzdC5sZW5ndGg7aSsrKXtub2RlTGlzdFtpXT1vUmVzdWx0LnNuYXBzaG90SXRlbShpKTt9XG5yZXN1bHQ9bm9kZUxpc3Q7fVxuZWxzZXtyZXN1bHQ9dGhpcy5ldmFsdWF0ZShzRXhwciwoY29udGV4dE5vZGU/Y29udGV4dE5vZGU6dGhpcyksbnNyZXNvbHZlcixYUGF0aFJlc3VsdC5GSVJTVF9PUkRFUkVEX05PREVfVFlQRSxudWxsKS5zaW5nbGVOb2RlVmFsdWU7fVxucmV0dXJuIHJlc3VsdDt9O0VsZW1lbnQucHJvdG90eXBlLnNlbGVjdE5vZGVzPWZ1bmN0aW9uKHNFeHByKXt2YXIgZG9jPXRoaXMub3duZXJEb2N1bWVudDtpZihkb2Muc2VsZWN0Tm9kZXMpe3JldHVybiBkb2Muc2VsZWN0Tm9kZXMoc0V4cHIsdGhpcyk7fVxuZWxzZXt0aHJvd1wiTWV0aG9kIHNlbGVjdE5vZGVzIGlzIG9ubHkgc3VwcG9ydGVkIGJ5IFhNTCBFbGVtZW50c1wiO319O1hNTERvY3VtZW50LnByb3RvdHlwZS5zZWxlY3RTaW5nbGVOb2RlPWZ1bmN0aW9uKHNFeHByLGNvbnRleHROb2RlKXt2YXIgY3R4PWNvbnRleHROb2RlP2NvbnRleHROb2RlOm51bGw7cmV0dXJuIHRoaXMuc2VsZWN0Tm9kZXMoc0V4cHIsY3R4LHRydWUpO307RWxlbWVudC5wcm90b3R5cGUuc2VsZWN0U2luZ2xlTm9kZT1mdW5jdGlvbihzRXhwcil7dmFyIGRvYz10aGlzLm93bmVyRG9jdW1lbnQ7aWYoZG9jLnNlbGVjdFNpbmdsZU5vZGUpe3JldHVybiBkb2Muc2VsZWN0U2luZ2xlTm9kZShzRXhwcix0aGlzKTt9XG5lbHNle3Rocm93XCJNZXRob2Qgc2VsZWN0Tm9kZXMgaXMgb25seSBzdXBwb3J0ZWQgYnkgWE1MIEVsZW1lbnRzXCI7fX07U2FyaXNzYS5JU19FTkFCTEVEX1NFTEVDVF9OT0RFUz10cnVlO31cblxuLy8ganF1ZXJ5LnhzbHQuanNcblxudmFyIHhzbFRyYW5zZm9ybT17dmVyc2lvbjoyMDA3MTIwMyxkZWJ1ZzpmYWxzZSxpbml0OmZ1bmN0aW9uKCl7dHJ5e3BhcnNlRmxvYXQoalF1ZXJ5LmZuLmpxdWVyeSk+PTE7fWNhdGNoKGUpe2FsZXJ0KCd4c2xUcmFuc2Zvcm0gcmVxdWlyZXMgalF1ZXJ5IDEuMC40IG9yIGdyZWF0ZXIgLi4uIHBsZWFzZSBsb2FkIGl0IHByaW9yIHRvIHhzbFRyYW5zZm9ybScpO31cbnRyeXtTYXJpc3NhO31jYXRjaChlKXthbGVydCgnTWlzc2luZyBTYXJpc3NhIC4uLiBwbGVhc2UgbG9hZCBpdCBwcmlvciB0byB4c2xUcmFuc2Zvcm0nKTt9XG5pZighalF1ZXJ5LmxvZyl7alF1ZXJ5LmxvZz1mdW5jdGlvbigpe307alF1ZXJ5LmZuLmRlYnVnPWZ1bmN0aW9uKCl7fTt9XG5pZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ3hzbFRyYW5zZm9ybTppbml0KCk6IHZlcnNpb24gJyt4c2xUcmFuc2Zvcm0udmVyc2lvbik7fSxYTUxTZXJpYWxpemVyOm5ldyBYTUxTZXJpYWxpemVyKCksc2VyaWFsaXplOmZ1bmN0aW9uKGRhdGEpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnc2VyaWFsaXplKCk6IHJlY2VpdmVkICcrdHlwZW9mKGRhdGEpKTtpZih0eXBlb2YoZGF0YSk9PSdzdHJpbmcnKXtyZXR1cm4gZGF0YTt9XG5yZXR1cm4gdGhpcy5YTUxTZXJpYWxpemVyLnNlcmlhbGl6ZVRvU3RyaW5nKGRhdGEpO30sbG9hZDpmdW5jdGlvbih4bWwsbWV0aCl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdsb2FkKCk6IHJlY2VpdmVkICcrdHlwZW9mKHhtbCkpO3ZhciByO2lmKHR5cGVvZih4bWwpPT0nb2JqZWN0Jyl7cmV0dXJuIHhtbDt9XG5pZih4bWwuc3Vic3RyaW5nKDAsMSk9PSc8Jyl7cj10aGlzLmxvYWRTdHJpbmcoeG1sKTt9ZWxzZXtyPXRoaXMubG9hZEZpbGUoeG1sLG1ldGgpO31cbmlmKHIpe3Iuc2V0UHJvcGVydHkoJ1NlbGVjdGlvbk5hbWVzcGFjZXMnLCd4bWxuczp4c2w9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm1cIicpO3Iuc2V0UHJvcGVydHkoJ1NlbGVjdGlvbkxhbmd1YWdlJywnWFBhdGgnKTtyZXR1cm4gcjt9ZWxzZXtpZih0aGlzLmRlYnVnKSQubG9nKCdVbmFibGUgdG8gbG9hZCAnK3htbCk7cmV0dXJuIGZhbHNlO319LGxvYWRTdHJpbmc6ZnVuY3Rpb24oc3RyKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ2xvYWRTdHJpbmcoKTogJytzdHIrJzo6Jyt0eXBlb2Yoc3RyKSk7dmFyIHA9bmV3IERPTVBhcnNlcigpO3ZhciB4bWw9cC5wYXJzZUZyb21TdHJpbmcoc3RyLCd0ZXh0L3htbCcpO2lmKCF4bWwpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZFN0cmluZygpOiBwYXJzZUZyb21TdHJpbmcoKSBmYWlsZWQnKTtyZXR1cm4gZmFsc2U7fVxucmV0dXJuIHhtbDt9LGxvYWRGaWxlOmZ1bmN0aW9uKHVybCxtZXRoKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ2xvYWRGaWxlKCk6ICcrdXJsKyc6OicrdHlwZW9mKHVybCkpO2lmKCF1cmwpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnRVJST1I6IGxvYWRGaWxlKCkgbWlzc2luZyB1cmwnKTtyZXR1cm4gZmFsc2U7fVxudmFyIGRvYzt0aGlzLnhocnN1Y2Nlc3M9ZnVuY3Rpb24oZGF0YSxzdHIpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZEZpbGUoKSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5ICgnK3N0cisnKScpO2RvYz1kYXRhO3JldHVybiB0cnVlO307dGhpcy54aHJlcnJvcj1mdW5jdGlvbih4aHIsZXJyKXt3aW5kb3cuREVCVUc9dHJ1ZTtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ2xvYWRGaWxlKCkgZmFpbGVkIHRvIGxvYWQgdGhlIHJlcXVlc3RlZCBmaWxlOiAoJytlcnIrJykgLSB4bWw6ICcreGhyLnJlc3BvbnNlWE1MKycgLSB0ZXh0OiAnK3hoci5yZXNwb25zZVRleHQpO2RvYz1udWxsO3JldHVybiBmYWxzZTt9O2lmKCFtZXRoKW1ldGg9XCJHRVRcIjskLmFqYXgoe3R5cGU6bWV0aCx1cmw6dXJsLGFzeW5jOmZhbHNlLHN1Y2Nlc3M6dGhpcy54aHJzdWNjZXNzLGVycm9yOnRoaXMueGhyZXJyb3J9KTtpZighZG9jKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ0VSUk9SOiBkb2N1bWVudCAnK3VybCsnIG5vdCBmb3VuZCAoNDA0KSwgb3IgdW5hYmxlIHRvIGxvYWQnKTtyZXR1cm4gZmFsc2U7fVxuaWYoZG9jLmxlbmd0aD09MCl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdFUlJPUjogZG9jdW1lbnQgJyt1cmwrJyBsb2FkZWQgaW4gbG9hZEZpbGUoKSBoYXMgbm8gZGF0YScpO3JldHVybiBmYWxzZTt9XG5yZXR1cm4gZG9jO30sdHJhbnNmb3JtOmZ1bmN0aW9uKHhzbCx4bWwsb3B0aW9ucyl7dmFyIGxvZz17J3hzbCc6eHNsLCd4bWwnOnhtbCwnb3B0aW9ucyc6b3B0aW9uc307aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCd0cmFuc2Zvcm0oKTogJyt4c2wrJzo6Jyt4bWwrJzo6JytvcHRpb25zLnRvU3RyaW5nKCkpO29wdGlvbnM9b3B0aW9uc3x8e307dmFyIHhtbD17J3JlcXVlc3QnOnhtbCwnZG9jJzp0aGlzLmxvYWQoeG1sLG9wdGlvbnMubWV0aCl9O2lmKG9wdGlvbnMueHBhdGgmJnhtbC5kb2MmJiFqUXVlcnkuYnJvd3Nlci5tc2llKXt4bWwuZG9jPXhtbC5kb2Muc2VsZWN0U2luZ2xlTm9kZShvcHRpb25zLnhwYXRoLnRvU3RyaW5nKCkpO2lmKHRoaXMuZGVidWcpJC5sb2coJ3RyYW5zZm9ybSgpOiB4cGF0aCBoYXMgYmVlbiBydW4uLi5yZXN1bHRpbmcgZG9jOiAnKyh0aGlzLnNlcmlhbGl6ZSh4bWwuZG9jKSkpO31cbnZhciByZXN1bHQ9eyd4c2wnOnRoaXMubG9hZCh4c2wsb3B0aW9ucy5tZXRoKX07cmVzdWx0Lmpzb249ZmFsc2U7aWYob3B0aW9ucy5qc29uJiZ4bWwuZG9jKXtyZXN1bHQuanNvbj14bWwuZG9jLnNlbGVjdFNpbmdsZU5vZGUob3B0aW9ucy5qc29uLnRvU3RyaW5nKCkpO31cbnZhciBwcm9jZXNzb3I9bmV3IFhTTFRQcm9jZXNzb3IoKTtwcm9jZXNzb3IuaW1wb3J0U3R5bGVzaGVldChyZXN1bHQueHNsKTtpZihvcHRpb25zLnBhcmFtcyYmcHJvY2Vzc29yKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ3RyYW5zZm9ybSgpOiByZWNlaXZlZCB4c2wgcGFyYW1zOiAnK29wdGlvbnMucGFyYW1zLnRvU3RyaW5nKCkpO2ZvcihrZXkgaW4gb3B0aW9ucy5wYXJhbXMpe3Byb2Nlc3Nvci5zZXRQYXJhbWV0ZXIobnVsbCxrZXkudG9TdHJpbmcoKSxvcHRpb25zLnBhcmFtc1trZXldLnRvU3RyaW5nKCkpO319XG5yZXN1bHQuZG9jPXByb2Nlc3Nvci50cmFuc2Zvcm1Ub0RvY3VtZW50KHhtbC5kb2MpO3ZhciBlcnJvclR4dD1TYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KHJlc3VsdC5kb2MpO2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygndHJhbnNmb3JtKCk6IFNhcmlzc2EgcGFyc2UgdGV4dDogJytlcnJvclR4dCk7aWYoZXJyb3JUeHQhPVNhcmlzc2EuUEFSU0VEX09LKXtyZXN1bHQuc3RyaW5nPVNhcmlzc2EuZ2V0UGFyc2VFcnJvclRleHQocmVzdWx0LmRvYykrJyA6OiB1c2luZyAnK3hzbCsnID0+ICcreG1sLnJlcXVlc3Q7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCd0cmFuc2Zvcm0oKTogZXJyb3IgaW4gdHJhbnNmb3JtYXRpb246ICcrU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChyZXN1bHQuZG9jKSk7cmV0dXJuIHJlc3VsdDt9XG5yZXN1bHQuc3RyaW5nPXRoaXMuc2VyaWFsaXplKHJlc3VsdC5kb2MpO3Jlc3VsdC5zY3JpcHRzPWpRdWVyeSgnc2NyaXB0JyxyZXN1bHQuZG9jKS50ZXh0KCk7cmV0dXJuIHJlc3VsdDt9fTt4c2xUcmFuc2Zvcm0uaW5pdCgpO2pRdWVyeS5mbi5nZXRUcmFuc2Zvcm09ZnVuY3Rpb24oeHNsLHhtbCxvcHRpb25zKXt2YXIgc2V0dGluZ3M9e2FwcGVuZDpmYWxzZSxwYXJhbXM6e30seHBhdGg6JycsZXZhbDp0cnVlLGNhbGxiYWNrOicnLGpzb246ZmFsc2UsbWV0aDpcIkdFVFwifTtqUXVlcnkuZXh0ZW5kKHNldHRpbmdzLG9wdGlvbnMpO2lmKHhzbFRyYW5zZm9ybS5kZWJ1ZylqUXVlcnkubG9nKCdnZXRUcmFuc2Zvcm06ICcreHNsKyc6OicreG1sKyc6Oicrc2V0dGluZ3MudG9TdHJpbmcoKSk7aWYoIXhzbHx8IXhtbCl7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ2dldFRyYW5zZm9ybTogbWlzc2luZyB4c2wgb3IgeG1sJyk7cmV0dXJuO31cbnJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdHJhbnM9eHNsVHJhbnNmb3JtLnRyYW5zZm9ybSh4c2wseG1sLHNldHRpbmdzKTt2YXIgcmU9dHJhbnMuc3RyaW5nLm1hdGNoKC88XFw/eG1sLio/XFw/Pi8pO2lmKHJlKXt0cmFucy5zdHJpbmc9dHJhbnMuc3RyaW5nLnJlcGxhY2UocmUsJycpO2lmKHhzbFRyYW5zZm9ybS5kZWJ1ZylqUXVlcnkubG9nKCdnZXRUcmFuc2Zvcm0oKTogZm91bmQgYW4geG1sIGRlY2xhcmF0aW9uIGFuZCByZW1vdmVkIGl0Jyk7fVxudHJ5e2lmKHNldHRpbmdzLmFwcGVuZCkkKHRoaXMpLmFwcGVuZCh0cmFucy5zdHJpbmcpO2Vsc2UgaWYoc2V0dGluZ3MucmVwbCkkKHRoaXMpLnJlcGxhY2VXaXRoKHRyYW5zLnN0cmluZyk7ZWxzZSAkKHRoaXMpLmh0bWwodHJhbnMuc3RyaW5nKTt9Y2F0Y2goZSl7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKSQubG9nKCdnZXRUcmFuc2Zvcm06IGVycm9yIHBsYWNpbmcgcmVzdWx0cyBvZiB0cmFuc2Zvcm0gaW50byBlbGVtZW50LCBmYWxsaW5nIGJhY2sgdG8gaW5uZXJIVE1MOiAnK2UudG9TdHJpbmcoKSk7JCh0aGlzKVswXS5pbm5lckhUTUw9dHJhbnMuc3RyaW5nO31cbmlmKHNldHRpbmdzLmV2YWwmJnRyYW5zLnNjcmlwdHMpe2lmKHRyYW5zLnNjcmlwdHMubGVuZ3RoPjApe2lmKHhzbFRyYW5zZm9ybS5kZWJ1ZylqUXVlcnkubG9nKCdGb3VuZCB0ZXh0L2phdmFzY3JpcHQgaW4gdHJhbnNmb3JtZWQgcmVzdWx0Jyk7ZXZhbC5jYWxsKHdpbmRvdyx0cmFucy5zY3JpcHRzKTt9fVxuaWYoc2V0dGluZ3MuY2FsbGJhY2smJmpRdWVyeS5pc0Z1bmN0aW9uKHNldHRpbmdzLmNhbGxiYWNrKSl7dmFyIGpzb249ZmFsc2U7aWYoc2V0dGluZ3MuanNvbiYmdHJhbnMuanNvbilldmFsKFwianNvbiA9IFwiK3RyYW5zLmpzb24uZmlyc3RDaGlsZC5kYXRhKTtzZXR0aW5ncy5jYWxsYmFjay5hcHBseSh3aW5kb3csW3RyYW5zLnN0cmluZyxqc29uXSk7fX0pO307XG5cbi8vIGpxdWVyeS5tZXRhZGF0YS5qc1xuXG4oZnVuY3Rpb24oJCl7JC5leHRlbmQoe21ldGFkYXRhOntkZWZhdWx0czp7dHlwZTonY2xhc3MnLG5hbWU6J21ldGFkYXRhJyxjcmU6Lyh7Lip9KS8sc2luZ2xlOidtZXRhZGF0YSd9LHNldFR5cGU6ZnVuY3Rpb24odHlwZSxuYW1lKXt0aGlzLmRlZmF1bHRzLnR5cGU9dHlwZTt0aGlzLmRlZmF1bHRzLm5hbWU9bmFtZTt9LGdldDpmdW5jdGlvbihlbGVtLG9wdHMpe3ZhciBzZXR0aW5ncz0kLmV4dGVuZCh7fSx0aGlzLmRlZmF1bHRzLG9wdHMpO2lmKCFzZXR0aW5ncy5zaW5nbGUubGVuZ3RoKXNldHRpbmdzLnNpbmdsZT0nbWV0YWRhdGEnO3ZhciBkYXRhPSQuZGF0YShlbGVtLHNldHRpbmdzLnNpbmdsZSk7aWYoZGF0YSlyZXR1cm4gZGF0YTtkYXRhPVwie31cIjtpZihzZXR0aW5ncy50eXBlPT1cImNsYXNzXCIpe3ZhciBtPXNldHRpbmdzLmNyZS5leGVjKGVsZW0uY2xhc3NOYW1lKTtpZihtKVxuZGF0YT1tWzFdO31lbHNlIGlmKHNldHRpbmdzLnR5cGU9PVwiZWxlbVwiKXtpZighZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSlcbnJldHVybiB1bmRlZmluZWQ7dmFyIGU9ZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZShzZXR0aW5ncy5uYW1lKTtpZihlLmxlbmd0aClcbmRhdGE9JC50cmltKGVbMF0uaW5uZXJIVE1MKTt9ZWxzZSBpZihlbGVtLmdldEF0dHJpYnV0ZSE9dW5kZWZpbmVkKXt2YXIgYXR0cj1lbGVtLmdldEF0dHJpYnV0ZShzZXR0aW5ncy5uYW1lKTtpZihhdHRyKVxuZGF0YT1hdHRyO31cbmlmKGRhdGEuaW5kZXhPZigneycpPDApXG5kYXRhPVwie1wiK2RhdGErXCJ9XCI7ZGF0YT1ldmFsKFwiKFwiK2RhdGErXCIpXCIpOyQuZGF0YShlbGVtLHNldHRpbmdzLnNpbmdsZSxkYXRhKTtyZXR1cm4gZGF0YTt9fX0pOyQuZm4ubWV0YWRhdGE9ZnVuY3Rpb24ob3B0cyl7cmV0dXJuICQubWV0YWRhdGEuZ2V0KHRoaXNbMF0sb3B0cyk7fTt9KShqUXVlcnkpO1xuXG4vLyBqcXVlcnkuY29va2llLmpzXG5cbmpRdWVyeS5jb29raWU9ZnVuY3Rpb24obmFtZSx2YWx1ZSxvcHRpb25zKXtpZih0eXBlb2YgdmFsdWUhPSd1bmRlZmluZWQnKXtvcHRpb25zPW9wdGlvbnN8fHt9O2lmKHZhbHVlPT09bnVsbCl7dmFsdWU9Jyc7b3B0aW9ucy5leHBpcmVzPS0xO31cbnZhciBleHBpcmVzPScnO2lmKG9wdGlvbnMuZXhwaXJlcyYmKHR5cGVvZiBvcHRpb25zLmV4cGlyZXM9PSdudW1iZXInfHxvcHRpb25zLmV4cGlyZXMudG9VVENTdHJpbmcpKXt2YXIgZGF0ZTtpZih0eXBlb2Ygb3B0aW9ucy5leHBpcmVzPT0nbnVtYmVyJyl7ZGF0ZT1uZXcgRGF0ZSgpO2RhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSsob3B0aW9ucy5leHBpcmVzKjI0KjYwKjYwKjEwMDApKTt9ZWxzZXtkYXRlPW9wdGlvbnMuZXhwaXJlczt9XG5leHBpcmVzPSc7IGV4cGlyZXM9JytkYXRlLnRvVVRDU3RyaW5nKCk7fVxudmFyIHBhdGg9b3B0aW9ucy5wYXRoPyc7IHBhdGg9Jysob3B0aW9ucy5wYXRoKTonJzt2YXIgZG9tYWluPW9wdGlvbnMuZG9tYWluPyc7IGRvbWFpbj0nKyhvcHRpb25zLmRvbWFpbik6Jyc7dmFyIHNlY3VyZT1vcHRpb25zLnNlY3VyZT8nOyBzZWN1cmUnOicnO2RvY3VtZW50LmNvb2tpZT1bbmFtZSwnPScsZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSxleHBpcmVzLHBhdGgsZG9tYWluLHNlY3VyZV0uam9pbignJyk7fWVsc2V7dmFyIGNvb2tpZVZhbHVlPW51bGw7aWYoZG9jdW1lbnQuY29va2llJiZkb2N1bWVudC5jb29raWUhPScnKXt2YXIgY29va2llcz1kb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtmb3IodmFyIGk9MDtpPGNvb2tpZXMubGVuZ3RoO2krKyl7dmFyIGNvb2tpZT1qUXVlcnkudHJpbShjb29raWVzW2ldKTtpZihjb29raWUuc3Vic3RyaW5nKDAsbmFtZS5sZW5ndGgrMSk9PShuYW1lKyc9Jykpe2Nvb2tpZVZhbHVlPWRlY29kZVVSSUNvbXBvbmVudChjb29raWUuc3Vic3RyaW5nKG5hbWUubGVuZ3RoKzEpKTticmVhazt9fX1cbnJldHVybiBjb29raWVWYWx1ZTt9fTsiLCIvKlxuICoganNUcmVlIDAuOS41XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDA4IEl2YW4gQm96aGFub3YgKHZha2F0YS5jb20pXG4gKlxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXM6XG4gKiAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG4gKiAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbFxuICpcbiAqIERhdGU6IDIwMDktMDEtMDNcbiAqXG4gKi9cbi8vanNoaW50IGlnbm9yZTpzdGFydFxuLy9qc2NzOmRpc2FibGVcblxuLy8gYnJvd3NlciBmaXhcbihmdW5jdGlvbiAoJCkge1xuICAgICQuYnJvd3NlciA9IHt9O1xuICAgICQuYnJvd3Nlci5tb3ppbGxhID0gL21vemlsbGEvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKSAmJiAhL3dlYmtpdC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpO1xuICAgICQuYnJvd3Nlci53ZWJraXQgPSAvd2Via2l0Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG4gICAgJC5icm93c2VyLm9wZXJhID0gL29wZXJhLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG4gICAgJC5icm93c2VyLm1zaWUgPSAvbXNpZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpO1xuXG4gICAgLy8galF1ZXJ5IHBsdWdpblxuICAgICQuZm4udHJlZSA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZih0cmVlX2NvbXBvbmVudC5pbnN0ICYmIHRyZWVfY29tcG9uZW50Lmluc3RbJCh0aGlzKS5hdHRyKCdpZCcpXSkge1xuICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50Lmluc3RbJCh0aGlzKS5hdHRyKCdpZCcpXS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihvcHRzICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHZhciB0bXAgPSBuZXcgdHJlZV9jb21wb25lbnQoKTtcbiAgICAgICAgICAgICAgICB0bXAuaW5pdCh0aGlzLCBvcHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvLyBjb3JlXG4gICAgd2luZG93LnRyZWVfY29tcG9uZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBpbnN0YW5jZSBtYW5hZ2VyXG4gICAgICAgIGlmKHR5cGVvZiB0cmVlX2NvbXBvbmVudC5pbnN0ID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmNudHIgPSAwO1xuICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuaW5zdCA9IFtdO1xuICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuZHJvcCA9IFtdO1xuXG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5mb2N1c0luc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyZWVfY29tcG9uZW50Lmluc3RbdHJlZV9jb21wb25lbnQuZm9jdXNlZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5tb3VzZWRvd24gPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5hdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicsICdub25lJyk7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdHJlZV9jb21wb25lbnQuZm9jdXNJbnN0KCk7XG4gICAgICAgICAgICAgICAgaWYoIV90aGlzKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gJChldmVudC50YXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LmRyb3AubGVuZ3RoICYmIHRtcC5pcyhcIi5cIiArIHRyZWVfY29tcG9uZW50LmRyb3Auam9pbihcIiwgLlwiKSkgKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWcgPSAkKFwiPGxpIGlkPSdkcmFnZ2VkJyBjbGFzcz0nZHJhZ2dlZCBmb3JlaWduIFwiICsgZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSArIFwiJz48YSBocmVmPScjJz5cIiArIHRtcC50ZXh0KCkgKyBcIjwvYT48L2xpPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2RyYWcgPSBfdGhpcy5kcmFnO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pc2Rvd24gICAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5mb3JlaWduICAgID0gdG1wO1xuICAgICAgICAgICAgICAgICAgICB0bXAuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5tb3VzZXVwID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAkKCdodG1sJykucmVtb3ZlQXR0cignZGF0YS10b3VjaC1hY3Rpb24nKTtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0cmVlX2NvbXBvbmVudC5mb2N1c0luc3QoKTtcbiAgICAgICAgICAgICAgICBpZighX3RoaXMpIHJldHVybjtcblxuXG4gICAgICAgICAgICAgICAgLy8gQ0xFQVIgVElNRU9VVCBGT1IgT1BFTklORyBIT1ZFUkVEIE5PREVTIFdISUxFIERSQUdHSU5HXG4gICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQudG8pICAgIGNsZWFyVGltZW91dCh0cmVlX2NvbXBvbmVudC50byk7XG4gICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuc3RvKSAgICBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQuc3RvKTtcbiAgICAgICAgICAgICAgICBpZihfdGhpcy5mb3JlaWduID09PSBmYWxzZSAmJiBfdGhpcy5kcmFnICYmIF90aGlzLmRyYWcucGFyZW50Tm9kZSAmJiBfdGhpcy5kcmFnLnBhcmVudE5vZGUgPT0gJChfdGhpcy5jb250YWluZXIpLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuZ2V0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIENBTEwgRlVOQ1RJT04gRk9SIENPTVBMRVRJTkcgTU9WRVxuICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5tb3ZlVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IHRyZWVfY29tcG9uZW50Lmluc3RbJChfdGhpcy5tb3ZlUmVmKS5wYXJlbnRzKFwiLnRyZWU6ZXEoMClcIikuYXR0cihcImlkXCIpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRtcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5tb3ZlZChfdGhpcy5jb250YWluZXIuZmluZChcImxpLmRyYWdnZWRcIiksIF90aGlzLm1vdmVSZWYsIF90aGlzLm1vdmVUeXBlLCBmYWxzZSwgKF90aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdfY29weSA9PSBcIm9uXCIgfHwgKF90aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdfY29weSA9PSBcImN0cmxcIiAmJiBldmVudC5jdHJsS2V5KSApICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihfdGhpcy5kcmFnICYmIF90aGlzLmZvcmVpZ24gIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLm1vdmVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdHJlZV9jb21wb25lbnQuaW5zdFskKF90aGlzLm1vdmVSZWYpLnBhcmVudHMoXCIudHJlZTplcSgwKVwiKS5hdHRyKFwiaWRcIildO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodG1wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnNldHRpbmdzLmNhbGxiYWNrLm9uZHJvcC5jYWxsKG51bGwsIF90aGlzLmZvcmVpZ24uZ2V0KDApLCBfdGhpcy5nZXRfbm9kZSggX3RoaXMubW92ZVJlZikuZ2V0KDApLCBfdGhpcy5tb3ZlVHlwZSwgX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZvcmVpZ24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBSRVNFVCBFVkVSWVRISU5HXG4gICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgIF90aGlzLl9kcmFnICAgICAgICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIF90aGlzLmRyYWcgICAgICAgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgX3RoaXMuaXNkb3duICAgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgX3RoaXMuYXBwZW5kZWQgICAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpcy5jb250YWluZXIuZmluZChcImxpLmRyYWdnZWRcIikucmVtb3ZlQ2xhc3MoXCJkcmFnZ2VkXCIpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50Lm1vdXNlbW92ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdHJlZV9jb21wb25lbnQuZm9jdXNJbnN0KCk7XG4gICAgICAgICAgICAgICAgaWYoIV90aGlzKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICBpZihfdGhpcy5pc2Rvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ0xFQVIgVElNRU9VVCBGT1IgT1BFTklORyBIT1ZFUkVEIE5PREVTIFdISUxFIERSQUdHSU5HXG4gICAgICAgICAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LnRvKSBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQudG8pO1xuICAgICAgICAgICAgICAgICAgICBpZighX3RoaXMuYXBwZW5kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5jaGlsZHJlbihcInVsOmVxKDApXCIpLmFwcGVuZChfdGhpcy5kcmFnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSAkKF90aGlzLmRyYWcpLm9mZnNldFBhcmVudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodG1wLmlzKFwiaHRtbFwiKSkgdG1wID0gJChcImJvZHlcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5wbyA9IHRtcC5vZmZzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmFwcGVuZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkKF90aGlzLmRyYWcpLmNzcyh7IFwibGVmdFwiIDogKGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVggLSBfdGhpcy5wby5sZWZ0IC0gKF90aGlzLnNldHRpbmdzLnVpLnJ0bCA/ICQoX3RoaXMuZHJhZykud2lkdGgoKSA6IC01ICkgKSwgXCJ0b3BcIiA6IChldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gX3RoaXMucG8udG9wICArICgkLmJyb3dzZXIub3BlcmEgPyBfdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgOiAwKSArIDE1KSB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZihldmVudC50YXJnZXQudGFnTmFtZSA9PSBcIklNR1wiICYmIGV2ZW50LnRhcmdldC5pZCA9PSBcIm1hcmtlclwiKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGNudCA9ICQoZXZlbnQudGFyZ2V0KS5wYXJlbnRzKFwiLnRyZWU6ZXEoMClcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IG1vdmluZyBvdmVyIGEgdHJlZVxuICAgICAgICAgICAgICAgICAgICBpZihjbnQuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LnN0bykgY2xlYXJUaW1lb3V0KHRyZWVfY29tcG9uZW50LnN0byk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkKF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiSU1HXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChfdGhpcy5kcmFnKS5hcHBlbmQoXCI8aW1nIGNsYXNzPSdyZW1vdmVpY29uJyBzdHlsZT0ncG9zaXRpb246YWJzb2x1dGU7IFwiICsgKF90aGlzLnNldHRpbmdzLnVpLnJ0bCA/IFwicmlnaHRcIiA6IFwibGVmdFwiICkgKyBcIjo0cHg7IHRvcDowcHg7JyBzcmM9J1wiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9yZW1vdmUuZ2lmJyAvPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVUeXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuaW5zdFtjbnQuYXR0cihcImlkXCIpXS5vZmZfaGVpZ2h0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbW92aW5nIG92ZXIgYW5vdGhlciB0cmVlIGFuZCBtdWx0aXRyZWUgaXMgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgaWYoIF90aGlzLmZvcmVpZ24gPT09IGZhbHNlICYmIGNudC5nZXQoMCkgIT0gX3RoaXMuY29udGFpbmVyLmdldCgwKSAmJiAoIV90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpdHJlZSB8fCAhdHJlZV9jb21wb25lbnQuaW5zdFtjbnQuYXR0cihcImlkXCIpXS5zZXR0aW5ncy5ydWxlcy5tdWx0aXRyZWUpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJChfdGhpcy5kcmFnKS5jaGlsZHJlbihcIklNR1wiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykuYXBwZW5kKFwiPGltZyBjbGFzcz0ncmVtb3ZlaWNvbicgc3R5bGU9J3Bvc2l0aW9uOmFic29sdXRlOyBcIiArIChfdGhpcy5zZXR0aW5ncy51aS5ydGwgPyBcInJpZ2h0XCIgOiBcImxlZnRcIiApICsgXCI6NHB4OyB0b3A6MHB4Oycgc3JjPSdcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcmVtb3ZlLmdpZicgLz5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LnN0bykgY2xlYXJUaW1lb3V0KHRyZWVfY29tcG9uZW50LnN0byk7XG4gICAgICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LnN0byA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgeyB0cmVlX2NvbXBvbmVudC5pbnN0W2NudC5hdHRyKFwiaWRcIildLnNjcm9sbENoZWNrKGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVgsZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSk7IH0sIDUwKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbW92ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdCA9IGNudC5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZihldmVudC50YXJnZXQudGFnTmFtZSA9PSBcIkFcIiAmJiBldmVudC50YXJnZXQuY2xhc3NOYW1lPT1cInRpdGxlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGp1c3QgaW4gY2FzZSBpZiBob3ZlciBpcyBvdmVyIHRoZSBkcmFnZ2FibGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoZXZlbnQudGFyZ2V0KS5pcyhcIiNkcmFnZ2VkXCIpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnb1RvID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggOiAoJChldmVudC50YXJnZXQpLm9mZnNldCgpLmxlZnQgLSAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5IDogKGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVkgLSB0cmVlX2NvbXBvbmVudC5pbnN0W2NudC5hdHRyKFwiaWRcIildLm9mZnNldC50b3ApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihjbnQuaGFzQ2xhc3MoXCJydGxcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnggKz0gJChldmVudC50YXJnZXQpLndpZHRoKCkgLSA4O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIChnb1RvLnkgKyBzdCklX3RoaXMubGlfaGVpZ2h0IDwgX3RoaXMubGlfaGVpZ2h0LzMgKyAxICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdiA9IFwiYmVmb3JlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29Uby55ID0gZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSAtIChnb1RvLnkgKyBzdCklX3RoaXMubGlfaGVpZ2h0IC0gMiA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKChnb1RvLnkgKyBzdCklX3RoaXMubGlfaGVpZ2h0ID4gX3RoaXMubGlfaGVpZ2h0KjIvMyAtIDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ID0gXCJhZnRlclwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvVG8ueSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVkgLSAoZ29Uby55ICsgc3QpJV90aGlzLmxpX2hlaWdodCArIF90aGlzLmxpX2hlaWdodCAtIDIgO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ID0gXCJpbnNpZGVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnggLT0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjbnQuaGFzQ2xhc3MoXCJydGxcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29Uby54ICs9IDM2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnkgPSBldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gKGdvVG8ueSArIHN0KSVfdGhpcy5saV9oZWlnaHQgKyBNYXRoLmZsb29yKF90aGlzLmxpX2hlaWdodC8yKSAtIDIgO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmdldF9ub2RlKGV2ZW50LnRhcmdldCkuaGFzQ2xhc3MoXCJjbG9zZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQudG8gPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7IF90aGlzLm9wZW5fYnJhbmNoKF90aGlzLmdldF9ub2RlKGV2ZW50LnRhcmdldCkpOyB9LCA1MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuaW5zdFtjbnQuYXR0cihcImlkXCIpXS5jaGVja01vdmUoX3RoaXMuY29udGFpbmVyLmZpbmQoXCJsaS5kcmFnZ2VkXCIpLCAkKGV2ZW50LnRhcmdldCksIG1vdikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihtb3YgPT0gXCJpbnNpZGVcIikgICAgJChcIiNtYXJrZXJcIikuYXR0cihcInNyY1wiLCBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L3BsdXMuZ2lmXCIpLndpZHRoKDE0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY250Lmhhc0NsYXNzKFwicnRsXCIpKSAgICB7ICQoXCIjbWFya2VyXCIpLmF0dHIoXCJzcmNcIiwgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9tYXJrZXJfcnRsLmdpZlwiKS53aWR0aCg0MCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgeyAkKFwiI21hcmtlclwiKS5hdHRyKFwic3JjXCIsIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvbWFya2VyLmdpZlwiKS53aWR0aCg0MCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgICAgPSBtb3Y7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiAgICA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiSU1HXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbWFya2VyXCIpLmNzcyh7IFwibGVmdFwiIDogZ29Uby54LTEgLCBcInRvcFwiIDogZ29Uby55LTIgfSkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJChfdGhpcy5kcmFnKS5jaGlsZHJlbihcIklNR1wiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF90aGlzLmRyYWcpLmFwcGVuZChcIjxpbWcgY2xhc3M9J3JlbW92ZWljb24nIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTsgXCIgKyAoX3RoaXMuc2V0dGluZ3MudWkucnRsID8gXCJyaWdodDowcHg7XCIgOiBcImxlZnQ6NHB4O1wiICkgKyBcIiB0b3A6MHB4Oycgc3JjPSdcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcmVtb3ZlLmdpZicgLz5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVUeXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoX3RoaXMuZHJhZykuY2hpbGRyZW4oXCJJTUdcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF90aGlzLmRyYWcpLmFwcGVuZChcIjxpbWcgY2xhc3M9J3JlbW92ZWljb24nIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTsgXCIgKyAoX3RoaXMuc2V0dGluZ3MudWkucnRsID8gXCJyaWdodDowcHg7XCIgOiBcImxlZnQ6NHB4O1wiICkgKyBcIiB0b3A6MHB4Oycgc3JjPSdcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcmVtb3ZlLmdpZicgLz5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY250ciA6IHRyZWVfY29tcG9uZW50LmNudHIgKyssXG4gICAgICAgICAgICBzZXR0aW5ncyA6IHtcbiAgICAgICAgICAgICAgICBkYXRhICAgIDoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlICAgIDogXCJwcmVkZWZpbmVkXCIsICAgIC8vIEVOVU0gW2pzb24sIHhtbF9mbGF0LCB4bWxfbmVzdGVkLCBwcmVkZWZpbmVkXVxuICAgICAgICAgICAgICAgICAgICBtZXRob2QgICAgOiBcIkdFVFwiLCAgICAgICAgLy8gSE9XIFRPIFJFUVVFU1QgRklMRVNcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgICAgOiBmYWxzZSwgICAgICAgIC8vIEJPT0wgLSBhc3luYyBsb2FkaW5nIG9ub3BlblxuICAgICAgICAgICAgICAgICAgICBhc3luY19kYXRhIDogZnVuY3Rpb24gKE5PREUpIHsgcmV0dXJuIHsgaWQgOiAkKE5PREUpLmF0dHIoXCJpZFwiKSB8fCAwIH0gfSwgLy8gUEFSQU1FVEVSUyBQQVNTRUQgVE8gU0VSVkVSXG4gICAgICAgICAgICAgICAgICAgIHVybCAgICAgICAgOiBmYWxzZSwgICAgICAgIC8vIEZBTFNFIG9yIFNUUklORyAtIHVybCB0byBkb2N1bWVudCB0byBiZSB1c2VkIChhc3luYyBvciBub3QpXG4gICAgICAgICAgICAgICAgICAgIGpzb24gICAgOiBmYWxzZSAgICAgICAgICAgIC8vIEZBTFNFIG9yIE9CSkVDVCBpZiB0eXBlIGlzIEpTT04gYW5kIGFzeW5jIGlzIGZhbHNlIC0gdGhlIHRyZWUgZHVtcCBhcyBqc29uXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZCAgICA6IGZhbHNlLCAgICAgICAgLy8gRkFMU0Ugb3IgU1RSSU5HIG9yIEFSUkFZXG4gICAgICAgICAgICAgICAgb3BlbmVkICAgICAgICA6IFtdLCAgICAgICAgICAgIC8vIEFSUkFZIE9GIElOSVRJQUxMWSBPUEVORUQgTk9ERVNcbiAgICAgICAgICAgICAgICBsYW5ndWFnZXMgICAgOiBbXSwgICAgICAgICAgICAvLyBBUlJBWSBvZiBzdHJpbmcgdmFsdWVzICh3aGljaCB3aWxsIGJlIHVzZWQgYXMgQ1NTIGNsYXNzZXMgLSBzaSB0aGV5IG11c3QgYmUgdmFsaWQpXG4gICAgICAgICAgICAgICAgcGF0aCAgICAgICAgOiBmYWxzZSwgICAgICAgIC8vIEZBTFNFIG9yIFNUUklORyAoaWYgZmFsc2UgLSB3aWxsIGJlIGF1dG9kZXRlY3RlZClcbiAgICAgICAgICAgICAgICBjb29raWVzICAgICAgICA6IGZhbHNlLCAgICAgICAgLy8gRkFMU0Ugb3IgT0JKRUNUIChwcmVmaXgsIG9wdHMgLSBmcm9tIGpxQ29va2llIC0gZXhwaXJlcywgcGF0aCwgZG9tYWluLCBzZWN1cmUpXG4gICAgICAgICAgICAgICAgdWkgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBkb3RzICAgICAgICA6IHRydWUsICAgICAgICAvLyBCT09MIC0gZG90cyBvciBubyBkb3RzXG4gICAgICAgICAgICAgICAgICAgIHJ0bCAgICAgICAgICAgIDogZmFsc2UsICAgIC8vIEJPT0wgLSBpcyB0aGUgdHJlZSByaWdodC10by1sZWZ0XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgICA6IDAsICAgICAgICAvLyBJTlQgLSBkdXJhdGlvbiBvZiBvcGVuL2Nsb3NlIGFuaW1hdGlvbnMgaW4gbWlsaXNlY29uZHNcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJfbW9kZSAgICA6IHRydWUsICAgICAgICAvLyBTSE9VTEQgZ2V0XyogZnVuY3Rpb25zIGNoYWdlIGZvY3VzIG9yIGNoYW5nZSBob3ZlcmVkIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsX3NwZCAgICA6IDQsXG4gICAgICAgICAgICAgICAgICAgIHRoZW1lX3BhdGggICAgOiBmYWxzZSwgICAgLy8gUGF0aCB0byB0aGVtZXNcbiAgICAgICAgICAgICAgICAgICAgdGhlbWVfbmFtZSAgICA6IFwiZGVmYXVsdFwiLC8vIE5hbWUgb2YgdGhlbWVcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dCAgICAgICAgOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgIDogXCJjcmVhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCAgICA6IFwiQ3JlYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiAgICA6IFwiY3JlYXRlLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUgICAgOiBmdW5jdGlvbiAoTk9ERSwgVFJFRV9PQkopIHsgaWYoTk9ERS5sZW5ndGggIT0gMSkgcmV0dXJuIGZhbHNlOyByZXR1cm4gVFJFRV9PQkouY2hlY2soXCJjcmVhdGFibGVcIiwgTk9ERSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IFRSRUVfT0JKLmNyZWF0ZShmYWxzZSwgTk9ERSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcInNlcGFyYXRvclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgICA6IFwicmVuYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgICAgOiBcIlJlbmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb24gICAgOiBcInJlbmFtZS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IGlmKE5PREUubGVuZ3RoICE9IDEpIHJldHVybiBmYWxzZTsgcmV0dXJuIFRSRUVfT0JKLmNoZWNrKFwicmVuYW1lYWJsZVwiLCBOT0RFKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gICAgOiBmdW5jdGlvbiAoTk9ERSwgVFJFRV9PQkopIHsgVFJFRV9PQkoucmVuYW1lKCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgIDogXCJkZWxldGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCAgICA6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiAgICA6IFwicmVtb3ZlLmdpZlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUgICAgOiBmdW5jdGlvbiAoTk9ERSwgVFJFRV9PQkopIHsgcmV0dXJuIFRSRUVfT0JKLmNoZWNrKFwiZGVsZXRhYmxlXCIsIE5PREUpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiAgICA6IGZ1bmN0aW9uIChOT0RFLCBUUkVFX09CSikgeyBOT0RFLmVhY2goIGZ1bmN0aW9uICgpIHsgVFJFRV9PQkoucmVtb3ZlKHRoaXMpOyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBydWxlcyAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGUgICAgOiBmYWxzZSwgICAgLy8gRkFMU0UgfCBDVFJMIHwgT04gLSBtdWx0aXBsZSBzZWxlY3Rpb24gb2ZmLyB3aXRoIG9yIHdpdGhvdXQgaG9sZGluZyBDdHJsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhICAgIDogZmFsc2UsICAgIC8vIEZBTFNFIG9yIFNUUklORyAtIGF0dHJpYnV0ZSBuYW1lICh1c2UgbWV0YWRhdGEgcGx1Z2luKVxuICAgICAgICAgICAgICAgICAgICB0eXBlX2F0dHIgICAgOiBcInJlbFwiLCAgICAvLyBTVFJJTkcgYXR0cmlidXRlIG5hbWUgKHdoZXJlIGlzIHRoZSB0eXBlIHN0b3JlZCBpZiBubyBtZXRhZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgbXVsdGl0cmVlICAgIDogZmFsc2UsICAgIC8vIEJPT0wgLSBpcyBkcmFnIG4gZHJvcCBiZXR3ZWVuIHRyZWVzIGFsbG93ZWRcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlYXQgICAgOiBcImJvdHRvbVwiLCAgICAvLyBTVFJJTkcgKHRvcCBvciBib3R0b20pIG5ldyBub2RlcyBnZXQgaW5zZXJ0ZWQgYXQgdG9wIG9yIGJvdHRvbVxuICAgICAgICAgICAgICAgICAgICB1c2VfaW5saW5lICAgIDogZmFsc2UsICAgIC8vIENIRUNLIEZPUiBJTkxJTkUgUlVMRVMgLSBSRVFVSVJFUyBNRVRBREFUQVxuICAgICAgICAgICAgICAgICAgICBjbGlja2FibGUgICAgOiBcImFsbFwiLCAgICAvLyB3aGljaCBub2RlIHR5cGVzIGNhbiB0aGUgdXNlciBzZWxlY3QgfCBkZWZhdWx0IC0gYWxsXG4gICAgICAgICAgICAgICAgICAgIHJlbmFtZWFibGUgICAgOiBcImFsbFwiLCAgICAvLyB3aGljaCBub2RlIHR5cGVzIGNhbiB0aGUgdXNlciBzZWxlY3QgfCBkZWZhdWx0IC0gYWxsXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0YWJsZSAgICA6IFwiYWxsXCIsICAgIC8vIHdoaWNoIG5vZGUgdHlwZXMgY2FuIHRoZSB1c2VyIGRlbGV0ZSB8IGRlZmF1bHQgLSBhbGxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRhYmxlICAgIDogXCJhbGxcIiwgICAgLy8gd2hpY2ggbm9kZSB0eXBlcyBjYW4gdGhlIHVzZXIgY3JlYXRlIGluIHwgZGVmYXVsdCAtIGFsbFxuICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGUgICAgOiBcIm5vbmVcIiwgICAgLy8gd2hpY2ggbm9kZSB0eXBlcyBjYW4gdGhlIHVzZXIgbW92ZSB8IGRlZmF1bHQgLSBub25lIHwgXCJhbGxcIlxuICAgICAgICAgICAgICAgICAgICBkcmFncnVsZXMgICAgOiBcImFsbFwiLCAgICAvLyB3aGF0IG1vdmUgb3BlcmF0aW9ucyBiZXR3ZWVuIG5vZGVzIGFyZSBhbGxvd2VkIHwgZGVmYXVsdCAtIG5vbmUgfCBcImFsbFwiXG4gICAgICAgICAgICAgICAgICAgIGRyYWdfY29weSAgICA6IGZhbHNlLCAgICAvLyBGQUxTRSB8IENUUkwgfCBPTiAtIGRyYWcgdG8gY29weSBvZmYvIHdpdGggb3Igd2l0aG91dCBob2xkaW5nIEN0cmxcbiAgICAgICAgICAgICAgICAgICAgZHJvcHBhYmxlICAgIDogW11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhbmcgOiB7XG4gICAgICAgICAgICAgICAgICAgIG5ld19ub2RlICAgIDogXCJOZXcgZm9sZGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRpbmcgICAgICAgIDogXCJMb2FkaW5nIC4uLlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFjayAgICA6IHsgICAgICAgICAgICAgICAgLy8gdmFyaW91cyBjYWxsYmFja3MgdG8gYXR0YWNoIGN1c3RvbSBsb2dpYyB0b1xuICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgZm9jdXMgIC0gc2hvdWxkIHJldHVybiB0cnVlIHwgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlY2hhbmdlOiBmdW5jdGlvbihOT0RFLFRSRUVfT0JKKSB7IHJldHVybiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBtb3ZlICAgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBiZWZvcmVtb3ZlICA6IGZ1bmN0aW9uKE5PREUsUkVGX05PREUsVFlQRSxUUkVFX09CSikgeyByZXR1cm4gdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgY3JlYXRlIC0gc2hvdWxkIHJldHVybiB0cnVlIHwgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlY3JlYXRlOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHsgcmV0dXJuIHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gYmVmb3JlIHJlbmFtZSAtIHNob3VsZCByZXR1cm4gdHJ1ZSB8IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZXJlbmFtZTogZnVuY3Rpb24oTk9ERSxMQU5HLFRSRUVfT0JKKSB7IHJldHVybiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBkZWxldGUgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBiZWZvcmVkZWxldGU6IGZ1bmN0aW9uKE5PREUsVFJFRV9PQkopIHsgcmV0dXJuIHRydWUgfSxcblxuICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZSAgICA6IGZ1bmN0aW9uKE5PREUsVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIGZvY3VzIGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgb25yZW5hbWUgICAgOiBmdW5jdGlvbihOT0RFLExBTkcsVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgLy8gbm9kZSByZW5hbWVkIElTTkVXIC0gVFJVRXxGQUxTRSwgY3VycmVudCBsYW5ndWFnZVxuICAgICAgICAgICAgICAgICAgICBvbm1vdmUgICAgICAgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7IH0sICAgIC8vIG1vdmUgY29tcGxldGVkIChUWVBFIGlzIEJFTE9XfEFCT1ZFfElOU0lERSlcbiAgICAgICAgICAgICAgICAgICAgb25jb3B5ICAgICAgICA6IGZ1bmN0aW9uKE5PREUsUkVGX05PREUsVFlQRSxUUkVFX09CSikgeyB9LCAgICAvLyBjb3B5IGNvbXBsZXRlZCAoVFlQRSBpcyBCRUxPV3xBQk9WRXxJTlNJREUpXG4gICAgICAgICAgICAgICAgICAgIG9uY3JlYXRlICAgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7IH0sICAgIC8vIG5vZGUgY3JlYXRlZCwgcGFyZW50IG5vZGUgKFRZUEUgaXMgaW5zZXJ0QXQpXG4gICAgICAgICAgICAgICAgICAgIG9uZGVsZXRlICAgIDogZnVuY3Rpb24oTk9ERSwgVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgZGVsZXRlZFxuICAgICAgICAgICAgICAgICAgICBvbm9wZW4gICAgICAgIDogZnVuY3Rpb24oTk9ERSwgVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgb3BlbmVkXG4gICAgICAgICAgICAgICAgICAgIG9uY2xvc2UgICAgICAgIDogZnVuY3Rpb24oTk9ERSwgVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgY2xvc2VkXG4gICAgICAgICAgICAgICAgICAgIGVycm9yICAgICAgICA6IGZ1bmN0aW9uKFRFWFQsIFRSRUVfT0JKKSB7IH0sICAgICAgICAgICAgICAgICAgICAvLyBlcnJvciBvY2N1cmVkXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvdWJsZSBjbGljayBvbiBub2RlIC0gZGVmYXVsdHMgdG8gb3Blbi9jbG9zZSAmIHNlbGVjdFxuICAgICAgICAgICAgICAgICAgICBvbmRibGNsayAgICA6IGZ1bmN0aW9uKE5PREUsIFRSRUVfT0JKKSB7IFRSRUVfT0JKLnRvZ2dsZV9icmFuY2guY2FsbChUUkVFX09CSiwgTk9ERSk7IFRSRUVfT0JKLnNlbGVjdF9icmFuY2guY2FsbChUUkVFX09CSiwgTk9ERSk7IH0sXG4gICAgICAgICAgICAgICAgICAgIC8vIHJpZ2h0IGNsaWNrIC0gdG8gcHJldmVudCB1c2U6IEVWLnByZXZlbnREZWZhdWx0KCk7IEVWLnN0b3BQcm9wYWdhdGlvbigpOyByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgb25yZ3RjbGsgICAgOiBmdW5jdGlvbihOT0RFLCBUUkVFX09CSiwgRVYpIHsgfSxcbiAgICAgICAgICAgICAgICAgICAgb25sb2FkICAgICAgICA6IGZ1bmN0aW9uKFRSRUVfT0JKKSB7IH0sXG4gICAgICAgICAgICAgICAgICAgIG9uZm9jdXMgICAgICAgIDogZnVuY3Rpb24oVFJFRV9PQkopIHsgfSxcbiAgICAgICAgICAgICAgICAgICAgb25kcm9wICAgICAgICA6IGZ1bmN0aW9uKE5PREUsUkVGX05PREUsVFlQRSxUUkVFX09CSikge31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gSU5JVElBTElaQVRJT05cbiAgICAgICAgICAgIGluaXQgOiBmdW5jdGlvbihlbGVtLCBvcHRzKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lciAgICAgICAgPSAkKGVsZW0pO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuY29udGFpbmVyLnNpemUgPT0gMCkgeyBhbGVydChcIkludmFsaWQgY29udGFpbmVyIG5vZGUhXCIpOyByZXR1cm4gfVxuXG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuaW5zdFt0aGlzLmNudHJdID0gdGhpcztcbiAgICAgICAgICAgICAgICBpZighdGhpcy5jb250YWluZXIuYXR0cihcImlkXCIpKSB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIixcImpzdHJlZV9cIiArIHRoaXMuY250cik7XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuaW5zdFt0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIildID0gdHJlZV9jb21wb25lbnQuaW5zdFt0aGlzLmNudHJdO1xuICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmZvY3VzZWQgPSB0aGlzLmNudHI7XG5cbiAgICAgICAgICAgICAgICAvLyBNRVJHRSBPUFRJT05TIFdJVEggREVGQVVMVFNcbiAgICAgICAgICAgICAgICBpZihvcHRzICYmIG9wdHMuY29va2llcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNvb2tpZXMgPSAkLmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLmNvb2tpZXMsb3B0cy5jb29raWVzKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMuY29va2llcztcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY29va2llcy5vcHRzKSB0aGlzLnNldHRpbmdzLmNvb2tpZXMub3B0cyA9IHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvcHRzICYmIG9wdHMuY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjayA9ICQuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MuY2FsbGJhY2ssb3B0cy5jYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLmNhbGxiYWNrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvcHRzICYmIG9wdHMuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmRhdGEgPSAkLmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLmRhdGEsb3B0cy5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMuZGF0YTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYob3B0cyAmJiBvcHRzLnVpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MudWkgPSAkLmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLnVpLG9wdHMudWkpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy51aTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYob3B0cyAmJiBvcHRzLnJ1bGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MucnVsZXMgPSAkLmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLnJ1bGVzLG9wdHMucnVsZXMpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy5ydWxlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYob3B0cyAmJiBvcHRzLmxhbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5sYW5nID0gJC5leHRlbmQoe30sdGhpcy5zZXR0aW5ncy5sYW5nLG9wdHMubGFuZyk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLmxhbmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MgICAgICAgID0gJC5leHRlbmQoe30sdGhpcy5zZXR0aW5ncyxvcHRzKTtcblxuICAgICAgICAgICAgICAgIC8vIFBBVEggVE8gSU1BR0VTIEFORCBYU0xcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnBhdGggPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgJChcInNjcmlwdFwiKS5lYWNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNyYy50b1N0cmluZygpLm1hdGNoKC90cmVlX2NvbXBvbmVudC4qP2pzLiokLykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5wYXRoID0gdGhpcy5zcmMudG9TdHJpbmcoKS5yZXBsYWNlKC90cmVlX2NvbXBvbmVudC4qP2pzLiokLywgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHRoaXMucGF0aCA9IHRoaXMuc2V0dGluZ3MucGF0aDtcblxuICAgICAgICAgICAgICAgIC8vIERFQUwgV0lUSCBMQU5HVUFHRSBWRVJTSU9OU1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9sYW5nICAgID0gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMgJiYgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoID8gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbMF0gOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcyAmJiB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbiA9IGdldF9zaGVldF9udW0oXCJ0cmVlX2NvbXBvbmVudC5jc3NcIik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIikgPyBcIiNcIiArIHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSA6IFwiLnRyZWVcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBsbiA9IDA7IGxuIDwgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoOyBsbisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdCA9IGFkZF9jc3MoaWQgKyBcIiAuXCIgKyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tsbl0sIHRoaXMuc24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3QgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbbG5dID09IHRoaXMuY3VycmVudF9sYW5nKSAgICBzdC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIERST1BQQUJMRVNcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmRyb3AucHVzaCh0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZVtpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5kcm9wID0gJC51bmlxdWUodHJlZV9jb21wb25lbnQuZHJvcCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBUSEVNRVNcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggPT09IGZhbHNlKSB0aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggPSB0aGlzLnBhdGggKyBcInRoZW1lcy9cIjtcbiAgICAgICAgICAgICAgICB0aGlzLnRoZW1lID0gdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZSArIFwiL1wiO1xuICAgICAgICAgICAgICAgIGFkZF9zaGVldChfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L3N0eWxlLmNzc1wiKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLnRoZW1lX25hbWUgIT0gXCJkZWZhdWx0XCIpIGFkZF9zaGVldChfdGhpcy50aGVtZSArIFwic3R5bGUuY3NzXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoXCJ0cmVlXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkucnRsKSB0aGlzLmNvbnRhaW5lci5hZGRDbGFzcyhcInJ0bFwiKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlKSB0aGlzLnNlbGVjdGVkX2FyciA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLmRvdHMgPT0gZmFsc2UpIHRoaXMuY29udGFpbmVyLmFkZENsYXNzKFwibm9fZG90c1wiKTtcblxuICAgICAgICAgICAgICAgIC8vIENPTlRFWFQgTUVOVVxuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuY29udGV4dCAhPSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gJzxkaXYgY2xhc3M9XCJjb250ZXh0XCI+JztcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0gPT0gXCJzZXBhcmF0b3JcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSBcIjxzcGFuIGNsYXNzPSdzZXBhcmF0b3InPiZuYnNwOzwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY24gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmljb24pIGljbiA9ICdiYWNrZ3JvdW5kLWltYWdlOnVybChcXCcnICsgKCB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWNvbi5pbmRleE9mKFwiL1wiKSA9PSAtMSA/IHRoaXMudGhlbWUgKyB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWNvbiA6IHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5pY29uICkgKyAnXFwnKTsnO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9ICc8YSByZWw9XCInICsgdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmlkICsgJ1wiIGhyZWY9XCIjXCIgc3R5bGU9XCInICsgaWNuICsgJ1wiPicgKyB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0ubGFiZWwgKyAnPC9hPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3RyICs9ICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQgPSAkKHN0cik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5hcHBlbmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmhvdmVyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gQ1JFQVRFIERVTU1ZIEZPUiBNT1ZJTkdcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdnYWJsZSAhPSBcIm5vbmVcIiAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlcyAhPSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGltZz5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZCAgICAgICAgOiBcIm1hcmtlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYyAgICA6IF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvbWFya2VyLmdpZlwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ICAgICAgICA6IFwiOHB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggICAgICAgIDogXCI0MnB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheSAgICAgICAgOiBcImJsb2NrXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gICAgOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCAgICAgICAgOiBcIjMwcHhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AgICAgICAgICAgICA6IFwiMzBweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleCAgICAgICAgOiBcIjEwMDBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuaGlkZSgpLmFwcGVuZFRvKFwiYm9keVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hFdmVudHMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb2ZmX2hlaWdodCA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLm9mZnNldCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuY3NzKHsgcG9zaXRpb24gOiBcInJlbGF0aXZlXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gdGhpcy5jb250YWluZXIub2Zmc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0bXAgPSBwYXJzZUludCgkLmNzcyh0aGlzLmNvbnRhaW5lci5nZXQoMCksIFwicGFkZGluZ1RvcFwiLCB0cnVlKSwxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRtcCkgdGhpcy5vZmZzZXQudG9wICs9IHRtcDtcbiAgICAgICAgICAgICAgICAgICAgdG1wID0gcGFyc2VJbnQoJC5jc3ModGhpcy5jb250YWluZXIuZ2V0KDApLCBcImJvcmRlclRvcFdpZHRoXCIsIHRydWUpLDEwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYodG1wKSB0aGlzLm9mZnNldC50b3AgKz0gdG1wO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3MoeyBwb3NpdGlvbiA6IFwiXCIgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKCF0aGlzLmxpX2hlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5jb250YWluZXIuZmluZChcInVsIGxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpX2hlaWdodCA9IHRtcC5maW5kKCcudGl0bGU6Zmlyc3QnKS5oZWlnaHQoKSArIDE7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmxpX2hlaWdodCkgdGhpcy5saV9oZWlnaHQgPSAxODtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gUkVQQUlOVCBUUkVFXG4gICAgICAgICAgICByZWZyZXNoIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgLy8gU0FWRSBPUEVORURcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5lZCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5jb29raWVzICYmICQuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX29wZW4nKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gJC5jb29raWUodGhpcy5zZXR0aW5ncy5jb29raWVzLnByZWZpeCArICdfb3BlbicpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHRtcCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLm9wZW5lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHRoaXMuc2V0dGluZ3Mub3BlbmVkICE9IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCh0aGlzLnNldHRpbmdzLm9wZW5lZCwgZnVuY3Rpb24gKGksIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9wZW5lZC5wdXNoKFwiI1wiICsgdGhpcy5yZXBsYWNlKC9eIy8sXCJcIikpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5vcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoXCJsaS5vcGVuXCIpLmVhY2goZnVuY3Rpb24gKGkpIHsgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLmlkKTsgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU0FWRSBTRUxFQ1RFRFxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRfYXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2godGhpcy5zZWxlY3RlZF9hcnIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXR0aW5ncy5zZWxlY3RlZC5wdXNoKFwiI1wiICsgdGhpcy5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLnNldHRpbmdzLnNlbGVjdGVkLnB1c2goXCIjXCIgKyB0aGlzLnNlbGVjdGVkLmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8qZWxzZSBpZih0aGlzLnNldHRpbmdzLmNvb2tpZXMgJiYgalF1ZXJ5LmNvb2tpZSh0aGlzLnNldHRpbmdzLmNvb2tpZXMucHJlZml4ICsgJ19zZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQgPSBBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0galF1ZXJ5LmNvb2tpZSh0aGlzLnNldHRpbmdzLmNvb2tpZXMucHJlZml4ICsgJ19zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVhY2godG1wLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXR0aW5ncy5zZWxlY3RlZC5wdXNoKFwiI1wiICsgdGhpcy5yZXBsYWNlKC9eIy8sXCJcIikpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQpLnRvTG93ZXJDYXNlKCkgPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAucHVzaChcIiNcIiArIHRoaXMucmVwbGFjZSgvXiMvLFwiXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgdG1wLnB1c2goXCIjXCIgKyB0aGlzLnNldHRpbmdzLnNlbGVjdGVkLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQgPSB0bXA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYob2JqICYmIHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luYykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5lZCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmZpbmQoXCJsaS5vcGVuXCIpLmVhY2goZnVuY3Rpb24gKGkpIHsgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLmlkKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VfYnJhbmNoKG9iaiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmh0bWwoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZW5fYnJhbmNoKG9iaiwgdHJ1ZSwgZnVuY3Rpb24gKCkgeyBfdGhpcy5yZXNlbGVjdC5hcHBseShfdGhpcyk7IH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBjbHMgPSBcInRyZWUtZGVmYXVsdFwiO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZSAhPSBcImRlZmF1bHRcIikgY2xzICs9IFwiIHRyZWUtXCIgKyBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9uYW1lO1xuXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLnR5cGUgPT0gXCJ4bWxfZmxhdFwiIHx8IHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwieG1sX25lc3RlZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NydG9wID0gdGhpcy5jb250YWluZXIuZ2V0KDApLnNjcm9sbFRvcDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhzbCA9ICh0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcInhtbF9mbGF0XCIpID8gXCJmbGF0LnhzbFwiIDogXCJuZXN0ZWQueHNsXCI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmdldFRyYW5zZm9ybSh0aGlzLnBhdGggKyB4c2wsIHRoaXMuc2V0dGluZ3MuZGF0YS51cmwsIHsgcGFyYW1zIDogeyB0aGVtZV9uYW1lIDogY2xzLCB0aGVtZV9wYXRoIDogX3RoaXMudGhlbWUgfSwgbWV0aCA6IF90aGlzLnNldHRpbmdzLmRhdGEubWV0aG9kICxjYWxsYmFjazogZnVuY3Rpb24gKCkgeyBfdGhpcy5yZXNlbGVjdC5hcHBseShfdGhpcyk7IH0gfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcImpzb25cIikge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuanNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuanNvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5zZXR0aW5ncy5kYXRhLmpzb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IHRoaXMucGFyc2VKU09OKHRoaXMuc2V0dGluZ3MuZGF0YS5qc29uW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugc3RyID0gdGhpcy5wYXJzZUpTT04odGhpcy5zZXR0aW5ncy5kYXRhLmpzb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuaHRtbChcIjx1bCBjbGFzcz0nXCIgKyBjbHMgKyBcIic+XCIgKyBzdHIgKyBcIjwvdWw+XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImxpOmxhc3QtY2hpbGRcIikuYWRkQ2xhc3MoXCJsYXN0XCIpLmVuZCgpLmZpbmQoXCJsaTpoYXModWwpXCIpLm5vdChcIi5vcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImxpXCIpLm5vdChcIi5vcGVuXCIpLm5vdChcIi5jbG9zZWRcIikuYWRkQ2xhc3MoXCJsZWFmXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNlbGVjdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEubWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCAgICAgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLnVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luY19kYXRhKGZhbHNlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZSAgICA6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgICAgICAgIDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSBfdGhpcy5wYXJzZUpTT04oZGF0YVtpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBzdHIgPSBfdGhpcy5wYXJzZUpTT04oZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5odG1sKFwiPHVsIGNsYXNzPSdcIiArIGNscyArIFwiJz5cIiArIHN0ciArIFwiPC91bD5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5maW5kKFwibGk6bGFzdC1jaGlsZFwiKS5hZGRDbGFzcyhcImxhc3RcIikuZW5kKCkuZmluZChcImxpOmhhcyh1bClcIikubm90KFwiLm9wZW5cIikuYWRkQ2xhc3MoXCJjbG9zZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5maW5kKFwibGlcIikubm90KFwiLm9wZW5cIikubm90KFwiLmNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJlc2VsZWN0LmFwcGx5KF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5hdHRyKFwiY2xhc3NcIiwgY2xzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImxpOmxhc3QtY2hpbGRcIikuYWRkQ2xhc3MoXCJsYXN0XCIpLmVuZCgpLmZpbmQoXCJsaTpoYXModWwpXCIpLm5vdChcIi5vcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGlcIikubm90KFwiLm9wZW5cIikubm90KFwiLmNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZWxlY3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gQ09OVkVSVCBKU09OIFRPIEhUTUxcbiAgICAgICAgICAgIHBhcnNlSlNPTiA6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgc3RyICs9IFwiPGxpIFwiO1xuICAgICAgICAgICAgICAgIHZhciBjbHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IoaSBpbiBkYXRhLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoaSA9PSBcImNsYXNzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSBcIiBjbGFzcz0nXCIgKyBkYXRhLmF0dHJpYnV0ZXNbaV0gKyBcIiBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuc3RhdGUgPT0gXCJjbG9zZWRcIiB8fCBkYXRhLnN0YXRlID09IFwib3BlblwiKSBzdHIgKz0gXCIgXCIgKyBkYXRhLnN0YXRlICsgXCIgXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCInIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHN0ciArPSBcIiBcIiArIGkgKyBcIj0nXCIgKyBkYXRhLmF0dHJpYnV0ZXNbaV0gKyBcIicgXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKCFjbHMgJiYgKGRhdGEuc3RhdGUgPT0gXCJjbG9zZWRcIiB8fCBkYXRhLnN0YXRlID09IFwib3BlblwiKSkgc3RyICs9IFwiIGNsYXNzPSdcIiArIGRhdGEuc3RhdGUgKyBcIicgXCI7XG4gICAgICAgICAgICAgICAgc3RyICs9IFwiPlwiO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyW1wiaHJlZlwiXSA9IFwiI1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltcInN0eWxlXCJdID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbXCJjbGFzc1wiXSA9IHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXSAmJiAodHlwZW9mIGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uYXR0cmlidXRlcykudG9Mb3dlckNhc2UoKSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGogPT0gXCJzdHlsZVwiIHx8IGogPT0gXCJjbGFzc1wiKSAgICBhdHRyW2pdICs9IFwiIFwiICsgZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyW2pdICA9IGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dICYmIGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uaWNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY24gPSBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmljb24uaW5kZXhPZihcIi9cIikgPT0gLTEgPyB0aGlzLnRoZW1lICsgZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5pY29uIDogZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5pY29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbXCJzdHlsZVwiXSArPSBcIiA7IGJhY2tncm91bmQtaW1hZ2U6dXJsKCdcIiArIGljbiArIFwiJyk7IFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiPGFcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqIGluIGF0dHIpIHN0ciArPSAnICcgKyBqICsgJz1cIicgKyBhdHRyW2pdICsgJ1wiICc7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCI+XCIgKyAoICh0eXBlb2YgZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS50aXRsZSkudG9Mb3dlckNhc2UoKSAhPSBcInVuZGVmaW5lZFwiID8gZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS50aXRsZSA6IGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0gKSArIFwiPC9hPlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBhdHRyW1wiaHJlZlwiXSA9IFwiI1wiO1xuICAgICAgICAgICAgICAgICAgICBhdHRyW1wic3R5bGVcIl0gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBhdHRyW1wiY2xhc3NcIl0gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIGRhdGEuZGF0YS5hdHRyaWJ1dGVzKS50b0xvd2VyQ2FzZSgpICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihpIGluIGRhdGEuZGF0YS5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaSA9PSBcInN0eWxlXCIgfHwgaSA9PSBcImNsYXNzXCIpICAgIGF0dHJbaV0gKz0gXCIgXCIgKyBkYXRhLmRhdGEuYXR0cmlidXRlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyW2ldICA9IGRhdGEuZGF0YS5hdHRyaWJ1dGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuZGF0YS5pY29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNuID0gZGF0YS5kYXRhLmljb24uaW5kZXhPZihcIi9cIikgPT0gLTEgPyB0aGlzLnRoZW1lICsgZGF0YS5kYXRhLmljb24gOiBkYXRhLmRhdGEuaWNvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbXCJzdHlsZVwiXSArPSBcIiA7IGJhY2tncm91bmQtaW1hZ2U6dXJsKCdcIiArIGljbiArIFwiJyk7XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiPGFcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gYXR0cikgc3RyICs9ICcgJyArIGkgKyAnPVwiJyArIGF0dHJbaV0gKyAnXCIgJztcbiAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiPlwiICsgKCAodHlwZW9mIGRhdGEuZGF0YS50aXRsZSkudG9Mb3dlckNhc2UoKSAhPSBcInVuZGVmaW5lZFwiID8gZGF0YS5kYXRhLnRpdGxlIDogZGF0YS5kYXRhICkgKyBcIjwvYT5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoZGF0YS5jaGlsZHJlbiAmJiBkYXRhLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzx1bD4nO1xuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IHRoaXMucGFyc2VKU09OKGRhdGEuY2hpbGRyZW5baV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHN0ciArPSAnPC91bD4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHIgKz0gXCI8L2xpPlwiO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gZ2V0SlNPTiBmcm9tIEhUTUxcbiAgICAgICAgICAgIGdldEpTT04gOiBmdW5jdGlvbiAobm9kLCBvdXRlcl9hdHRyaWIsIGlubmVyX2F0dHJpYiwgZm9yY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmKCFub2QgfHwgJChub2QpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZCA9IHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKFwidWxcIikuY2hpbGRyZW4oXCJsaVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBub2QgPSAkKG5vZCk7XG5cbiAgICAgICAgICAgICAgICBpZihub2Quc2l6ZSgpID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIG5vZC5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKF90aGlzLmdldEpTT04odGhpcywgb3V0ZXJfYXR0cmliLCBpbm5lcl9hdHRyaWIpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcnI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoIW91dGVyX2F0dHJpYikgb3V0ZXJfYXR0cmliID0gWyBcImlkXCIsIFwicmVsXCIsIFwiY2xhc3NcIiBdO1xuICAgICAgICAgICAgICAgIGlmKCFpbm5lcl9hdHRyaWIpIGlubmVyX2F0dHJpYiA9IFsgXTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0geyBhdHRyaWJ1dGVzIDoge30sIGRhdGEgOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGZvcihpIGluIG91dGVyX2F0dHJpYikge1xuICAgICAgICAgICAgICAgICAgICBvYmouYXR0cmlidXRlc1tvdXRlcl9hdHRyaWJbaV1dID0gbm9kLmF0dHIob3V0ZXJfYXR0cmliW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5kYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgIGZvcihpIGluIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IG5vZC5jaGlsZHJlbihcImEuXCIgKyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihmb3JjZSB8fCBpbm5lcl9hdHRyaWIubGVuZ3RoIHx8IGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS50b1N0cmluZygpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS50aXRsZSA9IGEudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmljb24gPSBhLmdldCgwKS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UucmVwbGFjZShcInVybChcIixcIlwiKS5yZXBsYWNlKFwiKVwiLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbm5lcl9hdHRyaWIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqIGluIGlubmVyX2F0dHJpYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXNbaW5uZXJfYXR0cmliW2pdXSA9IGEuYXR0cihpbm5lcl9hdHRyaWJbal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dID0gYS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhID0gbm9kLmNoaWxkcmVuKFwiYVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoZm9yY2UgfHwgaW5uZXJfYXR0cmliLmxlbmd0aCB8fCBhLmdldCgwKS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UudG9TdHJpbmcoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YS50aXRsZSA9IGEudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYS5nZXQoMCkuc3R5bGUuYmFja2dyb3VuZEltYWdlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLmljb24gPSBhLmdldCgwKS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UucmVwbGFjZShcInVybChcIixcIlwiKS5yZXBsYWNlKFwiKVwiLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5uZXJfYXR0cmliLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaiBpbiBpbm5lcl9hdHRyaWIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGEuYXR0cmlidXRlc1tpbm5lcl9hdHRyaWJbal1dID0gYS5hdHRyKGlubmVyX2F0dHJpYltqXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGEgPSBhLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKG5vZC5jaGlsZHJlbihcInVsXCIpLnNpemUoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuID0gW107XG4gICAgICAgICAgICAgICAgICAgIG5vZC5jaGlsZHJlbihcInVsXCIpLmNoaWxkcmVuKFwibGlcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4ucHVzaChfdGhpcy5nZXRKU09OKHRoaXMsIG91dGVyX2F0dHJpYiwgaW5uZXJfYXR0cmliKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZvY3VzIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuZm9jdXNlZCAhPSB0aGlzLmNudHIpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuZm9jdXNlZCA9IHRoaXMuY250cjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmZvY3VzLmNhbGwobnVsbCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dfY29udGV4dCA6IGZ1bmN0aW9uIChvYmosIHgsIHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5jb250ZXh0LnNob3coKS5vZmZzZXRQYXJlbnQoKTtcbiAgICAgICAgICAgICAgICBpZih0bXAuaXMoXCJodG1sXCIpKSB0bXAgPSAkKFwiYm9keVwiKTtcbiAgICAgICAgICAgICAgICB0bXAgPSB0bXAub2Zmc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmNzcyh7IFwibGVmdFwiIDogKHggLSB0bXAubGVmdCAtICh0aGlzLnNldHRpbmdzLnVpLnJ0bCA/ICQodGhpcy5jb250ZXh0KS53aWR0aCgpIDogLTUgKSApLCBcInRvcFwiIDogKHkgLSB0bXAudG9wICArICgkLmJyb3dzZXIub3BlcmEgPyB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSA6IDApICsgMTUpIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVfY29udGV4dCA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQuaGlkZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIEFMTCBFVkVOVFNcbiAgICAgICAgICAgIGF0dGFjaEV2ZW50cyA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgLmxpc3RlbihcImNsaWNrXCIsIFwibGlcIiwgZnVuY3Rpb24oZXZlbnQpIHsgLy8gV0hFTiBDTElDSyBJUyBPTiBUSEUgQVJST1dcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlX2JyYW5jaC5hcHBseShfdGhpcywgW2V2ZW50LnRhcmdldF0pO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAubGlzdGVuKFwiY2xpY2tcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkgeyAvLyBXSEVOIENMSUNLIElTIE9OIFRIRSBURVhUIE9SIElDT05cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmxvY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RfYnJhbmNoLmFwcGx5KF90aGlzLCBbZXZlbnQudGFyZ2V0LCBldmVudC5jdHJsS2V5IHx8IF90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlID09IFwib25cIl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuaW5wKSB7IF90aGlzLmlucC5ibHVyKCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAubGlzdGVuKFwiZGJsY2xpY2tcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkgeyAvLyBXSEVOIERPVUJMRUNMSUNLIE9OIFRFWFQgT1IgSUNPTlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uZGJsY2xrLmNhbGwobnVsbCwgX3RoaXMuZ2V0X25vZGUoZXZlbnQudGFyZ2V0KS5nZXQoMCksIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJjb250ZXh0bWVudVwiLCBcImEudGl0bGVcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9ucmd0Y2xrLmNhbGwobnVsbCwgX3RoaXMuZ2V0X25vZGUoZXZlbnQudGFyZ2V0KS5nZXQoMCksIF90aGlzLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuY29udGV4dC5hcHBlbmQgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmZpbmQoXCJ1bDplcSgwKVwiKS5hcHBlbmQoX3RoaXMuY29udGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRleHQuYXBwZW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXSA9PSBcInNlcGFyYXRvclwiKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZ1bmMgPSBfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmFjdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZXh0LmNoaWxkcmVuKFwiW3JlbD1cIiArIF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWQgK1wiXVwiKS5iaW5kKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmMuY2FsbChudWxsLCBfdGhpcy5zZWxlY3RlZF9hcnIgfHwgX3RoaXMuc2VsZWN0ZWQsIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGlkZV9jb250ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmlucCkgeyBfdGhpcy5pbnAuYmx1cigpOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvYmouY2hpbGRyZW4oXCJhOmVxKDApXCIpLmhhc0NsYXNzKFwiY2xpY2tlZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VsZWN0X2JyYW5jaC5hcHBseShfdGhpcywgW2V2ZW50LnRhcmdldCwgZXZlbnQuY3RybEtleSB8fCBfdGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSA9PSBcIm9uXCJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGV4dC5jaGlsZHJlbihcImxpXCIpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdvID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihpIGluIF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0gPT0gXCJzZXBhcmF0b3JcIikgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS52aXNpYmxlLmNhbGwobnVsbCwgX3RoaXMuc2VsZWN0ZWRfYXJyIHx8IF90aGlzLnNlbGVjdGVkLCBfdGhpcykpIF90aGlzLmNvbnRleHQuY2hpbGRyZW4oXCJbcmVsPVwiICsgX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5pZCArXCJdXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgZ28gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGdvID09IHRydWUpIF90aGlzLnNob3dfY29udGV4dChvYmosIGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVgsIGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAubGlzdGVuKFwicG9pbnRlcmVudGVyXCIsIFwiYS50aXRsZVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmxvY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuc2V0dGluZ3MudWkuaG92ZXJfbW9kZSAmJiBfdGhpcy5ob3ZlcmVkICE9PSBmYWxzZSAmJiBldmVudC50YXJnZXQudGFnTmFtZSA9PSBcIkFcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhvdmVyZWQuY2hpbGRyZW4oXCJhXCIpLnJlbW92ZUNsYXNzKFwiaG92ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaG92ZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBVFRBQ0ggRFJBRyAmIERST1AgT05MWSBJRiBORUVERURcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5kcmFnZ2FibGUgIT0gXCJub25lXCIgJiYgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcmFncnVsZXMgIT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdwb2ludGVydXAgcG9pbnRlcmRvd24nLCAnLmNvbDInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzLl9kcmFnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oXCJwb2ludGVyZG93blwiLCBcImEudGl0bGVcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmZvY3VzLmFwcGx5KF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMubG9ja2VkKSByZXR1cm4gX3RoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNFTEVDVCBMSVNUIElURU0gTk9ERVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gX3RoaXMuZ2V0X25vZGUoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUYgSVRFTSBJUyBEUkFHR0FCTEVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgX3RoaXMuc2VsZWN0ZWRfYXJyLmxlbmd0aCA+IDEgJiYgb2JqLmNoaWxkcmVuKFwiYTplcSgwKVwiKS5oYXNDbGFzcyhcImNsaWNrZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihpIGluIF90aGlzLnNlbGVjdGVkX2Fycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmNoZWNrKFwiZHJhZ2dhYmxlXCIsIF90aGlzLnNlbGVjdGVkX2FycltpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VsZWN0ZWRfYXJyW2ldLmFkZENsYXNzKFwiZHJhZ2dlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlciArKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjb3VudGVyID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmNoZWNrKFwiZHJhZ2dhYmxlXCIsIG9iaikpICAgIF90aGlzLl9kcmFnID0gb2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9kcmFnID0gX3RoaXMuY29udGFpbmVyLmZpbmQoXCJsaS5kcmFnZ2VkOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmlzZG93biAgICA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZyAgICAgICAgPSBfdGhpcy5fZHJhZy5nZXQoMCkuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWcuaWQgICAgPSBcImRyYWdnZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiYVwiKS5odG1sKFwiTXVsdGlwbGUgc2VsZWN0aW9uXCIpLmVuZCgpLmNoaWxkcmVuKFwidWxcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jaGVjayhcImRyYWdnYWJsZVwiLCBvYmopKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2RyYWcgICAgICAgID0gb2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWcgICAgICAgID0gb2JqLmdldCgwKS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZy5pZCAgICA9IFwiZHJhZ2dlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmlzZG93biAgICA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZm9yZWlnbiAgICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5hZGRDbGFzcyhcImRyYWdnZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJwb2ludGVydXBcIiwgXCJsaVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmxpc3RlbihcInBvaW50ZXJ1cFwiLCBcImEudGl0bGVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5fZHJhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2h0bWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcmRvd25cIiwgICAgdHJlZV9jb21wb25lbnQubW91c2Vkb3duKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcnVwXCIsICAgIHRyZWVfY29tcG9uZW50Lm1vdXNldXApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJwb2ludGVybW92ZVwiLCAgICB0cmVlX2NvbXBvbmVudC5tb3VzZW1vdmUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIEVORElGIE9GIERSQUcgJiBEUk9QIEZVTkNUSU9OU1xuICAgICAgICAgICAgICAgIGlmKF90aGlzLmNvbnRleHQpICQoJ2h0bWwnKS5iaW5kKFwicG9pbnRlcnVwXCIsIGZ1bmN0aW9uKCkgeyBfdGhpcy5oaWRlX2NvbnRleHQoKTsgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hlY2tNb3ZlIDogZnVuY3Rpb24gKE5PREVTLCBSRUZfTk9ERSwgVFlQRSkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIC8vIE9WRVIgU0VMRiBPUiBDSElMRFJFTlxuICAgICAgICAgICAgICAgIGlmKFJFRl9OT0RFLnBhcmVudHMoXCJsaS5kcmFnZ2VkXCIpLnNpemUoKSA+IDAgfHwgUkVGX05PREUuaXMoXCIuZHJhZ2dlZFwiKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJNT1ZFOiBOT0RFIE9WRVIgU0VMRlwiKTtcbiAgICAgICAgICAgICAgICAvLyBDSEVDSyBBR0FJTlNUIERSQUdfUlVMRVNcbiAgICAgICAgICAgICAgICBpZihOT0RFUy5zaXplKCkgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgTk9ERSA9IE5PREVTLmVxKDApO1xuICAgICAgICAgICAgICAgICAgICBpZihOT0RFLmhhc0NsYXNzKFwiZm9yZWlnblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGUubGVuZ3RoID09IDApIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFOT0RFLmlzKFwiLlwiICsgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGUuam9pbihcIiwgLlwiKSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihOT0RFLmlzKFwiLlwiICsgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGVbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT0RFLmF0dHIodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSwgXCJ0eXBlOiAnXCIgKyB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZVtpXSArIFwiJ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PREUuYXR0cih0aGlzLnNldHRpbmdzLnJ1bGVzLnR5cGVfYXR0ciwgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGVbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9rKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJkcmFncnVsZXNcIiwgW05PREUsIFRZUEUsIFJFRl9OT0RFLnBhcmVudHMoXCJsaTplcSgwKVwiKV0pKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IEFHQUlOU1QgRFJBRyBSVUxFU1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIE5PREVTLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWYgPSBOT0RFUy5lcSggKGkgLSAxKSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtdiA9IFwiYWZ0ZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWYgPSBSRUZfTk9ERTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXYgPSBUWVBFO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIV90aGlzLmNoZWNrLmFwcGx5KF90aGlzLFtcImRyYWdydWxlc1wiLCBbJCh0aGlzKSwgbXYsIHJlZl1dKSkgb2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmKG9rID09IGZhbHNlKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IEFHQUlOU1QgRFJBRyBSVUxFU1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ0hFQ0sgQUdBSU5TVCBNRVRBREFUQVxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMudXNlX2lubGluZSAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZihUWVBFID09IFwiaW5zaWRlXCIpICAgIG5kID0gUkVGX05PREUucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICBuZCA9IFJFRl9OT0RFLnBhcmVudHMoXCJsaTplcSgxKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYobmQuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWQUxJRCBDSElMRFJFTiBDSEVDS1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIG5kLm1ldGFkYXRhKClbXCJ2YWxpZF9jaGlsZHJlblwiXSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IG5kLm1ldGFkYXRhKClbXCJ2YWxpZF9jaGlsZHJlblwiXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PREVTLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJC5pbkFycmF5KF90aGlzLmdldF90eXBlKHRoaXMpLCB0bXApID09IC0xKSBvayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9rID09IGZhbHNlKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IE5PVCBBIFZBTElEIENISUxEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ0hFQ0sgSUYgUEFSRU5UIEhBUyBGUkVFIFNMT1RTIEZPUiBDSElMRFJFTlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIG5kLm1ldGFkYXRhKClbXCJtYXhfY2hpbGRyZW5cIl0gIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKChuZC5jaGlsZHJlbihcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGlcIikubm90KFwiLmRyYWdnZWRcIikuc2l6ZSgpICsgTk9ERVMuc2l6ZSgpKSA+IG5kLm1ldGFkYXRhKCkubWF4X2NoaWxkcmVuKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IE1BWCBDSElMRFJFTiBSRUFDSEVEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ0hFQ0sgRk9SIE1BWERFUFRIIFVQIFRIRSBDSEFJTlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluY3IgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgTk9ERVMuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUoaSA8IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gdC5jaGlsZHJlbihcInVsOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0LnNpemUoKSA9PSAwKSBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSArK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNyID0gTWF0aC5tYXgoaSxpbmNyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5kLnBhcmVudHMoXCJsaVwiKS5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQodGhpcykubWV0YWRhdGEoKS5tYXhfZGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIChpICsgaW5jcikgPj0gJCh0aGlzKS5tZXRhZGF0YSgpLm1heF9kZXB0aCkgb2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9rID09IGZhbHNlKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IE1BWF9ERVBUSCBSRUFDSEVEXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIFVTRUQgQUZURVIgUkVGUkVTSFxuICAgICAgICAgICAgcmVzZWxlY3QgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAvLyBSRU9QRU4gQlJBTkNIRVNcbiAgICAgICAgICAgICAgICBpZih0aGlzLm9wZW5lZCAmJiB0aGlzLm9wZW5lZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgdGhpcy5vcGVuZWQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2V0X25vZGUodGhpcy5vcGVuZWRbal0pLnNpemUoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IHRoaXMub3BlbmVkW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5vcGVuZWRbal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3Blbl9icmFuY2godG1wLCB0cnVlLCBmdW5jdGlvbiAoKSB7IF90aGlzLnJlc2VsZWN0LmFwcGx5KF90aGlzKTsgfSApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLm9wZW5fYnJhbmNoKHRoaXMub3BlbmVkW2pdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMgJiYgb3BuKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9wZW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gUkVQT1NJVElPTiBTQ1JPTExcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNjcnRvcCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoX3RoaXMuc2NydG9wKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2NydG9wO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBSRVNFTEVDVCBQUkVWSU9VU0xZIFNFTEVDVEVEXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5zZWxlY3RlZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQsIGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RfYnJhbmNoKCQoX3RoaXMuc2V0dGluZ3Muc2VsZWN0ZWRbaV0pLCAoX3RoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT09IGZhbHNlICYmIGkgPiAwKSApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9ubG9hZC5jYWxsKG51bGwsIF90aGlzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBHRVQgVEhFIEVYVEVOREVEIExJIEVMRU1FTlRcbiAgICAgICAgICAgIGdldF9ub2RlIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSAkKG9iaik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iai5pcyhcImxpXCIpID8gb2JqIDogb2JqLnBhcmVudHMoXCJsaTplcSgwKVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBHRVQgVEhFIFRZUEUgT0YgVEhFIE5PREVcbiAgICAgICAgICAgIGdldF90eXBlIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIG9iaiA9ICFvYmogPyB0aGlzLnNlbGVjdGVkIDogdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIGlmKCFvYmopIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICQubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBvYmoubWV0YWRhdGEoKS50eXBlO1xuICAgICAgICAgICAgICAgICAgICBpZih0bXApIHJldHVybiB0bXA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBvYmouYXR0cih0aGlzLnNldHRpbmdzLnJ1bGVzLnR5cGVfYXR0cik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gU0NST0xMIENPTlRBSU5FUiBXSElMRSBEUkFHR0lOR1xuICAgICAgICAgICAgc2Nyb2xsQ2hlY2sgOiBmdW5jdGlvbiAoeCx5KSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgY250ID0gX3RoaXMuY29udGFpbmVyO1xuICAgICAgICAgICAgICAgIHZhciBvZmYgPSBfdGhpcy5vZmZzZXQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3QgPSBjbnQuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICAgICAgdmFyIHNsID0gY250LnNjcm9sbExlZnQoKTtcbiAgICAgICAgICAgICAgICAvLyBERVRFQ1QgSE9SSVpPTlRBTCBTQ1JPTExcbiAgICAgICAgICAgICAgICB2YXIgaF9jb3IgPSAoY250LmdldCgwKS5zY3JvbGxXaWR0aCA+IGNudC53aWR0aCgpKSA/IDQwIDogMjA7XG5cbiAgICAgICAgICAgICAgICBpZih5IC0gb2ZmLnRvcCA8IDIwKSAgICAgICAgICAgICAgICAgICAgICAgIGNudC5zY3JvbGxUb3AoTWF0aC5tYXgoIChzdCAtIF90aGlzLnNldHRpbmdzLnVpLnNjcm9sbF9zcGQpICwwKSk7ICAgIC8vIE5FQVIgVE9QXG4gICAgICAgICAgICAgICAgaWYoY250LmhlaWdodCgpIC0gKHkgLSBvZmYudG9wKSA8IGhfY29yKSAgICBjbnQuc2Nyb2xsVG9wKHN0ICsgX3RoaXMuc2V0dGluZ3MudWkuc2Nyb2xsX3NwZCk7ICAgICAgICAgICAgICAgICAgICAvLyBORUFSIEJPVFRPTVxuICAgICAgICAgICAgICAgIGlmKHggLSBvZmYubGVmdCA8IDIwKSAgICAgICAgICAgICAgICAgICAgICAgIGNudC5zY3JvbGxMZWZ0KE1hdGgubWF4KCAoc2wgLSBfdGhpcy5zZXR0aW5ncy51aS5zY3JvbGxfc3BkKSwwKSk7ICAgIC8vIE5FQVIgTEVGVFxuICAgICAgICAgICAgICAgIGlmKGNudC53aWR0aCgpIC0gKHggLSBvZmYubGVmdCkgPCA0MCkgICAgICAgIGNudC5zY3JvbGxMZWZ0KHNsICsgX3RoaXMuc2V0dGluZ3MudWkuc2Nyb2xsX3NwZCk7ICAgICAgICAgICAgICAgICAgICAvLyBORUFSIFJJR0hUXG5cbiAgICAgICAgICAgICAgICBpZihjbnQuc2Nyb2xsTGVmdCgpICE9IHNsIHx8IGNudC5zY3JvbGxUb3AoKSAhPSBzdCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuc3RvID0gc2V0VGltZW91dCggZnVuY3Rpb24oKSB7IF90aGlzLnNjcm9sbENoZWNrKHgseSk7IH0sIDUwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjaGVjayA6IGZ1bmN0aW9uIChydWxlLCBub2Rlcykge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAvLyBDSEVDSyBMT0NBTCBSVUxFUyBJRiBNRVRBREFUQVxuICAgICAgICAgICAgICAgIGlmKHJ1bGUgIT0gXCJkcmFncnVsZXNcIiAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLnVzZV9pbmxpbmUgJiYgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkLm1ldGFkYXRhLnNldFR5cGUoXCJhdHRyXCIsIHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgdGhpcy5nZXRfbm9kZShub2RlcykubWV0YWRhdGEoKVtydWxlXSAhPSBcInVuZGVmaW5lZFwiKSByZXR1cm4gdGhpcy5nZXRfbm9kZShub2RlcykubWV0YWRhdGEoKVtydWxlXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MucnVsZXNbcnVsZV0pICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXNbcnVsZV0gPT0gXCJub25lXCIpICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzW3J1bGVdID09IFwiYWxsXCIpICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIGlmKHJ1bGUgPT0gXCJkcmFncnVsZXNcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmRzID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIG5kc1swXSA9IHRoaXMuZ2V0X3R5cGUobm9kZXNbMF0pO1xuICAgICAgICAgICAgICAgICAgICBuZHNbMV0gPSBub2Rlc1sxXTtcbiAgICAgICAgICAgICAgICAgICAgbmRzWzJdID0gdGhpcy5nZXRfdHlwZShub2Rlc1syXSk7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gKHIuaW5kZXhPZihcIiFcIikgPT09IDApID8gZmFsc2UgOiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW4pIHIgPSByLnJlcGxhY2UoXCIhXCIsXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gci5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgMzsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodG1wW2pdID09IG5kc1tqXSB8fCB0bXBbal0gPT0gXCIqXCIpIHRtcFtqXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0bXBbMF0gPT09IHRydWUgJiYgdG1wWzFdID09PSB0cnVlICYmIHRtcFsyXSA9PT0gdHJ1ZSkgcmV0dXJuIG47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoJC5pbkFycmF5KHRoaXMuZ2V0X3R5cGUobm9kZXMpLHRoaXMuc2V0dGluZ3MucnVsZXNbcnVsZV0pICE9IC0xKSA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBob3Zlcl9icmFuY2ggOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuaG92ZXJfbW9kZSA9PSBmYWxzZSkgcmV0dXJuIHRoaXMuc2VsZWN0X2JyYW5jaChvYmopO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IF90aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICAgICAgaWYoIW9iai5zaXplKCkpIHJldHVybiB0aGlzLmVycm9yKFwiSE9WRVI6IE5PVCBBIFZBTElEIE5PREVcIik7XG4gICAgICAgICAgICAgICAgLy8gQ0hFQ0sgQUdBSU5TVCBSVUxFUyBGT1IgU0VMRUNUQUJMRSBOT0RFU1xuICAgICAgICAgICAgICAgIGlmKCFfdGhpcy5jaGVjayhcImNsaWNrYWJsZVwiLCBvYmopKSByZXR1cm4gdGhpcy5lcnJvcihcIlNFTEVDVDogTk9ERSBOT1QgU0VMRUNUQUJMRVwiKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmhvdmVyZWQpIHRoaXMuaG92ZXJlZC5jaGlsZHJlbihcIkFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKTtcblxuICAgICAgICAgICAgICAgIC8vIFNBVkUgTkVXTFkgU0VMRUNURURcbiAgICAgICAgICAgICAgICB0aGlzLmhvdmVyZWQgPSBvYmo7XG5cbiAgICAgICAgICAgICAgICAvLyBGT0NVUyBORVcgTk9ERSBBTkQgT1BFTiBBTEwgUEFSRU5UIE5PREVTIElGIENMT1NFRFxuICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJlZC5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKS5hZGRDbGFzcyhcImhvdmVyXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gU0NST0xMIFNFTEVDVEVEIE5PREUgSU5UTyBWSUVXXG4gICAgICAgICAgICAgICAgdmFyIG9mZl90ID0gdGhpcy5ob3ZlcmVkLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgICB2YXIgYmVnX3QgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgdmFyIGVuZF90ID0gYmVnX3QgKyB0aGlzLmNvbnRhaW5lci5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgaF9jb3IgPSAodGhpcy5jb250YWluZXIuZ2V0KDApLnNjcm9sbFdpZHRoID4gdGhpcy5jb250YWluZXIud2lkdGgoKSkgPyA0MCA6IDIwO1xuICAgICAgICAgICAgICAgIGlmKG9mZl90ICsgNSA8IGJlZ190KSB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AodGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgLSAoYmVnX3QgLSBvZmZfdCArIDUpICk7XG4gICAgICAgICAgICAgICAgaWYob2ZmX3QgKyBoX2NvciA+IGVuZF90KSB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AodGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgKyAob2ZmX3QgKyBoX2NvciAtIGVuZF90KSApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdF9icmFuY2ggOiBmdW5jdGlvbiAob2JqLCBtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICBpZighb2JqICYmIHRoaXMuaG92ZXJlZCAhPT0gZmFsc2UpIG9iaiA9IHRoaXMuaG92ZXJlZDtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIG9iaiA9IF90aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICAgICAgaWYoIW9iai5zaXplKCkpIHJldHVybiB0aGlzLmVycm9yKFwiU0VMRUNUOiBOT1QgQSBWQUxJRCBOT0RFXCIpO1xuICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAvLyBDSEVDSyBBR0FJTlNUIFJVTEVTIEZPUiBTRUxFQ1RBQkxFIE5PREVTXG4gICAgICAgICAgICAgICAgaWYoIV90aGlzLmNoZWNrKFwiY2xpY2thYmxlXCIsIG9iaikpIHJldHVybiB0aGlzLmVycm9yKFwiU0VMRUNUOiBOT0RFIE5PVCBTRUxFQ1RBQkxFXCIpO1xuICAgICAgICAgICAgICAgIGlmKF90aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZWNoYW5nZS5jYWxsKG51bGwsb2JqLmdldCgwKSxfdGhpcykgPT09IGZhbHNlKSByZXR1cm4gdGhpcy5lcnJvcihcIlNFTEVDVDogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgICAgIC8vIElGIG11bHRpcGxlIEFORCBvYmogSVMgQUxSRUFEWSBTRUxFQ1RFRCAtIERFU0VMRUNUIElUXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiBtdWx0aXBsZSAmJiBvYmouY2hpbGRyZW4oXCJhLmNsaWNrZWRcIikuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZXNlbGVjdF9icmFuY2gob2JqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiBtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkX2Fyci5wdXNoKG9iaik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgIW11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihpIGluIHRoaXMuc2VsZWN0ZWRfYXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkX2FycltpXS5jaGlsZHJlbihcIkFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyLnB1c2gob2JqKTtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcIkFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZighdGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkKSB0aGlzLnNlbGVjdGVkLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFNBVkUgTkVXTFkgU0VMRUNURURcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gb2JqO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuaG92ZXJfbW9kZSAmJiB0aGlzLmhvdmVyZWQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJlZC5jaGlsZHJlbihcIkFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmVkID0gb2JqO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEZPQ1VTIE5FVyBOT0RFIEFORCBPUEVOIEFMTCBQQVJFTlQgTk9ERVMgSUYgQ0xPU0VEXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpLmFkZENsYXNzKFwiY2xpY2tlZFwiKS5lbmQoKS5wYXJlbnRzKFwibGkuY2xvc2VkXCIpLmVhY2goIGZ1bmN0aW9uICgpIHsgX3RoaXMub3Blbl9icmFuY2godGhpcywgdHJ1ZSk7IH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU0NST0xMIFNFTEVDVEVEIE5PREUgSU5UTyBWSUVXXG4gICAgICAgICAgICAgICAgdmFyIG9mZl90ID0gdGhpcy5zZWxlY3RlZC5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgdmFyIGJlZ190ID0gdGhpcy5jb250YWluZXIub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgIHZhciBlbmRfdCA9IGJlZ190ICsgdGhpcy5jb250YWluZXIuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdmFyIGhfY29yID0gKHRoaXMuY29udGFpbmVyLmdldCgwKS5zY3JvbGxXaWR0aCA+IHRoaXMuY29udGFpbmVyLndpZHRoKCkpID8gNDAgOiAyMDtcbiAgICAgICAgICAgICAgICBpZihvZmZfdCArIDUgPCBiZWdfdCkgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCgpIC0gKGJlZ190IC0gb2ZmX3QgKyA1KSApO1xuICAgICAgICAgICAgICAgIGlmKG9mZl90ICsgaF9jb3IgPiBlbmRfdCkgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCgpICsgKG9mZl90ICsgaF9jb3IgLSBlbmRfdCkgKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25jaGFuZ2UuY2FsbChudWxsLCB0aGlzLnNlbGVjdGVkLmdldCgwKSwgX3RoaXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc2VsZWN0X2JyYW5jaCA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkX2FyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwiYS5jbGlja2VkXCIpLmZpbHRlcihcIjpmaXJzdC1jaGlsZFwiKS5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdGVkX2Fyci5wdXNoKCQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLmdldCgwKSA9PSB0aGlzLnNlbGVjdGVkLmdldCgwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRoaXMuc2VsZWN0ZWRfYXJyWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UpIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQpICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25jaGFuZ2UuY2FsbChudWxsLCB0aGlzLnNlbGVjdGVkLmdldCgwKSwgX3RoaXMpO1xuICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmNoYW5nZS5jYWxsKG51bGwsIGZhbHNlLCBfdGhpcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9nZ2xlX2JyYW5jaCA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJjbG9zZWRcIikpICAgIHJldHVybiB0aGlzLm9wZW5fYnJhbmNoKG9iaik7XG4gICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwib3BlblwiKSkgICAgcmV0dXJuIHRoaXMuY2xvc2VfYnJhbmNoKG9iaik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3Blbl9icmFuY2ggOiBmdW5jdGlvbiAob2JqLCBkaXNhYmxlX2FuaW1hdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICBpZighb2JqLnNpemUoKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJPUEVOOiBOTyBTVUNIIE5PREVcIik7XG4gICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwibGVhZlwiKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJPUEVOOiBPUEVOSU5HIExFQUYgTk9ERVwiKTtcblxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luYyAmJiBvYmouZmluZChcImxpXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLnJlbW92ZSgpLmVuZCgpLmFwcGVuZChcIjx1bD48bGkgY2xhc3M9J2xhc3QnPjxhIHN0eWxlPSdiYWNrZ3JvdW5kLWltYWdlOnVybChcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvdGhyb2JiZXIuZ2lmKScgaHJlZj0nIyc+XCIgKyAoX3RoaXMuc2V0dGluZ3MubGFuZy5sb2FkaW5nIHx8IFwiTG9hZGluZyAuLi5cIikgKyBcIjwvYT48L2xpPjwvdWw+XCIpO1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcInhtbF9mbGF0XCIgfHwgdGhpcy5zZXR0aW5ncy5kYXRhLnR5cGUgPT0gXCJ4bWxfbmVzdGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4c2wgPSAodGhpcy5zZXR0aW5ncy5kYXRhLnR5cGUgPT0gXCJ4bWxfZmxhdFwiKSA/IFwiZmxhdC54c2xcIiA6IFwibmVzdGVkLnhzbFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9ICh0aGlzLnNldHRpbmdzLmRhdGEudXJsLmluZGV4T2YoXCI/XCIpID09IC0xKSA/IFwiP2lkPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9iai5hdHRyKFwiaWRcIikpIDogXCImaWQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob2JqLmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5nZXRUcmFuc2Zvcm0odGhpcy5wYXRoICsgeHNsLCB0aGlzLnNldHRpbmdzLmRhdGEudXJsICsgc3RyLCB7IHBhcmFtcyA6IHsgdGhlbWVfcGF0aCA6IF90aGlzLnRoZW1lIH0sIG1ldGggOiB0aGlzLnNldHRpbmdzLmRhdGEubWV0aG9kLCByZXBsIDogdHJ1ZSwgY2FsbGJhY2s6IGZ1bmN0aW9uIChzdHIsIGpzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3RyLmxlbmd0aCA8IDE1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLmFkZENsYXNzKFwibGVhZlwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5vcGVuX2JyYW5jaC5hcHBseShfdGhpcywgW29ial0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWxsYmFjaykgY2FsbGJhY2suY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS5tZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsICAgICAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEudXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jX2RhdGEob2JqKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZSAgICA6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgICAgICAgIDogZnVuY3Rpb24gKGRhdGEsIHRleHRTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWRhdGEgfHwgZGF0YS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLnJlbW92ZUNsYXNzKFwib3BlblwiKS5hZGRDbGFzcyhcImxlYWZcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrKSBjYWxsYmFjay5jYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSBfdGhpcy5wYXJzZUpTT04oZGF0YVtpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBzdHIgPSBfdGhpcy5wYXJzZUpTT04oZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLnJlcGxhY2VXaXRoKFwiPHVsPlwiICsgc3RyICsgXCI8L3VsPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmZpbmQoXCJsaTpsYXN0LWNoaWxkXCIpLmFkZENsYXNzKFwibGFzdFwiKS5lbmQoKS5maW5kKFwibGk6aGFzKHVsKVwiKS5ub3QoXCIub3BlblwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmZpbmQoXCJsaVwiKS5ub3QoXCIub3BlblwiKS5ub3QoXCIuY2xvc2VkXCIpLmFkZENsYXNzKFwibGVhZlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub3Blbl9icmFuY2guYXBwbHkoX3RoaXMsIFtvYmpdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHBhcnNlSW50KHRoaXMuc2V0dGluZ3MudWkuYW5pbWF0aW9uKSA+IDAgJiYgIWRpc2FibGVfYW5pbWF0aW9uICYmICEoJC5icm93c2VyLm1zaWUgJiYgJC5icm93c2VyLnZlcnNpb24gPCA3KSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmNzcyhcImRpc3BsYXlcIixcIm5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuc2xpZGVEb3duKHBhcnNlSW50KHRoaXMuc2V0dGluZ3MudWkuYW5pbWF0aW9uKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJkaXNwbGF5XCIsXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLmFkZENsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrKSBjYWxsYmFjay5jYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbm9wZW4uY2FsbChudWxsLCBvYmouZ2V0KDApLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsb3NlX2JyYW5jaCA6IGZ1bmN0aW9uIChvYmosIGRpc2FibGVfYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICBpZihwYXJzZUludCh0aGlzLnNldHRpbmdzLnVpLmFuaW1hdGlvbikgPiAwICYmICFkaXNhYmxlX2FuaW1hdGlvbiAmJiAhKCQuYnJvd3Nlci5tc2llICYmICQuYnJvd3Nlci52ZXJzaW9uIDwgNykgJiYgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuc2l6ZSgpID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuc2xpZGVVcChwYXJzZUludCh0aGlzLnNldHRpbmdzLnVpLmFuaW1hdGlvbiksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwib3BlblwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldF9jb29raWUoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJkaXNwbGF5XCIsXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwib3BlblwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCAmJiBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5maW5kKFwiYS5jbGlja2VkXCIpLnNpemUoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmZpbmQoXCJsaTpoYXMoYS5jbGlja2VkKVwiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVzZWxlY3RfYnJhbmNoKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLmNoaWxkcmVuKFwiYS5jbGlja2VkXCIpLnNpemUoKSA9PSAwKSB0aGlzLnNlbGVjdF9icmFuY2gob2JqLCAodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiB0aGlzLnNlbGVjdGVkX2Fyci5sZW5ndGggPiAwKSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uY2xvc2UuY2FsbChudWxsLCBvYmouZ2V0KDApLCB0aGlzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcGVuX2FsbCA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICBvYmogPSBvYmogPyAkKG9iaikgOiB0aGlzLmNvbnRhaW5lcjtcbiAgICAgICAgICAgICAgICBvYmouZmluZChcImxpLmNsb3NlZFwiKS5lYWNoKCBmdW5jdGlvbiAoKSB7IHZhciBfX3RoaXMgPSB0aGlzOyBfdGhpcy5vcGVuX2JyYW5jaC5hcHBseShfdGhpcywgW3RoaXMsIHRydWUsIGZ1bmN0aW9uKCkgeyBfdGhpcy5vcGVuX2FsbC5hcHBseShfdGhpcywgW19fdGhpc10pOyB9IF0pOyB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9zZV9hbGwgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgJCh0aGlzLmNvbnRhaW5lcikuZmluZChcImxpLm9wZW5cIikuZWFjaCggZnVuY3Rpb24gKCkgeyBfdGhpcy5jbG9zZV9icmFuY2godGhpcywgdHJ1ZSk7IH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dfbGFuZyA6IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldID09IHRoaXMuY3VycmVudF9sYW5nKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgc3QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIikgPyBcIiNcIiArIHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSA6IFwiLnRyZWVcIjtcbiAgICAgICAgICAgICAgICBzdCA9IGdldF9jc3MoaWQgKyBcIiAuXCIgKyB0aGlzLmN1cnJlbnRfbGFuZywgdGhpcy5zbik7XG4gICAgICAgICAgICAgICAgaWYoc3QgIT09IGZhbHNlKSBzdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgc3QgPSBnZXRfY3NzKGlkICsgXCIgLlwiICsgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0sIHRoaXMuc24pO1xuICAgICAgICAgICAgICAgIGlmKHN0ICE9PSBmYWxzZSkgc3Quc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfbGFuZyA9IHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGN5Y2xlX2xhbmcgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAkLmluQXJyYXkodGhpcy5jdXJyZW50X2xhbmcsIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzKTtcbiAgICAgICAgICAgICAgICBpICsrO1xuICAgICAgICAgICAgICAgIGlmKGkgPiB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGggLSAxKSBpID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dfbGFuZyhpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGUgOiBmdW5jdGlvbiAodHlwZSwgb2JqLCBkYXRhLCBpY29uLCBpZCApIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgLy8gTk9USElORyBTRUxFQ1RFRFxuICAgICAgICAgICAgICAgIG9iaiA9IG9iaiA/IHRoaXMuZ2V0X25vZGUob2JqKSA6IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgaWYoIW9iaiB8fCAhb2JqLnNpemUoKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJjcmVhdGFibGVcIiwgb2JqKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IENBTk5PVCBDUkVBVEUgSU4gTk9ERVwiKTtcblxuICAgICAgICAgICAgICAgIHZhciB0ID0gdHlwZSB8fCB0aGlzLmdldF90eXBlKG9iaikgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLnVzZV9pbmxpbmUgJiYgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkLm1ldGFkYXRhLnNldFR5cGUoXCJhdHRyXCIsIHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2Ygb2JqLm1ldGFkYXRhKClbXCJ2YWxpZF9jaGlsZHJlblwiXSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkLmluQXJyYXkodCwgb2JqLm1ldGFkYXRhKClbXCJ2YWxpZF9jaGlsZHJlblwiXSkgPT0gLTEpIHJldHVybiB0aGlzLmVycm9yKFwiQ1JFQVRFOiBOT0RFIE5PVCBBIFZBTElEIENISUxEXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBvYmoubWV0YWRhdGEoKVtcIm1heF9jaGlsZHJlblwiXSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiggKG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGlcIikuc2l6ZSgpICsgMSkgPiBvYmoubWV0YWRhdGEoKS5tYXhfY2hpbGRyZW4pIHJldHVybiB0aGlzLmVycm9yKFwiQ1JFQVRFOiBNQVhfQ0hJTERSRU4gUkVBQ0hFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgb2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBvYmoucGFyZW50cyhcImxpXCIpLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5tZXRhZGF0YSgpLm1heF9kZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAoaSArIDEpID49ICQodGhpcykubWV0YWRhdGEoKS5tYXhfZGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZighb2spIHJldHVybiB0aGlzLmVycm9yKFwiQ1JFQVRFOiBNQVhfREVQVEggUkVBQ0hFRFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwiY2xvc2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZW5fYnJhbmNoKG9iaiwgdHJ1ZSwgZnVuY3Rpb24gKCkgeyBfdGhpcy5jcmVhdGUuYXBwbHkoX3RoaXMsIFt0eXBlLCBvYmosIGRhdGEsIGljb24sIGlkXSk7IH0gKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZihpZCkgICAgJGxpID0gJChcIjxsaSBpZD0nXCIgKyBpZCArIFwiJyAvPlwiKTtcbiAgICAgICAgICAgICAgICBlbHNlICAgICRsaSA9ICQoXCI8bGkgLz5cIik7XG4gICAgICAgICAgICAgICAgLy8gTkVXIE5PREUgSVMgT0YgUEFTU0VEIFRZUEUgT1IgUEFSRU5UJ1MgVFlQRVxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5tZXRhZGF0YS5zZXRUeXBlKFwiYXR0clwiLCB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgJGxpLmF0dHIodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSwgXCJ0eXBlOiAnXCIgKyB0ICsgXCInXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGxpLmF0dHIodGhpcy5zZXR0aW5ncy5ydWxlcy50eXBlX2F0dHIsIHQpXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGljbiA9IFwiXCI7XG4gICAgICAgICAgICAgICAgaWYoKHR5cGVvZiBpY29uKS50b0xvd2VyQ2FzZSgpID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWNuID0gaWNvbjtcbiAgICAgICAgICAgICAgICAgICAgaWNuID0gaWNuLmluZGV4T2YoXCIvXCIpID09IC0xID8gdGhpcy50aGVtZSArIGljbiA6IGljbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIGRhdGEpLnRvTG93ZXJDYXNlKCkgPT0gXCJzdHJpbmdcIikgdmFsID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoZGF0YSAmJiBkYXRhW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gZGF0YVtpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYodGhpcy5zZXR0aW5ncy5sYW5nLm5ld19ub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKHR5cGVvZiB0aGlzLnNldHRpbmdzLmxhbmcubmV3X25vZGUpLnRvTG93ZXJDYXNlKCkgIT0gXCJzdHJpbmdcIiAmJiB0aGlzLnNldHRpbmdzLmxhbmcubmV3X25vZGVbaV0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuc2V0dGluZ3MubGFuZy5uZXdfbm9kZVtpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuc2V0dGluZ3MubGFuZy5uZXdfbm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IFwiTmV3IGZvbGRlclwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoKHR5cGVvZiBpY29uKS50b0xvd2VyQ2FzZSgpICE9IFwic3RyaW5nXCIgJiYgaWNvbiAmJiBpY29uW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNuID0gaWNvbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY24gPSBpY24uaW5kZXhPZihcIi9cIikgPT0gLTEgPyB0aGlzLnRoZW1lICsgaWNuIDogaWNuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgJGxpLmFwcGVuZChcIjxhIGhyZWY9JyMnXCIgKyAoIGljbi5sZW5ndGggPyBcIiBzdHlsZT0nYmFja2dyb3VuZC1pbWFnZTp1cmwoXFxcIlwiICsgaWNuICsgXCJcXFwiKTsnIFwiIDogXCIgXCIpICsgXCJjbGFzcz0nXCIgKyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXSArIFwiJz5cIiArIHZhbCArIFwiPC9hPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHsgJGxpLmFwcGVuZChcIjxhIGhyZWY9JyMnXCIgKyAoIGljbi5sZW5ndGggPyBcIiBzdHlsZT0nYmFja2dyb3VuZC1pbWFnZTp1cmwoXFxcIlwiICsgaWNuICsgXCJcXFwiKTsnIFwiIDogXCIgXCIpICsgXCI+XCIgKyAoZGF0YSB8fCB0aGlzLnNldHRpbmdzLmxhbmcubmV3X25vZGUgfHwgXCJOZXcgZm9sZGVyXCIpICsgXCI8L2E+XCIpOyB9XG4gICAgICAgICAgICAgICAgJGxpLmFkZENsYXNzKFwibGVhZlwiKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmNyZWF0ZWF0ID09IFwidG9wXCIgfHwgb2JqLmNoaWxkcmVuKFwidWxcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCgkbGksb2JqLmNoaWxkcmVuKFwiYTplcSgwKVwiKSxcImluc2lkZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZWQoJGxpLG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5jaGlsZHJlbihcImE6ZXEoMClcIiksXCJhZnRlclwiLHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdF9icmFuY2goJGxpLmNoaWxkcmVuKFwiYTplcSgwKVwiKSk7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEpIHRoaXMucmVuYW1lKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRsaTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW5hbWUgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJyZW5hbWVhYmxlXCIsIHRoaXMuc2VsZWN0ZWQpKSByZXR1cm4gdGhpcy5lcnJvcihcIlJFTkFNRTogTk9ERSBOT1QgUkVOQU1BQkxFXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5iZWZvcmVyZW5hbWUuY2FsbChudWxsLHRoaXMuc2VsZWN0ZWQuZ2V0KDApLCBfdGhpcy5jdXJyZW50X2xhbmcsIF90aGlzKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJSRU5BTUU6IFNUT1BQRUQgQlkgVVNFUlwiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudF9sYW5nKSAgICBvYmogPSBvYmouZmluZChcImEuXCIgKyB0aGlzLmN1cnJlbnRfbGFuZykuZ2V0KDApO1xuICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICBvYmogPSBvYmouZmluZChcImE6Zmlyc3RcIikuZ2V0KDApO1xuICAgICAgICAgICAgICAgICAgICBsYXN0X3ZhbHVlID0gb2JqLmlubmVySFRNTDtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5wID0gJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyAvPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5wXG4gICAgICAgICAgICAgICAgICAgICAgICAudmFsKGxhc3RfdmFsdWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYmluZChcInBvaW50ZXJkb3duXCIsICAgICAgICBmdW5jdGlvbiAoZXZlbnQpIHsgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYmluZChcInBvaW50ZXJ1cFwiLCAgICAgICAgZnVuY3Rpb24gKGV2ZW50KSB7IGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJjbGlja1wiLCAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkgeyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwia2V5dXBcIiwgICAgICAgICAgICBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2g7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PSAyNykgeyB0aGlzLnZhbHVlID0gbGFzdF92YWx1ZTsgdGhpcy5ibHVyKCk7IHJldHVybiB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PSAxMykgeyB0aGlzLmJsdXIoKTsgcmV0dXJuIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5wLmJsdXIoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZhbHVlID09IFwiXCIpIHRoaXMudmFsdWUgPT0gbGFzdF92YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKG9iaikuaHRtbCggJChvYmopLnBhcmVudCgpLmZpbmQoXCJpbnB1dFwiKS5lcSgwKS5hdHRyKFwidmFsdWVcIikgKS5nZXQoMCkuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChvYmopLnByZXZBbGwoXCJzcGFuXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudmFsdWUgIT0gbGFzdF92YWx1ZSkgX3RoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25yZW5hbWUuY2FsbChudWxsLCBfdGhpcy5nZXRfbm9kZShvYmopLmdldCgwKSwgX3RoaXMuY3VycmVudF9sYW5nLCBfdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5wID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwbiA9ICQoXCI8c3BhbiAvPlwiKS5hZGRDbGFzcyhvYmouY2xhc3NOYW1lKS5hcHBlbmQoX3RoaXMuaW5wKTtcbiAgICAgICAgICAgICAgICAgICAgc3BuLmF0dHIoXCJzdHlsZVwiLCAkKG9iaikuYXR0cihcInN0eWxlXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgJChvYmopLnBhcmVudCgpLnByZXBlbmQoc3BuKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5wLmdldCgwKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnAuZ2V0KDApLnNlbGVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLmVycm9yKFwiUkVOQU1FOiBOTyBOT0RFIFNFTEVDVEVEXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIFJFTU9WRSBOT0RFU1xuICAgICAgICAgICAgcmVtb3ZlIDogZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgICAgICBvYmogPSB0aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICAgICAgICAgIGlmKG9iai5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNoZWNrKFwiZGVsZXRhYmxlXCIsIG9iaikpIHJldHVybiB0aGlzLmVycm9yKFwiREVMRVRFOiBOT0RFIE5PVCBERUxFVEFCTEVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5iZWZvcmVkZWxldGUuY2FsbChudWxsLG9iai5nZXQoMCksIF90aGlzKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJERUxFVEU6IFNUT1BQRUQgQlkgVVNFUlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJlbnQgPSBvYmoucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSBvYmoucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkcGFyZW50LmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkcGFyZW50LmNoaWxkcmVuKFwibGlcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGkgPSAkcGFyZW50LnBhcmVudHMoXCJsaTplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGkucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLmFkZENsYXNzKFwibGVhZlwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uZGVsZXRlLmNhbGwobnVsbCwgb2JqLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJkZWxldGFibGVcIiwgdGhpcy5zZWxlY3RlZCkpIHJldHVybiB0aGlzLmVycm9yKFwiREVMRVRFOiBOT0RFIE5PVCBERUxFVEFCTEVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZWRlbGV0ZS5jYWxsKG51bGwsdGhpcy5zZWxlY3RlZC5nZXQoMCksIF90aGlzKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJERUxFVEU6IFNUT1BQRUQgQlkgVVNFUlwiKTtcbiAgICAgICAgICAgICAgICAgICAgJHBhcmVudCA9IHRoaXMuc2VsZWN0ZWQucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlID09IGZhbHNlIHx8IHRoaXMuc2VsZWN0ZWRfYXJyLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gKHRoaXMuc2VsZWN0ZWQucHJldihcImxpOmVxKDApXCIpLnNpemUoKSkgPyB0aGlzLnNlbGVjdGVkLnByZXYoXCJsaTplcSgwKVwiKSA6IHRoaXMuc2VsZWN0ZWQucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5nZXRfcHJldih0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvYmogPSBvYmoucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICRwYXJlbnQuY2hpbGRyZW4oXCJsaTpsYXN0XCIpLmFkZENsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoJHBhcmVudC5jaGlsZHJlbihcImxpXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbGkgPSAkcGFyZW50LnBhcmVudHMoXCJsaTplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsaS5yZW1vdmVDbGFzcyhcIm9wZW5cIikucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJsZWFmXCIpLmNoaWxkcmVuKFwidWxcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9jb29raWUoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uZGVsZXRlLmNhbGwobnVsbCwgb2JqLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoc3RvcCAmJiB0bXApIHRoaXMuc2VsZWN0X2JyYW5jaCh0bXApO1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmICFzdG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9hcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoXCJhLmNsaWNrZWRcIikuZmlsdGVyKFwiOmZpcnN0LWNoaWxkXCIpLnBhcmVudCgpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdGVkX2Fyci5wdXNoKCQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkX2Fyci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRoaXMuc2VsZWN0ZWRfYXJyWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5lcnJvcihcIkRFTEVURTogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBGT1IgRVhQTE9SRVItTElLRSBLRVlCT0FSRCBTSE9SVENVVFNcbiAgICAgICAgICAgIGdldF9uZXh0IDogZnVuY3Rpb24oZm9yY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5ob3ZlcmVkIHx8IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcIm9wZW5cIikpICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcmNlID8gdGhpcy5zZWxlY3RfYnJhbmNoKG9iai5maW5kKFwibGk6ZXEoMClcIikpIDogdGhpcy5ob3Zlcl9icmFuY2gob2JqLmZpbmQoXCJsaTplcSgwKVwiKSk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoJChvYmopLm5leHRBbGwoXCJsaVwiKS5zaXplKCkgPiAwKSAgICByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqLm5leHRBbGwoXCJsaTplcSgwKVwiKSkgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmoubmV4dEFsbChcImxpOmVxKDApXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcmNlID8gdGhpcy5zZWxlY3RfYnJhbmNoKG9iai5wYXJlbnRzKFwibGlcIikubmV4dChcImxpXCIpLmVxKDApKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5wYXJlbnRzKFwibGlcIikubmV4dChcImxpXCIpLmVxKDApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0X3ByZXYgOiBmdW5jdGlvbihmb3JjZSkge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmhvdmVyZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLnByZXYoXCJsaVwiKS5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBvYmoucHJldihcImxpXCIpLmVxKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUob2JqLmhhc0NsYXNzKFwib3BlblwiKSkgb2JqID0gb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaTpsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcmNlID8gdGhpcy5zZWxlY3RfYnJhbmNoKG9iaikgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmopO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgeyByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqLnBhcmVudHMoXCJsaTplcSgwKVwiKSkgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmoucGFyZW50cyhcImxpOmVxKDApXCIpKTsgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRfbGVmdCA6IGZ1bmN0aW9uKGZvcmNlLCBydGwpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLnJ0bCAmJiAhcnRsKSByZXR1cm4gdGhpcy5nZXRfcmlnaHQoZm9yY2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmhvdmVyZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwib3BlblwiKSkgICAgdGhpcy5jbG9zZV9icmFuY2gob2JqKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqLnBhcmVudHMoXCJsaTplcSgwKVwiKSkgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmoucGFyZW50cyhcImxpOmVxKDApXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRfcmlnaHQgOiBmdW5jdGlvbihmb3JjZSwgcnRsKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ydGwgJiYgIXJ0bCkgcmV0dXJuIHRoaXMuZ2V0X2xlZnQoZm9yY2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmhvdmVyZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwiY2xvc2VkXCIpKSAgICB0aGlzLm9wZW5fYnJhbmNoKG9iaik7XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcmNlID8gdGhpcy5zZWxlY3RfYnJhbmNoKG9iai5maW5kKFwibGk6ZXEoMClcIikpIDogdGhpcy5ob3Zlcl9icmFuY2gob2JqLmZpbmQoXCJsaTplcSgwKVwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9nZ2xlRG90cyA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci50b2dnbGVDbGFzcyhcIm5vX2RvdHNcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0X2Nvb2tpZSA6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5jb29raWVzID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qY2FzZSBcInNlbGVjdGVkXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmIHRoaXMuc2VsZWN0ZWRfYXJyLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gQXJyYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0aGlzLnNlbGVjdGVkX2FyciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwucHVzaCh0aGlzLmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsLmpvaW4oXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB2YXIgdmFsID0gdGhpcy5zZWxlY3RlZCA/IHRoaXMuc2VsZWN0ZWQuYXR0cihcImlkXCIpIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX3NlbGVjdGVkJyx2YWwsdGhpcy5zZXR0aW5ncy5jb29raWVzLm9wdHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ki9cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm9wZW5cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImxpLm9wZW5cIikuZWFjaChmdW5jdGlvbiAoaSkgeyBzdHIgKz0gdGhpcy5pZCArIFwiLFwiOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX29wZW4nLHN0ci5yZXBsYWNlKC8sJC9pZyxcIlwiKSx0aGlzLnNldHRpbmdzLmNvb2tpZXMub3B0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW92ZWQgOiBmdW5jdGlvbiAod2hhdCwgd2hlcmUsIGhvdywgaXNfbmV3LCBpc19jb3B5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHdoYXQgICAgPSAkKHdoYXQpO1xuICAgICAgICAgICAgICAgIHZhciAkcGFyZW50ICAgID0gJCh3aGF0KS5wYXJlbnRzKFwidWw6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgdmFyICR3aGVyZSAgICA9ICQod2hlcmUpO1xuICAgICAgICAgICAgICAgIC8vIElGIE1VTFRJUExFXG4gICAgICAgICAgICAgICAgaWYod2hhdC5zaXplKCkgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLm1vdmVkKHdoYXQuZXEoMCksd2hlcmUsaG93LCBmYWxzZSwgaXNfY29weSk7XG4gICAgICAgICAgICAgICAgICAgIHdoYXQuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaSA9PSAwKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSBfdGhpcy5tb3ZlZCh0aGlzLCB0bXAuY2hpbGRyZW4oXCJhOmVxKDApXCIpLCBcImFmdGVyXCIsIGZhbHNlLCBpc19jb3B5KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihpc19jb3B5KSB7XG4gICAgICAgICAgICAgICAgICAgIHdoYXQgPSB3aGF0LmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoYXQuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pZCA9IHRoaXMuaWQgKyBcIl9jb3B5XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJsaVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gdGhpcy5pZCArIFwiX2NvcHlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJhLmNsaWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoaXNfbmV3KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZWNyZWF0ZS5jYWxsKG51bGwsdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSxob3csdGhpcykpIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZW1vdmUuY2FsbChudWxsLHRoaXMuZ2V0X25vZGUod2hhdCkuZ2V0KDApLCB0aGlzLmdldF9ub2RlKHdoZXJlKS5nZXQoMCksaG93LHRoaXMpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoIWlzX25ldykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gJCh3aGF0KS5wYXJlbnRzKFwiLnRyZWU6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGRpZmZlcmVudCB0cmVlc1xuICAgICAgICAgICAgICAgICAgICBpZih0bXAuZ2V0KDApICE9IHRoaXMuY29udGFpbmVyLmdldCgwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdHJlZV9jb21wb25lbnQuaW5zdFt0bXAuYXR0cihcImlkXCIpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSBsYW5ndWFnZXMgLSBvdGhlcndpc2UgLSBubyBjbGVhbnVwIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodG1wLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbmV3IHRyZWUgaGFzIG5vIGxhbmd1YWdlcyAtIHVzZSBjdXJyZW50IHZpc2libGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGggPT0gMCkgcmVzLnB1c2goXCIuXCIgKyB0bXAuY3VycmVudF9sYW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqIGluIHRtcC5zZXR0aW5ncy5sYW5ndWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXSA9PSB0bXAuc2V0dGluZ3MubGFuZ3VhZ2VzW2pdKSByZXMucHVzaChcIi5cIiArIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXMubGVuZ3RoID09IDApIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogTk8gQ09NTU9OIExBTkdVQUdFU1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGF0LmZpbmQoXCJhXCIpLnJlbW92ZUNsYXNzKFwiY2xpY2tlZFwiKS5ub3QocmVzLmpvaW4oXCIsXCIpKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFERCBOT0RFIFRPIE5FVyBQTEFDRVxuICAgICAgICAgICAgICAgIHN3aXRjaChob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJlZm9yZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpLmxhc3RcIikucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5iZWZvcmUod2hhdC5yZW1vdmVDbGFzcyhcImxhc3RcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhZnRlclwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpLmxhc3RcIikucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5hZnRlcih3aGF0LnJlbW92ZUNsYXNzKFwibGFzdFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImluc2lkZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0X25vZGUoJHdoZXJlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJjbG9zZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub3Blbl9icmFuY2gob2JqLCB0cnVlLCBmdW5jdGlvbiAoKSB7IF90aGlzLm1vdmVkLmFwcGx5KF90aGlzLCBbd2hhdCwgd2hlcmUsIGhvdywgaXNfbmV3LCBpc19jb3B5XSk7IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5jaGlsZHJlbihcInVsOmZpcnN0XCIpLnNpemUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMuY3JlYXRlYXQgPT0gXCJ0b3BcIikgICAgJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5jaGlsZHJlbihcInVsOmZpcnN0XCIpLnByZXBlbmQod2hhdC5yZW1vdmVDbGFzcyhcImxhc3RcIikpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmNoaWxkcmVuKFwidWw6Zmlyc3RcIikuY2hpbGRyZW4oXCIubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIikuZW5kKCkuYXBwZW5kKHdoYXQucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpKS5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hhdC5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5hcHBlbmQoXCI8dWwvPlwiKS5yZW1vdmVDbGFzcyhcImxlYWZcIikuYWRkQ2xhc3MoXCJjbG9zZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5jaGlsZHJlbihcInVsOmZpcnN0XCIpLnByZXBlbmQod2hhdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuX2JyYW5jaCgkd2hlcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ0xFQU5VUCBPTEQgUEFSRU5UXG4gICAgICAgICAgICAgICAgaWYoJHBhcmVudC5maW5kKFwibGlcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRsaSA9ICRwYXJlbnQucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICRsaS5yZW1vdmVDbGFzcyhcIm9wZW5cIikucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJsZWFmXCIpLmNoaWxkcmVuKFwidWxcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICRsaS5wYXJlbnRzKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaS5sYXN0XCIpLnJlbW92ZUNsYXNzKFwibGFzdFwiKS5lbmQoKS5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9jb29raWUoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHBhcmVudC5jaGlsZHJlbihcImxpLmxhc3RcIikucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAkcGFyZW50LmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGlzX25ldyAmJiBob3cgIT0gXCJpbnNpZGVcIikgd2hlcmUgPSB0aGlzLmdldF9ub2RlKHdoZXJlKS5wYXJlbnRzKFwibGk6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgaWYoaXNfY29weSkgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25jb3B5LmNhbGwobnVsbCwgdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSwgaG93LCB0aGlzKVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoaXNfbmV3KSAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uY3JlYXRlLmNhbGwobnVsbCwgdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSwgdGhpcy5zZXR0aW5ncy5pbnNlcnRBdCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25tb3ZlLmNhbGwobnVsbCwgdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSwgaG93LCB0aGlzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2hhdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA6IGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5lcnJvci5jYWxsKG51bGwsY29kZSx0aGlzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9jayA6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9ja2VkID0gc3RhdGU7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpICAgIHRoaXMuY29udGFpbmVyLmFkZENsYXNzKFwibG9ja2VkXCIpO1xuICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImxvY2tlZFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjdXQgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNlbGVjdGVkKSByZXR1cm4gdGhpcy5lcnJvcihcIkNVVDogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvcHlfbm9kZXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1dF9ub2RlcyA9IHRoaXMuY29udGFpbmVyLmZpbmQoXCJhLmNsaWNrZWRcIikuZmlsdGVyKFwiOmZpcnN0LWNoaWxkXCIpLnBhcmVudCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvcHkgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNlbGVjdGVkKSByZXR1cm4gdGhpcy5lcnJvcihcIkNPUFk6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5jb3B5X25vZGVzID0gdGhpcy5jb250YWluZXIuZmluZChcImEuY2xpY2tlZFwiKS5maWx0ZXIoXCI6Zmlyc3QtY2hpbGRcIikucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXRfbm9kZXMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXN0ZSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWQpIHJldHVybiB0aGlzLmVycm9yKFwiUEFTVEU6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuY29weV9ub2RlcyAmJiAhdGhpcy5jdXRfbm9kZXMpIHJldHVybiB0aGlzLmVycm9yKFwiUEFTVEU6IE5PVEhJTkcgVE8gRE9cIik7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5jb3B5X25vZGVzICYmIHRoaXMuY29weV9ub2Rlcy5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2tNb3ZlKHRoaXMuY29weV9ub2RlcywgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcImE6ZXEoMClcIiksIFwiaW5zaWRlXCIpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZWQodGhpcy5jb3B5X25vZGVzLCB0aGlzLnNlbGVjdGVkLmNoaWxkcmVuKFwiYTplcSgwKVwiKSwgXCJpbnNpZGVcIiwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvcHlfbm9kZXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5jdXRfbm9kZXMgJiYgdGhpcy5jdXRfbm9kZXMuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNoZWNrTW92ZSh0aGlzLmN1dF9ub2RlcywgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcImE6ZXEoMClcIiksIFwiaW5zaWRlXCIpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZWQodGhpcy5jdXRfbm9kZXMsIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJhOmVxKDApXCIpLCBcImluc2lkZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXRfbm9kZXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VhcmNoIDogZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICBpZighc3RyIHx8ICh0aGlzLnNyY2ggJiYgc3RyICE9IHRoaXMuc3JjaCkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3JjaCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3JjaF9vcG4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImEuc2VhcmNoXCIpLnJlbW92ZUNsYXNzKFwic2VhcmNoXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNyY2ggPSBzdHI7XG4gICAgICAgICAgICAgICAgaWYoIXN0cikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luYykge1xuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5zcmNoX29wbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRkID0gJC5leHRlbmQoIHsgXCJzZWFyY2hcIiA6IHN0ciB9ICwgdGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jX2RhdGEoZmFsc2UpICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLm1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgICAgICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS51cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSAgICAgICAgOiBkZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZSAgICA6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgICAgICAgIDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3JjaF9vcG4gPSAkLnVuaXF1ZShkYXRhLnNwbGl0KFwiLFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaC5hcHBseShfdGhpcyxbc3RyXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNyY2hfb3BuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zcmNoX29wbiAmJiB0aGlzLnNyY2hfb3BuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcG4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgdGhpcy5zcmNoX29wbi5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmdldF9ub2RlKFwiI1wiICsgdGhpcy5zcmNoX29wbltqXSkuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBcIiNcIiArIHRoaXMuc3JjaF9vcG5bal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zcmNoX29wbltqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3Blbl9icmFuY2godG1wLCB0cnVlLCBmdW5jdGlvbiAoKSB7IF90aGlzLnNlYXJjaC5hcHBseShfdGhpcyxbc3RyXSk7IH0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighb3BuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3JjaF9vcG4gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaC5hcHBseShfdGhpcyxbc3RyXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gXCJhXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJRiBMQU5HVUFHRSBWRVJTSU9OU1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoKSBzZWxlY3RvciArPSBcIi5cIiArIHRoaXMuY3VycmVudF9sYW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChzZWxlY3RvciArIFwiOmNvbnRhaW5zKCdcIiArIHN0ciArIFwiJylcIikuYWRkQ2xhc3MoXCJzZWFyY2hcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNyY2hfb3BuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvciA9IFwiYVwiO1xuICAgICAgICAgICAgICAgICAgICAvLyBJRiBMQU5HVUFHRSBWRVJTSU9OU1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHNlbGVjdG9yICs9IFwiLlwiICsgdGhpcy5jdXJyZW50X2xhbmc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoc2VsZWN0b3IgKyBcIjpjb250YWlucygnXCIgKyBzdHIgKyBcIicpXCIpLmFkZENsYXNzKFwic2VhcmNoXCIpLnBhcmVudHMoXCJsaS5jbG9zZWRcIikuZWFjaCggZnVuY3Rpb24gKCkgeyBfdGhpcy5vcGVuX2JyYW5jaCh0aGlzLCB0cnVlKTsgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZGVzdHJveSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBldnRzID0gW1wiY2xpY2tcIixcImRibGNsaWNrXCIsXCJjb250ZXh0bWVudVwiLFwicG9pbnRlcm92ZXJcIixcInBvaW50ZXJkb3duXCJdO1xuICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiBldnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ZXIgPSB0aGlzLmNvbnRhaW5lci5pbmRleGVyKGV2dHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWR4ZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5yZW1vdmVEYXRhKCBpZHhlci5saXN0ZW5lciwgaWR4ZXIuZXZlbnQgKyAnLmluZGV4ZXInICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoKGVycikgeyB9XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIudW5iaW5kKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInRyZWVcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmVDbGFzcyhcInRyZWUtXCIgKyB0aGlzLnNldHRpbmdzLnVpLnRoZW1lX25hbWUpLmZpbmQoXCJsaVwiKS5yZW1vdmVDbGFzcyhcImxlYWZcIikucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLnJlbW92ZUNsYXNzKFwibGFzdFwiKS5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYodGhpcy5jbnRyID09IHRyZWVfY29tcG9uZW50LmZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdHJlZV9jb21wb25lbnQuaW5zdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaSAhPSB0aGlzLmNudHIgJiYgaSAhPSB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W2ldLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRyZWVfY29tcG9uZW50Lmluc3RbdGhpcy5jbnRyXTtcbiAgICAgICAgICAgICAgICBkZWxldGUgdHJlZV9jb21wb25lbnQuaW5zdFt0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIildO1xuICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmNudHIgLS07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufShDTVMuJCkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9