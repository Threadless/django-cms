{% load i18n adminmedia %}
<script type="text/javascript" src="{% admin_media_prefix %}js/jquery.min.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/libs/classy-1.3.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/jquery.cookie.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/jquery.ui.core.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/jquery.ui.draggable.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/jquery.ui.droppable.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/cms.base.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/cms.toolbar.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/cms.placeholders.js"></script>
<script type="text/javascript">
//<![CDATA[
jQuery(document).ready(function ($) {
	// load css file
	$('<link>').appendTo('head').attr({
		rel: 'stylesheet', type: 'text/css',
		href: '{{ CMS_MEDIA_URL }}css/plugins/cms.toolbar.css'
	});
	$('<link>').appendTo('head').attr({
		rel: 'stylesheet', type: 'text/css',
		href: '{{ CMS_MEDIA_URL }}css/plugins/cms.placeholders.css'
	});
	
	// invoke helpers method for toolbar
	CMS.Helpers = new CMS.Helpers();
	
	// original data
	var items=[
		{dir:'left',type:'anchor',order:1,class:'cms_toolbar-item_logo',title:'{% trans "django CMS" %}',url:'http://www.django-cms.org/'},
		{% if auth %}
		{dir:'left',type:'switcher',order:10,class:'cms_toolbar-item_editmode',addParameter:'edit',removeParameter:'edit-off',state:{% if edit %}true{% else %}false{% endif %},title:'{% trans "Edit mode" %}',url:'/'},
		{%if page.last_page_states%}
		{dir:'left',type:'html',order:20,class:'cms_toolbar-item_status',html:'<div class="cms_toolbar-item"><p>{% trans "Status" %}: <em>{% for state in page.last_page_states %}{{ state.get_action_display }} {% endfor %}<\/em><\/p><\/div>',htmlElement:''},
		{%endif%}
		{dir:'right',type:'list',order:30,class:'cms_toolbar-item_page',title:'{% trans "Page" %}',icon:'cms_toolbar_icon-edit',items:[{title:'{% trans "Move/add Pages" %}',url:'{% url admin:cms_page_changelist %}',icon:'cms_toolbar_icon-sitemap'}{%if has_add_page_permission%},{title:'{% trans "Add child page" %}',url:'{% url admin:cms_page_add %}?target={{ page.pk }}&amp;position=last-child',icon:'cms_toolbar_icon-child'},{title:'{% trans "Add sibling page" %}',url:'{% url admin:cms_page_add %}?{% if page.parent_id %}target={{ page.parent_id }}&amp;position=last-child{% endif %}',icon:'cms_toolbar_icon-sibling'}{%endif%}{%if has_delete_permission%},{title:'{% trans "Delete" %}',url:'{% url admin:cms_page_delete page.pk %}',icon:'cms_toolbar_icon-delete'},{%endif%}]},
		{dir:'right',type:'list',order:40,class:'cms_toolbar-item_admin',title:'{% trans "Admin" %}',icon:'cms_toolbar_icon-settings',items:[{title:'{% trans "Administration" %}',url:'{% url admin:index %}',icon:'cms_toolbar_icon-admin'}{%if has_change_permission%},{title:'{% trans "Page Settings" %}',url:'{% url admin:cms_page_change page.pk %}',icon:'cms_toolbar_icon-edit'},{title:'{% trans "Page History" %}',url:'{% url admin:cms_page_history page.pk %}',icon:'cms_toolbar_icon-history'}{%endif%}]},
		{dir:'right',type:'button',order:50,class:'cms_toolbar-item_logout',title:'{% trans "Logout" %}',icon:'cms_toolbar_icon-lock',action:'',hidden:'<input type="hidden" name="logout_submit" />'}{%if edit and page%},
		{%if moderator_should_approve and has_moderate_permission%}
		{dir:'right',type:'button',order:25,class:'cms_toolbar-item_moderator',title:'{{ page_moderator_state.label }}',icon:'',action:'',hidden:'',redirect:'{% url admin:cms_page_approve_page page.pk %}'}
		{%else%}
		{%if has_publish_permission%}
		{dir:'right',type:'button',order:25,class:'cms_toolbar-item_moderator',title:'{% trans "Publish" %}',icon:'',action:'',hidden:'',redirect:'{% url admin:cms_page_publish_page page.pk %}'}
		{%else%}
		{dir:'right',type:'button',order:25,class:'cms_toolbar-item_moderator',title:'{% trans "Request Approval" %}',icon:'',action:'',hidden:'',redirect:'{% url admin:cms_page_approve_page page.pk %}'}
		{%endif%}
		{%endif%}
		{%endif%}
		{%else%}
		{dir:'left',type:'html',order:20,class:'cms_toolbar-item_login',html:'',htmlElement:'#cms_toolbar-item_login'},
		{dir:'right',type:'button',order:20,class:'cms_toolbar-item_admin',title:'{% trans "Admin" %}',icon:'cms_toolbar_icon-settings',action:'',hidden:'',redirect:'{% url admin:index %}'}{%endif%}];
	
	// initialize toolbar and pass options and items
	CMS.Toolbar = new CMS.Toolbar('#cms_toolbar', {# toolbarconfig|safe #}{'items': items});

	// initialize placeholders and pass options
	CMS.Placeholders = new CMS.Placeholders('#cms_toolbar', {
		{% if edit %}edit_mode: true,{% endif %}
		{% if compact %}compact_mode: true,{% endif %}
		{% if page %}page_is_defined: true,{% endif %}
		data: '{{ placeholder_data }}', /* data will be required to check if this plugin is allowed to be moved to the desired placeholder */
		urls: {
			cms_page_move_plugin: '{% url admin:cms_page_move_plugin %}',
			cms_page_changelist: '{% url admin:cms_page_changelist %}',              
			cms_page_change_template: '{% if page %}{% url admin:cms_page_change_template page.pk %}{% else %}null{% endif %}',
			cms_page_add_plugin: '{% url admin:cms_page_add_plugin %}',
			cms_page_remove_plugin: '{% url admin:cms_page_remove_plugin %}'
		},
		lang: {
			move_slot: "{% trans 'Move to %(name)s' %}",
			move_warning: "{% trans 'The selected element can not be moved to the desired location.' %}",
			delete_request: "{% trans 'Are you sure you want to delete this plugin?' %}"
		}
	});
	
	// initialize security patch
	CMS.Security = new CMS.Security();
	CMS.Security.csrf();
});
//]]>
</script>

<div id="cms_toolbar" class="cms_reset" style="display:none;">
	<!-- start: toolbar -->
	<div class="cms_toolbar">
		<div id="cms_toolbar-toggle">
			<a href="#" class="cms_toolbar-btn cms_toolbar-btn_left">
				<span class="cms_toolbar-btn_right cms_toolbar_icon-toggle">
					<span class="cms_toolbar_icon">&nbsp;</span>
					<span class="cms_toolbar_icon-hide">{% trans "Show/Hide toolbar" %}</span>
				</span>
			</a>
		</div>
		<div id="cms_toolbar-toolbar">
			<div class="cms_toolbar-left"></div>
			<div class="cms_toolbar-right"></div>
		</div>
	</div>
	<!-- end: toolbar -->

	<!-- placeholder dimmer, loader and overlay -->
	<div id="cms_placeholder-dim"></div>
	<div id="cms_placeholder-content"><div class="cms_placeholder-content_inner cms_placeholder-content_loader"></div></div>
	<div id="cms_placeholder-overlay">
		<ul class="cms_placeholder-options">
			<li><a href="#" rel="drag">drag</a></li>
			<li><a href="#" rel="edit">edit</a></li>
			<li><a href="#" rel="moveup">up</a></li>
			<li><a href="#" rel="movedown">down</a></li>
			<li><a href="#" rel="settings">delete</a></li>
		</ul>
		<div class="cms_placeholder-overlay_bg"></div>
	</div>
	
	<!-- template: anchor -->
	{% include "cms/toolbar/items/anchor.html" %}
	
	<!-- template: switcher -->
	{% include "cms/toolbar/items/switcher.html" %}
	
	<!-- template: button -->
	{% include "cms/toolbar/items/button.html" %}
	
	<!-- template: list -->
	{% include "cms/toolbar/items/list.html" %}
	
	<!-- item: html - login -->
	{% include "cms/toolbar/items/login.html" %}
</div>