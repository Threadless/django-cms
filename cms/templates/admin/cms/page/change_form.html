{% extends "admin/change_form.html" %}
{% load i18n admin_modify adminmedia cms_tags %}
{% block title %}{% trans "Change a page" %}{% endblock %}

{% block extrahead %}
<script type="text/javascript" src="{% admin_media_prefix %}js/urlify.js"></script>
{{ block.super }}

{% endblock %}

{% block content_title %}
	<h1>{% if add %}{% trans "Add" %}{% else %}{% trans "Change" %}{% endif %} {% trans "page" %}</h1>
	{% if CMS_MODERATOR %}
		{% if moderation_required %}
			<h3>{% blocktrans %}This page must be moderated at level {{ moderation_level }}.{% endblocktrans %}</h3>
		{% else %}
			<h3>{% trans 'This page does not requires any moderation.' %}</h3>
		{% endif %}
	{% endif %}
{% endblock %}

{% block content %}<div id="content-main">
{% block object-tools %}
{% if change %}{% if not is_popup %}
  <ul class="object-tools">
  <li><a href="history/" class="historylink">{% trans "History" %}</a></li>
  {% if has_absolute_url %}<li><a href="{{ page.get_absolute_url }}?preview" class="viewsitelink">{% trans "View on site" %}</a></li>{% endif%}
  </ul>
{% endif %}{% endif %}
{% endblock %}
<form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="?language={{ language }}{%if request.GET.target %}&amp;target={{ request.GET.target }}{% endif %}&amp;{%if request.GET.target %}position={{ request.GET.position }}{% endif %}" method="post" id="page_form">{% block form_top %}{% endblock %}
{{ adminForm.fields.parent }}
<div>
{% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
{% if save_on_top %}{% submit_row %}{% endif %}
{% if errors %}
    <p class="errornote">
    {% blocktrans count errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
    </p>
    <ul class="errorlist">{% for error in adminform.form.non_field_errors %}<li>{{ error }}</li>{% endfor %}</ul>
{% endif %}

{% for fieldset in adminform %}
  {% include "admin/cms/page/includes/fieldset.html" %}
{% endfor %}

{% block after_field_sets %}{% if add %}
<p class="errornote">
    {% blocktrans %}You can add plugins only if you have saved the page.{% endblocktrans %}
    </p>{% endif %}
{% endblock %}

{% for inline_admin_formset in inline_admin_formsets %}
    {% include inline_admin_formset.opts.template %}
{% endfor %}


{% if CMS_PERMISSION and has_change_permissions_permission %}

<div class="inline-group">
	<div class="tabular inline-related">
		<fieldset id="inherited_permissions" class="module aligned collapse">
		  <h2>{% trans 'All permissions' %}</h2>
		  <div class="loading">{% trans 'Loading...' %}</div>
		</fieldset>
	</div>
</div>

<script type="text/javascript">
	$(function(){
		var loaded = false;
		$('#inherited_permissions > h2').click(function(){
			// reqest content - do it this way, so we can save some time which
			// this operation may need
			if (!loaded) {
				// load just once
				$('#inherited_permissions > div').load('./permissions/');
			}
			loaded = true;
			return false;	
		});
		
		$('#dialog').dialog({
			bgiframe: true,
			autoOpen: true,
			height: 300,
			modal: true,
			buttons: {
				'Create an account': function() {
					var bValid = true;
					allFields.removeClass('ui-state-error');

					if (bValid) {
						$('#users tbody').append('<tr>' +
							'<td>' + name.val() + '</td>' + 
							'<td>' + email.val() + '</td>' + 
							'<td>' + password.val() + '</td>' +
							'</tr>'); 
						$(this).dialog('close');
					}
				},
				Cancel: function() {
					$(this).dialog('close');
				}
			},
			close: function() {
				allFields.val('').removeClass('ui-state-error');
			}
			 
		});
	});
</script>

<div id="dialog" title="Approve dialog">
	<p>{% trans 'This page requires approvement by higher instance, please post a message
	if required' %}.</p>
	<textarea>sdfsdf</textarea>
</div>

{% endif %}

{% block after_related_objects %}{% endblock %}

{% submit_row %}

{% if add %}
   <script type="text/javascript">document.getElementById("{{ adminform.first_field.auto_id }}").focus();</script>
{% endif %}

{# JavaScript for prepopulated fields #}
{% prepopulated_fields_js %}

</div>
</form></div>
{% endblock %}